
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="a3ddc8a5-bec5-56eb-8c9d-df5af7c61c2b")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,9365163,4904548,e=>{"use strict";var t=e.i(6468255),l=e.i(6696646),n=e.i(5338940),i=e.i(1717203),a=e.i(7557283),r=e.i(4670733),s=e.i(588428),o=e.i(4396019),d=e.i(762945),c=e.i(7749291),u=e.i(9508212),m=e.i(8735244),h=e.i(1344973),p=e.i(2504781),x=e.i(6891161),g=e.i(455575),f=e.i(8522580),y=e.i(8761240),j=e.i(5756088),b=e.i(9386557),k=e.i(4004502),v=e.i(8042625),S=e.i(277234),T=e.i(4244280),A=e.i(5140444),C=e.i(4614946),D=e.i(5802506),w=e.i(6641571);e.i(9623499);var R=e.i(5576066),I=e.i(8815282),P=e.i(5229375);e.i(942336);var M=e.i(9668517);let L="[teamSlug]";var O=e.i(6060673),N=e.i(930810),E=e.i(7952834),_=e.i(1173672),B=e.i(8227242),F=e.i(9745887),$=e.i(3306538),H=e.i(5468328),z=e.i(9719784);function W(e){let{hidden:l,showIcon:n=!0,linkProps:i,defaultRoute:a}=e;return(0,t.jsx)(t.Fragment,{children:l.map(e=>(0,t.jsx)("div",{children:(0,t.jsx)(z.default,{defaultRoute:a,icon:n,title:e,truncate:!0,url:e,...i})},e))})}function U(e){let{hidden:l,linkProps:n}=e;return(0,t.jsx)(H.Tooltip,{text:(0,t.jsx)(W,{hidden:l,linkProps:n}),children:(0,t.jsx)($.Badge,{size:"sm",variant:"gray-subtle",children:`+${l.length}`})})}let G=function(e){let{className:l,defaultRoute:n,domains:i,firstOnly:a,showIcon:r=!0,style:s,linkProps:o}=e;if(!i)return(0,t.jsx)(h.Text,{as:"span",className:l,color:"gray-900",style:s,weight:400,children:"-"});let{visible:d,hidden:c}=i.reduce((e,t)=>(0===e.visible.length||!a&&1===e.visible.length&&e.visible[0].length<=20?e.visible.push(t):e.hidden.push(t),e),{visible:[],hidden:[]});return(0,t.jsx)(h.Text,{as:"span",className:l,weight:500,children:(0,t.jsxs)(u.Stack,{align:"center",direction:"row",gap:2,style:{display:"flex",maxWidth:"100%",alignItems:"stretch",...s},children:[d.map((e,l)=>{let i=l===d.length-1;return(0,t.jsx)(z.default,{defaultRoute:n,icon:r,style:{marginRight:i?void 0:"var(--geist-gap-half)",minWidth:0},truncate:!0,url:e,...o},e)}),c.length?(0,t.jsx)(U,{hidden:c,linkProps:o}):null]})})};e.s(["default",0,G],4904548);var V=e.i(8651268),Y=e.i(2547843);function q(){return(0,t.jsx)(x.Modal.Header,{children:(0,t.jsx)(x.Modal.Title,{center:!0,children:"Instant Rollback"})})}function K(e){let{setStage:l}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(x.Modal.Body,{children:[(0,t.jsx)(q,{}),(0,t.jsx)(h.Text,{as:"p",style:{marginBottom:"24px"},children:"Error: You must select a deployment to roll back."})]}),(0,t.jsx)(x.Modal.Actions,{children:(0,t.jsx)(x.Modal.Action,{fullWidth:!0,onClick:()=>{l("initial")},type:"secondary",children:"Back"})})]})}function X(){return(0,t.jsx)("div",{children:(0,t.jsx)(f.Note,{className:"bg-yellow-50 border-yellow-300 border text-amber-700",fill:!0,label:!1,type:"warning",variant:"contrast",children:(0,t.jsxs)(u.Stack,{align:"center",direction:"row",gap:4,style:{padding:4},children:[(0,t.jsx)(d.Warning,{style:{flexShrink:0}}),(0,t.jsxs)(u.Stack,{align:"start",children:[(0,t.jsx)(h.Text,{as:"p",color:"inherit",children:"Make sure the domains listed above are correct."}),(0,t.jsx)(h.Text,{as:"p",color:"inherit",children:"This deployment has custom aliases not included in the project's domain settings."})]})]})})})}function J(e){var i;let a,{hasFloatingAliases:o,onCancel:d,previousDeployment:m,productionAliases:g,productionDeployment:y,project:b,rollbackCandidates:v,setStage:S,selectedDeployment:T,setSelectedDeployment:A,deploymentSwr:C,rollbackReason:D,setRollbackReason:w}=e,I=(i="/[teamSlug]",a=(0,M.useTeamSlug)(),(0,l.useMemo)(()=>i.includes(L)?i.replace(`/${L}`,a?`/${a}`:""):i,[a,i])),[P,O]=(0,l.useState)(!1),{team:E}=(0,n.useTeam)(),_=!E||E.billing?.plan==="hobby",{value:B}=(0,r.useInstantRollbackHobbyRestrictionFlag)(),{value:$}=(0,s.useInstantRollbackHobbyRestrictionTeamFlag)();return v.length&&m&&T?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(x.Modal.Body,{children:[(0,t.jsx)(q,{}),(0,t.jsxs)(u.Stack,{gap:4,children:[(0,t.jsxs)(u.Stack,{gap:2,children:[(0,t.jsxs)(h.Text,{as:"p",size:16,children:["Rolling back"," ",(0,t.jsx)(G,{domains:g,firstOnly:!0,style:{display:"inline-flex",fontWeight:"500"}})]}),o?(0,t.jsx)(X,{}):null,(0,t.jsx)("div",{children:(0,t.jsx)(F.DeploymentCardSmall,{deployment:y,isProductionDeployment:!0,selectedDeployment:T,setSelectedDeployment:A})})]}),(0,t.jsxs)(u.Stack,{gap:2,children:[(0,t.jsx)(h.Text,{as:"p",size:16,children:"To the following deployment:"}),P?(0,t.jsx)("div",{children:(0,t.jsx)(N.ChooseDeploymentList,{deployments:v,previousDeployment:m,productionDeployment:y,rolledBackDeploymentId:b?.lastAliasRequest?.type==="rollback"?b.lastAliasRequest.fromDeploymentId:void 0,selectedDeployment:T,setSelectedDeployment:A,swr:C})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:(0,t.jsx)(F.DeploymentCardSmall,{deployment:T,isForm:P,isPreviousDeployment:T.uid===m.uid,selectedDeployment:T,setSelectedDeployment:A})}),(B||$)&&_?(0,t.jsx)(u.Stack,{style:{marginTop:"24px"},children:(0,t.jsx)(f.Note,{className:"bg-blue-50 border border-blue-500 text-blue-600",fill:!0,label:!1,size:"small",variant:"contrast",children:(0,t.jsxs)(u.Stack,{align:"center",direction:"row",gap:4,style:{padding:8},children:[(0,t.jsx)(j.LockClosed,{style:{transform:"translateX(1px)"}}),(0,t.jsxs)(u.Stack,{align:"start",direction:"column",children:[(0,t.jsx)(h.Text,{as:"p",color:"inherit",weight:500,children:"Looking for an earlier deployment?"}),(0,t.jsxs)("div",{children:[(0,t.jsx)(R.Link,{className:"inline-flex items-center justify-center gap-1 text-current no-underline",href:"/"===I?"/dashboard?createTeam=instant-rollback":`${I}?upgradeTeam=instant-rollback`,target:"_blank",children:(0,t.jsx)(h.Text,{as:"span",color:"inherit",children:"Upgrade to Pro"})}),(0,t.jsx)(c.ExternalSmall,{className:"ml-1"}),(0,t.jsx)(h.Text,{as:"span",color:"inherit",style:{whiteSpace:"nowrap"},children:"to roll back to an earlier deployment"})]})]})]})})}):(0,t.jsx)(p.Button,{onClick:()=>{O(!0)},type:"secondary",width:"100%",size:"small",children:"Choose another deployment"})]})]}),(0,t.jsxs)(u.Stack,{gap:2,children:[(0,t.jsx)(u.Stack,{as:"label",gap:1,htmlFor:"rollback-reason",children:(0,t.jsx)(h.Text,{as:"span",size:16,children:"Share a reason for this rollback:"})}),(0,t.jsx)(N.RollbackDescriptionTextarea,{value:D,onChange:w,id:"rollback-reason"})]})]})]}),(0,t.jsxs)(x.Modal.Actions,{children:[(0,t.jsx)(x.Modal.Action,{onClick:d,type:"secondary",children:"Cancel"}),(0,t.jsx)(x.Modal.Action,{"data-testid":(0,k.tid)("deployment","rollback-modal","continue-button"),disabled:D.length>=N.REASON_MAX_CHARACTER_LENGTH,onClick:()=>{S("selected")},children:"Continue"})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(x.Modal.Body,{children:[(0,t.jsx)(q,{}),(0,t.jsx)(h.Text,{as:"p",children:"This project does not have any valid deployments to roll back to."})]}),(0,t.jsx)(x.Modal.Actions,{children:(0,t.jsx)(x.Modal.Action,{onClick:d,type:"secondary",children:"Cancel"})})]})}function Q(e){let{selectedDeployment:l,setStage:n,requestRollback:i,project:a,rollbackReason:r,rollbackCandidates:s}=e,{user:o}=(0,A.useUser)();if(!l)return(0,t.jsx)(K,{setStage:n});let d=r.length>=N.REASON_MAX_CHARACTER_LENGTH,m=(0,N.getMostRecentlyPromotedDeployment)(s);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(x.Modal.Body,{children:[(0,t.jsx)(q,{}),(0,t.jsxs)(u.Stack,{gap:2,children:[(0,t.jsxs)(u.Stack,{gap:2,children:[(0,t.jsx)(h.Text,{size:16,children:"Rolling back to:"}),(0,t.jsx)(F.DeploymentCardSmall,{deployment:l,isPreviousDeployment:l.uid===m?.uid,selectedDeployment:l,setSelectedDeployment:()=>null})]}),r.trim()&&(0,t.jsx)(u.Stack,{gap:4,children:(0,t.jsx)(N.RollbackDescriptionCard,{rollbackDescription:{description:r.trim(),userId:o?.uid??"",username:o?.username??"",deploymentId:l.uid,projectId:a?.id??"",createdAt:new Date().getTime()},project:a,preview:!0})}),(0,t.jsxs)(w.UL,{className:"mb-0",children:[(0,t.jsx)(w.LI,{children:"Instant Rollback assigns domains to a previous deployment. All Environment Variables from the original build will remain. Cron jobs will be reverted to the state of the previous deployment."}),(0,t.jsxs)(w.LI,{children:[(0,t.jsxs)(R.Link,{className:"inline-flex items-center text-[var(--geist-success)] no-underline",href:`https://${l.url}`,target:"_blank",children:["View the selected deployment ",(0,t.jsx)(c.ExternalSmall,{className:"ml-1"})]})," ","before rolling back—external APIs, databases, and CMS platforms may not behave as expected."]}),(0,t.jsx)(w.LI,{children:"You can update the rollback reason from the project overview."})]}),(a?.autoAssignCustomDomains??!0)||a?.lastAliasRequest?.type==="rollback"?(0,t.jsx)(f.Note,{fill:!0,type:"secondary",children:(0,t.jsx)(u.Stack,{align:"center",direction:"row",gap:4,children:(0,t.jsx)(u.Stack,{align:"start",children:(0,t.jsx)(h.Text,{as:"p",color:"inherit",children:"After rolling back, production deployments will not be automatically promoted until the rollback is removed."})})})}):null]})]}),(0,t.jsxs)(x.Modal.Actions,{children:[(0,t.jsx)(x.Modal.Action,{onClick:()=>{n("initial")},type:"secondary",children:"Back"}),(0,t.jsx)(x.Modal.Action,{"data-testid":(0,k.tid)("deployment","rollback-modal","rollback-button"),disabled:d,onClick:()=>{i(l.uid),n("processing")},children:"Confirm Rollback"})]})]})}function Z(e){let{jobStatus:n,rollbackDeploymentId:i,rollbackCandidates:a,selectedDeployment:r,setStage:s,onCancel:o,statusSwr:d,requestRollback:c,rollbackReason:g}=e,{user:f}=(0,A.useUser)();if((0,l.useEffect)(()=>{i===r?.uid&&("failed"===n?s("error"):"succeeded"===n&&s("done"))},[i,n,r,s]),!r)return(0,t.jsx)(K,{setStage:s});let j=(0,N.getMostRecentlyPromotedDeployment)(a);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(x.Modal.Body,{children:[(0,t.jsx)(q,{}),(0,t.jsxs)(u.Stack,{gap:2,children:[(0,t.jsxs)(u.Stack,{gap:2,children:[(0,t.jsx)(h.Text,{children:"Assigning production domains:"}),(0,t.jsx)(F.DeploymentCardSmall,{deployment:r,isPreviousDeployment:r.uid===j?.uid,selectedDeployment:r,setSelectedDeployment:()=>null})]}),""!==g?(0,t.jsxs)("div",{className:"rounded bg-background-200 px-4 py-3 shadow-border",children:[(0,t.jsxs)(h.Text,{color:"gray-900",children:["“",(0,t.jsx)(B.LinkParser,{text:g.trim()}),"”"]}),(0,t.jsxs)("div",{className:"flex gap-1 pt-1",children:[(0,t.jsx)(h.Text,{children:"Rolled back by"}),f?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(V.PrincipalAvatar,{size:20,principalId:f.uid,principal:{type:"user",uid:f.uid,username:f.username}}),(0,t.jsx)(h.Text,{children:f.username})]}):null]})]}):null,(0,t.jsxs)(w.UL,{className:"mx-4 my-0 list-none pt-2",children:[d.aliases.map(e=>{let l="loading";return"completed"===e.status?l="success":"failed"===e.status&&(l="error"),(0,t.jsx)(w.LI,{children:(0,t.jsxs)("div",{style:{height:"24px",display:"flex"},children:["loading"===l&&(0,t.jsx)(m.Spinner,{size:24}),"error"===l&&(0,t.jsx)(b.WarningFill,{color:"amber-800",size:24}),"success"===l&&(0,t.jsx)(y.CheckCircleFill,{color:"blue-700",size:24}),(0,t.jsx)(h.Text,{as:"span",style:{lineHeight:"24px",paddingLeft:"7px"},children:e.alias})]})},e.alias)}),!d.isReachingEnd&&d.initialDataLoaded?(0,t.jsx)(w.LI,{children:(0,t.jsx)(p.Button,{loading:d.isLoadingMore,onClick:()=>{d.loadMore()},style:{marginTop:24},type:"secondary",width:"100%",children:"Show More"})}):null]})]})]}),(0,t.jsx)(x.Modal.Actions,{children:(0,t.jsx)(x.Modal.Action,{"data-testid":(0,k.tid)("deployment","rollback-modal","finish-button"),fullWidth:!0,loading:"failed"!==n&&"succeeded"!==n,onClick:()=>{"failed"===n?c(r.uid):"succeeded"===n&&(s("initial"),o())},children:"failed"===n?"Retry":"Done"})})]})}function ee(e){let{active:i,initialSelectedDeployment:a,onCancel:r,productionBranch:s,productionDeployment:o,projectId:d,rollbackCandidates:c,swr:u,rollbackDescription:m}=e,{mutate:h}=(0,C.useSWRConfig)(),[p,f]=(0,l.useState)("initial"),[y,j]=(0,l.useState)(""),{isReady:b,team:A}=(0,n.useTeam)(),w=(0,g.useToasts)(),R=(0,l.useMemo)(()=>{let e=c.filter(e=>e.uid!==o.id);return(0,N.getMostRecentlyPromotedDeployment)(e)},[c,o]),[M,L]=(0,l.useState)(null),B=M??a??R??null,F=(0,l.useCallback)(f,[f]),$=(0,l.useCallback)(L,[L]),[,{aliases:H}]=(0,P.useAliasesInfinite)({rollbackDeploymentId:o.id}),{data:z}=(0,O.useProject)(d),{lastAliasRequest:W,hasFloatingAliases:U}=z||{lastAliasRequest:void 0,hasFloatingAliases:!1},{toDeploymentId:G,jobStatus:V}=W||{toDeploymentId:null,jobStatus:null},[,q]=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,{isReady:a,team:r}=(0,n.useTeam)(),s=(0,I.default)((t,l)=>{if(!a)return null;let n={teamId:r?.id,limit:i};return t?l?.next?`${(0,T.API_PROJECTS_ROLLBACK_ALIAS_STATUS)(e)}${(0,v.encode)({...n,until:l.next})}`:null:`${(0,T.API_PROJECTS_ROLLBACK_ALIAS_STATUS)(e)}${(0,v.encode)(n)}`},e=>(0,S.fetchAPI)(e,{throwOnHTTPError:!0}),{refreshInterval:t}),o=(0,l.useMemo)(()=>s.data?[].concat(...s.data.filter(Boolean).map(e=>e.aliases.slice(0,i))):[],[s.data,i]),d=!!s.data,c=d&&0===o.length,u=d&&s.data&&s.size>s.data.length,m=d&&s.data&&s.data[s.data.length-1]?.aliases.length<i;return[s,{aliases:o,initialDataLoaded:d,isEmpty:c,loadMore:()=>s.setSize(e=>e+1),isLoadingMore:u,isReachingEnd:m,mutate:s.mutate}]}(d,2e3),K=(0,l.useMemo)(()=>o,[i]),X=()=>{f("initial"),L(a||R||null),r()},ee=(0,l.useCallback)(async e=>{if(!b)return;let t=`${(0,T.API_DEPLOYMENT_ROLLBACK)(d,e)}${(0,v.encode)({teamId:A?.id,description:y.trim()})}`;try{await (0,S.fetchAPI)(t,{throwOnHTTPError:!0,method:"POST",body:{}}),A&&(void 0!==z&&(0,E.revalidateProject)(h,z),await h((0,_.getProjectProductionDeploymentKey)({projectIdOrName:d,teamId:A.slug})),h((0,Y.getRollingReleaseEndpoint)(A.slug,d)))}catch(e){w.error({text:"Something went wrong - please try requesting an Instant Rollback again",key:"rollback-deployment"}),(0,D.captureError)(e)}},[b,d,w,y,h,A,z]),et={rollbackDeploymentId:G,hasFloatingAliases:!!U,jobStatus:V,onCancel:X,previousDeployment:R,productionBranch:s,productionDeployment:K,productionAliases:H.map(e=>{let{alias:t}=e;return t}),project:z,rollbackCandidates:c,setStage:F,selectedDeployment:B,setSelectedDeployment:$,deploymentSwr:u,statusSwr:q,requestRollback:ee,rollbackWarningText:"New deployments will not be automatically assigned production domains until this rollback is removed.",rollbackReason:y,setRollbackReason:j,rollbackDescription:m};return(0,t.jsxs)(x.Modal.Modal,{active:i,"data-testid":(0,k.tid)("deployment","rollback-modal"),onClickOutside:X,sticky:!0,width:"500px",children:["initial"===p&&(0,t.jsx)(J,{...et}),"selected"===p&&(0,t.jsx)(Q,{...et}),["processing","error","done"].includes(p)&&(0,t.jsx)(Z,{...et})]})}var et=e.i(5771992),el=e.i(5645345),en=e.i(3981247);e.i(3182268);var ei=e.i(7849855);function ea(e){let{team:t}=(0,n.useTeam)(),i=!t||t.billing?.plan==="hobby",{value:a}=(0,r.useInstantRollbackHobbyRestrictionFlag)(),{value:d}=(0,s.useInstantRollbackHobbyRestrictionTeamFlag)(),c=a||d,u=e?.name,{deployment:m,isLoading:h}=(0,o.useProjectProductionDeployment)(u);return(0,l.useMemo)(()=>{let t=(0,el.asListDeployment)(e),l=i&&!t?.isRollbackCandidate;return t?h?"Loading…":"readyState"in t&&"READY"!==t.readyState?"Only Deployments that are Ready can be rolled back.":"readySubstate"in t&&"PROMOTED"!==t.readySubstate?"Only Deployments previously aliased to a Production domain can be rolled back.":t.uid===m?.id?"This Deployment is already in Production.":c?t.isRollbackCandidate||"production"===t.target?l?"Hobby customers can only roll back to the previous deployment.":"":"Only Deployments previously aliased to a Production domain can be rolled back.":t.isRollbackCandidate?"":"Only Deployments previously aliased to a Production domain can be rolled back.":""},[e,i,h,m?.id,c])}function er(e){let{onClose:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},[r,s]=(0,l.useState)(!1),[d,c]=(0,l.useState)(),{teamSlug:u,projectSlug:m}=(0,ei.useProjectAndTeamSlug)(),{data:h}=(0,O.useProject)(d?.name),p=m??d?.name,x=e??h,{data:g}=(0,en.useRollingRelease)({teamIdOrSlug:u,projectSlug:p}),f=g?.rollingRelease?g?.rollingRelease?.canaryDeployment?.id:void 0,{deployment:y,rollbackDescription:j,mutate:b}=(0,o.useProjectProductionDeployment)(x?.name),{can:k}=(0,i.default)({projectIdOrName:x?.name}),v=k(a.Action.Create,a.Resource.DeploymentRollback),S=x?.link?.productionBranch?x.link.productionBranch:void 0,[T,A]=(0,et.useDeploymentsInfinite)({projectId:x?x.id:"",requireProject:!0,limit:10,rollbackCandidate:!0},{}),{deployments:C,initialDataLoaded:D}=A,w=C.filter(e=>!!e.isRollbackCandidate&&e.uid!==f),R=!!(D&&x&&!w.length),I=(0,l.useCallback)(e=>{c((0,el.asListDeployment)(e)),s(!0)},[]),P=(0,l.useCallback)(()=>{s(!1),b().finally(()=>null),n?.()},[b,n]);return{rollbackModal:(0,l.useMemo)(()=>v&&r&&y&&x?(0,t.jsx)(ee,{active:r,initialSelectedDeployment:d,onCancel:P,productionBranch:S,productionDeployment:y,projectId:x.id,rollbackCandidates:w,rollbackDescription:j,swr:A}):null,[v,r,d,S,y,w,x,A,P,j]),closeRollbackModal:P,openRollbackModal:I,canRollbackDeployment:v,noRollbackCandidates:R}}e.s(["useInstantRollbackModal",()=>er,"useRollbackTooltip",()=>ea],9365163)},3981247,e=>{"use strict";var t=e.i(3911483),l=e.i(2547843);function n(e){let{teamIdOrSlug:t,projectSlug:l}=e;return i({teamIdOrSlug:t,projectSlug:l},{suspense:!0,revalidateOnMount:!1})}function i(e,n){let{teamIdOrSlug:i,projectSlug:a}=e,r=!i||!a,s=(0,t.default)(()=>r?null:(0,l.getRollingReleaseEndpoint)(i,a),l.rollingReleaseFetcher,n);return{...s,skipped:r,isLoading:!r&&s.isLoading}}e.s(["useRollingRelease",()=>i,"useSuspenseRollingRelease",()=>n])},4443312,e=>{"use strict";var t=e.i(4603164),l=e.i(5338940);function n(e){let{deploymentId:n,swrOptions:i,enableCiChecksAndPolicies:a}=e,{team:r}=(0,l.useTeam)();return(0,t.useTypedSWR)("/v2/deployments/{deploymentId}/check-runs",a&&n&&r?.id?{deploymentId:n,teamId:r.id}:null,{refreshInterval:3e3,...i})}e.s(["CHECK_RUNS_REFRESH_INTERVAL",0,3e3,"useProjectCheckRuns",()=>n])},930810,9745887,e=>{"use strict";var t=e.i(6468255),l=e.i(1344973),n=e.i(2504781),i=e.i(9334091),a=e.i(3306538),r=e.i(9508212),s=e.i(57106),o=e.i(3753138),d=e.i(6226725),c=e.i(4345845),u=e.i(8893913),m=e.i(7218483),h=e.i(9722978),p=e.i(9375869),x=e.i(8529990),g=e.i(3907048);function f(e){let{isForm:l,children:n,className:i}=e;return l?(0,t.jsx)("label",{className:i,children:n}):(0,t.jsx)("div",{className:i,children:n})}function y(e){let{deployment:n,isForm:i,isPromote:y,isPreviousDeployment:j,isProductionDeployment:b,isRolledBackDeployment:k,selectedDeployment:v,setSelectedDeployment:S,ariaLabel:T="Rollback Deployment"}=e,A=(0,m.useAgo)(n.createdAt||0),C="number"==typeof n.aliasAssigned?n.aliasAssigned:0,D=C>0,w=(0,m.useAgo)(C),R=(0,p.useDeploymentLink)(n),I=(0,x.getGitInfoFromDeployment)(n),P=b||j||k;j&&k&&(j=!1);let M="Preview";if("target"in n)switch(n.target){case"staging":M="Staging";break;case"production":M="Production";break;default:M="Preview"}else M="Production";let L="uid"in n?n.uid:n.id,O=null;y?I?.commitRef&&(O=(0,t.jsxs)(r.Stack,{align:"center",direction:"row",gap:.5,children:[(0,t.jsx)(c.GitBranch,{color:"gray-900"}),(0,t.jsx)(l.Text,{as:"span",color:"gray-900",monospace:!0,style:{marginRight:"4px",maxWidth:120,textOverflow:"ellipsis",overflowX:"hidden",minWidth:0},title:I.commitRef,truncate:!0,wrap:!1,children:I.commitRef}),(0,t.jsxs)(l.Text,{as:"span",className:"flex items-center gap-1",color:"gray-900",style:{flexBasis:"50%",flexShrink:0,flexGrow:1,textOverflow:"ellipsis",overflowX:"hidden",minWidth:0,maxWidth:260},truncate:!0,wrap:!1,children:["Staged"," ",A," by"," ",(0,t.jsx)("span",{children:(0,t.jsx)(g.CreatorAvatar,{deployment:n,showProviderIcon:!0,size:24})}),(0,t.jsx)("span",{children:!n.meta?.originalDeploymentId&&n.creator?.username?n.creator.username:I.commitAuthorLogin})]})]})):O=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"inline-flex flex-row items-center",children:[(0,t.jsx)(l.Text,{as:"span",color:"gray-900",size:14,style:{marginRight:"4px"},children:M}),I?.commitRef?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.GitBranch,{color:"gray-900",size:14}),(0,t.jsx)(l.Text,{as:"span",className:"max-w-[100px] truncate whitespace-nowrap px-1 text-center text-sm leading-5 text-gray-900",monospace:!0,title:I.commitRef,children:I.commitRef}),(0,t.jsx)(l.Text,{as:"span",color:"gray-900",children:"by"}),(0,t.jsxs)("div",{className:"ml-1 inline-flex flex-row items-center gap-1",children:[(0,t.jsx)(g.CreatorAvatar,{deployment:n,size:20}),(0,t.jsx)(l.Text,{as:"span",className:"max-w-[140px] truncate",color:"gray-900",truncate:!0,children:!n.meta?.originalDeploymentId&&n.creator?.username?`${n.creator.username}`:I.commitAuthorLogin})]})]}):null]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)(l.Text,{as:"span",color:"gray-900",size:14,children:["Deployed"," "]}),(0,t.jsx)(l.Text,{as:"span",color:"gray-900",size:14,children:A}),(0,t.jsxs)(l.Text,{as:"span",color:"gray-900",size:14,children:[","," "]}),D?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(l.Text,{as:"span",color:"gray-900",size:14,children:["promoted"," "]}),(0,t.jsx)(l.Text,{as:"span",color:"gray-900",size:14,children:w})]}):(0,t.jsx)(l.Text,{as:"span",color:"gray-900",size:14,children:"never promoted"})]})]});let N=null;return i||(N=y?(0,t.jsx)(o.ArrowCircleUp,{className:"mr-4 hidden self-center sm:block",style:{flexShrink:0}}):b?(0,t.jsx)(d.CrossCircle,{className:"mr-4 hidden self-center sm:block",style:{flexShrink:0}}):(0,t.jsx)(u.RotateCounterClockwise,{className:"mr-4 hidden self-center sm:block",color:"gray-1000",style:{flexShrink:0}})),(0,t.jsxs)(f,{className:(0,h.clsx)("flex w-full items-end justify-start px-4 py-3","rounded border border-solid border-[var(--accents-2)]","rounded-b-none","last:rounded-b","[&+&]:rounded-t-none [&+&]:border-t-0",{"bg-[var(--accents-1)] shadow-none":b,"bg-[var(--geist-background)]":!b}),isForm:i,children:[i?(0,t.jsx)("input",{"aria-label":T,checked:v?.uid===L,className:`
            relative m-0 mr-4 size-4 shrink-0 appearance-none
            self-center rounded-[1000px] border
            border-solid border-[var(--geist-foreground)] after:absolute after:inset-[3px]
            after:rounded-[1000px] after:bg-[var(--geist-foreground)]
            after:content-none checked:after:content-['']
          `,name:"rollbackDeployment",onChange:()=>{"uid"in n&&"type"in n&&S&&S(n)},type:"radio",value:L}):N,(0,t.jsxs)("div",{style:{width:P?"initial":"100%",minWidth:0},children:[(0,t.jsx)(s.Link,{className:"flex w-[calc(100%-1ch)] items-center gap-0.5 break-all text-sm font-bold leading-5",href:R,target:"_blank",children:(0,t.jsx)(l.Text,{as:"span",title:n.url,truncate:1,weight:500,children:n.url})}),I?.commitMessage?(0,t.jsxs)(l.Text,{as:"p",className:"break-words",color:"gray-900",size:14,title:I.commitMessage,truncate:1,children:[I.commitSha.substring(0,7)," ",I.commitMessage]}):null,O]}),b?(0,t.jsx)(a.Badge,{className:"ml-auto hidden self-start text-xs font-medium sm:inline-flex",variant:"inverted",children:"Current"}):null,j?(0,t.jsx)(a.Badge,{className:"ml-auto hidden self-start text-xs font-medium sm:inline-flex",variant:"gray-subtle",children:"Previous"}):null,k?(0,t.jsx)(a.Badge,{className:"ml-auto hidden self-start text-xs font-medium sm:inline-flex",variant:"red-subtle",children:"Rolled back"}):null]})}e.s(["DeploymentCardSmall",()=>y],9745887);var j=e.i(8227242),b=e.i(8651268);function k(e){return"id"in e?e.id:"uid"in e?e.uid:void 0}function v(e){return void 0!==e.deleted}function S(e){let{rollbackDescription:n,project:i,preview:a}=e,r=(0,m.useAgo)(n.createdAt);return(0,t.jsxs)("div",{className:"px-4 py-3 rounded bg-background-200 shadow-border",children:[(0,t.jsx)(l.Text,{className:"break-words",color:"gray-900",children:n.description.length>0?(0,t.jsxs)(t.Fragment,{children:["“",(0,t.jsx)(j.LinkParser,{text:n.description}),"”"]}):(0,t.jsx)(l.Text,{children:"No reason provided."})}),(0,t.jsxs)("div",{className:"flex gap-1 pt-1",children:[a?null:(0,t.jsx)(l.Text,{children:"Rolled back by"}),n.username?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b.PrincipalAvatar,{size:20,principalId:n.userId,principal:{type:"user",uid:n.userId,username:n.username}}),(0,t.jsx)(l.Text,{children:n.username}),i?.lastAliasRequest!==void 0&&!a&&(0,t.jsx)(l.Text,{children:r})]}):null]})]})}function T(e){let{deployments:l,previousDeployment:i,rolledBackDeploymentId:a,productionDeployment:r,selectedDeployment:s,setSelectedDeployment:o,swr:d,ariaLabel:c}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:l.map(e=>r.id!==e.uid&&(0,t.jsx)(y,{deployment:e,isForm:!0,isPreviousDeployment:i?.uid===e.uid,isRolledBackDeployment:a===e.uid,selectedDeployment:s,setSelectedDeployment:o,ariaLabel:c},e.uid))}),!d.isReachingEnd&&(0,t.jsx)(n.Button,{loading:d.isLoadingMore,onClick:()=>{d.loadMore()},style:{marginTop:24},type:"secondary",width:"100%",children:"Show More"})]})}function A(e){if(0===e.length)return;let t=e.reduce((e,t)=>e.aliasAssigned&&t.aliasAssigned?e.aliasAssigned>t.aliasAssigned?e:t:t.aliasAssigned?t:e);if(t.aliasAssigned)return t}function C(e){let{value:l,onChange:n,id:a}=e;return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(i.Textarea,{autoFocus:!0,className:"text-base min-h-24",error:l.length>=250?"Reason cannot be longer than 250 characters.":void 0,id:a,onChange:e=>n(e.target.value),placeholder:"Production is not behaving as expected…",required:!0,value:l,style:{fontSize:14}})})}e.s(["ChooseDeploymentList",()=>T,"REASON_MAX_CHARACTER_LENGTH",0,250,"RollbackDescriptionCard",()=>S,"RollbackDescriptionTextarea",()=>C,"getDeploymentId",()=>k,"getMostRecentlyPromotedDeployment",()=>A,"isDeleted",()=>v],930810)},6619197,5645345,e=>{"use strict";var t=e.i(6468255),l=e.i(6696646),n=e.i(8248823),i=e.i(9100551),a=e.i(57106),r=e.i(3869281),s=e.i(4030453),o=e.i(2455417),d=e.i(6891161),c=e.i(8522580),u=e.i(5255926),m=e.i(9318197),h=e.i(9508212),p=e.i(1344973),x=e.i(455575),g=e.i(8761240),f=e.i(472117),y=e.i(4004502),j=e.i(8042625),b=e.i(277234),k=e.i(4244280),v=e.i(4443312),S=e.i(5140444),T=e.i(5338940),A=e.i(4614946),C=e.i(4450569),D=e.i(4396019),w=e.i(9375869),R=e.i(8518548);function I(e){if(!e)return;if("id"in e==!1)return e;let{aliasAssigned:t,aliasError:l=null,aliasAssignedAt:n,buildingAt:i,created:a=e.createdAt,createdAt:r,creator:s,name:o,ready:d,readyState:c,readySubstate:u,target:m=null,uid:h=e.id,url:p,isRollbackCandidate:x="production"===e.target}=e;return{aliasAssigned:t,aliasError:l,aliasAssignedAt:n,buildingAt:i,created:a,createdAt:r,creator:{email:"",githubLogin:"",...s},name:o,ready:d,readyState:c,readySubstate:u,target:m,type:"LAMBDAS",uid:h,url:p,isRollbackCandidate:x}}e.s(["asListDeployment",()=>I],5645345);var P=e.i(1840726),M=e.i(930810),L=e.i(7952834),O=e.i(1173672),N=e.i(9745887),E=e.i(3008300),_=e.i(3981247),B=e.i(6060673);function F(e){let t=e?.name,{deployment:n,isLoading:i}=(0,D.useProjectProductionDeployment)(t);return(0,l.useMemo)(()=>{let t=I(e);return t?i?"Loading…":t.uid===n?.id?"This Deployment is already in Production.":"readyState"in t&&"READY"!==t.readyState?"Only Deployments that are Ready can be promoted.":"":""},[e,i,n?.id])}function $(e){let{title:l}=e;return(0,t.jsx)(d.Modal.Header,{children:(0,t.jsx)(d.Modal.Title,{center:!0,children:l})})}function H(e){let{deploymentId:l}=e,n=(0,f.useChecksPrivateBetaFlag)(),i=(0,f.useCiChecksAndPoliciesFlagV2)(),r=n||i,{data:s,isLoading:o}=(0,v.useProjectCheckRuns)({deploymentId:l,enableCiChecksAndPolicies:r});if(!r)return null;if(o)return(0,t.jsx)(u.Skeleton,{});if(s?.runs.every(e=>"succeeded"===e.conclusion))return null;let d=s?.runs.filter(e=>"succeeded"!==e.conclusion)||[];return(0,t.jsxs)(c.Note,{type:"error",fill:!0,className:"mt-6",children:["By clicking Promote, you acknowledge that you are bypassing promotion requirements:",d.length>0&&(0,t.jsx)("ul",{className:"flex flex-col gap-1 ml-4 list-disc",children:d.slice(0,5).map(e=>(0,t.jsx)("li",{children:e.externalUrl?(0,t.jsx)(a.Link,{href:e.externalUrl,external:!0,children:e.name}):(0,t.jsx)("span",{children:e.name})},e.id||e.name||`${e.conclusion}-${e.status}`))})]})}function z(e,n){let{onDeploymentPromoted:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},[u,x]=(0,l.useState)(!1),[f,j]=(0,l.useState)(null),{team:b}=(0,T.useTeam)(),k=e??f?.name,{data:v}=(0,B.useProject)(k),A=n??v,w=(0,P.useShowIgnoreBuildStep)({project:A,deployment:f}),[I,L]=(0,l.useState)(E.DEFAULT_USE_IGNORE_BUILD_STEP_PROMOTE),O=(0,l.useCallback)(()=>{x(!1)},[]),{error:F,loading:z,promote:U,setError:G,setLoading:V}=W({deployment:f,useIgnoreBuildStep:I,project:A,onCurrentDeploymentPromoted:(0,l.useCallback)(()=>{O(),i?.()},[O,i])}),{user:Y}=(0,S.useUser)(),{data:q}=(0,_.useRollingRelease)({teamIdOrSlug:b?.slug,projectSlug:k}),K=A?.rollingRelease?.stages!==void 0&&A.rollingRelease.stages.length>0,X=q?.rollingRelease?.state==="ACTIVE",J=q?.rollingRelease?.canaryDeployment?.id,Q=X&&J===f?.uid,Z=K&&!X&&f?.target==="production",ee=K&&X&&f?.target==="production",et=Z&&A.rollingRelease?.stages!==void 0?A.rollingRelease.stages[0]?.targetPercentage:null,{data:el}=(0,R.useProjectDomains)(k,{limit:11,production:"true",redirects:"false",verified:"true",order:"ASC"}),en=(0,l.useCallback)(e=>{j(e),x(!0)},[]),ei=(0,l.useCallback)(()=>{V(!1),j(null),G(void 0)},[G,V]),{rollbackDescription:ea,deploymentIsStale:er}=(0,D.useProjectProductionDeployment)(A?.name),{andMoreDomains:es,remainingDomains:eo}=(0,l.useMemo)(()=>{if(!el)return{andMoreDomains:!1,remainingDomains:[]};let e=el.length>2,t=e?el.slice(2).map(e=>e.name):[];return{andMoreDomains:e,remainingDomains:t}},[el]),ed=(0,l.useMemo)(()=>{if(!A||!f)return(0,t.jsx)(C.default,{center:!0,style:{marginTop:10},children:(0,t.jsx)(o.LoadingDots,{size:4})});let e=!!(el&&el.length>0);return(0,t.jsxs)(t.Fragment,{children:["production"===f.target?(0,t.jsx)(p.Text,{as:"p",style:{marginBottom:"16px"},weight:400,children:"Deployment to promote:"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.Text,{as:"p",style:{marginBottom:"16px"},children:"A new deployment will be built using your production environment."}),(0,t.jsx)(p.Text,{as:"p",style:{marginBottom:"16px"},weight:400,children:"Deployment to promote to production:"})]}),(0,t.jsx)("div",{children:(0,t.jsx)(N.DeploymentCardSmall,{deployment:f,isPromote:!0,selectedDeployment:null})}),Z?(0,t.jsxs)(p.Text,{as:"p",style:{marginBottom:16,marginTop:24},children:["This will start a new rolling release with initial traffic of"," ",et,"%."]}):null,ee?(0,t.jsx)(p.Text,{as:"p",style:{marginBottom:16,marginTop:24},children:"This will queue the deployment for promotion after the current rolling release completes."}):null,Z||ee||!e?null:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.Text,{as:"p",style:{marginBottom:16,marginTop:24},weight:400,children:"It will be aliased to the following domains:"}),(0,t.jsx)(h.Stack,{gap:2,style:{paddingLeft:12},children:el?.slice(0,2).map(e=>{let{name:l}=e;return(0,t.jsx)(p.Text,{as:"p",children:(0,t.jsxs)(h.Stack,{align:"center",direction:"row",gap:3,children:[(0,t.jsx)(g.CheckCircleFill,{color:"blue-700",size:20}),(0,t.jsx)("span",{children:l.startsWith("*")?l:(0,t.jsx)(a.Link,{"data-testid":(0,y.tid)("deployments","promote-to-production-overlay","preview-link"),external:!0,href:`https://${l}`,variant:"highlight",children:l})})]})},l)})}),es?(0,t.jsxs)(p.Text,{as:"p",className:"mt-6 mb-4",children:["...and ",eo.length," more"]}):null]}),!Z&&!e&&(0,t.jsxs)(p.Text,{as:"p",style:{marginBottom:"24px",marginTop:"24px"},children:["Warning: Your Project does not have a Production Domain. We recommend you"," ",(0,t.jsx)(a.Link,{href:`/${b?b.slug:Y?.username}/${encodeURIComponent(A.name)}/settings/domains`,variant:"highlight",children:"add"})," ","one."]}),A.link&&f.gitSource?(0,t.jsx)(H,{deploymentId:f.id}):null,w?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.Spacer,{y:1}),(0,t.jsx)(r.Checkbox,{checked:I,fullWidth:!0,onChange:()=>{L(!I)},children:"Use project's Ignore Build Step"})]}):null,Q?(0,t.jsx)(c.Note,{className:" border border-[#fde68a] bg-[#fffbeb] text-[#bd5200] dark:border-[#411d06] dark:bg-[#241005] dark:text-[#fde68a] ",fill:!0,size:"small",style:{marginTop:24},type:"warning",variant:"contrast",children:(0,t.jsx)(h.Stack,{align:"center",direction:"row",gap:4,style:{padding:1},children:(0,t.jsx)(h.Stack,{align:"start",children:(0,t.jsx)(p.Text,{as:"p",color:"inherit",children:"This will complete the rolling release for this deployment."})})})}):null,er?(0,t.jsx)(c.Note,{className:" border border-[#fde68a] bg-[#fffbeb] text-[#bd5200] dark:border-[#411d06] dark:bg-[#241005] dark:text-[#fde68a] ",fill:!0,size:"small",style:{marginTop:24},type:"warning",variant:"contrast",children:(0,t.jsx)(h.Stack,{align:"center",direction:"row",gap:4,style:{padding:1},children:(0,t.jsx)(h.Stack,{align:"start",children:(0,t.jsx)(p.Text,{as:"p",color:"inherit",children:Z?"Completing the Rolling Release will undo the current Instant Rollback":"This action will undo the current Instant Rollback"})})})}):null,ea?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.Text,{as:"p",style:{marginBottom:16,marginTop:24},children:"Rollback Details:"}),(0,t.jsx)(M.RollbackDescriptionCard,{rollbackDescription:ea,project:A})]}):null]})},[es,eo,el,A,b,Y,f,I,w,er,ea,et,Z,ee,Q]),ec=(0,l.useMemo)(()=>(0,t.jsx)(d.Modal.Action,{"data-testid":(0,y.tid)("deployments","promote-to-production-overlay","confirm-button"),loading:z,onClick:U,children:f&&"target"in f&&"production"===f.target?"Promote":"Promote to Production"}),[U,z,f]);return{modal:(0,l.useMemo)(()=>(0,t.jsxs)(d.Modal.Modal,{active:u,"data-testid":(0,y.tid)("deployments","promote-to-production-overlay"),onAnimationDone:ei,onClickOutside:O,sticky:!0,width:"500px",children:[(0,t.jsxs)(d.Modal.Body,{children:[(0,t.jsx)($,{title:ee?"Queue for Promotion":f&&"target"in f&&"production"!==f.target?"Promote to Production":"Promote"}),ed,F?(0,t.jsx)(s.Error,{error:F}):null]}),(0,t.jsxs)(d.Modal.Actions,{children:[(0,t.jsx)(d.Modal.Action,{"data-testid":(0,y.tid)("deployments","promote-to-production-overlay","cancel-button"),loading:!1,onClick:O,type:"secondary",children:"Cancel"}),ec]})]}),[u,ei,O,ed,F,ec,ee,f]),close:O,open:en}}let W=e=>{let{deployment:t,project:a,useIgnoreBuildStep:r,onCurrentDeploymentPromoted:s}=e,o=(0,x.useToasts)(),d=(0,i.useRouter)(),{team:c}=(0,T.useTeam)(),{user:u}=(0,S.useUser)(),{mutate:m}=(0,A.useSWRConfig)(),[h,p]=(0,l.useState)(!1),[g,f]=(0,l.useState)(void 0),y=(0,P.useShowIgnoreBuildStep)({project:a,deployment:t});return{promote:(0,l.useCallback)(async()=>{if(t&&a){p(!0),f(void 0);try{let e,l=c?.id,n="Promoted Deployment successfully.";if("production"===t.target)await (0,b.fetchAPI)(`${(0,k.API_DEPLOYMENT_PROMOTE)(a.id,t.uid||t.id)}${(0,j.encode)({teamId:l})}`,{method:"POST",body:{},throwOnHTTPError:!0}),e=(0,w.pathFromDeployment)(t,{user:u,team:c});else{let i=await (0,b.fetchAPI)(`${(0,k.API_DEPLOYMENTS)("v13")}${(0,j.encode)({teamId:l,skipIgnoreBuildStep:y&&!r?"1":null})}`,{method:"POST",body:JSON.stringify({deploymentId:t.uid||t.id,meta:{action:"promote"},name:a.name,target:"production"}),throwOnHTTPError:!0});e=(0,w.pathFromDeployment)(i,{user:u,team:c});let s=t.uid||t.id;n="production"===t.target?s===i.id?"Deployment is already the current Production Deployment.":"Promoted Deployment to Production successfully.":"Created Production Deployment successfully."}c&&((0,L.revalidateProject)(m,a),await m((0,O.getProjectProductionDeploymentKey)({projectIdOrName:a.id,teamId:c.slug}))),o.success({text:n,key:"production-deployment"}),e&&(e===location.pathname?s?.():d.push(e))}catch(e){f((0,n.normalizeError)(e))}finally{p(!1)}}},[t,a,d,y,c,o,r,u,m,s]),loading:h,setLoading:p,error:g,setError:f}};e.s(["default",()=>z,"usePromoteDeployment",0,W,"usePromoteTooltip",()=>F],6619197)},2645806,e=>{"use strict";var t=e.i(6468255),l=e.i(6696646),n=e.i(9429645),i=e.i(6891161),a=e.i(455575),r=e.i(277234),s=e.i(4244280),o=e.i(9716741),d=e.i(4470704);let c=l.default.memo(e=>{let{active:c,onClose:u,deployment:m,teamId:h}=e,[p,x]=(0,l.useState)(!1),g=(0,a.useToasts)(),f=(0,l.useCallback)(async()=>{if(!m)return;x(!0);let e=h?"?teamId="+h:"",t=await (0,r.fetchAPI)(`${(0,s.API_DEPLOYMENTS)("v12")}/${m.id}/cancel`+e,{throwOnHTTPError:!1,method:"PATCH"});t.error&&g.error(`Could not cancel the deployment, it's ${m.readyState}`),"CANCELED"===t.readyState&&(g.success("The deployment has been successfully canceled."),(0,n.mutate)((0,d.getUrl)(m.id),{...m,readyState:t.readyState,status:t.readyState,canceledAt:t.canceledAt,host:m.url,isPrivate:!m.public})),x(!1),u()},[m,h,g,u]);return(0,t.jsxs)(i.Modal.Modal,{active:c,onClickOutside:u,width:"500px",children:[(0,t.jsxs)(i.Modal.Body,{children:[(0,t.jsx)(i.Modal.Header,{children:(0,t.jsx)(i.Modal.Title,{children:"Cancel Deployment"})}),(0,t.jsx)(o.default,{children:"Canceling this deployment will immediately stop the build, with no way to resume."}),(0,t.jsx)(o.default,{style:{margin:0},children:"Are you sure you want to continue?"})]}),(0,t.jsxs)(i.Modal.Actions,{children:[(0,t.jsx)(i.Modal.Action,{loading:!1,onClick:u,type:"secondary",children:"Close"}),(0,t.jsx)(i.Modal.Action,{disabled:p,loading:p,onClick:f,children:"Cancel deployment"})]})]})});e.s(["default",0,c])},2405448,e=>{"use strict";var t=e.i(542164);function l(e){return(0,t.default)(e)?e.slice(2):e}e.s(["default",()=>l])},9719784,e=>{"use strict";var t=e.i(6468255),l=e.i(6696646),n=e.i(57106),i=e.i(822157),a=e.i(7018452),r=e.i(2405448),s=e.i(542164),o=e.i(1681029),d=e.i(4478191);let c=(0,l.memo)(function(e){let{url:c,truncate:u,defaultRoute:m,...h}=e,[p,x]=(0,a.default)("#wildcard"),[g,f]=(0,l.useState)(null),[y,j]=(0,l.useState)(!1),b=(0,l.useCallback)(()=>{f((0,r.default)(c)),x(!0)},[f,x,c]);return c?(0,s.default)(c)?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.Link,{className:"pt-px leading-[16px] hover:underline",onClick:b,...h,onMouseEnter:()=>j(!0),style:{minWidth:0,maxWidth:u?"100%":void 0},children:u?(0,t.jsx)("span",{className:"geist-ellipsis",children:c}):c}),y||p?(0,t.jsx)(i.default,{active:p,onCancel:()=>{x(!1)},url:g}):null]}):(0,t.jsx)(n.Link,{className:"pt-px leading-[16px] hover:underline",external:!0,href:(0,d.withDefaultRoute)((0,o.domainToUrl)(c),m),...h,style:{minWidth:0,maxWidth:u?"100%":void 0},children:u?(0,t.jsx)("span",{className:"geist-ellipsis",children:c}):c}):null});e.s(["default",0,c])},822157,e=>{"use strict";var t=e.i(6468255),l=e.i(6696646),n=e.i(9177216),i=e.i(3500331),a=e.i(6891161),r=e.i(9318197),s=e.i(1681029);let o=(0,l.memo)(e=>{let{active:o,url:d,onCancel:c}=e,[u,m]=(0,l.useState)(""),h=(0,l.useMemo)(()=>!u||u.includes(".")||!(0,n.isValid)(`${u}.${d}`),[u,d]),p=(0,l.useCallback)(()=>{m(""),c()},[c]),x=(0,l.useCallback)(e=>{e.preventDefault(),window.open((0,s.domainToUrl)(`${u}.${d}`),"_blank","noopener"),p()},[u,d,p]);return d?(0,t.jsx)(a.Modal,{active:o,onClickOutside:p,children:(0,t.jsxs)("form",{onSubmit:x,children:[(0,t.jsxs)(a.Modal.Body,{children:[(0,t.jsx)(a.Modal.Title,{children:"Wildcard Domain"}),(0,t.jsx)(r.Spacer,{}),(0,t.jsx)(a.Modal.Subtitle,{children:"Enter a subdomain to visit below."}),(0,t.jsx)(r.Spacer,{y:.75}),(0,t.jsx)(i.Input,{autoFocus:!0,id:"hostname",label:"Hostname",onChange:e=>m(e.target.value),suffix:`.${d}`,value:u})]}),(0,t.jsxs)(a.Modal.Actions,{children:[(0,t.jsx)(a.Modal.Action,{onClick:c,children:"Cancel"}),(0,t.jsx)(a.Modal.Action,{buttonType:"submit",disabled:h,children:"Visit"})]})]})}):null});e.s(["default",0,o])},5229375,e=>{"use strict";var t=e.i(6696646),l=e.i(3911483),n=e.i(8815282),i=e.i(818351),a=e.i(8042625),r=e.i(277234),s=e.i(4244280),o=e.i(5338940);function d(e,t){let{deploymentId:l,teamId:n}=e;return(0,i.useIsomorphicSWR)(l?function(e){let{deploymentId:t,teamId:l}=e;return`${(0,s.API_DEPLOYMENTS)("v2")}/${t}/aliases${(0,a.encode)({teamId:l})}`}({deploymentId:l,teamId:n}):null,t)}function c(e,t){return(0,l.default)(()=>{if(!e)return null;let{team:t,id:l,teamId:n}=e;return`${(0,s.API_DEPLOYMENTS)("v2")}/${l}/aliases${(0,a.encode)({teamId:n??(t?t.id:null)})}`},e=>(0,r.fetchAPI)(e,{throwOnHTTPError:!0}),t)}function u(e,l){let{limit:i=20,domains:a,rollbackDeploymentId:d}=e,{isReady:c,team:u}=(0,o.useTeam)(),h=(0,n.default)((e,t)=>{if(!c)return null;let l=`${s.API_ALIASES}`,n=a?.map(e=>`domain=${encodeURIComponent(e)}`).join("&")||null;if(!e)return`${l}${m({limit:i+1,teamId:u?.id,rollbackDeploymentId:d},n)}`;let r=t?.aliases&&t.aliases.length>i?t.aliases[i-1].createdAt:null;return r?`${l}${m({limit:i+1,teamId:u?.id,until:r},n)}`:null},e=>(0,r.fetchAPI)(e,{throwOnHTTPError:!0}),l),p=(0,t.useMemo)(()=>h.data?[].concat(...h.data.filter(Boolean).map(e=>e.aliases.slice(0,i))):[],[h.data,i]),x=!!h.data&&!h.error,g=!!(h.data&&0===p.length),f=!!(h.data&&h.size>h.data.length),y=!!(h.data&&h.data[h.data.length-1]?.aliases.length<=i);return[h,{aliases:p,initialDataLoaded:x,isEmpty:g,loadMore:()=>h.setSize(e=>e+1),isLoadingMore:f,isReachingEnd:y}]}function m(e,t){let l=(0,a.encode)(e,!1),n=t?`&${t}`:"";return l?`?${l}${n}`:`?${n}`}e.s(["useAliases",()=>c,"useAliasesInfinite",()=>u,"useAliasesV2",()=>d],5229375)},663807,e=>{"use strict";let t=/^xn--/,l=/[^\0-\x7F]/,n=/[\x2E\u3002\uFF0E\uFF61]/g,i={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},a=Math.floor,r=String.fromCharCode;function s(e){throw RangeError(i[e])}function o(e,t){let l=e.split("@"),i="";return l.length>1&&(i=l[0]+"@",e=l[1]),i+(function(e,t){let l=[],n=e.length;for(;n--;)l[n]=t(e[n]);return l})((e=e.replace(n,".")).split("."),t).join(".")}function d(e){let t=[],l=0,n=e.length;for(;l<n;){let i=e.charCodeAt(l++);if(i>=55296&&i<=56319&&l<n){let n=e.charCodeAt(l++);(64512&n)==56320?t.push(((1023&i)<<10)+(1023&n)+65536):(t.push(i),l--)}else t.push(i)}return t}let c=e=>String.fromCodePoint(...e),u=function(e,t){return e+22+75*(e<26)-((0!=t)<<5)},m=function(e,t,l){let n=0;for(e=l?a(e/700):e>>1,e+=a(e/t);e>455;n+=36)e=a(e/35);return a(n+36*e/(e+38))},h=function(e){let t=[],l=e.length,n=0,i=128,r=72,o=e.lastIndexOf("-");o<0&&(o=0);for(let l=0;l<o;++l)e.charCodeAt(l)>=128&&s("not-basic"),t.push(e.charCodeAt(l));for(let c=o>0?o+1:0;c<l;){let o=n;for(let t=1,i=36;;i+=36){var d;c>=l&&s("invalid-input");let o=(d=e.charCodeAt(c++))>=48&&d<58?26+(d-48):d>=65&&d<91?d-65:d>=97&&d<123?d-97:36;o>=36&&s("invalid-input"),o>a((0x7fffffff-n)/t)&&s("overflow"),n+=o*t;let u=i<=r?1:i>=r+26?26:i-r;if(o<u)break;let m=36-u;t>a(0x7fffffff/m)&&s("overflow"),t*=m}let u=t.length+1;r=m(n-o,u,0==o),a(n/u)>0x7fffffff-i&&s("overflow"),i+=a(n/u),n%=u,t.splice(n++,0,i)}return String.fromCodePoint(...t)},p=function(e){let t=[],l=(e=d(e)).length,n=128,i=0,o=72;for(let l of e)l<128&&t.push(r(l));let c=t.length,h=c;for(c&&t.push("-");h<l;){let l=0x7fffffff;for(let t of e)t>=n&&t<l&&(l=t);let d=h+1;for(let p of(l-n>a((0x7fffffff-i)/d)&&s("overflow"),i+=(l-n)*d,n=l,e))if(p<n&&++i>0x7fffffff&&s("overflow"),p===n){let e=i;for(let l=36;;l+=36){let n=l<=o?1:l>=o+26?26:l-o;if(e<n)break;let i=e-n,s=36-n;t.push(r(u(n+i%s,0))),e=a(i/s)}t.push(r(u(e,0))),o=m(i,d,h===c),i=0,++h}++i,++n}return t.join("")},x=function(e){return o(e,function(e){return t.test(e)?h(e.slice(4).toLowerCase()):e})},g=function(e){return o(e,function(e){return l.test(e)?"xn--"+p(e):e})};e.s(["decode",()=>h,"default",0,{version:"2.3.1",ucs2:{decode:d,encode:c},decode:h,encode:p,toASCII:g,toUnicode:x},"encode",()=>p,"toASCII",()=>g,"toUnicode",()=>x,"ucs2decode",()=>d,"ucs2encode",()=>c])},9177216,(e,t,l)=>{"use strict";var n=e.r(663807),i={};i.rules=e.r(8765996).map(function(e){return{rule:e,suffix:e.replace(/^(\*\.|\!)/,""),punySuffix:-1,wildcard:"*"===e.charAt(0),exception:"!"===e.charAt(0)}}),i.endsWith=function(e,t){return -1!==e.indexOf(t,e.length-t.length)},i.findRule=function(e){var t=n.toASCII(e);return i.rules.reduce(function(e,l){return(-1===l.punySuffix&&(l.punySuffix=n.toASCII(l.suffix)),i.endsWith(t,"."+l.punySuffix)||t===l.punySuffix)?l:e},null)},l.errorCodes={DOMAIN_TOO_SHORT:"Domain name too short.",DOMAIN_TOO_LONG:"Domain name too long. It should be no more than 255 chars.",LABEL_STARTS_WITH_DASH:"Domain name label can not start with a dash.",LABEL_ENDS_WITH_DASH:"Domain name label can not end with a dash.",LABEL_TOO_LONG:"Domain name label should be at most 63 chars long.",LABEL_TOO_SHORT:"Domain name label should be at least 1 character long.",LABEL_INVALID_CHARS:"Domain name label can only contain alphanumeric characters or dashes."},i.validate=function(e){var t,l=n.toASCII(e);if(l.length<1)return"DOMAIN_TOO_SHORT";if(l.length>255)return"DOMAIN_TOO_LONG";for(var i=l.split("."),a=0;a<i.length;++a){if(!(t=i[a]).length)return"LABEL_TOO_SHORT";if(t.length>63)return"LABEL_TOO_LONG";if("-"===t.charAt(0))return"LABEL_STARTS_WITH_DASH";if("-"===t.charAt(t.length-1))return"LABEL_ENDS_WITH_DASH";if(!/^[a-z0-9\-]+$/.test(t))return"LABEL_INVALID_CHARS"}},l.parse=function(e){if("string"!=typeof e)throw TypeError("Domain name must be a string.");var t=e.slice(0).toLowerCase();"."===t.charAt(t.length-1)&&(t=t.slice(0,t.length-1));var a=i.validate(t);if(a)return{input:e,error:{message:l.errorCodes[a],code:a}};var r={input:e,tld:null,sld:null,domain:null,subdomain:null,listed:!1},s=t.split(".");if("local"===s[s.length-1])return r;var o=function(){return/xn--/.test(t)&&(r.domain&&(r.domain=n.toASCII(r.domain)),r.subdomain&&(r.subdomain=n.toASCII(r.subdomain))),r},d=i.findRule(t);if(!d)return s.length<2?r:(r.tld=s.pop(),r.sld=s.pop(),r.domain=[r.sld,r.tld].join("."),s.length&&(r.subdomain=s.pop()),o());r.listed=!0;var c=d.suffix.split("."),u=s.slice(0,s.length-c.length);return d.exception&&u.push(c.shift()),r.tld=c.join("."),u.length&&(d.wildcard&&(c.unshift(u.pop()),r.tld=c.join(".")),u.length&&(r.sld=u.pop(),r.domain=[r.sld,r.tld].join("."),u.length&&(r.subdomain=u.join(".")))),o()},l.get=function(e){return e&&l.parse(e).domain||null},l.isValid=function(e){var t=l.parse(e);return!!(t.domain&&t.listed)}},7018452,e=>{"use strict";var t=e.i(6696646);function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",[l,n]=(0,t.useState)(!1),i=window.location.hash,a=e.startsWith("#")?e:`#${e}`;return(0,t.useEffect)(()=>{let e=()=>{window.location.hash!==a||l||n(!0)};return window.addEventListener("hashchange",e),()=>{window.removeEventListener("hashchange",e)}},[l,a]),i!==a||l||(n(!0),window.history.replaceState(null,""," ")),i!==a&&l&&(window.location.hash=a),[l,n]}e.s(["default",()=>l])}]);

//# sourceMappingURL=58e69e0ebd784c6d.js.map
//# debugId=a3ddc8a5-bec5-56eb-8c9d-df5af7c61c2b
