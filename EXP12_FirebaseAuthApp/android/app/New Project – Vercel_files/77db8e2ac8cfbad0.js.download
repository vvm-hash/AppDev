
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="9fa033ed-243e-56a8-bbce-99f0f6241e90")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,8190515,6354799,e=>{"use strict";var t,a,r,s,o,i,n,l,d,c,u,p,h,g,m,v,y,b,f,I,E,w,T,S,A,M=e.i(6696646),C=e.i(505274),_=e.i(4418577),x=e.i(6068993),k=e.i(942336);e.i(9439603),e.i(408667);var R=e.i(5207889),R=R,j=Symbol.for("vercel.ai.gateway.error"),N=class e extends(a=Error,t=j,a){constructor({message:e,statusCode:a=500,cause:r}){super(e),this[t]=!0,this.statusCode=a,this.cause=r}static isInstance(t){return e.hasMarker(t)}static hasMarker(e){return"object"==typeof e&&null!==e&&j in e&&!0===e[j]}},O="GatewayAuthenticationError",D=Symbol.for(`vercel.ai.gateway.error.${O}`),P=class e extends(s=N,r=D,s){constructor({message:e="Authentication failed",statusCode:t=401,cause:a}={}){super({message:e,statusCode:t,cause:a}),this[r]=!0,this.name=O,this.type="authentication_error"}static isInstance(e){return N.hasMarker(e)&&D in e}static createContextualError(t){let{apiKeyProvided:a,oidcTokenProvided:r,message:s="Authentication failed",statusCode:o=401,cause:i}=t;return new e({message:a?`AI Gateway authentication failed: Invalid API key provided.

The token is expected to be provided via the 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`:r?`AI Gateway authentication failed: Invalid OIDC token provided.

The token is expected to be provided via the 'VERCEL_OIDC_TOKEN' environment variable. It expires every 12 hours.
- make sure your Vercel project settings have OIDC enabled
- if running locally with 'vercel dev', the token is automatically obtained and refreshed
- if running locally with your own dev server, run 'vercel env pull' to fetch the token
- in production/preview, the token is automatically obtained and refreshed

Alternative: Provide an API key via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`:`AI Gateway authentication failed: No authentication provided.

Provide either an API key or OIDC token.

API key instructions:

The token is expected to be provided via the 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.

OIDC token instructions:

The token is expected to be provided via the 'VERCEL_OIDC_TOKEN' environment variable. It expires every 12 hours.
- make sure your Vercel project settings have OIDC enabled
- if running locally with 'vercel dev', the token is automatically obtained and refreshed
- if running locally with your own dev server, run 'vercel env pull' to fetch the token
- in production/preview, the token is automatically obtained and refreshed`,statusCode:o,cause:i})}},F="GatewayInvalidRequestError",U=Symbol.for(`vercel.ai.gateway.error.${F}`),L=class extends(i=N,o=U,i){constructor({message:e="Invalid request",statusCode:t=400,cause:a}={}){super({message:e,statusCode:t,cause:a}),this[o]=!0,this.name=F,this.type="invalid_request_error"}static isInstance(e){return N.hasMarker(e)&&U in e}},J="GatewayRateLimitError",K=Symbol.for(`vercel.ai.gateway.error.${J}`),B=class extends(l=N,n=K,l){constructor({message:e="Rate limit exceeded",statusCode:t=429,cause:a}={}){super({message:e,statusCode:t,cause:a}),this[n]=!0,this.name=J,this.type="rate_limit_exceeded"}static isInstance(e){return N.hasMarker(e)&&K in e}},V="GatewayModelNotFoundError",q=Symbol.for(`vercel.ai.gateway.error.${V}`),G=R.object({modelId:R.string()}),W=class extends(c=N,d=q,c){constructor({message:e="Model not found",statusCode:t=404,modelId:a,cause:r}={}){super({message:e,statusCode:t,cause:r}),this[d]=!0,this.name=V,this.type="model_not_found",this.modelId=a}static isInstance(e){return N.hasMarker(e)&&q in e}},H="GatewayInternalServerError",Y=Symbol.for(`vercel.ai.gateway.error.${H}`),$=class extends(p=N,u=Y,p){constructor({message:e="Internal server error",statusCode:t=500,cause:a}={}){super({message:e,statusCode:t,cause:a}),this[u]=!0,this.name=H,this.type="internal_server_error"}static isInstance(e){return N.hasMarker(e)&&Y in e}},z="GatewayResponseError",Q=Symbol.for(`vercel.ai.gateway.error.${z}`),X=class extends(g=N,h=Q,g){constructor({message:e="Invalid response from Gateway",statusCode:t=502,response:a,validationError:r,cause:s}={}){super({message:e,statusCode:t,cause:s}),this[h]=!0,this.name=z,this.type="response_error",this.response=a,this.validationError=r}static isInstance(e){return N.hasMarker(e)&&Q in e}};function Z(e){let{response:t,statusCode:a,defaultMessage:r="Gateway request failed",cause:s,authMethod:o}=e,i=ee.safeParse(t);if(!i.success)return new X({message:`Invalid error response format: ${r}`,statusCode:a,response:t,validationError:i.error,cause:s});let n=i.data,l=n.error.type,d=n.error.message;switch(l){case"authentication_error":return P.createContextualError({apiKeyProvided:"api-key"===o,oidcTokenProvided:"oidc"===o,statusCode:a,cause:s});case"invalid_request_error":return new L({message:d,statusCode:a,cause:s});case"rate_limit_exceeded":return new B({message:d,statusCode:a,cause:s});case"model_not_found":{let e=G.safeParse(n.error.param);return new W({message:d,statusCode:a,modelId:e.success?e.data.modelId:void 0,cause:s})}default:return new $({message:d,statusCode:a,cause:s})}}var ee=R.object({error:R.object({message:R.string(),type:R.string().nullish(),param:R.unknown().nullish(),code:R.union([R.string(),R.number()]).nullish()})});function et(e,t){var a;return N.isInstance(e)?e:_.APICallError.isInstance(e)?Z({response:function(e){if(void 0!==e.data)return e.data;if(null!=e.responseBody)try{return JSON.parse(e.responseBody)}catch(t){return e.responseBody}return{}}(e),statusCode:null!=(a=e.statusCode)?a:500,defaultMessage:"Gateway request failed",cause:e,authMethod:t}):Z({response:{},statusCode:500,defaultMessage:e instanceof Error?`Gateway request failed: ${e.message}`:"Unknown Gateway error",cause:e,authMethod:t})}var ea="ai-gateway-auth-method";function er(e){let t=es.safeParse(e[ea]);return t.success?t.data:void 0}var es=R.union([R.literal("api-key"),R.literal("oidc")]),eo=class{constructor(e){this.config=e}async getAvailableModels(){try{let{value:e}=await (0,C.getFromApi)({url:`${this.config.baseURL}/config`,headers:await (0,C.resolve)(this.config.headers()),successfulResponseHandler:(0,C.createJsonResponseHandler)(ed),failedResponseHandler:(0,C.createJsonErrorResponseHandler)({errorSchema:R.any(),errorToMessage:e=>e}),fetch:this.config.fetch});return e}catch(e){throw et(e)}}},ei=R.object({specificationVersion:R.literal("v2"),provider:R.string(),modelId:R.string()}),en=R.object({input:R.string(),output:R.string()}),el=R.object({id:R.string(),name:R.string(),description:R.string().nullish(),pricing:en.nullish(),specification:ei,modelType:R.enum(["language","embedding","image"]).nullish()}),ed=R.object({models:R.array(el)}),ec=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2",this.supportedUrls={"*/*":[/.*/]}}get provider(){return this.config.provider}async getArgs(e){let{abortSignal:t,...a}=e;return{args:this.maybeEncodeFileParts(a),warnings:[]}}async doGenerate(e){let{args:t,warnings:a}=await this.getArgs(e),{abortSignal:r}=e,s=await (0,C.resolve)(this.config.headers());try{let{responseHeaders:o,value:i,rawValue:n}=await (0,C.postJsonToApi)({url:this.getUrl(),headers:(0,C.combineHeaders)(s,e.headers,this.getModelConfigHeaders(this.modelId,!1),await (0,C.resolve)(this.config.o11yHeaders)),body:t,successfulResponseHandler:(0,C.createJsonResponseHandler)(R.any()),failedResponseHandler:(0,C.createJsonErrorResponseHandler)({errorSchema:R.any(),errorToMessage:e=>e}),...r&&{abortSignal:r},fetch:this.config.fetch});return{...i,request:{body:t},response:{headers:o,body:n},warnings:a}}catch(e){throw et(e,er(s))}}async doStream(e){let{args:t,warnings:a}=await this.getArgs(e),{abortSignal:r}=e,s=await (0,C.resolve)(this.config.headers());try{let{value:o,responseHeaders:i}=await (0,C.postJsonToApi)({url:this.getUrl(),headers:(0,C.combineHeaders)(s,e.headers,this.getModelConfigHeaders(this.modelId,!0),await (0,C.resolve)(this.config.o11yHeaders)),body:t,successfulResponseHandler:(0,C.createEventSourceResponseHandler)(R.any()),failedResponseHandler:(0,C.createJsonErrorResponseHandler)({errorSchema:R.any(),errorToMessage:e=>e}),...r&&{abortSignal:r},fetch:this.config.fetch});return{stream:o.pipeThrough(new TransformStream({start(e){a.length>0&&e.enqueue({type:"stream-start",warnings:a})},transform(t,a){if(t.success){let r=t.value;("raw"!==r.type||e.includeRawChunks)&&("response-metadata"===r.type&&r.timestamp&&"string"==typeof r.timestamp&&(r.timestamp=new Date(r.timestamp)),a.enqueue(r))}else a.error(t.error)}})),request:{body:t},response:{headers:i}}}catch(e){throw et(e,er(s))}}isFilePart(e){return e&&"object"==typeof e&&"type"in e&&"file"===e.type}maybeEncodeFileParts(e){for(let t of e.prompt)for(let e of t.content)if(this.isFilePart(e)&&e.data instanceof Uint8Array){let t=Uint8Array.from(e.data),a=x.Buffer.from(t).toString("base64");e.data=new URL(`data:${e.mediaType||"application/octet-stream"};base64,${a}`)}return e}getUrl(){return`${this.config.baseURL}/language-model`}getModelConfigHeaders(e,t){return{"ai-language-model-specification-version":"2","ai-language-model-id":e,"ai-language-model-streaming":String(t)}}},eu=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0}get provider(){return this.config.provider}async doEmbed(e){var t;let{values:a,headers:r,abortSignal:s,providerOptions:o}=e,i=await (0,C.resolve)(this.config.headers());try{let{responseHeaders:e,value:n,rawValue:l}=await (0,C.postJsonToApi)({url:this.getUrl(),headers:(0,C.combineHeaders)(i,null!=r?r:{},this.getModelConfigHeaders(),await (0,C.resolve)(this.config.o11yHeaders)),body:{input:1===a.length?a[0]:a,...null!=o?o:{}},successfulResponseHandler:(0,C.createJsonResponseHandler)(ep),failedResponseHandler:(0,C.createJsonErrorResponseHandler)({errorSchema:R.any(),errorToMessage:e=>e}),...s&&{abortSignal:s},fetch:this.config.fetch});return{embeddings:n.embeddings,usage:null!=(t=n.usage)?t:void 0,providerMetadata:n.providerMetadata,response:{headers:e,body:l}}}catch(e){throw et(e,er(i))}}getUrl(){return`${this.config.baseURL}/embedding-model`}getModelConfigHeaders(){return{"ai-embedding-model-specification-version":"2","ai-model-id":this.modelId}}},ep=R.object({embeddings:R.array(R.array(R.number())),usage:R.object({tokens:R.number()}).nullish(),providerMetadata:R.record(R.string(),R.record(R.string(),R.unknown())).optional()});async function eh(){var e,t;let a=null!=(t=null==(e=ev().headers)?void 0:e["x-vercel-oidc-token"])?t:k.default.env.VERCEL_OIDC_TOKEN;if(!a)throw new P({message:"OIDC token not available",statusCode:401});return a}async function eg(){var e;return null==(e=ev().headers)?void 0:e["x-vercel-id"]}var em=Symbol.for("@vercel/request-context");function ev(){var e,t,a;return null!=(a=null==(t=null==(e=globalThis[em])?void 0:e.get)?void 0:t.call(e))?a:{}}async function ey(e){let t=(0,C.loadOptionalSetting)({settingValue:e.apiKey,environmentVariableName:"AI_GATEWAY_API_KEY"});if(t)return{token:t,authMethod:"api-key"};try{return{token:await eh(),authMethod:"oidc"}}catch(e){return null}}!function(){var e,t;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=null,s=null,o=null!=(e=a.metadataCacheRefreshMillis)?e:3e5,i=0,n=null!=(t=(0,C.withoutTrailingSlash)(a.baseURL))?t:"https://ai-gateway.vercel.sh/v1/ai",l=async()=>{let e=await ey(a);if(e)return{Authorization:`Bearer ${e.token}`,"ai-gateway-protocol-version":"0.0.1",[ea]:e.authMethod,...a.headers};throw P.createContextualError({apiKeyProvided:!1,oidcTokenProvided:!1,statusCode:401})},d=()=>{let e=(0,C.loadOptionalSetting)({settingValue:void 0,environmentVariableName:"VERCEL_DEPLOYMENT_ID"}),t=(0,C.loadOptionalSetting)({settingValue:void 0,environmentVariableName:"VERCEL_ENV"}),a=(0,C.loadOptionalSetting)({settingValue:void 0,environmentVariableName:"VERCEL_REGION"});return async()=>{let r=await eg();return{...e&&{"ai-o11y-deployment-id":e},...t&&{"ai-o11y-environment":t},...a&&{"ai-o11y-region":a},...r&&{"ai-o11y-request-id":r}}}},c=e=>new ec(e,{provider:"gateway",baseURL:n,headers:l,fetch:a.fetch,o11yHeaders:d()}),u=function(e){if(new.target)throw Error("The Gateway Provider model function cannot be called with the new keyword.");return c(e)};u.getAvailableModels=async()=>{var e,t,d;let c=null!=(d=null==(t=null==(e=a._internal)?void 0:e.currentDate)?void 0:t.call(e).getTime())?d:Date.now();return(!r||c-i>o)&&(i=c,r=new eo({baseURL:n,headers:l,fetch:a.fetch}).getAvailableModels().then(e=>(s=e,e)).catch(async e=>{throw et(e,er(await l()))})),s?Promise.resolve(s):r},u.imageModel=e=>{throw new _.NoSuchModelError({modelId:e,modelType:"imageModel"})},u.languageModel=c,u.textEmbeddingModel=e=>new eu(e,{provider:"gateway",baseURL:n,headers:l,fetch:a.fetch,o11yHeaders:d()})}();var R=R;e.i(4048866),e.i(6370374),e.i(4710717);var eb=Object.defineProperty,ef=Symbol.for("vercel.ai.error.AI_NoOutputSpecifiedError");_.AISDKError;Symbol.for("vercel.ai.error.AI_InvalidArgumentError");_.AISDKError;Symbol.for("vercel.ai.error.AI_InvalidStreamPartError");_.AISDKError;Symbol.for("vercel.ai.error.AI_InvalidToolInputError");_.AISDKError;Symbol.for("vercel.ai.error.AI_MCPClientError");_.AISDKError;Symbol.for("vercel.ai.error.AI_NoImageGeneratedError");_.AISDKError;var eI="AI_NoObjectGeneratedError",eE=`vercel.ai.error.${eI}`,ew=Symbol.for(eE),eT=class extends _.AISDKError{constructor({message:e="No object generated.",cause:t,text:a,response:r,usage:s,finishReason:o}){super({name:eI,message:e,cause:t}),this[m]=!0,this.text=a,this.response=r,this.usage=s,this.finishReason=o}static isInstance(e){return _.AISDKError.hasMarker(e,eE)}};m=ew;Symbol.for("vercel.ai.error.AI_NoOutputGeneratedError");_.AISDKError;Symbol.for("vercel.ai.error.AI_NoSuchToolError");_.AISDKError;Symbol.for("vercel.ai.error.AI_ToolCallRepairError");_.AISDKError,_.AISDKError;Symbol.for("vercel.ai.error.AI_InvalidDataContentError");_.AISDKError;Symbol.for("vercel.ai.error.AI_InvalidMessageRoleError");_.AISDKError;Symbol.for("vercel.ai.error.AI_MessageConversionError");_.AISDKError;Symbol.for("vercel.ai.error.AI_DownloadError");_.AISDKError;Symbol.for("vercel.ai.error.AI_RetryError");_.AISDKError;var eS=R.union([R.string(),R.instanceof(Uint8Array),R.instanceof(ArrayBuffer),R.custom(e=>{var t,a;return null!=(a=null==(t=globalThis.Buffer)?void 0:t.isBuffer(e))&&a},{message:"Must be a Buffer"})]),eA=R.lazy(()=>R.union([R.null(),R.string(),R.number(),R.boolean(),R.record(R.string(),eA),R.array(eA)])),eM=R.record(R.string(),R.record(R.string(),eA)),eC=R.object({type:R.literal("text"),text:R.string(),providerOptions:eM.optional()}),e_=R.object({type:R.literal("image"),image:R.union([eS,R.instanceof(URL)]),mediaType:R.string().optional(),providerOptions:eM.optional()}),ex=R.object({type:R.literal("file"),data:R.union([eS,R.instanceof(URL)]),filename:R.string().optional(),mediaType:R.string(),providerOptions:eM.optional()}),ek=R.object({type:R.literal("reasoning"),text:R.string(),providerOptions:eM.optional()}),eR=R.object({type:R.literal("tool-call"),toolCallId:R.string(),toolName:R.string(),input:R.unknown(),providerOptions:eM.optional(),providerExecuted:R.boolean().optional()}),ej=R.discriminatedUnion("type",[R.object({type:R.literal("text"),value:R.string()}),R.object({type:R.literal("json"),value:eA}),R.object({type:R.literal("error-text"),value:R.string()}),R.object({type:R.literal("error-json"),value:eA}),R.object({type:R.literal("content"),value:R.array(R.union([R.object({type:R.literal("text"),text:R.string()}),R.object({type:R.literal("media"),data:R.string(),mediaType:R.string()})]))})]),eN=R.object({type:R.literal("tool-result"),toolCallId:R.string(),toolName:R.string(),output:ej,providerOptions:eM.optional()}),eO=R.object({role:R.literal("system"),content:R.string(),providerOptions:eM.optional()}),eD=R.object({role:R.literal("user"),content:R.union([R.string(),R.array(R.union([eC,e_,ex]))]),providerOptions:eM.optional()}),eP=R.object({role:R.literal("assistant"),content:R.union([R.string(),R.array(R.union([eC,ex,ek,eR,eN]))]),providerOptions:eM.optional()}),eF=R.object({role:R.literal("tool"),content:R.array(eN),providerOptions:eM.optional()});R.union([eO,eD,eP,eF]),(0,C.createIdGenerator)({prefix:"aitxt",size:24}),TransformStream;var eU=R.union([R.strictObject({type:R.literal("text-start"),id:R.string(),providerMetadata:eM.optional()}),R.strictObject({type:R.literal("text-delta"),id:R.string(),delta:R.string(),providerMetadata:eM.optional()}),R.strictObject({type:R.literal("text-end"),id:R.string(),providerMetadata:eM.optional()}),R.strictObject({type:R.literal("error"),errorText:R.string()}),R.strictObject({type:R.literal("tool-input-start"),toolCallId:R.string(),toolName:R.string(),providerExecuted:R.boolean().optional(),dynamic:R.boolean().optional()}),R.strictObject({type:R.literal("tool-input-delta"),toolCallId:R.string(),inputTextDelta:R.string()}),R.strictObject({type:R.literal("tool-input-available"),toolCallId:R.string(),toolName:R.string(),input:R.unknown(),providerExecuted:R.boolean().optional(),providerMetadata:eM.optional(),dynamic:R.boolean().optional()}),R.strictObject({type:R.literal("tool-input-error"),toolCallId:R.string(),toolName:R.string(),input:R.unknown(),providerExecuted:R.boolean().optional(),providerMetadata:eM.optional(),dynamic:R.boolean().optional(),errorText:R.string()}),R.strictObject({type:R.literal("tool-output-available"),toolCallId:R.string(),output:R.unknown(),providerExecuted:R.boolean().optional(),dynamic:R.boolean().optional(),preliminary:R.boolean().optional()}),R.strictObject({type:R.literal("tool-output-error"),toolCallId:R.string(),errorText:R.string(),providerExecuted:R.boolean().optional(),dynamic:R.boolean().optional()}),R.strictObject({type:R.literal("reasoning"),text:R.string(),providerMetadata:eM.optional()}),R.strictObject({type:R.literal("reasoning-start"),id:R.string(),providerMetadata:eM.optional()}),R.strictObject({type:R.literal("reasoning-delta"),id:R.string(),delta:R.string(),providerMetadata:eM.optional()}),R.strictObject({type:R.literal("reasoning-end"),id:R.string(),providerMetadata:eM.optional()}),R.strictObject({type:R.literal("reasoning-part-finish")}),R.strictObject({type:R.literal("source-url"),sourceId:R.string(),url:R.string(),title:R.string().optional(),providerMetadata:eM.optional()}),R.strictObject({type:R.literal("source-document"),sourceId:R.string(),mediaType:R.string(),title:R.string(),filename:R.string().optional(),providerMetadata:eM.optional()}),R.strictObject({type:R.literal("file"),url:R.string(),mediaType:R.string(),providerMetadata:eM.optional()}),R.strictObject({type:R.string().startsWith("data-"),id:R.string().optional(),data:R.unknown(),transient:R.boolean().optional()}),R.strictObject({type:R.literal("start-step")}),R.strictObject({type:R.literal("finish-step")}),R.strictObject({type:R.literal("start"),messageId:R.string().optional(),messageMetadata:R.unknown().optional()}),R.strictObject({type:R.literal("finish"),messageMetadata:R.unknown().optional()}),R.strictObject({type:R.literal("abort")}),R.strictObject({type:R.literal("message-metadata"),messageMetadata:R.unknown()})]);async function eL(e){if(void 0===e)return{value:void 0,state:"undefined-input"};let t=await (0,C.safeParseJSON)({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=await (0,C.safeParseJSON)({text:function(e){let t=["ROOT"],a=-1,r=null;function s(e,s,o){switch(e){case'"':a=s,t.pop(),t.push(o),t.push("INSIDE_STRING");break;case"f":case"t":case"n":a=s,r=s,t.pop(),t.push(o),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(o),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=s,t.pop(),t.push(o),t.push("INSIDE_NUMBER");break;case"{":a=s,t.pop(),t.push(o),t.push("INSIDE_OBJECT_START");break;case"[":a=s,t.pop(),t.push(o),t.push("INSIDE_ARRAY_START")}}function o(e,r){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":a=r,t.pop()}}function i(e,r){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=r,t.pop()}}for(let n=0;n<e.length;n++){let l=e[n];switch(t[t.length-1]){case"ROOT":s(l,n,"FINISH");break;case"INSIDE_OBJECT_START":switch(l){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":a=n,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===l&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":s(l,n,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":o(l,n);break;case"INSIDE_STRING":switch(l){case'"':t.pop(),a=n;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:a=n}break;case"INSIDE_ARRAY_START":"]"===l?(a=n,t.pop()):(a=n,s(l,n,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(l){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=n,t.pop();break;default:a=n}break;case"INSIDE_ARRAY_AFTER_COMMA":s(l,n,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),a=n;break;case"INSIDE_NUMBER":switch(l){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=n;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,n),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&o(l,n);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&o(l,n);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,n);break;default:t.pop()}break;case"INSIDE_LITERAL":{let s=e.substring(r,n+1);"false".startsWith(s)||"true".startsWith(s)||"null".startsWith(s)?a=n:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?o(l,n):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,n))}}}let n=e.slice(0,a+1);for(let a=t.length-1;a>=0;a--)switch(t[a]){case"INSIDE_STRING":n+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":n+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":n+="]";break;case"INSIDE_LITERAL":{let t=e.substring(r,e.length);"true".startsWith(t)?n+="true".slice(t.length):"false".startsWith(t)?n+="false".slice(t.length):"null".startsWith(t)&&(n+="null".slice(t.length))}}return n}(e)})).success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"}}function eJ(e){return e.type.startsWith("tool-")}function eK(e){return"dynamic-tool"===e.type}function eB(e){return eJ(e)||eK(e)}function eV(e){return e.type.split("-").slice(1).join("-")}function eq(e){return eK(e)?e.toolName:eV(e)}async function eG(e){let{stream:t,onError:a}=e,r=t.getReader();try{for(;;){let{done:e}=await r.read();if(e)break}}catch(e){null==a||a(e)}finally{r.releaseLock()}}(0,C.createIdGenerator)({prefix:"aitxt",size:24}),(0,C.createIdGenerator)({prefix:"aiobj",size:24});var eW=class{constructor(){this.queue=[],this.isProcessing=!1}async processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length>0;)await this.queue[0](),this.queue.shift();this.isProcessing=!1}}async run(e){return new Promise((t,a)=>{this.queue.push(async()=>{try{await e(),t()}catch(e){a(e)}}),this.processQueue()})}};(0,C.createIdGenerator)({prefix:"aiobj",size:24}),_.AISDKError;var eH={},eY={object:()=>eQ,text:()=>ez};for(var e$ in eY)eb(eH,e$,{get:eY[e$],enumerable:!0});var ez=()=>({type:"text",responseFormat:{type:"text"},async parsePartial(e){let{text:t}=e;return{partial:t}},async parseOutput(e){let{text:t}=e;return t}}),eQ=e=>{let{schema:t}=e,a=(0,C.asSchema)(t);return{type:"object",responseFormat:{type:"json",schema:a.jsonSchema},async parsePartial(e){let{text:t}=e,a=await eL(t);switch(a.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:a.value};default:{let e=a.state;throw Error(`Unsupported parse state: ${e}`)}}},async parseOutput(e,t){let{text:r}=e,s=await (0,C.safeParseJSON)({text:r});if(!s.success)throw new eT({message:"No object generated: could not parse the response.",cause:s.error,text:r,response:t.response,usage:t.usage,finishReason:t.finishReason});let o=await (0,C.safeValidateTypes)({value:s.value,schema:a});if(!o.success)throw new eT({message:"No object generated: response did not match schema.",cause:o.error,text:r,response:t.response,usage:t.usage,finishReason:t.finishReason});return o.value}}},eX=Symbol.for("vercel.ai.error.AI_NoSuchProviderError");_.NoSuchModelError;var eZ=R.looseObject({name:R.string(),version:R.string()}),e0=R.looseObject({_meta:R.optional(R.object({}).loose())}),e1=R.object({method:R.string(),params:R.optional(e0)}),e4=R.looseObject({experimental:R.optional(R.object({}).loose()),logging:R.optional(R.object({}).loose()),prompts:R.optional(R.looseObject({listChanged:R.optional(R.boolean())})),resources:R.optional(R.looseObject({subscribe:R.optional(R.boolean()),listChanged:R.optional(R.boolean())})),tools:R.optional(R.looseObject({listChanged:R.optional(R.boolean())}))});e0.extend({protocolVersion:R.string(),capabilities:e4,serverInfo:eZ,instructions:R.optional(R.string())});var e2=e0.extend({nextCursor:R.optional(R.string())}),e6=R.object({name:R.string(),description:R.optional(R.string()),inputSchema:R.object({type:R.literal("object"),properties:R.optional(R.object({}).loose())}).loose()}).loose();e2.extend({tools:R.array(e6)});var e5=R.object({type:R.literal("text"),text:R.string()}).loose(),e9=R.object({type:R.literal("image"),data:R.base64(),mimeType:R.string()}).loose(),e8=R.object({uri:R.string(),mimeType:R.optional(R.string())}).loose(),e3=e8.extend({text:R.string()}),e7=e8.extend({blob:R.base64()}),te=R.object({type:R.literal("resource"),resource:R.union([e3,e7])}).loose();e0.extend({content:R.array(R.union([e5,e9,te])),isError:R.boolean().default(!1).optional()}).or(e0.extend({toolResult:R.unknown()}));var tt=R.object({jsonrpc:R.literal("2.0"),id:R.union([R.string(),R.number().int()])}).merge(e1).strict(),ta=R.object({jsonrpc:R.literal("2.0"),id:R.union([R.string(),R.number().int()]),result:e0}).strict(),tr=R.object({jsonrpc:R.literal("2.0"),id:R.union([R.string(),R.number().int()]),error:R.object({code:R.number().int(),message:R.string(),data:R.optional(R.unknown())})}).strict(),ts=R.object({jsonrpc:R.literal("2.0")}).merge(R.object({method:R.string(),params:R.optional(e0)})).strict();async function to(e){let{stream:t,onTextPart:a}=e,r=t.pipeThrough(new TextDecoderStream).getReader();for(;;){let{done:e,value:t}=await r.read();if(e)break;await a(t)}}async function ti(e){var t;let{api:a,prompt:r,credentials:s,headers:o,body:i,streamProtocol:n="data",setCompletion:l,setLoading:d,setError:c,setAbortController:u,onFinish:p,onError:h,fetch:g=fetch}=e;try{d(!0),c(void 0);let e=new AbortController;u(e),l("");let h=await g(a,{method:"POST",body:JSON.stringify({prompt:r,...i}),credentials:s,headers:{"Content-Type":"application/json",...o},signal:e.signal}).catch(e=>{throw e});if(!h.ok)throw Error(null!=(t=await h.text())?t:"Failed to fetch the chat response.");if(!h.body)throw Error("The response body is empty.");let m="";switch(n){case"text":await to({stream:h.body,onTextPart:e=>{m+=e,l(m)}});break;case"data":await eG({stream:(0,C.parseJsonEventStream)({stream:h.body,schema:eU}).pipeThrough(new TransformStream({async transform(e){if(!e.success)throw e.error;let t=e.value;if("text-delta"===t.type)m+=t.delta,l(m);else if("error"===t.type)throw Error(t.errorText)}})),onError:e=>{throw e}});break;default:throw Error(`Unknown stream protocol: ${n}`)}return p&&p(r,m),u(null),m}catch(e){if("AbortError"===e.name)return u(null),null;e instanceof Error&&h&&h(e),c(e)}finally{d(!1)}}async function tn(e){if(null==e)return[];if(!globalThis.FileList||!(e instanceof globalThis.FileList))throw Error("FileList is not supported in the current environment");return Promise.all(Array.from(e).map(async e=>{let{name:t,type:a}=e;return{type:"file",mediaType:a,filename:t,url:await new Promise((t,a)=>{let r=new FileReader;r.onload=e=>{var a;t(null==(a=e.target)?void 0:a.result)},r.onerror=e=>a(e),r.readAsDataURL(e)})}}))}R.union([tt,ts,ta,tr]),_.AISDKError;var tl=class{constructor({api:e="/api/chat",credentials:t,headers:a,body:r,fetch:s,prepareSendMessagesRequest:o,prepareReconnectToStreamRequest:i}){this.api=e,this.credentials=t,this.headers=a,this.body=r,this.fetch=s,this.prepareSendMessagesRequest=o,this.prepareReconnectToStreamRequest=i}async sendMessages(e){var t,a,r,s,o;let{abortSignal:i,...n}=e,l=await (0,C.resolve)(this.body),d=await (0,C.resolve)(this.headers),c=await (0,C.resolve)(this.credentials),u=await (null==(t=this.prepareSendMessagesRequest)?void 0:t.call(this,{api:this.api,id:n.chatId,messages:n.messages,body:{...l,...n.body},headers:{...d,...n.headers},credentials:c,requestMetadata:n.metadata,trigger:n.trigger,messageId:n.messageId})),p=null!=(a=null==u?void 0:u.api)?a:this.api,h=(null==u?void 0:u.headers)!==void 0?u.headers:{...d,...n.headers},g=(null==u?void 0:u.body)!==void 0?u.body:{...l,...n.body,id:n.chatId,messages:n.messages,trigger:n.trigger,messageId:n.messageId},m=null!=(r=null==u?void 0:u.credentials)?r:c,v=null!=(s=this.fetch)?s:globalThis.fetch,y=await v(p,{method:"POST",headers:{"Content-Type":"application/json",...h},body:JSON.stringify(g),credentials:m,signal:i});if(!y.ok)throw Error(null!=(o=await y.text())?o:"Failed to fetch the chat response.");if(!y.body)throw Error("The response body is empty.");return this.processResponseStream(y.body)}async reconnectToStream(e){var t,a,r,s,o;let i=await (0,C.resolve)(this.body),n=await (0,C.resolve)(this.headers),l=await (0,C.resolve)(this.credentials),d=await (null==(t=this.prepareReconnectToStreamRequest)?void 0:t.call(this,{api:this.api,id:e.chatId,body:{...i,...e.body},headers:{...n,...e.headers},credentials:l,requestMetadata:e.metadata})),c=null!=(a=null==d?void 0:d.api)?a:`${this.api}/${e.chatId}/stream`,u=(null==d?void 0:d.headers)!==void 0?d.headers:{...n,...e.headers},p=null!=(r=null==d?void 0:d.credentials)?r:l,h=null!=(s=this.fetch)?s:globalThis.fetch,g=await h(c,{method:"GET",headers:u,credentials:p});if(204===g.status)return null;if(!g.ok)throw Error(null!=(o=await g.text())?o:"Failed to fetch the chat response.");if(!g.body)throw Error("The response body is empty.");return this.processResponseStream(g.body)}},td=class extends tl{constructor(e={}){super(e)}processResponseStream(e){return(0,C.parseJsonEventStream)({stream:e,schema:eU}).pipeThrough(new TransformStream({async transform(e,t){if(!e.success)throw e.error;t.enqueue(e.value)}}))}},tc=class{constructor({generateId:e=C.generateId,id:t=e(),transport:a=new td,messageMetadataSchema:r,dataPartSchemas:s,state:o,onError:i,onToolCall:n,onFinish:l,onData:d,sendAutomaticallyWhen:c}){var u=this;this.activeResponse=void 0,this.jobExecutor=new eW,this.sendMessage=async(e,t)=>{var a,r,s,o;let i;if(null==e)return void await this.makeRequest({trigger:"submit-message",messageId:null==(a=this.lastMessage)?void 0:a.id,...t});if(i="text"in e||"files"in e?{parts:[...Array.isArray(e.files)?e.files:await tn(e.files),..."text"in e&&null!=e.text?[{type:"text",text:e.text}]:[]]}:e,null!=e.messageId){let t=this.state.messages.findIndex(t=>t.id===e.messageId);if(-1===t)throw Error(`message with id ${e.messageId} not found`);if("user"!==this.state.messages[t].role)throw Error(`message with id ${e.messageId} is not a user message`);this.state.messages=this.state.messages.slice(0,t+1),this.state.replaceMessage(t,{...i,id:e.messageId,role:null!=(r=i.role)?r:"user",metadata:e.metadata})}else this.state.pushMessage({...i,id:null!=(s=i.id)?s:this.generateId(),role:null!=(o=i.role)?o:"user",metadata:e.metadata});await this.makeRequest({trigger:"submit-message",messageId:e.messageId,...t})},this.regenerate=async function(){let{messageId:e,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=null==e?u.state.messages.length-1:u.state.messages.findIndex(t=>t.id===e);if(-1===a)throw Error(`message ${e} not found`);u.state.messages=u.state.messages.slice(0,"assistant"===u.messages[a].role?a:a+1),await u.makeRequest({trigger:"regenerate-message",messageId:e,...t})},this.resumeStream=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};await u.makeRequest({trigger:"resume-stream",...e})},this.clearError=()=>{"error"===this.status&&(this.state.error=void 0,this.setStatus({status:"ready"}))},this.addToolResult=async e=>{let{tool:t,toolCallId:a,output:r}=e;return this.jobExecutor.run(async()=>{var e,t;let s=this.state.messages,o=s[s.length-1];this.state.replaceMessage(s.length-1,{...o,parts:o.parts.map(e=>eB(e)&&e.toolCallId===a?{...e,state:"output-available",output:r}:e)}),this.activeResponse&&(this.activeResponse.state.message.parts=this.activeResponse.state.message.parts.map(e=>eB(e)&&e.toolCallId===a?{...e,state:"output-available",output:r,errorText:void 0}:e)),"streaming"!==this.status&&"submitted"!==this.status&&(null==(e=this.sendAutomaticallyWhen)?void 0:e.call(this,{messages:this.state.messages}))&&this.makeRequest({trigger:"submit-message",messageId:null==(t=this.lastMessage)?void 0:t.id})})},this.stop=async()=>{var e;("streaming"===this.status||"submitted"===this.status)&&(null==(e=this.activeResponse)?void 0:e.abortController)&&this.activeResponse.abortController.abort()},this.id=t,this.transport=a,this.generateId=e,this.messageMetadataSchema=r,this.dataPartSchemas=s,this.state=o,this.onError=i,this.onToolCall=n,this.onFinish=l,this.onData=d,this.sendAutomaticallyWhen=c}get status(){return this.state.status}setStatus(e){let{status:t,error:a}=e;this.status!==t&&(this.state.status=t,this.state.error=a)}get error(){return this.state.error}get messages(){return this.state.messages}get lastMessage(){return this.state.messages[this.state.messages.length-1]}set messages(e){this.state.messages=e}async makeRequest(e){var t,a,r;let{trigger:s,metadata:o,headers:i,body:n,messageId:l}=e;this.setStatus({status:"submitted",error:void 0});let d=this.lastMessage;try{let e,a={state:function(e){let{lastMessage:t,messageId:a}=e;return{message:(null==t?void 0:t.role)==="assistant"?t:{id:a,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}({lastMessage:this.state.snapshot(d),messageId:this.generateId()}),abortController:new AbortController};if(this.activeResponse=a,"resume-stream"===s){let t=await this.transport.reconnectToStream({chatId:this.id,metadata:o,headers:i,body:n});if(null==t)return void this.setStatus({status:"ready"});e=t}else e=await this.transport.sendMessages({chatId:this.id,messages:this.state.messages,abortSignal:a.abortController.signal,metadata:o,headers:i,body:n,trigger:s,messageId:l});let r=e=>this.jobExecutor.run(()=>e({state:a.state,write:()=>{var e;this.setStatus({status:"streaming"}),a.state.message.id===(null==(e=this.lastMessage)?void 0:e.id)?this.state.replaceMessage(this.state.messages.length-1,a.state.message):this.state.pushMessage(a.state.message)}}));await eG({stream:function(e){let{stream:t,messageMetadataSchema:a,dataPartSchemas:r,runUpdateMessageJob:s,onError:o,onToolCall:i,onData:n}=e;return t.pipeThrough(new TransformStream({async transform(e,t){await s(async s=>{var l,d,c,u;let{state:p,write:h}=s;function g(e){let t=p.message.parts.filter(eJ).find(t=>t.toolCallId===e);if(null==t)throw Error("tool-output-error must be preceded by a tool-input-available");return t}function m(e){let t=p.message.parts.filter(e=>"dynamic-tool"===e.type).find(t=>t.toolCallId===e);if(null==t)throw Error("tool-output-error must be preceded by a tool-input-available");return t}function v(e){var t;let a=p.message.parts.find(t=>eJ(t)&&t.toolCallId===e.toolCallId);null!=a?(a.state=e.state,a.input=e.input,a.output=e.output,a.errorText=e.errorText,a.rawInput=e.rawInput,a.preliminary=e.preliminary,a.providerExecuted=null!=(t=e.providerExecuted)?t:a.providerExecuted,null!=e.providerMetadata&&"input-available"===a.state&&(a.callProviderMetadata=e.providerMetadata)):p.message.parts.push({type:`tool-${e.toolName}`,toolCallId:e.toolCallId,state:e.state,input:e.input,output:e.output,rawInput:e.rawInput,errorText:e.errorText,providerExecuted:e.providerExecuted,preliminary:e.preliminary,...null!=e.providerMetadata?{callProviderMetadata:e.providerMetadata}:{}})}function y(e){var t;let a=p.message.parts.find(t=>"dynamic-tool"===t.type&&t.toolCallId===e.toolCallId);null!=a?(a.state=e.state,a.toolName=e.toolName,a.input=e.input,a.output=e.output,a.errorText=e.errorText,a.rawInput=null!=(t=e.rawInput)?t:a.rawInput,a.preliminary=e.preliminary,null!=e.providerMetadata&&"input-available"===a.state&&(a.callProviderMetadata=e.providerMetadata)):p.message.parts.push({type:"dynamic-tool",toolName:e.toolName,toolCallId:e.toolCallId,state:e.state,input:e.input,output:e.output,errorText:e.errorText,preliminary:e.preliminary,...null!=e.providerMetadata?{callProviderMetadata:e.providerMetadata}:{}})}async function b(e){if(null!=e){let t=null!=p.message.metadata?function e(t,a){if(void 0===t&&void 0===a)return;if(void 0===t)return a;if(void 0===a)return t;let r={...t};for(let s in a)if(Object.prototype.hasOwnProperty.call(a,s)){let o=a[s];if(void 0===o)continue;let i=s in t?t[s]:void 0,n=null!==o&&"object"==typeof o&&!Array.isArray(o)&&!(o instanceof Date)&&!(o instanceof RegExp),l=null!=i&&"object"==typeof i&&!Array.isArray(i)&&!(i instanceof Date)&&!(i instanceof RegExp);n&&l?r[s]=e(i,o):r[s]=o}return r}(p.message.metadata,e):e;null!=a&&await (0,C.validateTypes)({value:t,schema:a}),p.message.metadata=t}}switch(e.type){case"text-start":{let t={type:"text",text:"",providerMetadata:e.providerMetadata,state:"streaming"};p.activeTextParts[e.id]=t,p.message.parts.push(t),h();break}case"text-delta":{let t=p.activeTextParts[e.id];t.text+=e.delta,t.providerMetadata=null!=(l=e.providerMetadata)?l:t.providerMetadata,h();break}case"text-end":{let t=p.activeTextParts[e.id];t.state="done",t.providerMetadata=null!=(d=e.providerMetadata)?d:t.providerMetadata,delete p.activeTextParts[e.id],h();break}case"reasoning-start":{let t={type:"reasoning",text:"",providerMetadata:e.providerMetadata,state:"streaming"};p.activeReasoningParts[e.id]=t,p.message.parts.push(t),h();break}case"reasoning-delta":{let t=p.activeReasoningParts[e.id];t.text+=e.delta,t.providerMetadata=null!=(c=e.providerMetadata)?c:t.providerMetadata,h();break}case"reasoning-end":{let t=p.activeReasoningParts[e.id];t.providerMetadata=null!=(u=e.providerMetadata)?u:t.providerMetadata,t.state="done",delete p.activeReasoningParts[e.id],h();break}case"file":p.message.parts.push({type:"file",mediaType:e.mediaType,url:e.url}),h();break;case"source-url":p.message.parts.push({type:"source-url",sourceId:e.sourceId,url:e.url,title:e.title,providerMetadata:e.providerMetadata}),h();break;case"source-document":p.message.parts.push({type:"source-document",sourceId:e.sourceId,mediaType:e.mediaType,title:e.title,filename:e.filename,providerMetadata:e.providerMetadata}),h();break;case"tool-input-start":{let t=p.message.parts.filter(eJ);p.partialToolCalls[e.toolCallId]={text:"",toolName:e.toolName,index:t.length,dynamic:e.dynamic},e.dynamic?y({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-streaming",input:void 0}):v({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-streaming",input:void 0,providerExecuted:e.providerExecuted}),h();break}case"tool-input-delta":{let t=p.partialToolCalls[e.toolCallId];t.text+=e.inputTextDelta;let{value:a}=await eL(t.text);t.dynamic?y({toolCallId:e.toolCallId,toolName:t.toolName,state:"input-streaming",input:a}):v({toolCallId:e.toolCallId,toolName:t.toolName,state:"input-streaming",input:a}),h();break}case"tool-input-available":e.dynamic?y({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-available",input:e.input,providerMetadata:e.providerMetadata}):v({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-available",input:e.input,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}),h(),i&&!e.providerExecuted&&await i({toolCall:e});break;case"tool-input-error":e.dynamic?y({toolCallId:e.toolCallId,toolName:e.toolName,state:"output-error",input:e.input,errorText:e.errorText,providerMetadata:e.providerMetadata}):v({toolCallId:e.toolCallId,toolName:e.toolName,state:"output-error",input:void 0,rawInput:e.input,errorText:e.errorText,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}),h();break;case"tool-output-available":if(e.dynamic){let t=m(e.toolCallId);y({toolCallId:e.toolCallId,toolName:t.toolName,state:"output-available",input:t.input,output:e.output,preliminary:e.preliminary})}else{let t=g(e.toolCallId);v({toolCallId:e.toolCallId,toolName:eV(t),state:"output-available",input:t.input,output:e.output,providerExecuted:e.providerExecuted,preliminary:e.preliminary})}h();break;case"tool-output-error":if(e.dynamic){let t=m(e.toolCallId);y({toolCallId:e.toolCallId,toolName:t.toolName,state:"output-error",input:t.input,errorText:e.errorText})}else{let t=g(e.toolCallId);v({toolCallId:e.toolCallId,toolName:eV(t),state:"output-error",input:t.input,rawInput:t.rawInput,errorText:e.errorText})}h();break;case"start-step":p.message.parts.push({type:"step-start"});break;case"finish-step":p.activeTextParts={},p.activeReasoningParts={};break;case"start":null!=e.messageId&&(p.message.id=e.messageId),await b(e.messageMetadata),(null!=e.messageId||null!=e.messageMetadata)&&h();break;case"finish":case"message-metadata":await b(e.messageMetadata),null!=e.messageMetadata&&h();break;case"error":null==o||o(Error(e.errorText));break;default:if(e.type.startsWith("data-")){if((null==r?void 0:r[e.type])!=null&&await (0,C.validateTypes)({value:e.data,schema:r[e.type]}),e.transient){null==n||n(e);break}let t=null!=e.id?p.message.parts.find(t=>e.type===t.type&&e.id===t.id):void 0;null!=t?t.data=e.data:p.message.parts.push(e),null==n||n(e),h()}}t.enqueue(e)})}}))}({stream:e,onToolCall:this.onToolCall,onData:this.onData,messageMetadataSchema:this.messageMetadataSchema,dataPartSchemas:this.dataPartSchemas,runUpdateMessageJob:r,onError:e=>{throw e}}),onError:e=>{throw e}}),null==(t=this.onFinish)||t.call(this,{message:a.state.message}),this.setStatus({status:"ready"})}catch(e){if("AbortError"===e.name)return this.setStatus({status:"ready"}),null;this.onError&&e instanceof Error&&this.onError(e),this.setStatus({status:"error",error:e})}finally{this.activeResponse=void 0}(null==(a=this.sendAutomaticallyWhen)?void 0:a.call(this,{messages:this.state.messages}))&&await this.makeRequest({trigger:"submit-message",messageId:null==(r=this.lastMessage)?void 0:r.id,metadata:o,headers:i,body:n})}},tu=R.object({type:R.literal("text"),text:R.string(),state:R.enum(["streaming","done"]).optional(),providerMetadata:eM.optional()}),tp=R.object({type:R.literal("reasoning"),text:R.string(),state:R.enum(["streaming","done"]).optional(),providerMetadata:eM.optional()}),th=R.object({type:R.literal("source-url"),sourceId:R.string(),url:R.string(),title:R.string().optional(),providerMetadata:eM.optional()}),tg=R.object({type:R.literal("source-document"),sourceId:R.string(),mediaType:R.string(),title:R.string(),filename:R.string().optional(),providerMetadata:eM.optional()}),tm=R.object({type:R.literal("file"),mediaType:R.string(),filename:R.string().optional(),url:R.string(),providerMetadata:eM.optional()}),tv=R.object({type:R.literal("step-start")}),ty=R.object({type:R.string().startsWith("data-"),id:R.string().optional(),data:R.unknown()}),tb=[R.object({type:R.literal("dynamic-tool"),toolName:R.string(),toolCallId:R.string(),state:R.literal("input-streaming"),input:R.unknown().optional(),output:R.never().optional(),errorText:R.never().optional()}),R.object({type:R.literal("dynamic-tool"),toolName:R.string(),toolCallId:R.string(),state:R.literal("input-available"),input:R.unknown(),output:R.never().optional(),errorText:R.never().optional(),callProviderMetadata:eM.optional()}),R.object({type:R.literal("dynamic-tool"),toolName:R.string(),toolCallId:R.string(),state:R.literal("output-available"),input:R.unknown(),output:R.unknown(),errorText:R.never().optional(),callProviderMetadata:eM.optional(),preliminary:R.boolean().optional()}),R.object({type:R.literal("dynamic-tool"),toolName:R.string(),toolCallId:R.string(),state:R.literal("output-error"),input:R.unknown(),output:R.never().optional(),errorText:R.string(),callProviderMetadata:eM.optional()})],tf=[R.object({type:R.string().startsWith("tool-"),toolCallId:R.string(),state:R.literal("input-streaming"),input:R.unknown().optional(),output:R.never().optional(),errorText:R.never().optional()}),R.object({type:R.string().startsWith("tool-"),toolCallId:R.string(),state:R.literal("input-available"),input:R.unknown(),output:R.never().optional(),errorText:R.never().optional(),callProviderMetadata:eM.optional()}),R.object({type:R.string().startsWith("tool-"),toolCallId:R.string(),state:R.literal("output-available"),input:R.unknown(),output:R.unknown(),errorText:R.never().optional(),callProviderMetadata:eM.optional(),preliminary:R.boolean().optional()}),R.object({type:R.string().startsWith("tool-"),toolCallId:R.string(),state:R.literal("output-error"),input:R.unknown(),output:R.never().optional(),errorText:R.string(),callProviderMetadata:eM.optional()})];R.object({id:R.string(),role:R.enum(["system","user","assistant"]),metadata:R.unknown().optional(),parts:R.array(R.union([tu,tp,th,tg,tm,tv,ty,...tb,...tf]))}),e.s(["AbstractChat",()=>tc,"DefaultChatTransport",()=>td,"callCompletionApi",()=>ti,"getToolOrDynamicToolName",()=>eq,"isDeepEqualData",()=>function e(t,a){if(t===a)return!0;if(null==t||null==a)return!1;if("object"!=typeof t&&"object"!=typeof a)return t===a;if(t.constructor!==a.constructor)return!1;if(t instanceof Date&&a instanceof Date)return t.getTime()===a.getTime();if(Array.isArray(t)){if(t.length!==a.length)return!1;for(let r=0;r<t.length;r++)if(!e(t[r],a[r]))return!1;return!0}let r=Object.keys(t),s=Object.keys(a);if(r.length!==s.length)return!1;for(let o of r)if(!s.includes(o)||!e(t[o],a[o]))return!1;return!0},"isToolOrDynamicToolUIPart",()=>eB,"isToolUIPart",()=>eJ,"parsePartialJson",()=>eL],6354799);var tI=e.i(7561030);e.i(3911483);var tE=(e,t,a)=>{if(!t.has(e))throw TypeError("Cannot "+a)},tw=(e,t,a)=>(tE(e,t,"read from private field"),a?a.call(e):t.get(e)),tT=(e,t,a)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,a)},tS=(e,t,a,r)=>(tE(e,t,"write to private field"),r?r.call(e,a):t.set(e,a),a),tA=class{constructor(e=[]){tT(this,v,void 0),tT(this,y,"ready"),tT(this,b,void 0),tT(this,f,new Set),tT(this,I,new Set),tT(this,E,new Set),this.pushMessage=e=>{tS(this,v,tw(this,v).concat(e)),tw(this,w).call(this)},this.popMessage=()=>{tS(this,v,tw(this,v).slice(0,-1)),tw(this,w).call(this)},this.replaceMessage=(e,t)=>{tS(this,v,[...tw(this,v).slice(0,e),this.snapshot(t),...tw(this,v).slice(e+1)]),tw(this,w).call(this)},this.snapshot=e=>structuredClone(e),this["~registerMessagesCallback"]=(e,t)=>{let a=t?null!=t?(0,tI.default)(e,t):e:e;return tw(this,f).add(a),()=>{tw(this,f).delete(a)}},this["~registerStatusCallback"]=e=>(tw(this,I).add(e),()=>{tw(this,I).delete(e)}),this["~registerErrorCallback"]=e=>(tw(this,E).add(e),()=>{tw(this,E).delete(e)}),tT(this,w,()=>{tw(this,f).forEach(e=>e())}),tT(this,T,()=>{tw(this,I).forEach(e=>e())}),tT(this,S,()=>{tw(this,E).forEach(e=>e())}),tS(this,v,e)}get status(){return tw(this,y)}set status(e){tS(this,y,e),tw(this,T).call(this)}get error(){return tw(this,b)}set error(e){tS(this,b,e),tw(this,S).call(this)}get messages(){return tw(this,v)}set messages(e){tS(this,v,[...e]),tw(this,w).call(this)}};v=new WeakMap,y=new WeakMap,b=new WeakMap,f=new WeakMap,I=new WeakMap,E=new WeakMap,w=new WeakMap,T=new WeakMap,S=new WeakMap;var tM=class extends tc{constructor({messages:e,...t}){const a=new tA(e);super({...t,state:a}),tT(this,A,void 0),this["~registerMessagesCallback"]=(e,t)=>tw(this,A)["~registerMessagesCallback"](e,t),this["~registerStatusCallback"]=e=>tw(this,A)["~registerStatusCallback"](e),this["~registerErrorCallback"]=e=>tw(this,A)["~registerErrorCallback"](e),tS(this,A,a)}};function tC(){let{experimental_throttle:e,resume:t=!1,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(0,M.useRef)("chat"in a?a.chat:new tM(a));("chat"in a&&a.chat!==r.current||"id"in a&&r.current.id!==a.id)&&(r.current="chat"in a?a.chat:new tM(a));let s="id"in a?a.id:null,o=(0,M.useCallback)(t=>r.current["~registerMessagesCallback"](t,e),[e,s]),i=(0,M.useSyncExternalStore)(o,()=>r.current.messages,()=>r.current.messages),n=(0,M.useSyncExternalStore)(r.current["~registerStatusCallback"],()=>r.current.status,()=>r.current.status),l=(0,M.useSyncExternalStore)(r.current["~registerErrorCallback"],()=>r.current.error,()=>r.current.error),d=(0,M.useCallback)(e=>{"function"==typeof e&&(e=e(r.current.messages)),r.current.messages=e},[r]);return(0,M.useEffect)(()=>{t&&r.current.resumeStream()},[t,r]),{id:r.current.id,messages:i,setMessages:d,sendMessage:r.current.sendMessage,regenerate:r.current.regenerate,clearError:r.current.clearError,stop:r.current.stop,error:l,resumeStream:r.current.resumeStream,status:n,addToolResult:r.current.addToolResult}}A=new WeakMap,e.s(["useChat",()=>tC],8190515)}]);

//# sourceMappingURL=849799f8679e16e8.js.map
//# debugId=9fa033ed-243e-56a8-bbce-99f0f6241e90
