
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="0b1dd83f-36f6-54b5-aa79-485ec72aeb75")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,5628754,e=>{"use strict";e.i(5313122),e.i(9203481),e.i(680627),e.i(8026771),e.i(9691190),e.s([])},6356390,e=>{"use strict";var t=e.i(6468255),a=e.i(6696646),n=e.i(6891161),r=e.i(8522580),i=e.i(8735244),o=e.i(5338940),s=e.i(9544652),l=e.i(8711152),c=e.i(3677672),d=e.i(3798983),u=e.i(9906957),g=e.i(5074599);e.i(2331088);var p=e.i(545169),h=e.i(6817234),m=e.i(9623675),x=e.i(9508212),j=e.i(1344973),b=e.i(57106),y=e.i(119294),f=e.i(6352514),C=e.i(1717203),S=e.i(7557283),k=e.i(277234),I=e.i(4244280);async function M(e){let{integrationId:t,teamId:a,source:n,acceptedPolicies:r,metadata:i,billingPlanId:o,authorizationId:s}=e,l=new URLSearchParams;a&&l.append("teamId",a);let c=l.toString();return await (0,k.fetchAPI)(`${I.API_INTEGRATION_CONTROLLER_V2}/integration/${t}/marketplace/install${c?`?${c}`:""}`,{method:"POST",body:{acceptedPolicies:r,source:n??"marketplace",metadata:i,billingPlanId:o,authorizationId:s},throwOnHTTPError:!0})}var w=e.i(9186321),P=e.i(2512825),T=e.i(3788585),v=e.i(4030453),A=e.i(4004502);e.i(553769);var N=e.i(3758860),R=e.i(2557188),L=e.i(1914640),E=e.i(373291);function B(e){let{integration:r,product:i,cancelLabel:o,onBack:s,onNext:l,isLoading:c=!1,isTransitioning:d}=e,{hasMetadataErrors:u,isLoading:g,metadataState:j,areMetadataChanged:b}=(0,E.useStoreIntegrationFormContext)(),{plan:y,isBillingPlanSelectionValid:f}=(0,h.useMarketplaceBillingPlansContext)(),C=(0,a.useMemo)(()=>Object.keys(r.metadataSchema?.properties??{}).length>0,[r]);return(0,t.jsx)(m.ResourceModalWrapper,{SuccessAction:(0,t.jsx)(n.Modal.Action,{"data-testid":(0,A.tid)("create-integration-button","store-modal-continue"),disabled:u||!y||!f||c,loading:g||d,onClick:()=>{y&&l(j,y)},children:"Continue"}),cancelLabel:o,checkoutContentVariant:"default",from:"installation",integration:r,onBack:s,product:i,children:(0,t.jsxs)(x.Stack,{gap:5,children:[C?(0,t.jsx)(x.Stack,{className:"border-0 border-b border-solid border-gray-alpha-400 bg-background-200 p-6 px-0",children:(0,t.jsx)(p.ResourceMetadataFieldsWithErrorBoundary,{integrationId:r.id,isLoading:c,productId:"iap_none"})}):null,(0,t.jsx)(x.Stack,{paddingY:6,children:u?(0,t.jsx)(R.BillingPlanMetadataErrors,{integrationSlug:r.slug,isInstallationLevel:!0}):(0,t.jsx)(R.MarketplaceBillingPlanSelectorWithErrorBoundary,{areMetadataChanged:b,arePermissionsLoading:!1,hasLogDrainsSupport:r.products.some(e=>(0,N.isProtocolSupported)(e,"logDrain")),integrationId:r.id,integrationName:r.name,integrationSlug:r.slug,isInstallationLevel:!0,metadata:j,type:"new-installation"})})]})})}function O(e){let{integration:a,product:r,onBack:i,onNext:o,isTransitioning:s}=e,{isLoading:l,metadataState:c,formError:d}=(0,E.useStoreIntegrationFormContext)(),{plan:u}=(0,h.useMarketplaceBillingPlansContext)();return(0,t.jsx)(m.ResourceModalWrapper,{SuccessAction:(0,t.jsxs)(n.Modal.Action,{"data-testid":(0,A.tid)("create-integration-button","store-modal-create"),loading:l||s,onClick:o,children:["Create ",(0,g.getAccountTitleBySlug)({slug:r.slug})]}),cancelLabel:"Back",checkoutContentVariant:"no-padding",from:"installation",integration:a,onBack:i,product:r,children:(0,t.jsxs)(x.Stack,{gap:4,padding:6,children:[(0,t.jsx)(j.Text,{size:16,weight:500,children:"Your Selection"}),d.form?(0,t.jsx)(v.Error,{children:d.form}):null,(0,t.jsx)(L.ReadOnlyMetadataWithErrorBoundary,{integrationId:a.id,metadata:c,metadataErrors:d.metadata,productId:r.id,target:"create"}),(0,t.jsx)(L.ReadOnlyBillingPlan,{billingPlan:u})]})})}var F=e.i(9588822),D=e.i(8843717),_=e.i(1008179),U=e.i(6111613);function $(e){let{team:a,requireNew:n,paymentMethodState:r,onBack:i,onNext:o}=e;return(0,t.jsx)(U.PaymentMethodAction,{onBack:i,onNext:o,paymentMethodState:r,requireNew:n,team:a})}var z=e.i(2504781),V=e.i(762945),W=e.i(5761705),K=e.i(4987761);function q(e){let{teamId:a,integration:r,authorizationId:i,onChangePaymentMethod:o,onBack:s,onNext:l,product:c,success:d,error:u,isTransitioning:g}=e,{authorization:p,error:h,handleUserActions:j}=(0,K.usePollAuthorization)(a,i),b=!!(h||u||p?.status==="failed"),y=p?.status==="requires_action";return(0,t.jsx)(m.ResourceModalWrapper,{SuccessAction:(0,t.jsx)(n.Modal.Action,{disabled:!d,loading:!b&&!d||g,onClick:()=>l(),children:d?"Done":"Processing"}),cancelLabel:"Back",checkoutContentVariant:"no-padding-no-bottom",hideCancel:!(b||y)||d,from:"resource",integration:r,onBack:s,product:c,children:(0,t.jsx)(x.Stack,{gap:4,padding:6,paddingBottom:0,children:(0,t.jsx)(G,{authorization:p,error:u||(h?"Unknown error":void 0),handleUserActions:j,integration:r,onChangePaymentMethod:o,success:d})})})}function G(e){let{authorization:a,error:n,success:r,integration:o,handleUserActions:s,onChangePaymentMethod:l}=e;return r?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(x.Stack,{align:"center",direction:"row",gap:2,children:[(0,t.jsx)(W.CheckCircle,{color:"green-900",size:16}),(0,t.jsxs)(j.Text,{color:"green-900","data-testid":(0,A.tid)("create-resource-modal","successfully-created"),weight:500,children:[o.name," Account Created Successfully"]})]}),(0,t.jsxs)(j.Text,{className:"text-gray-900",children:["Your"," ",(0,t.jsx)(j.Text,{as:"span",className:"text-gray-1000",children:o.name})," ","account has been created successfully."]})]}):a?.status==="requires_action"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(x.Stack,{align:"center",direction:"row",gap:2,children:[(0,t.jsx)(V.Warning,{color:"amber-900",size:16}),(0,t.jsx)(j.Text,{color:"amber-900",weight:500,children:"Authentication Needed"})]}),(0,t.jsx)(j.Text,{className:"text-gray-900",children:"Further action is needed. Please authenticate your payment method to continue."}),(0,t.jsx)(z.Button,{onClick:()=>{s()},children:"Authenticate"})]}):a?.status==="failed"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(v.Error,{children:"Preauthorization Failed"}),(0,t.jsx)(j.Text,{className:"text-gray-900",children:"There was an error using your payment method. Please try again with a different payment method."}),(0,t.jsx)(z.Button,{onClick:()=>l(),children:"Change Payment Method"})]}):n?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(v.Error,{children:n}),(0,t.jsxs)(j.Text,{className:"text-gray-900",children:["There was an error creating your"," ",(0,t.jsx)(j.Text,{as:"span",className:"text-gray-1000",children:o.name})," ","account. Please try again later."]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(x.Stack,{align:"center",direction:"row",gap:2,children:[(0,t.jsx)(i.Spinner,{size:16}),(0,t.jsx)(j.Text,{size:16,weight:500,children:"Processing"})]}),(0,t.jsxs)(j.Text,{className:"text-gray-900",children:["Almost ready, we're setting up your"," ",(0,t.jsx)(j.Text,{as:"span",className:"text-gray-1000",children:o.name}),"."]})]})}var H=e.i(8794163);function Y(e){let{product:a,cancelLabel:n,integration:i,isLoading:o,onSuccess:s,onBack:l,team:c,checkoutContentVariant:d}=e,u=c.enabledInvoiceItems?.vercelMarketplace?.enabled===!0,{can:g,isLoading:p}=(0,C.default)({teamId:c.id}),h=g(S.Action.Create,S.Resource.IntegrationConfiguration);return u?h||p?(0,t.jsx)(Q,{isLoading:o,cancelLabel:n,integration:i,product:a,team:c,onBack:l,onSuccess:s}):(0,t.jsx)(m.ResourceModalWrapper,{SuccessAction:(0,t.jsx)(P.InstallButton,{account:c,canInstall:!1,hasPermission:!1,onClick:()=>{},children:"Continue"}),cancelLabel:n,checkoutContentVariant:d,from:"installation",integration:i,onBack:l,product:a,children:(0,t.jsx)(x.Stack,{gap:4,children:(0,t.jsxs)(r.Note,{type:"warning",children:["You need additional permissions to install integrations to"," ",c.name||"this"," account. Please contact your account administrator to request the necessary permissions."," ",(0,t.jsx)(b.Link,{external:!0,href:"https://vercel.com/docs/accounts/team-members-and-roles",target:"_blank",children:(0,t.jsx)(j.Text,{children:"Learn more"})})]})})}):(0,t.jsx)(m.ResourceModalWrapper,{SuccessAction:(0,t.jsx)(b.ButtonLink,{href:"/contact/sales",children:"Contact Sales"}),cancelLabel:n,checkoutContentVariant:d,from:"installation",integration:i,onBack:l,product:a,children:(0,t.jsx)(x.Stack,{gap:4,style:{minHeight:0},children:(0,t.jsx)(r.Note,{type:"warning",children:"Your Enterprise account is not yet available to use the Vercel Marketplace. To gain access, contact our team to discuss an account upgrade."})})})}function X(e){let{team:n,integration:r,product:i,isLoading:o,cancelLabel:s,onBack:l,onSuccess:c}=e,[d,u]=(0,a.useState)("policies"),{onSubmit:g,metadataState:p,formError:x,isLoading:j}=(0,E.useStoreIntegrationFormContext)(),b=r.flags?.includes(w.LaunchDarklyIntegrationFlags.MarketplaceInstallationOnlyPlan),{plan:C}=(0,h.useMarketplaceBillingPlansContext)(),[S,k]=(0,a.useState)(!1),{data:I}=(0,D.useIntegrationPaymentMethodState)(),v=(0,_.useAwaitData)(I),[A,N]=(0,a.useState)(),{createAuthorization:R}=(0,K.useMarketplaceBillingAuthorizationApi)(),L=(0,K.useAwaitAuthorization)(),[F,z]=(0,a.useState)(null),[V,W]=(0,a.useTransition)(),[G,Y]=(0,a.useState)(),{connectProjectAndReturnToV0:X}=(0,H.useV0Marketplace)()||{},J=e=>{if(G)return void c(G,C??void 0);let t=X?"v0":"marketplace";y.analytics.track(f.AnalyticsEvent.MARKETPLACE_INSTALLATION_CREATE_CLICKED,{integration:{id:r.id,slug:r.slug},source:t});let a=e.paymentMethodId??A;C&&u("provisioning"),g(async()=>{let e,i={},o=new Date().toISOString();if(r.eulaDocUri&&(i.eula=o),r.privacyDocUri&&(i.privacy=o),C){let t=await R(n.id,{integrationIdOrSlug:r.id,billingPlanId:C.id,metadata:p,integrationConfigurationId:void 0,paymentMethodId:a});if(z(t?.id??null),e=t?.id,t&&"succeeded"!==(await L(n.id,t.id)).status)return}let s=await M({integrationId:r.id,teamId:n.id,acceptedPolicies:i,metadata:p,billingPlanId:C?.id,authorizationId:e,source:t});Y(s),a&&await (0,D.updateInstallationPaymentMethod)(n.id,s.id,a),c(s,C??void 0)})},Q=`Accept and ${b?"Continue":"Create"}`;switch(d){case"policies":return(0,t.jsx)(m.ResourceModalWrapper,{SuccessAction:(0,t.jsx)(P.InstallButton,{account:n,canInstall:!0,hasPermission:!0,loading:o||V||j,onClick:()=>{b?u("select-plan"):J({paymentMethodId:void 0})},children:Q}),cancelLabel:s,checkoutContentVariant:"default",from:"installation",integration:r,onBack:l,product:i,children:(0,t.jsx)(T.TermsAndConditions,{buttonCaption:Q,integrations:[r]})});case"select-plan":return(0,t.jsx)(B,{cancelLabel:"Back",integration:r,isLoading:o,isTransitioning:V,onBack:()=>u("policies"),onNext:function(){W(async()=>{if(C?.paymentMethodRequired){let e=await v;if((0,U.getIsPaymentMethodStepNeeded)(n,e,C))return void u("payment-method")}u("confirm-plan")})},product:i});case"confirm-plan":return(0,t.jsx)(O,{integration:r,isTransitioning:V,onBack:()=>u("select-plan"),onNext:function(){y.analytics.track(f.AnalyticsEvent.MARKETPLACE_INSTALLATION_PLAN_SELECTED,{integration:{id:r.id,slug:r.slug}}),J({paymentMethodId:A})},product:i});case"payment-method":return I?(0,t.jsx)($,{onBack:()=>u("confirm-plan"),onNext:e=>{N(e),k(!1),u("confirm-plan")},paymentMethodState:I,requireNew:S,team:n}):null;case"provisioning":return(0,t.jsx)(q,{authorizationId:F,error:x.form??void 0,integration:r,isTransitioning:V,onBack:()=>u("confirm-plan"),onChangePaymentMethod:()=>{k(!0),u("payment-method")},onNext:()=>{G&&C&&c(G,C)},product:i,success:!!G,teamId:n.id})}}let J={type:"object",properties:{},additionalProperties:!1,required:[]},Q=(0,F.withStripe)(function(e){return(0,t.jsx)(h.MarketplaceInstallationBillingPlansProvider,{target:"create",children:(0,t.jsx)(p.ResourceFormProvider,{metadataSchema:e.integration.metadataSchema??J,resourceTitle:"Account",target:"create",children:(0,t.jsx)(X,{...e})})})});var Z=e.i(455575),ee=e.i(9100551),et=e.i(5033426),ea=e.i(9219571),en=e.i(9349058),er=e.i(9722978),ei=e.i(5328446),eo=e.i(1906681),es=e.i(5684165);function el(e){let[n,r]=(0,a.useState)(void 0);return{protocolSettingsForm:(0,a.useMemo)(()=>{if("protocols"in e&&e.protocols.experimentation?.edgeConfigSyncingSupport){let e=n?.experimentation?.edgeConfigSyncingEnabled??!1;return(0,t.jsx)(x.Stack,{gap:2,children:(0,t.jsx)(es.IntegrationResourceFormControlWithDescription,{controlKey:"",description:(0,t.jsxs)(t.Fragment,{children:["Synchronizes integration data with Edge Config for ultra-low latency resolution. Additional costs may apply for Edge Config usage."," ",(0,t.jsx)(b.Link,{external:!0,href:"https://vercel.com/docs/integrations/marketplace-flows#experimentation-edge-config-syncing",variant:"highlight",children:"Learn more"})]}),children:(0,t.jsxs)(x.Stack,{align:"center",direction:"row",gap:3,children:[(0,t.jsx)(eo.Toggle,{checked:e,onChange:e=>{r(t=>({...t,experimentation:{...t?.experimentation,edgeConfigSyncingEnabled:e}}))},size:"large"}),(0,t.jsx)(j.Text,{color:"gray-900",weight:500,children:"Enable Edge Config Syncing"})]})})})}return null},[e,n,r]),protocolSettings:n}}var ec=e.i(6835270),ed=e.i(6143247);function eu(e){let{product:a,integration:n,installationId:r,cancelLabel:i,onBack:o,onNext:s,isLoading:l,isTransitioning:c,...d}=e;return(0,t.jsx)(eg,{cancelLabel:i,installationId:r,integration:n,isLoading:l,isTransitioning:c,onBack:o,onNext:s,product:a,...d})}function eg(e){let{product:r,integration:i,installationId:o,cancelLabel:s,onBack:l,onNext:c,isLoading:d,isTransitioning:u,...g}=e,j=i.flags?.includes(w.LaunchDarklyIntegrationFlags.MarketplaceInstallationOnlyPlan),{hasMetadataErrors:b,isLoading:y,metadataState:f,areMetadataChanged:C,target:S}=(0,E.useStoreIntegrationFormContext)(),{plan:k,isSelectedPlanValid:I,isBillingPlanPreselected:M}=(0,h.useMarketplaceBillingPlansContext)(),P=(0,a.useMemo)(()=>Object.keys(r.metadataSchema.properties).length>0,[r]),T=i.supportsInstallationBillingPlans??!1,{protocolSettings:v,protocolSettingsForm:L}=el(r),{data:B}=(0,ei.default)(o),O=j||k&&I,F=(0,ec.useInstallMarketplaceProductDisplayMode)();return(0,t.jsx)(m.ResourceModalWrapper,{SuccessAction:(0,t.jsx)(n.Modal.Action,{"data-testid":(0,A.tid)("create-integration-button","store-modal-create"),disabled:b||!O||d,loading:y||u,onClick:()=>{let e=k??(T?B?.billingPlan:void 0);e&&c(f,e,v)},children:"create"===S?"Continue":"Save"}),cancelLabel:s,checkoutContentVariant:"no-padding",from:"resource",integration:i,onBack:l,product:r,children:(0,t.jsxs)(x.Stack,{gap:5,children:[P?(0,t.jsx)(x.Stack,{className:(0,ed.cn)("border-0 border-b border-solid border-gray-alpha-400 bg-background-200",{"p-6":"modal"===F,"pb-6":"inline"===F}),children:(0,t.jsx)(p.ResourceMetadataFieldsWithErrorBoundary,{integrationId:i.id,isLoading:d,productId:r.id})}):null,L?(0,t.jsx)(x.Stack,{className:(0,er.clsx)("border-0 border-b border-solid border-gray-alpha-400 bg-background-200 px-6",{"pb-6 pt-0":P,"py-6":!P},"inline"===F?" !px-0 pt-0":""),children:L}):null,M||j?null:(0,t.jsx)(x.Stack,{padding:6*("modal"===F),children:b?(0,t.jsx)(R.BillingPlanMetadataErrors,{integrationSlug:i.slug,isInstallationLevel:T}):(0,t.jsx)(R.MarketplaceBillingPlanSelectorWithErrorBoundary,{areMetadataChanged:C,arePermissionsLoading:d,hasLogDrainsSupport:(0,N.isProtocolSupported)(r,"logDrain"),installationId:o,integrationId:i.id,integrationName:i.name,integrationSlug:i.slug,isInstallationLevel:T,metadata:f,productId:r.id,...g})})]})})}var ep=e.i(3500331),eh=e.i(4585051),em=e.i(5468328),ex=e.i(3322724),ej=e.i(1595844),eb=e.i(1571992),ey=e.i(6060673);function ef(e){let{team:i,integration:o,installationBalance:s,product:l,onBack:c,onNext:d,source:u,projectId:p}=e,k=o.flags?.includes(w.LaunchDarklyIntegrationFlags.MarketplaceInstallationOnlyPlan),{isLoading:I,formError:M,metadataState:P}=(0,E.useStoreIntegrationFormContext)(),{plan:T,defaultPlan:R,topUpForm:B,shouldAddTopUpFormStep:O}=(0,h.useMarketplaceBillingPlansContext)(),F=(0,a.useMemo)(()=>{let e=l.slug.toLowerCase(),t=Object.entries(l.metadataSchema?.properties||{}).find(e=>{let[t,a]=e;return"git-namespace"===a["ui:control"]});if(t&&P[t[0]]){let a=P[t[0]];if(a&&"string"==typeof a){let t=(0,eb.stringToGitNamespace)(a);t&&(e+=`-${t.slug}`)}}return`${e}-${(0,ej.generateRandomName)()}`},[l,P]),D=(0,g.getResourceNameLabelByProduct)(l),{name:_,setName:U,resourceNameError:$,characterCount:z,isAtLimit:V}=(0,ej.useResourceName)({product:l,defaultName:F}),W=(0,a.useRef)(null),[K,q]=(0,a.useState)(!1),G=(0,ex.useIsMobile)();(0,a.useEffect)(()=>{G||setTimeout(()=>{W.current?.focus(),W.current?.select()},0)},[G]);let H=!!(R&&T?.id!==R.id),Y=(0,ec.useInstallMarketplaceProductDisplayMode)(),{data:X}=(0,ey.useProject)(p),{can:J}=(0,C.default)(),Q=J(S.Action.Create,S.Resource.Drain),Z=(0,N.isProtocolSupported)(l,"traceDrain"),ee=(0,N.hasFreeBillingPlan)(i),et=Z&&Q&&!ee&&!!p,[ea,en]=(0,a.useState)(et);return(0,t.jsx)(m.ResourceModalWrapper,{SuccessAction:(0,t.jsx)(n.Modal.Action,{"data-testid":(0,A.tid)("create-resource-modal","confirm-create"),disabled:!_,loading:I,onClick:()=>{if(q(!0),$)return;let e={integration:{id:o.id,slug:o.slug},productSlug:l.slug},t=u?{...e,source:u}:e;y.analytics.track(f.AnalyticsEvent.MARKETPLACE_RESOURCE_PROVISION_CLICKED,t);let a=et&&ea&&p?{name:`${_}-${Math.random().toString(36).substring(2,8).toLowerCase()}`,projects:"some",projectIds:[p],sampling:[],schemas:{trace:{version:"v1"}}}:void 0;d({resourceName:_,createDrainPayload:a})},children:(0,g.createResourceConfirmationStepLabel)(l)}),cancelLabel:"Back",checkoutContentVariant:"no-padding",from:"resource",integration:o,onBack:c,product:l,children:(0,t.jsxs)(x.Stack,{gap:5,children:[(0,t.jsxs)(x.Stack,{className:"inline"===Y?"bg-background-200":"border-0 border-b border-solid border-gray-alpha-400 bg-background-200 p-6",gap:2.5,children:[(0,t.jsxs)(x.Stack,{gap:1,children:[(0,t.jsx)(ep.Input,{"aria-label":`${D} Name`,disabled:I,error:K?$:void 0,label:`${D} Name (*)`,maxLength:ej.MAX_RESOURCE_NAME_LENGTH+1,minLength:ej.MIN_RESOURCE_NAME_LENGTH,onChange:e=>{U(e.currentTarget.value)},placeholder:`${D.toLowerCase().replaceAll(" ","-")}-name`,ref:W,value:_,width:"100%"}),(0,t.jsxs)(j.Text,{color:V?"red-900":"gray-900",size:12,style:{textAlign:"right"},children:[z,"/",ej.MAX_RESOURCE_NAME_LENGTH]})]}),(0,t.jsxs)(j.Text,{color:"gray-900",size:13,children:["This is how we call your ",D," in the Vercel dashboard and in ",o.name,"."]}),l.disableResourceRenaming&&(0,t.jsx)(r.Note,{fill:!0,type:"warning",children:"The name cannot be changed after the resource is created."})]}),(0,t.jsxs)(x.Stack,{gap:4,paddingX:6*("inline"!==Y),paddingY:6,children:[(0,t.jsx)(j.Text,{size:16,weight:500,children:"Your Selection"}),H?(0,t.jsx)(r.Note,{fill:!0,type:"secondary",children:"You have selected to upgrade your plan. This upgrade will apply at the installation level."}):null,M.form?(0,t.jsx)(v.Error,{children:M.form}):null,(0,t.jsx)(L.ReadOnlyMetadataWithErrorBoundary,{integrationId:o.id,metadata:P,metadataErrors:M.metadata,productId:l.id,target:"create"}),O&&void 0!==B.getAmountToAdd()?(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(L.ReadOnlyPanel,{title:"Manage Funds",children:[(0,t.jsx)(L.ReadOnlyPanelRecord,{title:"Initial credit balance",children:(0,t.jsx)(j.Text,{children:B.formatCurrency(B.addFundsForm.getValues().amountToAdd)})}),B.rechargeSettingsForm.getValues().autoRecharge?(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(L.ReadOnlyPanelRecord,{align:"center",title:"Auto recharge",titleWrap:!1,children:(0,t.jsxs)(j.Text,{color:"gray-900",align:"right",className:"text-balance",children:["add"," ",(0,t.jsx)(j.Text,{as:"span",children:B.formatCurrency(B.rechargeSettingsForm.getValues().topUpAmount)})," ","when balance falls below"," ",(0,t.jsx)(j.Text,{as:"span",children:B.formatCurrency(B.rechargeSettingsForm.getValues().topUpThreshold)}),", up to"," ",(0,t.jsx)(j.Text,{as:"span",children:B.formatCurrency(B.rechargeSettingsForm.getValues().periodSpendMaximum)})," ","per month"]})})}):null]})}):(0,t.jsx)(t.Fragment,{children:s?.currencyValueInCents!==void 0?(0,t.jsx)(L.ReadOnlyPanel,{title:(0,t.jsx)(j.Text,{weight:500,children:"Current balance"}),children:(0,t.jsx)(L.ReadOnlyPanelRecord,{title:"Current installation balance",children:(0,t.jsx)(j.Text,{children:B.formatCurrency((s.currencyValueInCents/100).toFixed(2))})})}):null}),k?null:(0,t.jsx)(L.ReadOnlyBillingPlan,{billingPlan:T}),et&&X?(0,t.jsxs)("div",{className:"flex w-full flex-col items-start gap-1",children:[(0,t.jsxs)("div",{className:"flex w-full items-center gap-2",children:[(0,t.jsx)(eo.Toggle,{checked:ea,onChange:e=>en(e)}),(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 items-center gap-1 text-sm",children:[(0,t.jsx)("span",{className:"shrink-0 whitespace-nowrap",children:"Drain traces from"}),(0,t.jsx)(eh.Avatar,{hash:X.id,size:16,className:"shrink-0"}),(0,t.jsx)(em.Tooltip,{text:X.name,className:"min-w-0 max-w-full flex-shrink inline-flex items-center overflow-hidden",children:(0,t.jsx)("span",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:X.name})}),(0,t.jsx)("span",{className:"shrink-0 whitespace-nowrap",children:"to this product"})]})]}),(0,t.jsx)("div",{className:"text-gray-900",children:(0,t.jsx)(b.Link,{href:"/docs/drains#usage-and-pricing",target:"_blank",underline:!0,children:"Learn about Drains pricing"})})]}):null]})]})})}function eC(e){let{integration:i,product:o,onBack:s,onNext:l,cancelLabel:c,installationId:d}=e,{hasMetadataErrors:u,isLoading:b,metadataState:C,areMetadataChanged:S,formError:k}=(0,E.useStoreIntegrationFormContext)(),{plan:I,isSelectedPlanValid:M,isBillingPlanPreselected:w}=(0,h.useMarketplaceBillingPlansContext)();(0,ei.default)(d);let P=(0,a.useMemo)(()=>Object.keys(o.metadataSchema.properties).length>0,[o]),T=i.supportsInstallationBillingPlans??!1,{protocolSettings:L,protocolSettingsForm:B}=el(o),O=(0,a.useMemo)(()=>{let e=o.slug.toLowerCase(),t=Object.entries(o.metadataSchema?.properties||{}).find(e=>{let[t,a]=e;return"git-namespace"===a["ui:control"]});if(t&&C[t[0]]){let a=C[t[0]];if(a&&"string"==typeof a){let t=(0,eb.stringToGitNamespace)(a);t&&(e+=`-${t.slug}`)}}return`${e}-${(0,ej.generateRandomName)()}`},[o,C]),F=(0,g.getResourceNameLabelByProduct)(o),D=(0,a.useMemo)(()=>"ab-12-aws"===i.slug?`${o.slug.toLowerCase()}-`:"",[i.slug,o.slug]),{name:_,setName:U,resourceNameError:$,characterCount:z,isAtLimit:V}=(0,ej.useResourceName)({product:o,defaultName:O}),[W,K]=(0,a.useState)(()=>"ab-12-aws"===i.slug&&_.startsWith(D)?_.slice(D.length):_);(0,a.useEffect)(()=>{"ab-12-aws"===i.slug&&U(`${D}${W}`)},[i.slug,D,W,U]);let q=(0,a.useRef)(null),[G,H]=(0,a.useState)(!1),Y=(0,ex.useIsMobile)();(0,a.useEffect)(()=>{Y||setTimeout(()=>{q.current?.focus(),q.current?.select()},0)},[Y]);let X=(0,ec.useInstallMarketplaceProductDisplayMode)(),J=I&&M;return(0,t.jsx)(m.ResourceModalWrapper,{SuccessAction:(0,t.jsx)(n.Modal.Action,{"data-testid":(0,A.tid)("create-resource-modal","combined-create"),disabled:u||!J||!_,loading:b,onClick:()=>{H(!0),!$&&I&&(y.analytics.track(f.AnalyticsEvent.MARKETPLACE_RESOURCE_PROVISION_CLICKED,{integration:{id:i.id,slug:i.slug},productSlug:o.slug}),l(_,C,I,L))},children:(0,g.createResourceConfirmationStepLabel)(o)}),cancelLabel:c,checkoutContentVariant:"no-padding",from:"resource",integration:i,onBack:s,product:o,children:(0,t.jsxs)(x.Stack,{gap:5,children:[P?(0,t.jsx)(x.Stack,{className:(0,ed.cn)("border-0 border-b border-solid border-gray-alpha-400 bg-background-200",{"p-6":"modal"===X,"pb-6":"inline"===X}),children:(0,t.jsx)(p.ResourceMetadataFieldsWithErrorBoundary,{integrationId:i.id,isLoading:!1,productId:o.id})}):null,B?(0,t.jsx)(x.Stack,{className:(0,ed.cn)("border-0 border-b border-solid border-gray-alpha-400 bg-background-200 px-6",{"pb-6 pt-0":P,"py-6":!P},"inline"===X?" !px-0 pt-0":""),children:B}):null,(0,t.jsxs)(x.Stack,{className:"inline"===X?"bg-background-200":"border-0 border-b border-solid border-gray-alpha-400 bg-background-200 p-6",gap:2.5,children:[(0,t.jsxs)(x.Stack,{gap:1,children:["ab-12-aws"===i.slug?(0,t.jsxs)(x.Stack,{gap:1,children:[(0,t.jsxs)(j.Text,{as:"label",color:"gray-900",size:12,style:{textTransform:"none"},weight:500,children:[F," Name (*)"]}),(0,t.jsxs)(x.Stack,{direction:"row",gap:0,children:[(0,t.jsx)("div",{className:"flex items-center rounded-l border border-solid border-gray-400 bg-gray-100 px-3",style:{borderRight:"none",flexShrink:0,whiteSpace:"nowrap"},children:(0,t.jsx)(j.Text,{color:"gray-900",children:D})}),(0,t.jsx)(ep.Input,{"aria-label":`${F} Name Suffix`,disabled:b,error:G?$:void 0,maxLength:ej.MAX_RESOURCE_NAME_LENGTH-D.length+1,minLength:ej.MIN_RESOURCE_NAME_LENGTH,onChange:e=>{K(e.currentTarget.value)},placeholder:"name",ref:q,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,flex:1},value:W,width:"100%"})]})]}):(0,t.jsx)(ep.Input,{"aria-label":`${F} Name`,disabled:b,error:G?$:void 0,label:`${F} Name (*)`,maxLength:ej.MAX_RESOURCE_NAME_LENGTH+1,minLength:ej.MIN_RESOURCE_NAME_LENGTH,onChange:e=>{U(e.currentTarget.value)},placeholder:`${F.toLowerCase().replaceAll(" ","-")}-name`,ref:q,value:_,width:"100%"}),(0,t.jsxs)(j.Text,{color:V?"red-900":"gray-900",size:12,style:{textAlign:"right"},children:[z,"/",ej.MAX_RESOURCE_NAME_LENGTH]})]}),(0,t.jsxs)(j.Text,{color:"gray-900",size:13,children:["This is how we call your ",F," in the Vercel dashboard and in ",i.name,"."]}),o.disableResourceRenaming&&(0,t.jsx)(r.Note,{fill:!0,type:"warning",children:"The name cannot be changed after the resource is created."})]}),w?null:(0,t.jsx)(x.Stack,{className:(0,ed.cn)("border-0 border-b border-solid border-gray-alpha-400",{"px-6 pb-6":"modal"===X,"pb-6":"inline"===X}),children:u?(0,t.jsx)(R.BillingPlanMetadataErrors,{integrationSlug:i.slug,isInstallationLevel:T}):(0,t.jsx)(R.MarketplaceBillingPlanSelectorWithErrorBoundary,{areMetadataChanged:S,arePermissionsLoading:!1,hasLogDrainsSupport:(0,N.isProtocolSupported)(o,"logDrain"),installationId:d,integrationId:i.id,integrationName:i.name,integrationSlug:i.slug,isInstallationLevel:T,metadata:C,productId:o.id,type:"product"})}),k.form?(0,t.jsx)(x.Stack,{paddingX:6*("inline"!==X),children:(0,t.jsx)(v.Error,{children:k.form})}):null]})})}function eS(e){let{team:a,configuration:n,requireNew:r,paymentMethodState:i,onBack:o,onNext:s}=e;return(0,t.jsx)(U.PaymentMethodInstallationAction,{installationId:n.id,onBack:o,onNext:s,paymentMethodState:i,requireNew:r,team:a})}var ek=e.i(2083276);e.i(6887680);var eI=e.i(5779481),eM=e.i(4011256),ew=e.i(397510),eP=e.i(7114720);e.i(6483798);var eT=e.i(8287059);function ev(e){let{success:t,onboardingRequired:a,modalDisplayMode:n,drainAddedAfterCreation:r,createdResource:i}=e;return t&&!a&&"inline"===n&&!r&&null!=i&&"integration"===i.type&&(0,N.supportsAnyDrainProtocol)(i.product)}function eA(e){let{success:t,onboardingRequired:a,modalDisplayMode:n,drainAddedAfterCreation:r,createdResource:i,isFreePlan:o}=e;return o&&ev({success:t,onboardingRequired:a,modalDisplayMode:n,drainAddedAfterCreation:r,createdResource:i})}function eN(e){let{team:r,authorizationId:i,onChangePaymentMethod:s,onBack:l,onNext:c,onSkipOnboarding:d,integration:u,product:p,resourceName:h,success:x,isTransitioning:j,createdResource:b,createdDrain:y}=e,f=(0,ee.useRouter)(),[C,S]=(0,a.useState)(!1),{authorization:k,error:I,handleUserActions:M}=(0,K.usePollAuthorization)(r.id,i),{formError:w}=(0,E.useStoreIntegrationFormContext)(),P=!!(I||w.form||k?.status==="failed"),T=k?.status==="requires_action",v=(0,g.getResourceTitleByProduct)(p),A=(0,ec.useInstallMarketplaceProductDisplayMode)(),R=y?.projectIds&&y.projectIds.length>0?y.projectIds[0]:void 0,{data:L}=(0,ey.useProject)(R),{data:B}=(0,eI.useResourceItem)({resourceId:b?.id||null}),O=B?.store,F="onboarding"===(O?O.status:b?.status),D=()=>{b&&f.push((0,eM.getResourceDashboardLink)(b,{teamSlug:r.slug}))},{mutate:_}=(0,o.useTeam)(),U=(0,eT.useOpenUpgradeModal)(),$=(0,N.hasFreeBillingPlan)(r),V=eA({success:x,onboardingRequired:F,modalDisplayMode:A,drainAddedAfterCreation:C,createdResource:b,isFreePlan:$}),W=function(e){let{success:t,onboardingRequired:a,modalDisplayMode:n,drainAddedAfterCreation:r,createdResource:i,isFreePlan:o}=e;return ev({success:t,onboardingRequired:a,modalDisplayMode:n,drainAddedAfterCreation:r,createdResource:i})&&!o}({success:x,onboardingRequired:F,modalDisplayMode:A,drainAddedAfterCreation:C,createdResource:b,isFreePlan:$});return(0,t.jsx)(m.ResourceModalWrapper,{SecondaryButton:function(e){let{showUpgradeUpsell:a,showAddDrainButton:r,createdResource:i,teamSlug:o,onNext:s,onDrainCreated:l}=e;return a?(0,t.jsx)(n.Modal.Action,{onClick:()=>s(),type:"secondary",children:"Done"}):r&&i?(0,t.jsx)(eP.MarketplaceAddDrainButton,{resource:i,teamSlug:o,type:"secondary",onDrainCreated:l}):void 0}({showUpgradeUpsell:V,showAddDrainButton:W,createdResource:b,teamSlug:r.slug,onNext:c,onDrainCreated:async()=>{S(!0)}}),SuccessAction:function(e){let{onboardingRequired:a,createdResource:r,showUpgradeUpsell:i,openUpgradeModal:o,mutateTeam:s,success:l,hasErrors:c,isTransitioning:d,onNext:u,goToResource:g}=e;return a&&r?(0,t.jsx)(ew.OpenInPartnerDashboardButton,{buttonVariant:"default",componentType:"button",integrationConfigurationId:r.product.integrationConfigurationId,label:"Complete Onboarding",onClick:()=>{g()},productId:r.product.id,externalResourceId:r.externalResourceId,teamIdOrSlug:r.ownerId,path:"onboarding"}):i?(0,t.jsx)(z.Button,{onClick:()=>{o({source:"marketplace-install-flow-upgrade",forceImmediateUpgrade:!0,onConversionSuccess:()=>{s()}})},children:"Upgrade"}):(0,t.jsx)(n.Modal.Action,{disabled:!l,loading:!c&&!l||d,onClick:()=>u(),children:l?"Done":"Processing"})}({onboardingRequired:F,createdResource:b,showUpgradeUpsell:V,openUpgradeModal:U,mutateTeam:_,success:x,hasErrors:P,isTransitioning:j,onNext:c,goToResource:D}),cancelLabel:F?"Later":"Back",checkoutContentVariant:"no-padding-no-bottom",hideCancel:(!(P||T)||x)&&!F,from:"resource",integration:u,onBack:()=>{F?d?d(b):D():l()},product:p,children:(0,t.jsx)("div",{className:(0,ed.cn)("flex flex-col gap-4","inline"===A?"p-0":"p-6"),children:(0,t.jsx)(eR,{authorization:k,createdDrain:y,createdResource:b,drainAddedAfterCreation:C,error:w.form||(I?I instanceof Error?I.message:`There was an error creating your ${h||v}`:void 0),handleUserActions:M,integration:u,isFreePlan:$,modalDisplayMode:A,onChangePaymentMethod:s,onboardingRequired:F,product:p,project:L,resourceName:h,success:x})})})}function eR(e){let{product:a,resourceName:n,authorization:o,error:s,success:l,onboardingRequired:c,integration:d,handleUserActions:u,onChangePaymentMethod:p,project:h,createdDrain:m,createdResource:b,isFreePlan:y,modalDisplayMode:f,drainAddedAfterCreation:C}=e,S=(0,g.getResourceTitleByProduct)(a);if(l){let e=eA({success:l,onboardingRequired:c,modalDisplayMode:f,drainAddedAfterCreation:C,createdResource:b,isFreePlan:y});return(0,t.jsxs)(x.Stack,{gap:3,children:[(0,t.jsxs)(x.Stack,{align:"center",direction:"row",gap:2,className:"mb-3",children:[(0,t.jsx)(W.CheckCircle,{color:"green-900",size:16}),(0,t.jsx)(j.Text,{color:"green-900","data-testid":(0,A.tid)("create-resource-modal","successfully-created"),weight:500,children:m?`${S} and Trace Drain Created Successfully`:`${S} Created Successfully`})]}),e?(0,t.jsxs)(r.Note,{fill:!0,type:"secondary",children:["The"," ",(0,t.jsx)(j.Text,{as:"span",className:"text-gray-1000",children:n||`${d.name} ${S}`})," ","has been created, but you will need to upgrade in order to start using Drains."]}):(0,t.jsx)("div",{className:"rounded-md bg-gray-200 p-4",children:(0,t.jsxs)("p",{className:"leading-relaxed",children:["The"," ",(0,t.jsx)("span",{className:"font-semibold",children:n||`${d.name} ${S}`})," ","has been created successfully",c?(0,t.jsx)(t.Fragment,{children:", but you will need to proceed to the partner dashboard to continue onboarding and complete the setup."}):"."]})}),m&&h?(0,t.jsx)("div",{className:"rounded-md bg-gray-200 p-4",children:(0,t.jsxs)("p",{className:"leading-relaxed text-gray-900",children:["The trace drain"," ",(0,t.jsx)("span",{className:"text-gray-1000",children:m.name})," has been created and connected to"," ",(0,t.jsx)(eh.Avatar,{className:"top-[2px]",hash:h.id,size:16})," ",(0,t.jsx)("span",{className:"text-gray-1000",children:h.name}),"."]})}):null]})}return o?.status==="requires_action"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(x.Stack,{align:"center",direction:"row",gap:2,children:[(0,t.jsx)(V.Warning,{color:"amber-900",size:16}),(0,t.jsx)(j.Text,{color:"amber-900",weight:500,children:"Authentication Needed"})]}),(0,t.jsx)(j.Text,{className:"text-gray-900",children:"Further action is needed. Please authenticate your payment method to continue."}),(0,t.jsx)(z.Button,{onClick:()=>{u()},children:"Authenticate"})]}):o?.status==="failed"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(v.Error,{children:"Preauthorization Failed"}),(0,t.jsx)(j.Text,{className:"text-gray-900",children:"There was an error using your payment method. Please try again with a different payment method."}),(0,t.jsx)(z.Button,{onClick:()=>p(),children:"Change Payment Method"})]}):s?(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(r.Note,{fill:!0,type:"error",children:[(0,ek.default)(s),". Please go back and check your settings before trying again."]})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(x.Stack,{align:"center",direction:"row",gap:2,children:[(0,t.jsx)(i.Spinner,{size:16}),(0,t.jsx)(j.Text,{size:16,weight:500,children:"Processing"})]}),(0,t.jsxs)(j.Text,{className:"text-gray-900",children:["Almost ready, we're setting up your"," ",(0,t.jsx)(j.Text,{as:"span",className:"text-gray-1000",children:n||S}),"."]})]})}var eL=e.i(7063289);function eE(e){let a=(0,h.useMarketplaceBillingPlansContext)();return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(m.ResourceModalWrapper,{SuccessAction:(0,t.jsx)(n.Modal.Action,{disabled:!1,loading:e.isTransitioning,onClick:async()=>{let t=await a.topUpForm.addFundsForm.trigger(),n=await a.topUpForm.rechargeSettingsForm.trigger();t&&n&&e.onNext()},children:"Continue"}),cancelLabel:"Back",checkoutContentVariant:"default",from:"top-up",integration:e.integration,onBack:()=>{e.onBack()},product:e.product,children:(0,t.jsx)(x.Stack,{className:"pb-6",gap:5,children:(0,t.jsx)("form",{children:(0,t.jsx)(eL.TopUpFormFields,{topUpForm:a.topUpForm,variant:"create"})})})})})}var eB=e.i(9871375),eO=e.i(4758962);let eF=(0,F.withStripe)(function(e){let n,{arePermissionsLoading:r,isTransitioning:i,startTransition:o,team:s,integration:l,product:c,configuration:d,onBack:u,onIntegrationResourceCreate:g,cancelLabel:p,onStepChange:m,onSkipOnboarding:x}=e,j=(0,ee.useSearchParams)(),b=j?.get("external-id")||void 0,{connectProjectAndReturnToV0:C}=(0,H.useV0Marketplace)()||{},S=(0,eB.useProjectCloneContext)();n=S.projectId?"deploy-button":C?"v0":"marketplace";let{projectId:k}=S,{createDrain:I}=(0,eO.useCreateDrain)(s.slug,k??void 0),[M,w]=(0,a.useState)(null),[P,T]=(0,a.useState)(!1),{onSubmit:v}=(0,E.useStoreIntegrationFormContext)(),A="ab-12-aws"===l.slug,[N,R]=(0,a.useState)(A?"combined":"select-plan"),{createResource:L}=(0,en.useMutateResource)(),{data:B}=(0,ea.useMarketplaceBillingBalance)(d.id),[O,F]=(0,a.useState)(),[$,z]=(0,a.useState)(null),[V,W]=(0,a.useState)(!1),{data:q}=(0,D.useInstallationPaymentMethodState)({integrationConfigurationId:d.id}),G=(0,_.useAwaitData)(q),{createAuthorization:Y}=(0,K.useMarketplaceBillingAuthorizationApi)(),X=(0,K.useAwaitAuthorization)(),[J,Q]=(0,a.useState)(null),[er,ei]=(0,a.useState)(null),[eo,es]=(0,a.useState)(),el=(0,h.useMarketplaceBillingPlansContext)(),ec=(0,a.useCallback)((e,t)=>{e.paymentMethodRequired||t?o(async()=>{let t=await G;(0,U.getIsPaymentMethodStepNeeded)(s,t,e)?R("payment-method"):R("confirm")}):R("confirm")},[G,o,s]),ed=(0,a.useCallback)(()=>{O&&ec(O,!0)},[O,ec]),eg=(0,a.useCallback)(()=>{R("confirm"),W(!1)},[]),ep=(0,a.useCallback)(()=>{W(!0),R("payment-method")},[]);function eh(e){let{resourceName:t,createDrainPayload:a,billingPlanOverride:r}=e;z(t),T(!!a),v(async e=>{let{metadata:i}=e;R("provisioning");let o=r??O;if(!o)throw Error("Billing plan is missing");let u="prepayment"===o.type?el.topUpForm.getAmountToAdd():void 0,g=await Y(s.id,{integrationIdOrSlug:l.id,productId:c.id,integrationConfigurationId:d.id,billingPlanId:o.id,metadata:i,prepaymentAmountCents:u});if(Q(g?.id??null),g&&"succeeded"!==(await X(s.id,g.id)).status)return;let p=await L({metadata:i,externalId:b,billingPlanId:o.id,name:t,integrationConfigurationId:d.id,integrationProductIdOrSlug:c.id,authorizationId:g?.id??void 0,protocolSettings:eo,source:n});y.analytics.track(f.AnalyticsEvent.MARKETPLACE_RESOURCE_INSTALL_CLICKED,{integration:{id:l.id,slug:l.slug},productSlug:c.slug,source:n}),"prepayment"===o.type&&await el.topUpForm.requests.updateRechargeSettingsForResource({billingPlanId:o.id,resourceId:p.id,teamId:s.id,configurationId:d.id,metadata:i}),ei(p),a&&w(await I({...a,source:{kind:"integration",resourceId:p.id}}))},{noTransition:!0,resourceName:t})}let em=(0,a.useCallback)(()=>{if(!er)throw Error("Not created");o(async()=>{if(C){Z.toasts.success(`Created ${er.name} successfully. Redirecting back to v0.`);try{(0,et.track)("v0/marketplace/integration-connected",{integrationId:l.id,productId:c.id}),await C({integrationId:l.id,productId:c.id,resourceId:er.id,productSlug:c.slug})}catch(t){let e="[object Error]"===Object.prototype.toString.call(t)?t.message:String(t);(0,et.track)("v0/marketplace/integration-connect-failed",{integrationId:l.id,productId:c.id,error:e}),Z.toasts.error("Failed to connect integration to v0.")}}else await g(er)})},[er,o,C,l.id,c.id,c.slug,g]);switch(N){case"combined":return(0,t.jsx)(eC,{cancelLabel:p,installationId:d.id,integration:l,onBack:()=>{m?.(),u()},onNext:(e,t,a,n)=>{m?.(),F(a),es(n),eh({resourceName:e,billingPlanOverride:a})},product:c});case"select-plan":return(0,t.jsx)(eu,{cancelLabel:p,installationId:d.id,integration:l,isLoading:r,isTransitioning:i,onBack:()=>{m?.(),u()},onNext:(e,t,a)=>{m?.(),function(e,t,a){if(y.analytics.track(f.AnalyticsEvent.MARKETPLACE_PRODUCT_PLAN_SELECTED,{integration:{id:l.id,slug:l.slug},productSlug:c.slug,source:n}),F(t),es(a),el.shouldAddTopUpFormStep&&("installation"!==t.scope||(B?.balance?.currencyValueInCents??0)===0)){let e=B?.balance?.currencyValueInCents;el.topUpForm.setup({type:"create",billingPlan:t,currentBalance:e?(e/100).toString():void 0}),R("top-up");return}ec(t,!1)}(0,t,a)},product:c,type:"product"});case"payment-method":return q?(0,t.jsx)(eS,{configuration:d,onBack:()=>{m?.(),R("select-plan")},onNext:()=>{m?.(),eg()},paymentMethodState:q,requireNew:V,team:s}):null;case"confirm":return(0,t.jsx)(ef,{cancelLabel:p,installationBalance:B?.balance,integration:l,onBack:()=>{m?.(),R("select-plan")},onNext:e=>{m?.(),eh({resourceName:e.resourceName,createDrainPayload:e.createDrainPayload})},product:c,projectId:k??void 0,source:n,team:s});case"provisioning":return(0,t.jsx)(eN,{authorizationId:J,cancelLabel:p,configurationId:d.id,createdDrain:M,createdResource:er,integration:l,isTransitioning:i||P&&!M,onBack:()=>{m?.(),R("confirm")},onChangePaymentMethod:ep,onNext:()=>{m?.(),em()},onSkipOnboarding:x,product:c,resourceName:$,success:!!er&&(!P||!!M),team:s});case"top-up":return(0,t.jsx)(eE,{integration:l,isTransitioning:i,onBack:()=>{m?.(),R("select-plan")},onNext:()=>{m?.(),ed()},product:c})}});function eD(e){let{onBack:n,onIntegrationResourceCreate:r,onSkipOnboarding:i,cancelLabel:s,product:c,integration:d,teamSlug:g,team:p,initialConfigurationStatus:h,neonIntegrationStatus:m,onStepChange:x}=e,{team:j}=(0,o.useTeam)(g),b=p??j,{pushToDetailPath:y}=(0,u.usePushToStorePath)(),{configurationStatus:f,onConfigurationInstalled:C}=(0,l.useConfigurationStatus)({initialConfigurationStatus:h}),{data:S}=(0,ei.default)(!f.isLoading&&f.isInstalled?f.configuration.id:void 0),[k,I]=(0,a.useState)(!1);if((0,a.useEffect)(()=>{m.isLoading||I(!0)},[m.isLoading]),f.isLoading||!b||m.isLoading&&!k)return(0,t.jsx)(eU,{cancelLabel:s,integration:d,onBack:n,product:c});if(!f.isInstalled)return(0,t.jsx)(Y,{cancelLabel:s,checkoutContentVariant:"default",integration:d,isLoading:!d,onBack:n,onSuccess:C,product:c,team:b});if(!S)return(0,t.jsx)(eU,{cancelLabel:s,integration:d,onBack:n,product:c});let M=d.supportsInstallationBillingPlans?S.billingPlan??f.configuration.billingPlan:void 0;return(0,t.jsx)(e_,{onStepChange:x,cancelLabel:s,configuration:S,installationBillingPlan:f.billingPlan??M,integration:d,onBack:n,onIntegrationResourceCreate:r,onSkipOnboarding:i,preselectedBillingPlan:f.billingPlan,product:c,team:b})}function e_(e){let{team:n,installationBillingPlan:i,preselectedBillingPlan:o,integration:l,product:u,configuration:x,onStepChange:j,onBack:b,onIntegrationResourceCreate:y,onSkipOnboarding:f,cancelLabel:C}=e,{canCreateResource:S,isLoading:k,isDeleteRequested:I}=(0,c.useInstallationPermissions)(x.id),[M,w]=(0,a.useTransition)();return I?(0,t.jsx)(m.ResourceModalWrapper,{SuccessAction:null,cancelLabel:C,checkoutContentVariant:"default",from:"resource",integration:l,onBack:b,product:u,children:(0,t.jsx)(r.Note,{type:"warning",children:`${(0,g.pendingDeletionLabel)("create",u,n.name)}`})}):k||S?(0,t.jsx)(p.ResourceFormProvider,{metadataSchema:u.metadataSchema,resourceTitle:d.storeTitle.integration,target:"create",children:(0,t.jsx)(h.MarketplaceInstallationBillingPlansProvider,{defaultPlan:o??i,isBillingPlanPreselected:!!o,target:"create",children:(0,t.jsx)(s.DisabledContext.Provider,{value:k||M,children:(0,t.jsx)(eF,{arePermissionsLoading:k,cancelLabel:C,configuration:x,integration:l,isTransitioning:M,onBack:b,onIntegrationResourceCreate:y,product:u,startTransition:w,team:n,onStepChange:j,onSkipOnboarding:f})})})}):(0,t.jsx)(m.ResourceModalWrapper,{SuccessAction:null,cancelLabel:C,checkoutContentVariant:"default",from:"resource",integration:l,onBack:b,product:u,children:(0,t.jsx)(r.Note,{type:"warning",children:`${(0,g.missingPermissionLabel)("create",u,n.name)}`})})}function eU(e){return(0,t.jsx)(m.ResourceModalWrapper,{SuccessAction:(0,t.jsx)(n.Modal.Action,{buttonType:"submit",disabled:!0,loading:!0,children:"Continue"}),from:"installation",checkoutContentVariant:"default",...e,children:(0,t.jsx)("div",{className:"flex size-full items-center justify-center py-16",children:(0,t.jsx)(i.Spinner,{})})})}e.s(["CreateResourceModal",()=>eD],6356390)},15312,e=>{"use strict";var t=e.i(6468255),a=e.i(7512194),n=e.i(9508212),r=e.i(6891161),i=e.i(8923565),o=e.i(6696646),s=e.i(119294),l=e.i(6352514),c=e.i(9668517),d=e.i(4597921);e.i(6887680);var u=e.i(6810699),g=e.i(8711152);e.i(5628754);var p=e.i(680627),h=e.i(1017032),m=e.i(5074599),x=e.i(4981413),j=e.i(3758860),b=e.i(7849855),y=e.i(7137779),f=e.i(2483721),C=e.i(3183079),S=e.i(39509),k=e.i(6356390),I=e.i(9100551),M=e.i(3584802);function w(){let e=(0,c.useTeamSlug)(),{data:a}=(0,h.useConfigurations)({type:"marketplace",skipBillingData:!0}),{hasProject:w,projectSlug:P}=(0,b.useProjectSlug)(),{state:T,onClose:v,onBack:A,onAnimationDone:N,protocolType:R,onResourceUpdated:L,maybeGoToConnectProjectStep:E,goToCreateResourceStep:B,switchTab:O}=(0,C.useResourceModalsContext)(),{data:F}=(0,u.useResourceList)({protocolType:R}),D=(0,I.useRouter)(),_=(0,d.useServerFlag)("enable-marketplace-drains",!1),U=`create-connect-${T.modalKey}`,[$,z]=(0,o.useState)(),V=(0,o.useRef)(null),W=(0,o.useCallback)(()=>{z(void 0),N()},[N]),K=(0,o.useCallback)(()=>{z(void 0),v()},[v]),q=(0,o.useCallback)(e=>{"integration"===e.type&&(0,j.supportsAnyDrainProtocol)(e.product)&&_?(L({resource:e,isConnected:!0}),v()):(L({resource:e,isConnected:!1}),E(e))},[E,L,v,_]);switch(T.type){case S.ResourceModalsActionTypes.ModalClosed:return(0,t.jsx)(r.Modal.Modal,{active:T.active,allowOverflow:!0,onAnimationDone:W,onClickOutside:v,width:620,children:(0,t.jsx)("div",{})},U);case S.ResourceModalsActionTypes.BrowseProudctsOrSelectResources:return(0,t.jsx)(r.Modal.Modal,{active:T.active,allowOverflow:!0,onAnimationDone:W,onClickOutside:v,width:"browse-new"===T.tab?540:620,children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.Modal.Body,{className:"p-8",children:(0,t.jsxs)(n.Stack,{gap:6,ref:V,children:[(0,t.jsx)(n.Stack,{gap:2,children:(0,t.jsx)(r.Modal.Title,{center:!0,children:(0,m.browseProductsOrSelectResourcesModalTitle)(R)})}),(0,t.jsxs)(i.Switch,{name:"switch-new-existing-tab",children:[(0,t.jsx)(i.Switch.Control,{defaultChecked:"browse-new"===T.tab,label:"Create New",onChange:()=>{O("browse-new")},size:"large",value:"create",width:104}),(0,t.jsx)(i.Switch.Control,{defaultChecked:"browse-existing"===T.tab,disabled:F?.stores.length===0,label:"Select Existing",onChange:()=>{O("browse-existing")},size:"large",value:"connect",width:122})]}),"browse-new"===T.tab?(0,t.jsx)(x.BrowseProducts,{onClickProduct:e=>{z(e)},protocolType:R,selectedProduct:$}):null,"browse-existing"===T.tab?(0,t.jsx)(p.SelectResources,{hasCreateConnectButton:!1,onClickConnectStoreModal:e=>{E(e)},protocolType:R}):null]})}),(0,t.jsxs)(r.Modal.Actions,{children:[(0,t.jsx)(r.Modal.Action,{onClick:K,type:"secondary",children:"Cancel"}),"browse-new"===T.tab?(0,t.jsx)(r.Modal.Action,{disabled:!$,onClick:()=>{$&&("integration"===$.type?D.push((0,M.getIntegrationCheckoutUrl)({params:{teamSlug:e??"",integrationSlug:$.integration.slug},searchParams:{productSlug:$.product.slug,projectSlug:P??void 0,cancelUrl:e?`/${e}/~/integrations/${$.integration.slug}`:`/marketplace/${$.integration.slug}`}})):B($))},children:"Continue"}):null]})]})},U);case S.ResourceModalsActionTypes.BrowseProducts:return(0,t.jsx)(r.Modal.Modal,{active:T.active,allowOverflow:!0,onAnimationDone:W,onClickOutside:v,width:540,children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.Modal.Body,{className:"p-8",children:(0,t.jsxs)(n.Stack,{gap:6,ref:V,children:[(0,t.jsx)(n.Stack,{gap:2,children:(0,t.jsx)(r.Modal.Title,{center:!0,children:(0,m.browseProductsModalTitle)(R)})}),(0,t.jsx)(x.BrowseProducts,{onClickProduct:e=>{z(e)},protocolType:R,selectedProduct:$})]})}),(0,t.jsxs)(r.Modal.Actions,{children:[(0,t.jsx)(r.Modal.Action,{onClick:K,type:"secondary",children:"Cancel"}),(0,t.jsx)(r.Modal.Action,{disabled:!$,onClick:()=>{$&&("integration"===$.type?(D.push((0,M.getIntegrationCheckoutUrl)({params:{teamSlug:e??"",integrationSlug:$.integration.slug},searchParams:{productSlug:$.product.slug,projectSlug:P??void 0,cancelUrl:`${window.location.pathname}${window.location.search}`}})),s.analytics.track(l.AnalyticsEvent.MARKETPLACE_PRODUCT_INSTALL_CLICKED,{source:"storage",integration:{id:$.integration.id,slug:$.integration.slug},productSlug:$.product.slug})):B($))},children:"Continue"})]})]})},U);case S.ResourceModalsActionTypes.CreateResource:{if("integration"!==T.resourceWithProduct.type)return null;let n=T.resourceWithProduct.integration;return(0,t.jsx)(r.Modal.Modal,{active:T.active,allowOverflow:!0,onAnimationDone:W,onClickOutside:v,width:540,children:(0,t.jsx)(k.CreateResourceModal,{cancelLabel:T.backOrCancelLabel,initialConfigurationStatus:(0,g.getConfigurationStatusByIntegrationId)(a,n.id),integration:n,neonIntegrationStatus:{isNeonDisabled:!1,isLoading:!1},onBack:A,onIntegrationResourceCreate:q,product:(0,j.getProductWithSupportedProtocols)(T.resourceWithProduct.product),teamSlug:e??""})},U)}case S.ResourceModalsActionTypes.CreateEnvs:if(T.connection)return(0,t.jsx)(y.UpdateResourceConnectionModal,{active:T.active,connection:T.connection,onAnimationDone:W,onClickOutside:v,onConnectionCreated:()=>L({resource:T.resource,isConnected:!0}),resourceId:T.resource.id,store:T.resource},U);if(w)return(0,t.jsx)(r.Modal.Modal,{active:T.active,allowOverflow:!0,onAnimationDone:W,onClickOutside:v,width:540,children:(0,t.jsx)(y.ConnectResourceForCurrentProjectStep,{resource:T.resource})},U);return(0,t.jsx)(y.CreateResourceConnectionModal,{active:T.active,onAnimationDone:W,onClickOutside:v,onConnectionCreated:()=>L({resource:T.resource,isConnected:!0}),resourceId:T.resource.id,store:T.resource},U);case S.ResourceModalsActionTypes.DeleteEnvs:return(0,t.jsx)(f.DeleteStoreConnectionModal,{active:T.active,connections:T.connections,onAnimationDone:W,onClickOutside:v,resourceId:T.resourceId,resource:T.resource},U)}}function P(e){let{children:n,protocolType:r}=e;return(0,t.jsx)(a.ResourceModalsProviderBase,{Modal:(0,t.jsx)(w,{}),protocolType:r,children:n})}e.s(["ResourceModalsProvider",()=>P],15312)}]);

//# sourceMappingURL=a0d02ebc09e97d8b.js.map
//# debugId=0b1dd83f-36f6-54b5-aa79-485ec72aeb75
