
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="4b9d4aa8-f515-56ed-8eb6-893f77c8d8ad")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,131102,e=>{"use strict";var t=e.i(9100551),n=e.i(818351),i=e.i(134877),a=e.i(7952834),r=e.i(7101053);function o(e){let{teamSlug:o}=(0,t.useParams)()??{},l=(0,r.useDefaultProjectParams)();return(0,n.useIsomorphicSWR)(e?(0,a.getProjectKey)(e,{teamId:o,...l}):null,async(e,t)=>{try{let n=await t(e);return(0,a.transformDeploymentOverviewProject)(n)}catch(e){if((0,i.isAPIErrorForbidden)(e)||(0,i.isAPIErrorNotFound)(e))return null;throw e}})}e.s(["useDeploymentOverviewProject",()=>o])},9850094,e=>{"use strict";var t=e.i(215852),n=e.i(134877),i=e.i(7952834),a=e.i(7101053);function r(e,r){let o=(0,a.useDefaultProjectParams)(),l=(0,i.getProjectKey)(e.projectSlug,{teamId:e.teamSlug,...o});return(0,t.useIsomorphicSuspenseSWR)(l,async(e,t)=>{try{let n=await t(e);return(0,i.transformDeploymentOverviewProject)(n)}catch(e){if((0,n.isAPIErrorForbidden)(e)||(0,n.isAPIErrorNotFound)(e))return null;throw e}},r)}e.s(["useDashboardDeploymentOverviewProject",()=>r])},3212616,7629673,e=>{"use strict";var t=e.i(9100551),n=e.i(9850094);function i(e){let{project:i,teamSlug:a}=(0,t.useParams)()??{};if(!a||!i)throw Error("Missing params");return(0,n.useDashboardDeploymentOverviewProject)({projectSlug:i,teamSlug:a},e)}e.s(["useCurrentDashboardDeploymentOverviewProject",()=>i],3212616);var a=e.i(4396019);function r(e){let{project:n}=(0,t.useParams)()??{},{deployment:i}=(0,a.useProjectProductionDeployment)(n);return!!(e&&i?.id===(e.id||e.uid))}e.s(["useIsCurrentProductionDeployment",()=>r],7629673)},8382149,9148684,e=>{"use strict";var t=e.i(6468255),n=e.i(6696646),i=e.i(8159863),a=e.i(3212616),r=e.i(5129431),o=e.i(2645806),l=e.i(7629673),s=e.i(9365163),c=e.i(6619197),d=e.i(57106),u=e.i(4030453),p=e.i(6891161),m=e.i(9318197),h=e.i(1344973),x=e.i(455575),y=e.i(4004502),g=e.i(277234),j=e.i(4244280),b=e.i(5338940),f=e.i(609109),v=e.i(2695633),k=e.i(9100551),w=e.i(9716741),C=e.i(131102);let S=(0,n.memo)(function(e){let{active:i,onClose:a,deployment:r,teamId:o}=e,[l,s]=(0,n.useState)(!1),c=(0,k.useRouter)(),{teamSlug:d,project:u}=(0,k.useParams)()??{},{data:m}=(0,C.useDeploymentOverviewProject)(u),h=(0,n.useCallback)(async()=>{s(!0);let e=o?`?teamId=${o}`:"";await (0,g.fetchAPI)(`${(0,j.API_DEPLOYMENTS)("v2")}/${r.id}${e}`,{throwOnHTTPError:!0,method:"DELETE"}),c.replace(`/${d??""}/${encodeURIComponent(m?.name||"")}?deploymentDeleted=1`),s(!1)},[r,o,c,m,d]);return(0,t.jsxs)(p.Modal.Modal,{active:i,onClickOutside:a,width:"500px",children:[(0,t.jsxs)(p.Modal.Body,{children:[(0,t.jsx)(p.Modal.Header,{children:(0,t.jsx)(p.Modal.Title,{children:"Delete Deployment"})}),(0,t.jsxs)(w.default,{preset:"body-2",children:[(0,t.jsx)("b",{children:"NOTE:"})," Deployments that are not actively receiving any traffic do not generate any costs nor count towards any limits."]}),(0,t.jsx)(w.default,{preset:"body-2",children:"Deleting this deployment will prevent you from instantly reverting and might break links used in integrations, such as the ones in the pull requests of your Git provider."}),(0,t.jsx)(w.default,{preset:"body-2",style:{marginBottom:0},children:"Are you sure you want to continue?"})]}),(0,t.jsxs)(p.Modal.Actions,{children:[(0,t.jsx)(p.Modal.Action,{loading:!1,onClick:a,type:"secondary",children:"Cancel"}),(0,t.jsx)(p.Modal.Action,{disabled:l,loading:l,onClick:h,children:"Delete"})]})]})});var A=e.i(1857939),I=e.i(1717203),D=e.i(7557283);function T(e){let{project:t,deployment:n}=e,{can:i,isLoading:a}=(0,I.default)({projectIdOrName:t?.name}),{isLoggedOut:r}=(0,A.useIsLoggedIn)(),o=n?.target==="production"?D.Resource.DeploymentFromProductionBranch:D.Resource.DeploymentPreview,l=i(D.Action.Create,o),s=i(D.Action.Update,o),c=i(D.Action.Read,o)||!!(r&&n?.public),d=i(D.Action.Delete,o),u=i(D.Action.Create,D.Resource.Deployment),p=i(D.Action.Update,D.Resource.SkewProtection),m=i(D.Action.Create,D.Resource.DeploymentFromProductionBranch)&&u;return{isLoading:a,permissions:{canCreateDeployment:l,canUpdateDeployment:s,canReadDeployment:c,canDeleteDeployment:d,canPromoteToProduction:u,canUpdateSkewProtection:p,canRedeployProduction:m}}}e.s(["useDeploymentPermissions",()=>T],9148684);let P=(0,n.createContext)(void 0);function E(e){let{children:i}=e,[a,r]=(0,n.useState)(!0),[o,l]=(0,n.useState)({openRedeployModal:()=>{},openCancelDeploymentModal:()=>{},openPromoteToProductionModal:()=>{},openInstantRollbackModal:()=>{},openSkewProtectionModal:()=>{},openDeleteDeploymentModal:()=>{},canRollbackDeployment:!1,isLoadingModals:a});return(0,t.jsxs)(P.Provider,{value:o,children:[i,(0,t.jsx)(n.Suspense,{fallback:null,children:(0,t.jsx)(M,{setIsLoadingModals:r,setModalsContext:l})})]})}function M(e){let{setIsLoadingModals:n,setModalsContext:i}=e,{data:r}=(0,a.useCurrentDashboardDeploymentOverviewProject)();return r?(0,t.jsx)(N,{project:r,setIsLoadingModals:n,setModalsContext:i}):null}function N(e){let{setIsLoadingModals:a,setModalsContext:k,project:w}=e,{data:C,mutate:A}=(0,i.useCurrentDashboardDeploymentInterval)(),{permissions:I}=T({project:w,deployment:C}),D=(0,l.useIsCurrentProductionDeployment)(),{modal:P,open:E}=(0,r.default)(w),{canRollbackDeployment:M,rollbackModal:N,openRollbackModal:L}=(0,s.useInstantRollbackModal)(w),{modal:R,open:O}=function(e){let[i,a]=(0,n.useState)(!1),[r,o]=(0,n.useState)(!1),[l,s]=(0,n.useState)(null),[c,k]=(0,n.useState)(null),w=(0,x.useToasts)(),{team:C}=(0,b.useTeam)(),S=C?.id,A=(0,v.getGitMeta)(l?.meta),I=(0,n.useCallback)(e=>{s(e),a(!0)},[]),D=(0,n.useCallback)(()=>{a(!1)},[]),T=(0,n.useCallback)(()=>{o(!1),s(null),k(null)},[]),P=(0,n.useCallback)(()=>{if(!e)throw k({message:"projectIdOrName is required to save skew protection"}),Error("projectIdOrName is required to save skew protection");if(!l)throw k({message:"deployment is required to save skew protection"}),Error("deployment is required to save skew protection");o(!0),k(null),(0,g.fetchAPI)(`${(0,j.API_PROJECTS_VERSION)("v9")}/${encodeURIComponent(e)}${S?`?teamId=${S}`:""}`,{method:"PATCH",body:JSON.stringify({skewProtectionBoundaryAt:l.createdAt}),throwOnHTTPError:!0}).then(e=>{e&&(w.success("Successfully configured Skew Protection."),D())}).catch(e=>{k(e)}).finally(()=>{o(!1)})},[e,l,S,w,D]);return{modal:(0,n.useMemo)(()=>(0,t.jsxs)(p.Modal.Modal,{active:i,"data-testid":(0,y.tid)("skew-protection-modal","modal"),onAnimationDone:T,onClickOutside:D,width:"500px",children:[(0,t.jsxs)(p.Modal.Body,{children:[(0,t.jsx)(p.Modal.Header,{children:(0,t.jsx)(p.Modal.Title,{children:"Skew Protection Threshold"})}),(0,t.jsx)(m.Spacer,{y:1}),(0,t.jsxs)(h.Text,{children:["Deployments created before"," ",A?(0,t.jsx)(d.Link,{external:!0,href:A.commitUrl,title:"Open git commit in a new window",type:"highlight",children:A.sha.slice(0,7)}):"the selected deployment"," ","(",(0,t.jsx)("em",{children:(0,f.formatDateAndTime)(new Date(l?.createdAt??0))}),")"," ","will no longer use Skew Protection."]}),(0,t.jsx)(m.Spacer,{y:1}),(0,t.jsx)(h.Text,{children:"This overrides the maximum age set in your project settings to define a specific deployment as the cutoff."}),(0,t.jsx)(m.Spacer,{y:1}),(0,t.jsx)(h.Text,{children:"While uncommon, this may be necessary if there is a specific problematic deployment you want to ensure no longer resolves requests from any other active clients."}),(0,t.jsx)(m.Spacer,{y:1}),c?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.Error,{error:c}),(0,t.jsx)(m.Spacer,{y:1})]}):null,(0,t.jsxs)(h.Text,{children:["Learn more about"," ",(0,t.jsx)(d.Link,{external:!0,href:"https://vercel.com/docs/skew-protection",type:"highlight",children:"Skew Protection"})]})]}),(0,t.jsxs)(p.Modal.Actions,{children:[(0,t.jsx)(p.Modal.Action,{loading:!1,onClick:D,type:"secondary",children:"Cancel"}),(0,t.jsx)(p.Modal.Action,{"data-testid":(0,y.tid)("skew-protection-modal","save-button"),loading:r,onClick:P,children:"Set"})]})]}),[D,T,i,r,c,P,l,A]),close:D,open:I}}(w.id),B=(0,n.useCallback)(()=>{A()},[A]),{modal:_,open:F}=(0,c.default)(C.projectId,w,{onDeploymentPromoted:B}),[U,H]=(0,n.useState)(!1),[V,z]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{a(!1),k({openRedeployModal:()=>E(C),openCancelDeploymentModal:()=>H(!0),openPromoteToProductionModal:()=>F(C),openInstantRollbackModal:()=>L(C),openSkewProtectionModal:()=>O(C),openDeleteDeploymentModal:()=>z(!0),canRollbackDeployment:M,isLoadingModals:!1})},[M,C,D,L,F,E,O,k,a]),(0,t.jsxs)(t.Fragment,{children:[N,R,_,P,(0,t.jsx)(o.default,{active:U,deployment:C,onClose:()=>H(!1),teamId:C.team?C.team.id:null}),I.canDeleteDeployment?(0,t.jsx)(S,{active:V,deployment:C,onClose:()=>z(!1),teamId:C.team?.id}):null]})}P.displayName="DeploymentModalsContext",e.s(["DeploymentModalsProvider",()=>E,"useDeploymentModals",0,()=>{let e=(0,n.useContext)(P);if(!e)throw Error("useDeploymentRedeployModal must be used within a DeploymentModalsProvider");return e}],8382149)},3872400,e=>{"use strict";var t=e.i(6468255),n=e.i(6696646),i=e.i(9100551),a=e.i(4004502),r=e.i(8893913),o=e.i(3753138),l=e.i(8876434),s=e.i(9508212),c=e.i(5255926),d=e.i(2504781),u=e.i(1344973),p=e.i(5468328),m=e.i(8674454),h=e.i(4991687),x=e.i(6694387),y=e.i(8459493),g=e.i(7448864),j=e.i(5326905),b=e.i(455575),f=e.i(119294),v=e.i(6352514),k=e.i(3981247),w=e.i(1857939),C=e.i(57106),S=e.i(545405),A=e.i(475038),I=e.i(8382149),D=e.i(380513),T=e.i(9148684),P=e.i(472117),E=e.i(4443312),M=e.i(6619197),N=e.i(9365163);function L(e){let{project:c,deployment:d}=e,{permissions:C,isLoading:L}=(0,T.useDeploymentPermissions)({project:c,deployment:d}),{data:B}=(0,k.useRollingRelease)({teamIdOrSlug:c?.accountId,projectSlug:c?.name}),_=(0,P.useChecksPrivateBetaFlag)(),F=(0,P.useCiChecksAndPoliciesFlagV2)(),U=_||F,{data:H}=(0,D.useFeatureFlag)("enable-team-deployments-page"),{isLoggedOut:V}=(0,w.useIsLoggedIn)(),z=(0,A.useIsViewingPublicDeployment)(),q=(0,b.useToasts)(),{openRedeployModal:$,openPromoteToProductionModal:Y,openSkewProtectionModal:G,openInstantRollbackModal:W,openDeleteDeploymentModal:K,canRollbackDeployment:Q,isLoadingModals:X}=(0,I.useDeploymentModals)(),J=(0,n.useCallback)(e=>{(0,S.copyToClipboard)(e),q.message("Copied to clipboard!"),f.analytics.track(v.AnalyticsEvent.DEPLOYMENT_OVERVIEW_COPIED_DEPLOYMENT_URL,{projectId:d.projectId,deploymentId:d.id,deploymentTarget:d.target})},[d,q]),Z=Object.values(C).every(e=>!e),ee=Object.values(C).every(e=>e),{teamSlug:et,project:en}=(0,i.useParams)()??{},ei=(0,n.useMemo)(()=>{if(!et||!en)return null;let e=new URLSearchParams,t=d.gitSource?.ref;return t?(e.set("filterBranch",t),`/${et}/${en}/deployments?${e.toString()}`):null},[et,en,d]),ea=(0,n.useMemo)(()=>{if(!et)return null;let e=new URLSearchParams,t=d.gitSource?.ref;return t?(e.set("filterBranch",t),`/${et}/~/deployments?${e.toString()}`):null},[et,d]),er=H&&ea?ea:ei,eo=!!(c?.link?.type==="github"&&c.link.org&&c.link.repo&&d.meta?.githubCommitSha),{data:el}=(0,E.useProjectCheckRuns)({deploymentId:d.id,enableCiChecksAndPolicies:U}),es=!!eo&&!!el&&!el.runs.every(e=>"succeeded"===e.conclusion&&"completed"===e.status),ec=(0,M.usePromoteTooltip)(d),ed=(0,N.useRollbackTooltip)(d);if(Z)return(0,t.jsx)(O,{});if(!z&&L&&!V)return(0,t.jsx)(R,{});let eu=null;Q&&(eu=ed?(0,t.jsx)(s.Stack,{children:(0,t.jsx)(p.Tooltip,{position:"top",boxAlign:"center",style:{width:"100%"},text:ed,children:(0,t.jsx)(y.MenuItem,{disabled:!0,style:{width:"100%"},suffix:(0,t.jsx)(r.RotateCounterClockwise,{color:"gray-600"}),children:(0,t.jsx)(s.Stack,{align:"center",direction:"row",gap:2,children:(0,t.jsx)(u.Text,{as:"span",style:{fontSize:"inherit",color:"inherit"},children:"Instant Rollback"})})})})}):(0,t.jsx)(y.MenuItem,{onClick:W,suffix:(0,t.jsx)(r.RotateCounterClockwise,{color:"gray-900"}),title:ed,children:(0,t.jsx)(s.Stack,{align:"center",direction:"row",gap:2,children:(0,t.jsx)(u.Text,{as:"span",style:{fontSize:"inherit",color:"inherit"},children:"Instant Rollback"})})}));let ep=null;if(C.canPromoteToProduction){let e=!!ec,n="production"===d.target,i=e?"Promote":B?.rollingRelease?.state==="ACTIVE"?"Queue for Promotion":n&&es&&U?"Force Promote":n?"Promote":es?"Force Promote to Production":"Promote to Production";ep=e?(0,t.jsx)(s.Stack,{children:(0,t.jsx)(p.Tooltip,{boxAlign:"center",position:"top",style:{width:"100%"},text:ec,children:(0,t.jsx)(y.MenuItem,{disabled:!0,style:{width:"100%"},suffix:(0,t.jsx)(o.ArrowCircleUp,{color:"gray-600"}),children:(0,t.jsx)(s.Stack,{align:"center",direction:"row",gap:2,children:(0,t.jsx)(u.Text,{as:"span",style:{fontSize:"inherit",color:"inherit"},children:i})})})})}):(0,t.jsx)(y.MenuItem,{disabled:X,onClick:Y,suffix:(0,t.jsx)(o.ArrowCircleUp,{color:"gray-900"}),children:i})}let em="production"===d.target?C.canRedeployProduction:C.canCreateDeployment;return(0,t.jsxs)(h.MenuContainer,{position:"bottom-end",children:[(0,t.jsx)(x.MenuButton,{"aria-label":"Deployment Actions","data-testid":(0,a.tid)("deployment-actions","more-button"),disabled:!d,shape:"square",svgOnly:!0,type:"secondary",children:(0,t.jsx)(l.MoreHorizontal,{})}),(0,t.jsxs)(m.Menu,{width:"auto",children:[z?null:(0,t.jsxs)(t.Fragment,{children:[eu,ep,em?(0,t.jsx)(y.MenuItem,{disabled:z||X,onClick:$,children:"Redeploy"}):null]}),C.canReadDeployment?(0,t.jsx)(y.MenuItem,{onClick:()=>J(`https://${d.host}`),children:"Copy URL"}):null,!z&&er?(0,t.jsx)(y.MenuItem,{href:er,isLink:!0,children:"View All Branch Deployments"}):null,!z&&C.canUpdateSkewProtection?(0,t.jsx)(y.MenuItem,{disabled:X||!c?.skewProtectionMaxAge,onClick:G,children:"Skew Protection Threshold"}):null,!z&&C.canDeleteDeployment?(0,t.jsx)(y.MenuItem,{disabled:!function(e){let{readyState:t}=e;return"QUEUED"!==t&&"BUILDING"!==t}(d)||X,onClick:K,type:"error",children:"Delete"}):null,!ee&&!V&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.MenuDivider,{}),z?null:(0,t.jsxs)(t.Fragment,{children:[Q?null:(0,t.jsx)(g.MenuItemLocked,{children:"Instant Rollback"}),C.canPromoteToProduction?null:(0,t.jsx)(g.MenuItemLocked,{children:"Promote"}),em?null:(0,t.jsx)(g.MenuItemLocked,{children:"Redeploy"})]}),C.canReadDeployment?null:(0,t.jsx)(g.MenuItemLocked,{children:"Copy URL"}),z||C.canUpdateSkewProtection?null:(0,t.jsx)(g.MenuItemLocked,{children:"Skew Protection Threshold"}),z||C.canDeleteDeployment?null:(0,t.jsx)(g.MenuItemLocked,{children:"Delete"})]})]})]})}function R(){return(0,t.jsx)(c.Skeleton,{children:(0,t.jsx)(O,{})})}function O(){return(0,t.jsx)(p.Tooltip,{position:"bottom",text:(0,t.jsxs)(t.Fragment,{children:["Additional permissions are required to manage Deployment."," ",(0,t.jsx)(C.Link,{href:"/docs/deployments",variant:"highlight",children:"Learn More →"})]}),children:(0,t.jsx)(d.Button,{"aria-label":"Deployment Actions","data-testid":(0,a.tid)("deployment-actions","more-button"),disabled:!0,shape:"square",svgOnly:!0,type:"secondary",children:(0,t.jsx)(l.MoreHorizontal,{})})})}e.s(["DeploymentMetadataMenuSkeleton",()=>R,"DeploymentMoreMenu",()=>L])},1585391,e=>{"use strict";var t=e.i(9100551),n=e.i(215852),i=e.i(1988648),a=e.i(5709282);function r(e){var r;let o,{teamSlug:l,id:s}=(0,t.useParams)()??{};if(!l||!s)throw Error("Missing params");return r={deploymentId:s,teamSlug:l},o=(0,i.getDashboardDeploymentDomainsEndpoint)(r),(0,n.useIsomorphicSuspenseSWR)(o,async(e,t)=>{let n=await t(e);return{...n,aliases:n.aliases.sort(a.domainStringCompare)}},e)}e.s(["useCurrentDashboardDeploymentDomains",()=>r],1585391)},310143,e=>{"use strict";var t=e.i(6468255),n=e.i(9722978),i=e.i(2504781),a=e.i(5468328),r=e.i(7917902),o=e.i(5044530),l=e.i(8893913),s=e.i(475038),c=e.i(100247),d=e.i(6696646),u=e.i(9166951),p=e.i(5585544),m=e.i(3353711),h=e.i(8735244),x=e.i(5255926),y=e.i(6891161),g=e.i(9668517),j=e.i(2695633),b=e.i(3089600),f=e.i(5229375),v=e.i(4896636),k=e.i(1585391),w=e.i(243249);let C=e=>{let{team:t,user:n,projectName:i}=e,a=t?.slug||n?.username;return a&&i?`/${a}/${i}/settings/deployment-protection`:""};var S=e.i(3306538),A=e.i(8674454),I=e.i(6694387),D=e.i(4991687),T=e.i(8459493),P=e.i(8522580),E=e.i(7087273),M=e.i(9508212),N=e.i(1344973),L=e.i(455575),R=e.i(57106),O=e.i(1438473),B=e.i(6318858),_=e.i(2560270),F=e.i(4345845),U=e.i(5479400),H=e.i(3228096),V=e.i(9138164),z=e.i(2375916),q=e.i(2563635),$=e.i(3814652),Y=e.i(119294),G=e.i(6352514),W=e.i(7780974),K=e.i(7837522),Q=e.i(3322724),X=e.i(1717203),J=e.i(7557283),Z=e.i(9100551),ee=e.i(2882012);e.i(6483798);var et=e.i(8287059),en=e.i(1475969),ei=e.i(4595422),ea=e.i(9481787),er=e.i(1136434),eo=e.i(5756088);let el=(0,e.i(9334638).withNewIcon)('<path fill-rule="evenodd" clip-rule="evenodd" d="M14 6V4.5C14 3.39543 13.1046 2.5 12 2.5C10.8954 2.5 10 3.39543 10 4.5V6H10.5H12V7.5V12.5C12 13.8807 10.8807 15 9.5 15H2.5C1.11929 15 0 13.8807 0 12.5V7.5V6H1.5H8.5V4.5C8.5 2.567 10.067 1 12 1C13.933 1 15.5 2.567 15.5 4.5V6H14ZM10.5 7.5H10H8.5H1.5V12.5C1.5 13.0523 1.94772 13.5 2.5 13.5H9.5C10.0523 13.5 10.5 13.0523 10.5 12.5V7.5Z" fill="currentColor"/>');var es=e.i(198667),ec=e.i(5326905),ed=e.i(4670733),eu=e.i(1138941),ep=e.i(8529990),em=e.i(9844152),eh=e.i(9815345),ex=e.i(4201247),ey=e.i(1201436);let eg={visible:{opacity:1,scale:1,filter:"blur(0px)"},hidden:{opacity:0,scale:.6,filter:"blur(2px)"}};function ej(e){let{"aria-label":a,classNameSuccess:r,textToCopy:o,onClick:l,label:s,isLoading:c,...u}=e,p=(0,L.useToasts)(),[m,x]=(0,d.useState)(!1),[y,g]=(0,d.useState)(!1),j=(0,d.useRef)(null);return(0,d.useEffect)(()=>{m&&o&&(x(!1),j.current&&clearTimeout(j.current),g(!0),navigator.clipboard.writeText(o).catch(()=>p.error("Failed to copy to clipboard")),j.current=setTimeout(()=>{g(!1)},1e3))},[p,o,m]),(0,t.jsx)(i.Button,{"aria-label":a,disabled:u.disabled||m,onClick:()=>{x(!0),l?.()},...u,className:(0,n.clsx)(u.className,{[r||""]:y}),children:(0,t.jsx)("div",{className:"flex items-center gap-1.5",children:(0,t.jsxs)(eh.MotionConfig,{transition:{duration:.1},children:[(0,t.jsx)(em.AnimatePresence,{initial:!1,mode:"wait",children:c?(0,t.jsx)(h.Spinner,{}):y?(0,t.jsx)(ex.motion.div,{animate:"visible",exit:"hidden",initial:"hidden",variants:eg,children:(0,t.jsx)(B.Check,{})},"check"):(0,t.jsx)(ex.motion.div,{animate:"visible",exit:"hidden",initial:"hidden",variants:eg,children:(0,t.jsx)(ey.Copy,{})},"copy")}),s]})})})}var eb=e.i(1681029);function ef(e){let{alias:t,protectionBypass:n,protectionEnabledForDeployment:i}=e;if(!t)return;let a=(0,eb.domainToUrl)(t);return n&&i?(0,ei.createShareableLink)(a,n):a}var ev=e.i(4123527);function ek(e){let{alias:n,deployment:a,isLoading:o,previewCommentsEnabledForDeployment:l,protectionBypass:s,protectionEnabledForDeployment:c,git:u,onCreateShareableLink:p,onDeleteShareableLink:m,onRegenerateShareableLink:h,openUpgradeModal:x,canUpdateShareableLink:y,viewAndCommentDescription:g}=e,j=(0,Q.useIsMobile)(),b=(0,Q.useMediaQuery)(430),{team:f,account:v}=(0,r.useAccount)(),k=(0,eu.useProjectIdOrName)(),w=v?.billing?.plan==="hobby",[C,S]=(0,d.useState)(s?"anyone":"team"),[I,P]=(0,d.useState)(!1),E=n&&ef({alias:n,protectionBypass:s,protectionEnabledForDeployment:c||!!s}),L=!c&&!l,O=(0,t.jsx)(ej,{"aria-label":"Copy Link",className:"!h-8 !w-auto !justify-start !px-1",disabled:o||!n||I,onClick:()=>Y.analytics.track(G.AnalyticsEvent.DEPLOYMENT_SHARE_COPY_LINK,{projectId:k,deploymentType:"alias"}),textToCopy:E||"",type:"secondary",label:b?"Link":"Copy Link",isLoading:o||I}),_=(0,ep.getGitInfoFromDeployment)(a),F=(0,ed.useNewFeedbackSharingModal)().value||!1,U=_&&!_.isPublic,H=!!(F&&U&&w),V=(0,d.useCallback)(()=>{Y.analytics.track(G.AnalyticsEvent.DEPLOYMENT_SHARE_UPGRADE_TO_PRO_CLICKED,{projectId:k,isHobbyPrivate:H}),x()},[H,x,k]),z=(0,d.useCallback)(e=>{if("anyone"===e&&w||S(e),"anyone"!==e||s)s&&m();else{if(w)return void P(!0);p()}},[w,s,p,m]);(0,d.useEffect)(()=>{I&&s&&P(!1)},[I,P,s,C]),(0,d.useEffect)(()=>{o||S(s?"anyone":"team")},[s,o]);let q=F&&H&&!!f&&(0,t.jsxs)(t.Fragment,{children:["To allow external collaborators to comment on the Hobby plan, the repository"," ",(0,t.jsx)("span",{style:{display:"inline-block",transform:"scale(0.85) translateY(2px)"},children:u?.logo})," ",_?.repoName," ",(0,t.jsx)(eo.LockClosed,{size:12})," visibility must be public."]}),$=(0,d.useMemo)(()=>{if(!y)return"You need additional permissions to manage sharing"},[y]),W="Only people with access",K=c?"Anyone with the link":"Publicly accessible",X=(s||o)&&c;return L?(0,t.jsxs)(ew,{notActionable:!0,children:[(0,t.jsx)(M.Stack,{align:"center",direction:"row",gap:2.5,children:(0,t.jsx)(N.Text,{align:"left",className:"text-pretty [&_svg]:align-text-top",children:"Publicly accessible"})}),O]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(D.MenuContainer,{children:["team"===C?(0,t.jsxs)(ew,{disabled:o||I,notActionable:!!$,children:[(0,t.jsx)(eS,{disabled:o||I,isActionable:!$,children:(0,t.jsx)(M.Stack,{align:"center",direction:"row",gap:2.5,children:(0,t.jsx)(eC,{forceHide:!$,text:$,children:(0,t.jsxs)(N.Text,{align:"left",className:"flex flex-nowrap items-center gap-1 text-pretty",children:[W,b?null:` can ${g}`,$?null:(0,t.jsx)(er.ChevronDownSmall,{})]})})})}),O]}):(0,t.jsxs)(ew,{disabled:o,notActionable:!!$,children:[(0,t.jsx)(eS,{disabled:o,isActionable:!$,children:(0,t.jsx)(M.Stack,{align:"center",direction:"row",gap:2.5,children:(0,t.jsx)(eC,{forceHide:!$,text:$,children:(0,t.jsxs)(M.Stack,{align:"start",children:[(0,t.jsxs)(M.Stack,{align:"center",direction:"row",gap:1,children:[(0,t.jsxs)(N.Text,{align:"left",className:"text-pretty [&_svg]:align-text-top",color:$?"gray-800":void 0,children:[K,c&&!b?` can ${g}`:null]}),$?null:(0,t.jsx)(er.ChevronDownSmall,{})]}),l?(0,t.jsxs)(N.Text,{color:$?"gray-800":"gray-900",size:13,children:["Visitors must"," ",(0,t.jsx)("span",{className:"geist-hide-on-mobile",children:"be logged in"})," ",(0,t.jsx)("span",{className:"geist-show-on-mobile",children:"log in"})," to comment"]}):null]})})})}),O]}),(0,t.jsxs)(A.Menu,{width:300,children:[(0,t.jsx)(eC,{forceHide:!$,text:$,children:(0,t.jsx)(T.MenuItem,{disabled:o||!!$,onClick:()=>z("team"),prefix:(0,t.jsx)(eo.LockClosed,{}),style:{width:"100%"},suffix:"team"===C?(0,t.jsx)(B.Check,{}):null,children:W})}),(0,t.jsx)(eC,{forceHide:!($||q),text:$||q,children:(0,t.jsx)(T.MenuItem,{disabled:o||H||!!$||I,innerMenuItemClassName:"!pointer-events-auto",onClick:()=>{z("anyone")},prefix:(0,t.jsx)(el,{}),style:{width:"100%"},suffix:"anyone"===C?(0,t.jsx)(B.Check,{}):null,children:(0,t.jsxs)(M.Stack,{align:"center",direction:"row",gap:2,justify:"space-between",style:{width:"100%"},children:[K,H?(0,t.jsx)(i.Button,{onClick:V,size:"small",style:{cursor:"pointer",background:"var(--geist-foreground)",color:"var(--geist-background)"},children:"Upgrade"}):null]})})}),X?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ec.MenuDivider,{}),(0,t.jsx)(eC,{text:"Regenerate shareable link",children:(0,t.jsx)(T.MenuItem,{onClick:h,prefix:(0,t.jsx)(es.RefreshClockwise,{}),style:{width:"100%"},children:"Reset link"})})]}):null]})]}),(0,t.jsx)(ev.ToastMobileAware,{actionText:"Confirm",active:I,cancelActionText:"Cancel",onAction:()=>{S("anyone"),p()},onCancelAction:()=>{P(!1)},preserve:!0,toastKey:"create-shareable-link-hobby-confirmation",children:(0,t.jsxs)(M.Stack,{direction:"column",gap:3,children:[(0,t.jsxs)(N.Text,{children:["You can only have 1 shareable link at a time on Hobby."," ",(0,t.jsx)(R.Link,{external:!0,icon:!1,onClick:()=>{P(!1),V()},underline:!j||void 0,variant:j?"highlight":void 0,children:"Upgrade to Pro"})," ","for unlimited shareable links."]}),(0,t.jsx)(N.Text,{children:"Continuing will revoke any existing shareable links."})]})})]})}function ew(e){let{disabled:i=!1,children:a,notActionable:r}=e;return(0,t.jsx)(M.Stack,{className:"w-full",children:(0,t.jsx)(M.Stack,{style:{width:"100%"},children:(0,t.jsx)(M.Stack,{className:(0,n.clsx)("w-full py-0 pl-0.5",{"cursor-not-allowed":i,"cursor-default":r&&!i}),children:(0,t.jsx)(M.Stack,{direction:"row",justify:"space-between",style:{width:"100%"},children:a})})})})}function eC(e){let{children:n,forceHide:i,text:r}=e;return(0,t.jsx)(a.Tooltip,{desktopOnly:!0,forceHide:i,maxWidth:350,padding:10,style:{width:"100%"},text:r,children:n})}function eS(e){let{isActionable:n,children:i,disabled:a}=e;return n?(0,t.jsx)(I.MenuButton,{disabled:a,variant:"unstyled",className:"hover:bg-gray-100 rounded-md",children:i}):(0,t.jsx)(M.Stack,{paddingLeft:1.5,children:i})}var eA=e.i(4585051),eI=e.i(6942035),eD=e.i(2988836),eT=e.i(4796599),eP=e.i(681883),eE=e.i(7898658),eM=e.i(9523111);function eN(){return(0,t.jsx)(M.Stack,{align:"center",className:"max-w-max overflow-hidden rounded-full border border-gray-400 bg-gray-700 p-2 font-bold text-white",justify:"center",children:(0,t.jsx)(eM.Email,{size:16})})}var eL=e.i(7901966);function eR(e){let{target:n,canUpdateProtectionBypass:i=!0,hideStaticTeamMembersBanner:a=!1,onUpgradeClick:r,project:o,revalidateAlias:l,branchAliasId:s,branchName:c}=e;return n?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eO,{branchAliasId:s,branchName:c,canUpdateProtectionBypass:i,filter:"requests",onUpgradeClick:r,project:o,revalidateAlias:l,target:n}),(0,t.jsx)(eO,{canUpdateProtectionBypass:i,filter:"granted",hideStaticTeamMembersBanner:a,onUpgradeClick:r,project:o,revalidateAlias:l,target:n})]}):null}function eO(e){let{target:n,canUpdateProtectionBypass:i=!0,filter:o,hideStaticTeamMembersBanner:l=!1,onUpgradeClick:s,project:c,revalidateAlias:u,branchAliasId:p,branchName:m}=e,{team:h,user:x}=(0,r.useAccount)(),{data:y}=(0,eP.default)({limit:1},{revalidateIfStale:!1,revalidateOnFocus:!1}),g=(0,d.useMemo)(()=>Object.entries(n.protectionBypass??{}).map(e=>{let[t,n]=e;return"user"===n.scope?{...n,userId:t}:"email_invite"===n.scope?{...n,email:t}:void 0}).filter(e=>void 0!==e).sort((e,t)=>t.createdAt>e.createdAt?1:-1),[n.protectionBypass]),j=o?g.filter(e=>("user"===e.scope&&"requested"===e.access)==("requests"===o)):g,b=(0,d.useCallback)(async e=>{await (0,ee.updateAliasProtectionBypass)({aliasId:n.id,teamId:h?.id,body:e}),await u()},[n.id,h?.id,u]),f=(0,d.useMemo)(()=>{if(p&&n.id.startsWith("dpl_"))return async e=>{await (0,ee.insertInviteToAliasProtectionBypass)({aliasId:p,teamId:h?.id,inviteeEmails:[e],message:""}),await u()}},[p,u,n.id,h?.id]);if(0===j.length&&!("granted"===o&&!l))return null;let v=y?.members.length;return(0,t.jsxs)(M.Stack,{gap:2,children:[(0,t.jsx)("p",{className:"text-copy-14 font-medium",children:"requests"===o?"Access requests":"People with access"}),(0,t.jsx)(M.Stack,{gap:4,children:(0,t.jsxs)("div",{className:"space-y-2",children:[l||"granted"!==o?null:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e_,{thumbnail:(0,t.jsx)(eA.Avatar,{size:20,teamId:h?.id,username:h?void 0:x?.username}),title:(0,t.jsxs)(M.Stack,{as:"span",direction:"row",gap:1,children:[(0,t.jsx)(N.Text,{as:"span",weight:500,children:h?.name||"You"}),h?(0,t.jsx)(t.Fragment,{children:/\bteam\b/i.test(h.name)?" members":" team members"}):null,v?(0,t.jsx)(a.Tooltip,{text:"Excluding contributors without access to this project.",children:(0,t.jsx)(eD.InformationFillSmall,{})}):null]})}),v?(0,t.jsx)(e_,{thumbnail:(0,t.jsx)(eV,{project:c}),title:(0,t.jsxs)(N.Text,{as:"span",children:[(0,t.jsx)(N.Text,{as:"span",weight:500,children:c.name})," ",(0,t.jsx)(N.Text,{as:"span",children:"project contributors"})]})}):null]}),j.map(e=>(0,t.jsx)(eB,{branchName:m,canUpdateProtectionBypass:i,onUpgradeClick:s,targetUrl:n.url,updateBranchAccess:f,updateUserAccess:b,user:e},"user"===e.scope?e.userId:e.email))]})})]})}function eB(e){let{canUpdateProtectionBypass:n,onUpgradeClick:i,user:a,updateUserAccess:o,updateBranchAccess:l,branchName:s,targetUrl:c}=e,u=(0,L.useToasts)(),{account:p}=(0,r.useAccount)(),[m,h]=(0,d.useState)(void 0),x=p?.billing?.plan==="hobby",[y,g]=(0,d.useState)(!1),j="user"===a.scope,b=async(e,t)=>{h(e);try{let n=j?{scope:{userId:a.userId,access:e}}:{scope:{email:a.email,access:"denied"}};await Promise.all([o(n),a.email&&t&&l&&"granted"===e?l(a.email):void 0])}catch{u.error("An error occured, please try again later.")}finally{h(void 0)}},f=async e=>{x?g(!0):await b("granted",e)},v=void 0!==m;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e_,{actions:(0,t.jsx)(eF,{branchName:s,canUpdateProtectionBypass:n,isAccessRequested:!!j&&"requested"===a.access,isInvitationFlagEnabled:!0,isLoading:v,isUpdating:m,onAccessGranted:f,showBranchOption:!!(l&&a.email)&&!x,showHobbyLimitAction:y,targetUrl:c,updateAccess:b}),description:j?a.email:void 0,thumbnail:"user"===a.scope?(0,t.jsx)(eA.Avatar,{size:20,username:j?a.username:void 0}):(0,t.jsx)(eN,{}),title:j?a.username??a.userId:a.email}),(0,t.jsx)(eU,{isInvitationFlagEnabled:!0,isLoading:v,onUpgradeClick:i,setShowHobbyLimitAction:g,showHobbyLimitAction:y,updateAccess:b})]})}function e_(e){let{actions:n,description:i,thumbnail:a,title:r}=e;return(0,t.jsxs)(M.Stack,{align:"center",direction:"row",gap:2,justify:"space-between",children:[(0,t.jsxs)(M.Stack,{align:"center",direction:"row",gap:2,children:[a,(0,t.jsxs)(M.Stack,{children:[(0,t.jsx)(N.Text,{lineHeight:20,size:14,children:r}),(0,t.jsx)(N.Text,{color:"gray-900",lineHeight:16,size:13,children:i})]})]}),n]})}function eF(e){let{canUpdateProtectionBypass:n=!0,isAccessRequested:r,isInvitationFlagEnabled:o,isLoading:l,isUpdating:s,onAccessGranted:c,showHobbyLimitAction:d,updateAccess:u,showBranchOption:p,branchName:m,targetUrl:x}=e,y=(0,t.jsx)(eI.Cross,{}),g=(0,t.jsx)(B.Check,{}),j=n?void 0:"You need additional permissions to manage access requests",b=d||!n,f=p?(0,t.jsxs)(D.MenuContainer,{children:[(0,t.jsx)(I.MenuButton,{"aria-label":"Approve",disabled:b,shape:"square",size:"small",svgOnly:!0,type:"tertiary",children:g}),(0,t.jsxs)(A.Menu,{width:"auto",children:[(0,t.jsx)(T.MenuItem,{innerMenuItemClassName:"h-auto py-2",onClick:()=>void c(),prefix:(0,t.jsx)(U.GitCommit,{}),children:(0,t.jsxs)(M.Stack,{direction:"column",gap:1,children:[(0,t.jsx)(N.Text,{children:"Approve for Deployment"}),(0,t.jsx)(N.Text,{color:"gray-900",size:13,children:x})]})}),(0,t.jsx)(T.MenuItem,{innerMenuItemClassName:"h-auto py-2",onClick:()=>void c(!0),prefix:(0,t.jsx)(F.GitBranch,{}),children:(0,t.jsxs)(M.Stack,{direction:"column",gap:1,children:[(0,t.jsx)(N.Text,{children:"Approve for Deployment and Branch"}),(0,t.jsx)(N.Text,{color:"gray-900",size:13,children:m})]})})]})]}):(0,t.jsx)(i.Button,{"aria-label":"Approve",disabled:b,onClick:()=>void c(),shape:"square",size:"small",svgOnly:!0,type:"tertiary",children:g});return(0,t.jsxs)(M.Stack,{align:"center",direction:"row",gap:1,children:[(0,t.jsx)(a.Tooltip,{desktopOnly:!0,text:j??(r?"Decline":"Revoke"),children:l?(0,t.jsx)(M.Stack,{className:"mx-2",children:"denied"===s?(0,t.jsx)(h.Spinner,{size:16}):y}):(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(i.Button,{"aria-label":"Decline",disabled:!n,onClick:()=>void u("denied"),shape:"square",size:"small",svgOnly:!0,type:"tertiary",children:y})})}),r?(0,t.jsx)(a.Tooltip,{desktopOnly:!0,text:j??"Approve",children:l?(0,t.jsx)(M.Stack,{className:"mx-2",children:"granted"===s?(0,t.jsx)(h.Spinner,{size:16}):g}):f}):null]})}function eU(e){let{isInvitationFlagEnabled:n,isLoading:i,onUpgradeClick:a,setShowHobbyLimitAction:r,showHobbyLimitAction:o,updateAccess:l}=e;return n&&a?(0,t.jsx)(eL.HobbyLimitAction,{onUpgradeClick:a,setShowHobbyLimitAction:r,showHobbyLimitAction:o,updateAccess:l}):(0,t.jsx)(eH,{isLoading:i,setShowHobbyLimitAction:r,showHobbyLimitAction:o,updateAccess:l})}function eH(e){let{isLoading:n,setShowHobbyLimitAction:r,showHobbyLimitAction:o,updateAccess:l}=e;return(0,t.jsx)(em.AnimatePresence,{children:o&&!n?(0,t.jsx)(eT.m.div,{animate:{height:"auto"},className:"relative box-border rounded border border-gray-400 bg-gray-100 dark:bg-gray-100",exit:{height:0},initial:{height:0},style:{padding:0},transition:{ease:"easeInOut"},children:(0,t.jsxs)(M.Stack,{align:"center",className:"px-4",direction:"row",gap:2,justify:"space-between",children:[(0,t.jsx)(N.Text,{color:"gray-900",size:13,children:"Hobby plans have a limit of 1 external collaborator at a time. Confirm to remove any existing user access."}),(0,t.jsxs)(M.Stack,{align:"center",direction:"row",gap:1,children:[(0,t.jsx)(a.Tooltip,{desktopOnly:!0,text:"Cancel",children:(0,t.jsx)(i.Button,{"aria-label":"Cancel",onClick:()=>{r(!1)},shape:"square",size:"small",svgOnly:!0,type:"tertiary",children:(0,t.jsx)(eI.Cross,{})})}),(0,t.jsx)(a.Tooltip,{desktopOnly:!0,text:"Confirm",children:(0,t.jsx)(i.Button,{"aria-label":"Confirm",onClick:()=>{r(!1),l("granted")},shape:"square",size:"small",svgOnly:!0,type:"tertiary",children:(0,t.jsx)(B.Check,{})})})]})]})},"hobby-limit-actions"):null})}function eV(e){let{size:n=20,style:i,project:a,title:r}=e,{data:o,isLoading:l}=(0,eE.default)({project:a}),s=(0,eu.useFramework)(a);return!l&&(s||o)?(0,t.jsx)(eA.Avatar,{size:n,src:o?.src||s?.logo,style:i,title:r??s?.name}):(0,t.jsx)(x.Skeleton,{height:n,rounded:!0,style:{flexShrink:0},width:n})}var ez=e.i(8248823),eq=e.i(4030453),e$=e.i(9334091),eY=e.i(8384463),eG=e.i(6734680),eW=e.i(8587921),eK=e.i(5071474);function eQ(e){let{inputText:n,navIndex:i,onPicked:a,setNavIndex:r,suggestions:o}=e;return n?(0,t.jsxs)(M.Stack,{gap:3,children:[(0,t.jsx)(eX,{index:-1,isSelected:-1===i,onClick:()=>{a({label:n,value:n})},onMouseMove:()=>{r(-1)},option:{label:n,value:n}}),o?.map((e,n)=>(0,t.jsx)(eX,{index:n,isSelected:n===i,onClick:()=>{a(e)},onMouseMove:()=>{r(n)},option:e},e.value))]}):null}function eX(e){let{index:i,isSelected:a,onClick:r,onMouseMove:o,option:l}=e,{member:s}=l,c=(0,d.useRef)(null);(0,d.useEffect)(()=>{c.current&&a&&c.current.scrollIntoView({behavior:"smooth",block:-1===i?"end":"nearest"})},[i,a]);let u=s?.name||s?.username,p=u||l.value;return(0,t.jsxs)(M.Stack,{align:"center",className:(0,n.clsx)("relative cursor-default rounded-md transition-colors duration-150 hover:bg-gray-100",{'after:content-["_"] after:box-content after:absolute after:-left-2 after:bg-gray-alpha-100 after:w-full after:h-full after:rounded after:p-2':a}),direction:"row",gap:2,onClick:r,onMouseMove:o,ref:c,children:[s?(0,t.jsx)(eA.Avatar,{size:32,username:s.username}):(0,t.jsx)(eN,{}),(0,t.jsxs)(M.Stack,{style:{overflow:"hidden"},children:[(0,t.jsx)(N.Text,{lineHeight:20,size:14,truncate:!0,children:p}),u?(0,t.jsx)(N.Text,{color:"gray-900",lineHeight:16,size:13,children:l.value}):null]})]})}var eJ=e.i(623454),eZ=e.i(5592888),e0=e.i(2610996),e1=e.i(4386650),e5=e.i(2203852),e2=e.i(712031),e3=e.i(7033292),e4=e.i(6993),e6=["allowCreateWhileLoading","createOptionPosition","formatCreateLabel","isValidNewOption","getNewOptionData","onCreateOption","options","onChange"],e9=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,i=String(e).toLowerCase(),a=String(n.getOptionValue(t)).toLowerCase(),r=String(n.getOptionLabel(t)).toLowerCase();return a===i||r===i},e8=function(e){return'Create "'.concat(e,'"')},e7=function(e,t,n,i){return!(!e||t.some(function(t){return e9(e,t,i)})||n.some(function(t){return e9(e,t,i)}))},te=function(e,t){return{label:t,value:e,__isNew__:!0}};e.i(7828999),e.i(643180),e.i(7966790),e.i(5653849),e.i(7909138),e.i(6623660),e.i(9404324),e.i(7792275),e.i(7738723),e.i(5159057);var tt=(0,d.forwardRef)(function(e,t){var n,i,a,r,o,l,s,c,u,p,m,h,x,y,g,j,b,f,v,k,w,C,S,A,I,D,T,P,E=(a=void 0!==(i=(n=(0,e1.u)(e)).allowCreateWhileLoading)&&i,o=void 0===(r=n.createOptionPosition)?"last":r,s=void 0===(l=n.formatCreateLabel)?e8:l,u=void 0===(c=n.isValidNewOption)?e7:c,m=void 0===(p=n.getNewOptionData)?te:p,h=n.onCreateOption,y=void 0===(x=n.options)?[]:x,g=n.onChange,f=void 0===(b=(j=(0,e3.default)(n,e6)).getOptionValue)?e0.g:b,k=void 0===(v=j.getOptionLabel)?e0.b:v,w=j.inputValue,C=j.isLoading,S=j.isMulti,A=j.value,I=j.name,D=(0,d.useMemo)(function(){return u(w,(0,e4.H)(A),y,{getOptionValue:f,getOptionLabel:k})?m(w,s(w)):void 0},[s,m,k,f,w,u,y,A]),T=(0,d.useMemo)(function(){return(a||!C)&&D?"first"===o?[D].concat((0,e2.default)(y)):[].concat((0,e2.default)(y),[D]):y},[a,o,C,D,y]),P=(0,d.useCallback)(function(e,t){if("select-option"!==t.action)return g(e,t);var n=Array.isArray(e)?e:[e];if(n[n.length-1]===D){if(h)h(w);else{var i=m(w,w);g((0,e4.D)(S,[].concat((0,e2.default)((0,e4.H)(A)),[i]),i),{action:"create-option",name:I,option:i})}return}g(e,t)},[m,w,S,I,D,h,g,A]),(0,e5.default)((0,e5.default)({},j),{},{options:T,onChange:P}));return d.createElement(e0.S,(0,eZ.default)({ref:t},E))}),tn=e.i(6401841),ti=e.i(9096446),ta=e.i(3617058);let tr={control:e=>(0,ta.twMerge)("w-full border border-solid border-gray-alpha-400 bg-white rounded min-h-10 transition-colors duration-200",e.isFocused&&"hover:border-gray-alpha-600 bg-white shadow-focus-border",e.isDisabled&&"bg-gray-100"),valueContainer:()=>"px-2 py-1.5",input:()=>"py-0.5 m-0.5 text-gray-1000 text-base lg:text-sm",placeholder:()=>"mx-0.5 text-gray-600",indicatorsContainer:()=>"flex items-center px-2",indicatorSeparator:()=>"hidden",dropdownIndicator:()=>"text-gray-600 hover:text-gray-800 transition-colors duration-150",clearIndicator:()=>"text-gray-600 hover:text-gray-800 transition-colors duration-150 cursor-pointer",menu:()=>"bg-white border border-gray-alpha-400 rounded-md shadow-lg mt-1 z-50",menuList:()=>"py-1 max-h-60 overflow-auto",option:e=>(0,ta.twMerge)("px-3 py-2 text-sm cursor-pointer transition-colors duration-150 text-gray-1000 hover:bg-gray-100",e.isFocused&&"bg-gray-alpha-100",e.isSelected&&"bg-blue-500 text-white"),multiValue:()=>"inline-flex items-center bg-gray-200 rounded text-sm",multiValueLabel:()=>"pl-1 pr-0 py-1 flex font-medium text-xs",multiValueRemove:()=>"pl-0.5 pr-1 cursor-pointer rounded-xs flex items-center text-inherit box-border hover:bg-transparent hover:text-inherit"},to=(0,d.forwardRef)(function(e,n){let{disabled:i,disabledText:r,inputText:o,invitationFocused:l,invitees:s,onInputBlur:c,onInputChangeHandler:u,onInputFocused:p,onKeyDown:m,placeholder:h,setInvitees:x}=e,y=(0,d.useCallback)((e,t)=>{e&&Array.isArray(e)&&x(e)},[x]),g=(0,t.jsx)(tt,{autoFocus:l,classNames:tr,components:{MultiValue:tl,MultiValueRemove:tc,Option:td,NoOptionsMessage:tm,DropdownIndicator:()=>null},formatCreateLabel:e=>e,inputValue:o,isClearable:!1,isDisabled:i,isLoading:!1,isMulti:!0,isSearchable:!0,menuIsOpen:!1,onBlur:()=>c(),onChange:y,onFocus:()=>p(),onInputChange:u,onKeyDown:m,openMenuOnClick:!1,placeholder:h,ref:n,value:s,unstyled:!0});return i?(0,t.jsx)(a.Tooltip,{desktopOnly:!0,style:{width:"100%",display:"block"},text:r,children:g}):g});function tl(e){let i=e.data,a=!(0,eG.default)(i.value),r={...{innerProps:{className:(0,n.clsx)(e.className,"m-0.5 flex min-h-6 items-center overflow-hidden rounded-full leading-none",{"bg-red-300 hover:bg-red-400 text-red-900 [&_span>div>svg]:hover:stroke-red-500":a,"bg-gray-300 text-gray-1000 hover:bg-gray-400":!a})}},...e};return(0,t.jsx)(eJ.components.MultiValue,{...r,children:(0,t.jsx)(ts,{isEmailInvalid:a,option:i})})}function ts(e){let{isEmailInvalid:i,option:r}=e;return i?(0,t.jsx)(a.Tooltip,{text:"Not a valid email address",children:(0,t.jsxs)(M.Stack,{align:"center",direction:"row",gap:.5,children:[(0,t.jsx)(tp,{}),r.value]})}):(0,t.jsxs)(M.Stack,{align:"center",className:(0,n.clsx)({"ml-0.5":!r.member}),direction:"row",gap:1,children:[r.member?(0,t.jsx)(eA.Avatar,{className:"border-none",size:16,username:r.member.username}):null,r.value]})}function tc(e){let{innerProps:n}=e;return(0,t.jsx)("div",{...n,children:(0,t.jsx)(ti.CrossSmall,{})})}function td(e){let n=e.data;return(0,t.jsx)(eJ.components.Option,{...e,children:(0,t.jsx)(tu,{text:n.label})})}function tu(e){let{text:n}=e;return(0,t.jsxs)(M.Stack,{align:"center",direction:"row",gap:2,children:[(0,t.jsx)(eN,{}),(0,t.jsx)(N.Text,{children:n})]})}function tp(){return(0,t.jsx)(tn.Stop,{"aria-hidden":!0,className:"fill-red-900 stroke-red-300",size:19})}function tm(){return(0,t.jsx)(M.Stack,{align:"center",className:"flex min-h-[70px] items-center justify-center text-sm text-gray-600",children:(0,t.jsx)(N.Text,{color:"gray-700",children:"No options …"})})}function th(e){let{canUpdateProtectionBypass:n,git:o,header:l,branchAliasId:s,selectedTarget:c,invitationFocused:u,onCancel:p,onFinished:m,onFocus:x,openUpgradeModal:g,previewCommentsEnabledForDeployment:j,revalidateAlias:b,teamId:f,viewAndCommentDescription:v,deployment:k}=e,{track:w}=(0,K.useTrackActivity)(),C=(0,L.useToasts)(),S=(0,Q.useIsMobile)(),{account:A}=(0,r.useAccount)(),I=(0,eu.useProjectIdOrName)(),D=A?.billing?.plan==="hobby",[T,E]=(0,d.useState)(!1),B=(0,d.useRef)(null),[_,H]=(0,d.useState)(!1),[V,z]=(0,d.useState)(""),[q,$]=(0,d.useState)([]),[X,J]=(0,d.useState)(""),[Z,et]=(0,d.useState)(null),en=D&&q.length>1,ei=q.some(e=>!(0,eG.default)(e.value)),ea=X.length>250,er=(0,d.useMemo)(()=>ea||ei?"Please correct the form input errors to continue":q.length?en?"Upgrade your plan to invite multiple external collaborators":void 0:"Input must not be empty",[ei,q.length,en,ea]),eo=(0,d.useCallback)(()=>{Y.analytics.track(G.AnalyticsEvent.DEPLOYMENT_SHARE_UPGRADE_TO_PRO_CLICKED,{projectId:I}),g()},[g,I]),el=()=>{B.current&&B.current.focus()},es=(0,d.useCallback)(async()=>{w(W.VercelActivityAction.DeploymentInviteSent,{count:q.length,teamMemberCount:q.filter(e=>void 0!==e.member).length}),et(null),H(!0);try{await (0,ee.insertInviteToAliasProtectionBypass)({aliasId:c.id,teamId:f,inviteeEmails:q.map(e=>e.value),message:X});let e=1===q.length?"Invite was sent":"Invites were sent";C.message({text:e}),$([]),J(""),m(),await b()}catch(e){et((0,ez.normalizeError)(e))}H(!1)},[c.id,q,X,m,b,f,C,w]),[,{isLagging:ec,members:ed}]=(0,eW.useMembersInfinite)({revalidateIfStale:!1},{search:V},!0),ep=(0,d.useMemo)(()=>ed.map(e=>({label:e.name,value:e.email,member:e})).filter(e=>!q.some(t=>t.value===e.value)),[q,ed]),eh=function(e){let[t,n]=(0,d.useState)(-1);return{lowBorder:-1,highBorder:e-1,navIndex:t,resetNavIndex:()=>n(-1),setNavIndex:n}}(ep.length),{navIndex:ex,resetNavIndex:ey,setNavIndex:eg}=eh,ej=(0,d.useCallback)((e,t)=>{"input-change"!==t.action||e.length>320||q.length>50||(z(e),et(null))},[q.length]),eb=(0,d.useCallback)(()=>{V||q.length||p()},[V,q.length,p]),ef=(0,d.useCallback)(()=>{V||q.length?(z(""),el(),ey()):p()},[V,q.length,p,ey]),ek=(0,d.useCallback)(e=>{q.some(t=>t.value===e.value)||($([...q,e.member?e:ep.find(t=>t.value===e.value)||e]),z(""),el(),ey())},[q,ey,ep]),{onInputKeyDownHandler:ew}=function(e){let{inputText:t,navIndexState:n,onEscape:i,onPicked:a,suggestions:r}=e,{lowBorder:o,highBorder:l,navIndex:s,setNavIndex:c}=n;return{onInputKeyDownHandler:e=>{switch(e.key){case"Escape":e.stopPropagation(),i();break;case"Enter":case"Tab":if(!t)break;e.preventDefault(),-1===s?a({label:t,value:t}):a(r[s]);break;case"ArrowUp":e.preventDefault(),c(s>o?s-1:l);break;case"ArrowDown":e.preventDefault(),c(s<l?s+1:o)}}}}({inputText:V,navIndexState:eh,onEscape:ef,onPicked:ek,suggestions:ep});(0,d.useEffect)(()=>{V||ey()},[V,ey]);let eC=c.id===k.id?(0,eK.default)(k).hash:void 0;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(tx,{header:l,invitationFocused:u,children:[(0,t.jsxs)(M.Stack,{gap:3,children:[(0,t.jsxs)(N.Text,{as:"span",children:[n?"Choose":"People"," who can"," ",(0,t.jsx)(N.Text,{as:"span",weight:500,children:v})," ",j?"on":null," ",c.id===s&&o?.branchName?(0,t.jsxs)(R.Link,{className:"inline-flex flex-nowrap items-center gap-1.5 pl-1 align-middle",href:o.branchUrl,title:"Git Branch",children:[(0,t.jsx)(F.GitBranch,{color:"gray-900"})," ",(0,t.jsx)("span",{className:"truncate text-copy-13-mono font-medium",children:o.branchName})]}):(0,t.jsx)(N.Text,{as:"span",weight:500,children:eC?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(U.GitCommit,{className:"align-sub"})," ",(0,t.jsx)(N.Text,{as:"span",monospace:!0,size:13,children:eC})]}):c.url})]}),(0,t.jsx)("form",{className:"mt-2",children:(0,t.jsx)(to,{disabled:!n,disabledText:"You need additional permissions to invite collaborators",inputText:V,invitationFocused:u,invitees:q,onInputBlur:eb,onInputChangeHandler:ej,onInputFocused:x,onKeyDown:ew,placeholder:"Add team members or emails…",ref:B,setInvitees:$})}),(0,t.jsx)(em.AnimatePresence,{children:en?(0,t.jsx)(eT.m.div,{animate:{height:"auto"},exit:{height:0},initial:{height:0},style:{padding:0},transition:{ease:"easeInOut"},children:(0,t.jsx)(P.Note,{action:(0,t.jsx)(i.Button,{"aria-label":"Upgrade your plan to invite multiple external collaborators.",onClick:()=>{E(!1),eo()},shape:"square",size:"tiny",svgOnly:!0,type:"tertiary",children:(0,t.jsx)(O.ArrowRight,{})}),className:"rounded-md !px-1 !py-0 !pl-2 !text-[13px]",fill:!0,label:!1,size:"small",type:"secondary",children:"Upgrade your plan to invite multiple external collaborators."})},"hobby-limit-actions"):null})]}),u?(0,t.jsxs)(M.Stack,{className:"h-[132px]",gap:3,children:[(0,t.jsx)(eQ,{inputText:V,navIndex:ex,onPicked:ek,setNavIndex:eg,suggestions:ep}),V||q.length?null:(0,t.jsxs)(M.Stack,{align:"center",className:"px-6 py-8 text-gray-600",gap:4,children:[(0,t.jsx)(M.Stack,{align:"center",className:"size-8 overflow-hidden rounded-sm border border-solid border-gray-300 font-bold text-gray-600",justify:"center",children:(0,t.jsx)(eY.UserPlus,{})}),(0,t.jsx)(N.Text,{color:"inherit",children:"Search team members or enter an email to invite collaborators."})]}),V&&ec?(0,t.jsx)(M.Stack,{align:"center",children:(0,t.jsx)(h.Spinner,{})}):null,!V&&q.length?(0,t.jsx)(e$.Textarea,{onChange:e=>{J(e.target.value)},placeholder:"Add an optional message",resize:"vertical",rows:3,value:X}):null,ea?(0,t.jsx)(eq.Error,{error:`The message should be 250 characters or less (current length: ${X.length})`,size:"small"}):null,Z?(0,t.jsx)(eq.Error,{error:Z}):null]}):null,(0,t.jsx)(ev.ToastMobileAware,{actionText:"Confirm",active:T,cancelActionText:"Cancel",onAction:()=>{es(),E(!1)},onCancelAction:()=>{E(!1)},preserve:!0,toastKey:"invite-hobby-confirmation",children:(0,t.jsxs)(M.Stack,{direction:"column",gap:3,children:[(0,t.jsxs)(N.Text,{children:["You can only share with 1 external collaborator at a time on Hobby."," ",(0,t.jsx)(R.Link,{external:!0,icon:!1,onClick:()=>{E(!1),eo()},underline:!S||void 0,variant:S?"highlight":void 0,children:"Upgrade to Pro"})," ","for unlimited external collaborators."]}),(0,t.jsx)(N.Text,{children:"Continuing will remove any existing user access."})]})})]}),u?(0,t.jsxs)(y.Modal.Actions,{children:[(0,t.jsx)(y.Modal.Action,{onClick:()=>{T?E(!1):(et(null),$([]),J(""),p())},type:"secondary",children:"Cancel"}),(0,t.jsx)(y.Modal.Action,{disabled:en||T||_||ei||ea||!q.length,loading:_||T,onClick:()=>{D?E(!0):es()},children:(0,t.jsx)(a.Tooltip,{text:er,children:"Invite"})})]}):null]})}function tx(e){let{children:n,header:i,invitationFocused:a}=e;return a?(0,t.jsx)(y.Modal.Body,{className:"px-0 py-3.5",padding:!1,children:(0,t.jsx)(E.Scroller,{overflow:"y",scrollerClassName:"px-1 py-2.5",children:(0,t.jsxs)(M.Stack,{className:"min-h-[285px] px-5",gap:6,children:[i,n]})})}):(0,t.jsx)(t.Fragment,{children:n})}var ty=e.i(545405);function tg(e){let{targets:n,branchAliasId:i,deployment:a,git:r,isLoading:o,isPreviewDeployment:l,modalClose:s,previewCommentsEnabledForBranch:c,previewCommentsEnabledForDeployment:u,productionProtectionEnabled:p,project:m,protectionEnabledForDeployment:h,protectionEnabledForProject:x,revalidateAlias:g,setIsLoading:j,team:b,user:f,branchAlias:v}=e,{track:k}=(0,K.useTrackActivity)(),{teamSlug:w,project:S}=(0,Z.useParams)()??{},[A,I]=(0,d.useState)(()=>n.find(e=>e.pendingRequests>0)?.id??n.find(e=>!(e.url.endsWith("vercel.app")||b?.previewDeploymentSuffix&&e.url.endsWith(b.previewDeploymentSuffix)))?.id??(i?n.find(e=>e.id===i)?.id:void 0)??n.find(e=>e.id!==a.id)?.id??a.id),D=n.find(e=>e.id===A),T=(0,ei.getProtectionBypass)(D??{},"shareable-link");(0,d.useEffect)(()=>{k(W.VercelActivityAction.DeploymentShareOpened,{})},[k]);let[B,_]=(0,d.useState)(!1);(0,d.useEffect)(()=>{B&&k(W.VercelActivityAction.DeploymentInviteScreenOpened,{})},[B,k]);let U=(0,d.useMemo)(()=>(e=>{let{previewCommentsEnabledForDeployment:t,protectionEnabledForDeployment:n}=e;return!t&&n?"view":t&&!n?"comment":"view and comment"})({previewCommentsEnabledForDeployment:u,protectionEnabledForDeployment:!!h}),[u,h]),H=(0,L.useToasts)(),z=(0,d.useCallback)(async e=>{if(!o&&D&&("create"===e||T)){switch(e){case"create":Y.analytics.track(G.AnalyticsEvent.DEPLOYMENT_SHARE_GENERATE_EXTERNAL_LINK,{projectId:m.id});break;case"delete":Y.analytics.track(G.AnalyticsEvent.DEPLOYMENT_SHARE_DISABLE_EXTERNAL_LINK,{projectId:m.id});break;case"regenerate":Y.analytics.track(G.AnalyticsEvent.DEPLOYMENT_SHARE_REGENERATE_EXTERNAL_LINK,{projectId:m.id})}j(!0);try{let t=await (0,ee.updateAliasProtectionBypass)({teamId:b?.id,aliasId:D.id,body:"create"!==e?{revoke:{secret:T||"",regenerate:"regenerate"===e}}:{}});if("create"===e){let e=ef({alias:D.url,protectionBypass:(0,ei.getProtectionBypass)(t,"shareable-link"),protectionEnabledForDeployment:!0});e&&(0,ty.copyToClipboard)(e),H.success("A shareable link was generated and copied to your clipboard.")}}catch{H.error("An error occured, please try again later.")}await g(),j(!1)}},[D,o,m.id,T,g,H,b?.id,j]),{can:q}=(0,X.default)(),$=q(J.Action.Update,"production"===a.target?J.Resource.ProductionAliasProtectionBypass:J.Resource.AliasProtectionBypass),Q=(0,et.useOpenUpgradeModal)(),er=(0,en.getAliasDeploymentProtectionException)(D?.protectionBypass),eo=(0,t.jsx)(tj,{branchAliasId:i,canUpdateProtectionBypass:$,getLinkToProtectionSettingsInner:()=>C({team:b,user:f,projectName:m.name}),isPreviewDeployment:l,productionProtectionEnabled:p,protectionBypass:T,protectionEnabledForDeployment:h,selectedTargetId:A,setSelectedTargetId:I,targets:n}),el=w&&S&&v?.deploymentId?(0,ea.getDashboardHref)(`/${S}/${v.deploymentId.replace("dpl_","")}`,w):void 0,es=A===a.id&&v?.deploymentId&&v.deploymentId!==a.id&&el?(0,t.jsxs)(P.Note,{action:(0,t.jsx)(R.ButtonLink,{"aria-label":"Go to latest branch deployment",href:el,shape:"square",size:"small",svgOnly:!0,children:(0,t.jsx)(O.ArrowRight,{})}),className:"!text-gray-1000",fill:!0,type:"secondary",children:["There is a newer deployment for"," ",r?.branchName?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(F.GitBranch,{className:"mr-0.5 align-middle",size:14}),(0,t.jsx)(N.Text,{as:"span",monospace:!0,children:r.branchName})]}):"this branch",". To share it go to the latest."]}):null;return B&&(u||h)&&D?(0,t.jsx)(th,{branchAliasId:i,canUpdateProtectionBypass:$,deployment:a,git:r,header:eo,invitationFocused:B,onCancel:()=>_(!1),onFinished:()=>_(!1),onFocus:()=>void 0,openUpgradeModal:()=>{s(),Q({source:"Hobby account email invite limit call to upgrade",trialBehavior:"choose"})},previewCommentsEnabledForDeployment:u,revalidateAlias:g,selectedTarget:D,teamId:b?.id,viewAndCommentDescription:U}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(y.Modal.Body,{className:"px-5 py-6",padding:!1,children:(0,t.jsx)(E.Scroller,{overflow:"y",scrollerClassName:"px-1 max-h-[80vh]",children:(0,t.jsxs)(M.Stack,{gap:6,children:[eo,es,er?(0,t.jsxs)(P.Note,{fill:!0,type:"warning",variant:"contrast",children:["This domain is listed in"," ",(0,t.jsx)(R.Link,{href:`${C({team:b,user:f,projectName:m.name})}#deployment-protection-exceptions`,variant:"underline",children:"Deployment Protection Exceptions"}),", making it is currently"," ",(0,t.jsx)(N.Text,{as:"span",color:"inherit",weight:600,children:"unprotected"})," ","and"," ",(0,t.jsx)(N.Text,{as:"span",color:"inherit",weight:600,children:"publicly available"}),"."]}):null,u||h?D&&(0,t.jsx)(th,{branchAliasId:i,canUpdateProtectionBypass:$,deployment:a,git:r,header:eo,invitationFocused:B,onCancel:()=>void 0,onFinished:()=>void 0,onFocus:()=>_(!0),openUpgradeModal:()=>{s(),Q({source:"Hobby account email invite limit call to upgrade",trialBehavior:"choose"})},previewCommentsEnabledForDeployment:u,revalidateAlias:g,selectedTarget:D,teamId:b?.id,viewAndCommentDescription:U}):null,(0,t.jsx)(eR,{branchAliasId:i,branchName:r?.branchName,canUpdateProtectionBypass:$,hideStaticTeamMembersBanner:!h&&!u,onUpgradeClick:()=>{s(),Y.analytics.track(G.AnalyticsEvent.DEPLOYMENT_SHARE_UPGRADE_TO_PRO_CLICKED,{projectId:m.id}),Q({source:"Hobby account approve request limit call to upgrade",trialBehavior:"choose"})},project:m,revalidateAlias:g,target:D}),!u&&l?(0,t.jsx)(t.Fragment,{children:c?(0,t.jsx)(P.Note,{className:"rounded-md !px-1 !py-0 !pl-2 !text-[13px]",fill:!0,size:"small",type:"secondary",children:"Comments will be available for new builds."}):(0,t.jsx)(P.Note,{action:(0,t.jsx)(R.ButtonLink,{"aria-label":"Enable Comments",href:(e=>{let{team:t}=e;return t?`/${t.slug}/~/settings/general#toolbar`:"/account/general#toolbar"})({team:b}),onClick:()=>{Y.analytics.track(G.AnalyticsEvent.DEPLOYMENT_SHARE_CLICK_ON_ENABLE_PREVIEW_COMMENTS,{projectId:m.id})},shape:"square",size:"tiny",svgOnly:!0,tab:!0,type:"tertiary",children:(0,t.jsx)(V.SettingsGear,{})}),className:"rounded-md !px-1 !py-0 !pl-2 !text-[13px]",fill:!0,label:!1,size:"small",type:"secondary",children:"Enable comments for this deployment."})}):null,x?null:(0,t.jsx)(P.Note,{action:(0,t.jsx)(R.ButtonLink,{"aria-label":"Enable Deployment Protection",href:C({team:b,user:f,projectName:m.name}),onClick:()=>{Y.analytics.track(G.AnalyticsEvent.DEPLOYMENT_SHARE_CLICK_ON_ENABLE_VERCEL_AUTHENTICATION,{projectId:m.id})},shape:"square",size:"tiny",svgOnly:!0,type:"tertiary",children:(0,t.jsx)(O.ArrowRight,{})}),className:"rounded-md !px-1 !py-0 !pl-2 !text-[13px]",fill:!0,label:!1,size:"small",type:"secondary",children:"Enable Deployment Protection for this project."})]})})}),(0,t.jsx)(y.Modal.Actions,{children:(0,t.jsx)(ek,{alias:D?.url,canUpdateShareableLink:$,deployment:a,git:r,isLoading:o,onCreateShareableLink:()=>void z("create"),onDeleteShareableLink:()=>void z("delete"),onRegenerateShareableLink:()=>void z("regenerate"),openUpgradeModal:()=>{s(),Q({source:"Hobby account shareable link limit call to upgrade",trialBehavior:"choose"})},previewCommentsEnabledForDeployment:u??!1,protectionBypass:T,protectionEnabledForDeployment:h,viewAndCommentDescription:U})})]})}function tj(e){let{canUpdateProtectionBypass:n,getLinkToProtectionSettingsInner:i,isPreviewDeployment:a,productionProtectionEnabled:r,protectionBypass:o,protectionEnabledForDeployment:l,targets:s,selectedTargetId:c,setSelectedTargetId:d,branchAliasId:u}=e,p=s.some(e=>e.pendingRequests>0&&e.id!==c);return(0,t.jsxs)(M.Stack,{align:"center",direction:"row",justify:"space-between",children:[(0,t.jsxs)(M.Stack,{align:"center",direction:"row",gap:2,children:[(0,t.jsx)(N.Text,{size:24,weight:600,children:"Share"}),s.length>1?(0,t.jsxs)(D.MenuContainer,{children:[(0,t.jsxs)(I.MenuButton,{"aria-label":"Select URL",shape:"square",size:"tiny",svgOnly:!0,type:"tertiary",children:[(0,t.jsx)(_.ChevronDown,{}),p?(0,t.jsx)("div",{className:"absolute -right-0.5 -top-0.5 size-2 rounded-full bg-green-500"}):null]}),(0,t.jsx)(A.Menu,{width:"auto",children:s.map(e=>{var n,i;let a=(n=e,i=u,n.id===i?F.GitBranch:n.id.startsWith("dpl_")?U.GitCommit:H.Globe);return(0,t.jsx)(T.MenuItem,{onClick:()=>{d(e.id)},prefix:(0,t.jsx)(a,{}),suffix:e.id===c?(0,t.jsx)(B.Check,{}):null,children:(0,t.jsxs)(M.Stack,{align:"center",direction:"row",gap:2,children:[e.url,e.pendingRequests>0?(0,t.jsx)(S.Badge,{className:"min-w-5",size:"sm",variant:"blue",children:e.pendingRequests}):null]})},e.id)})})]}):null]}),n&&(a||l)?(0,t.jsx)(tb,{getLinkToProtectionSettingsInner:i,isProtectionBypassShareableLink:!!o,productionProtectionEnabled:r,protectionEnabledForDeployment:l}):null]})}function tb(e){let{getLinkToProtectionSettingsInner:n,productionProtectionEnabled:i,isProtectionBypassShareableLink:r,protectionEnabledForDeployment:o}=e,l=(0,Q.useIsMobile)(),s=r?"Deployment Protection can be bypassed with the Shareable Link":`${i?"All":"Preview"} deployments ${!l?"in this project ":""}are protected`,c=r?(0,t.jsx)(q.ShieldGlobe,{}):(0,t.jsx)(z.Shield,{}),d=o?c:(0,t.jsx)($.ShieldOff,{});return(0,t.jsx)(a.Tooltip,{desktopOnly:!0,text:o?s:"Deployment Protection is not enabled and deployments are publicly accessible",children:(0,t.jsx)(R.ButtonLink,{align:"center","aria-label":"Settings",href:n(),label:"Settings",shape:"circle",size:"small",svgOnly:!0,type:"tertiary",children:d})})}function tf(e){let{deployment:n,project:a,mutateDeployment:o,...l}=e,{user:s,team:c,account:C}=(0,r.useAccount)(),S=C?.billing?.plan==="hobby",A=!!n.buildSkipped,{targets:I,branchAliasId:D,branchAlias:T,isLoading:P,mutate:E}=function(e){let{data:t}=(0,k.useCurrentDashboardDeploymentDomains)({revalidateIfStale:!1,revalidateOnFocus:!1}),n=(0,g.useTeamSlug)(),{data:i,mutate:a,isLoading:r}=(0,f.useAliasesV2)({deploymentId:e?.id,teamId:n??void 0}),o=t.branch??e?.meta.branchAlias??(e?.alias?e.alias[e.alias.length-1]:void 0),l=(0,d.useMemo)(()=>{let n,a=e?[{id:e.id,url:e.url,protectionBypass:e.protectionBypass,pendingRequests:tv(e)}]:[];if(!i)return{targets:a};for(let e of i.aliases)e.redirect||(e.alias===o&&(n=e.uid),a.push({id:e.uid,url:e.alias,protectionBypass:e.protectionBypass,pendingRequests:tv(e)}));let r=[t.commit,t.branch??"",...t.aliases].filter(Boolean);return a.sort((e,t)=>r.indexOf(e.url)-r.indexOf(t.url)),{targets:a,branchAliasId:n}},[o,i,e,t]),s=o&&!l.branchAliasId,{data:c,mutate:u,isLoading:p}=(0,v.default)({domain:s?o:void 0});return{isLoading:r||p,mutate:async()=>{await a(),await u()},targets:l.targets,branchAliasId:l.branchAliasId||c?.uid,branchAlias:c}}(n),M=(0,j.getGitMeta)(n.meta),N=(0,d.useMemo)(()=>I.some(e=>e.pendingRequests>0),[I]),L="production"!==n.target,{value:R}=(0,w.useArePreviewCommentsEnabled)({target:L?"preview":"production",branch:M?.branchName}),[O,B]=(0,d.useState)(!1),{protectionEnabledForDeployment:_,protectionEnabledForProject:F,isLoading:U,productionProtectionEnabled:H}=(e=>{let{deployment:t,project:n,isProjectLoading:i=!1}=e;if(!t||!n)return i?{isLoading:!0,protectionEnabledForDeployment:null,protectionEnabledForProject:null,productionProtectionEnabled:null}:{isLoading:!1,protectionEnabledForDeployment:!1,protectionEnabledForProject:!1,productionProtectionEnabled:!1};let{passwordProtection:a,ssoProtection:r,trustedIps:o}=n,l="production"!==t.target,s=["preview","prod_deployment_urls_and_all_previews","all_except_custom_domains"],c=a?.deploymentType==="all"||l&&a?.deploymentType&&s.includes(a.deploymentType),d=r?.deploymentType==="all"||l&&r?.deploymentType&&s.includes(r.deploymentType),u=o?.deploymentType==="all"||!l&&o?.deploymentType==="production"||l&&o?.deploymentType&&s.includes(o.deploymentType);return{productionProtectionEnabled:a?.deploymentType==="all"||r?.deploymentType==="all"||o?.deploymentType==="all",protectionEnabledForProject:!!(a||r||o),protectionEnabledForDeployment:!!(c||d||u),isLoading:!1}})({deployment:n,project:a}),V=(0,w.useCommentsEnabledForDeployment)(n),z=(0,d.useMemo)(()=>O?(0,t.jsx)(h.Spinner,{}):_?S?(0,t.jsx)(u.User,{}):(0,t.jsx)(p.Users,{}):(0,t.jsx)(m.Share,{}),[_,S,O]),[q,$,Y]=(()=>{let[e,t]=(0,d.useState)(!1);return[e,(0,d.useCallback)(()=>t(!0),[]),(0,d.useCallback)(()=>t(!1),[])]})();return((0,b.default)("openSharing",()=>{$()}),P||U)?L||V?(0,t.jsx)(x.Skeleton,{className:l.className,height:40,width:"100%"}):null:V||_?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(i.Button,{disabled:A||0===I.length,onClick:$,prefix:z,style:{color:A||0===I.length?void 0:"gray-900"},type:"secondary",typeName:"button",...l,children:["Share",N?(0,t.jsx)("div",{className:"absolute -right-0.5 -top-0.5 size-2 rounded-full bg-geist-success"}):null]}),(0,t.jsx)(y.Modal.Modal,{active:q,disableFocusTrap:!0,onClickOutside:Y,children:(0,t.jsx)(tg,{branchAlias:T,branchAliasId:D,deployment:n,git:M,isLoading:O,isPreviewDeployment:L,modalClose:Y,previewCommentsEnabledForBranch:R??V,previewCommentsEnabledForDeployment:V,productionProtectionEnabled:H,project:a,protectionEnabledForDeployment:_,protectionEnabledForProject:F,revalidateAlias:async()=>{await E(),await o()},setIsLoading:B,targets:I,team:c,user:s})})]}):null}function tv(e){return Object.values(e?.protectionBypass??{}).filter(e=>"user"===e.scope&&"requested"===e.access).length}var tk=e.i(8382149),tw=e.i(6613731),tC=e.i(4478191),tS=e.i(9267266),tA=e.i(9148684);function tI(e){let{className:i,...a}=e;return(0,t.jsx)(R.ButtonLink,{className:(0,n.clsx)(i,"min-w-[80px] flex-1"),...a})}function tD(e){let{className:a,...r}=e;return(0,t.jsx)(i.Button,{className:(0,n.clsx)(a,"min-w-[96px] flex-1"),...r})}function tT(e){let{deployment:n,project:i}=e,{user:a,team:o}=(0,r.useAccount)(),{areChecksRunning:l,areDomainsAssigning:d}=(0,c.getDeploymentStatus)(n),u=(0,tS.useShouldVisitWithTheToolbar)(n),{permissions:p}=(0,tA.useDeploymentPermissions)({project:i,deployment:n}),m=n.readyState,h=(0,s.useIsViewingPublicDeployment)(),{onClick:x,...y}=(0,tw.useWrappedToolbarAuthLinkHandler)({via:"deployment-visit-button",deployment:h?void 0:n});return l?(0,t.jsx)(tD,{disabled:!0,children:"Waiting for Checks"}):d?(0,t.jsx)(tD,{disabled:!0,children:"Waiting for Domains"}):(a||o)&&p.canUpdateDeployment&&!["READY","ERROR","CANCELED"].includes(n.readyState)?null:"READY"===m?u&&"production"===n.target?(0,t.jsx)(tS.VisitWithToolbarButton,{Component:tI,buttonProps:{href:(0,tC.withDefaultRoute)((0,eb.domainToUrl)(n.url),n.defaultRoute),onClick:()=>{Y.analytics.track(G.AnalyticsEvent.DEPLOYMENT_OVERVIEW_CLICKED_VISIT_BUTTON,{projectId:n.projectId||i?.id,deploymentId:n.id,deploymentTarget:n.target})},passthroughOnClick:x,...y,target:"_blank"},className:"flex-1",page:n.defaultRoute?.startsWith("/")?n.defaultRoute:`/${n.defaultRoute??""}`,url:(0,tC.withDefaultRoute)((0,eb.domainToUrl)(n.url),n.defaultRoute),via:"deployment-visit-button",children:"Visit"}):(0,t.jsx)(tI,{href:(0,tC.withDefaultRoute)((0,eb.domainToUrl)(n.url),n.defaultRoute),onClick:()=>{Y.analytics.track(G.AnalyticsEvent.DEPLOYMENT_OVERVIEW_CLICKED_VISIT_BUTTON,{projectId:n.projectId||i?.id,deploymentId:n.id,deploymentTarget:n.target})},passthroughOnClick:x,...y,target:"_blank",children:"Visit"}):(0,t.jsx)(tI,{disabled:!0,href:`https://${n.host}`,...y,children:"Visit"})}let tP="min-w-[96px] flex-1 px-[10px]";function tE(e){let{className:a,...r}=e;return(0,t.jsx)(i.Button,{className:(0,n.clsx)(tP,a),...r})}function tM(e){let{deployment:n,project:i,mutateDeployment:d}=e,{user:u,team:p}=(0,r.useAccount)(),{areChecksRunning:m,areDomainsAssigning:h}=(0,c.getDeploymentStatus)(n),{permissions:x}=(0,tA.useDeploymentPermissions)({project:i,deployment:n}),{openRedeployModal:y,openCancelDeploymentModal:g,isLoadingModals:j}=(0,tk.useDeploymentModals)(),b=n.readyState,f=(0,s.useIsViewingPublicDeployment)();if(m)return(0,t.jsx)(tE,{disabled:!0,children:"Waiting for Checks"});if(h)return(0,t.jsx)(tE,{disabled:!0,children:"Waiting for Domains"});if("ERROR"===b){let e="production"===n.target?x.canRedeployProduction:x.canCreateDeployment;return f||!e?(0,t.jsx)(a.Tooltip,{className:"min-w-x[96px] flex-1",position:"top",text:"You are not the owner of this deployment. In turn, you cannot re-deploy it.",children:(0,t.jsx)(tE,{disabled:!0,prefix:(0,t.jsx)(l.RotateCounterClockwise,{}),type:"secondary",children:"Redeploy"})}):(0,t.jsx)(tE,{disabled:j,onClick:y,prefix:(0,t.jsx)(l.RotateCounterClockwise,{}),type:"secondary",children:"Redeploy"})}return(u||p)&&x.canUpdateDeployment&&!["READY","ERROR","CANCELED"].includes(n.readyState)?(0,t.jsx)(tE,{onClick:g,prefix:(0,t.jsx)(o.StopCircle,{}),style:{paddingInline:6},type:"secondary",children:"Cancel"}):(0,t.jsxs)(t.Fragment,{children:[i?(0,t.jsx)(tf,{className:tP,deployment:n,mutateDeployment:d,project:i}):null,(0,t.jsx)(tT,{deployment:n,project:i})]})}e.s(["DeploymentActionButton",()=>tM],310143)}]);

//# sourceMappingURL=305d7240bda6ee60.js.map
//# debugId=4b9d4aa8-f515-56ed-8eb6-893f77c8d8ad
