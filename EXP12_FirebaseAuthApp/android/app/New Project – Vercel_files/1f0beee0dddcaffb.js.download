
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="944c7983-b12e-5e54-a8c6-33d54cbc0f75")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,7311072,e=>{e.v({container:"styled-combobox-module__dUtXFG__container"})},161312,7181648,7849701,e=>{"use strict";var t=e.i(6468255),a=e.i(9722978),l=e.i(6143247),s=e.i(2504781),i=e.i(4138437),n=e.i(6891161),r=e.i(3672946),o=e.i(6696646);let c=(0,o.createContext)({});function d(e){let{children:l,className:s}=e,[n,r]=(0,o.useState)(!1),d=(0,o.useMemo)(()=>({expanded:n,setExpanded:r}),[n,r]);return(0,t.jsx)(i.Card,{border:!0,className:(0,a.clsx)("relative overflow-hidden",s),children:(0,t.jsx)(c.Provider,{value:d,children:l})})}c.displayName="ExpandablePanelContext",d.Header=function(e){let{children:a,className:s}=e;return(0,t.jsx)("div",{className:(0,l.cn)("border-b px-5 py-3",s),children:a})},d.Footer=function(e){let{children:a}=e;return(0,t.jsx)("div",{className:"pointer-events-none absolute inset-x-0 bottom-0 flex flex-row items-center justify-center bg-gradient-to-t from-background-200 to-background-200/0 pb-4",children:a})},d.Expand=function(){let{setExpanded:e}=(0,o.useContext)(c);return(0,t.jsx)(s.Button,{className:"pointer-events-auto mr-[3px]",onClick:()=>e(!0),shadow:!0,shape:"rounded",size:"small",suffix:(0,t.jsx)(r.Fullscreen,{}),type:"secondary",children:"View All"})},d.Expanded=function(e){let{children:a,...l}=e,{expanded:s,setExpanded:i}=(0,o.useContext)(c);return(0,t.jsxs)(n.Modal.Modal,{...l,active:s,onClickOutside:()=>i(!1),style:{height:"80vh"},width:600,children:[(0,t.jsx)(n.Modal.Body,{className:"flex-1 p-0",children:a}),(0,t.jsx)(n.Modal.Actions,{children:(0,t.jsx)(n.Modal.Action,{fullWidth:!0,onClick:()=>i(!1),children:"Close"})})]})},e.s(["ExpandablePanel",()=>d],161312);var u=e.i(1233856);let m=Symbol("RELATIVE_LINK");function x(e,t){var a;let l,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m,i=(0,u.getRollup)(t);if(!i)throw Error("Rollup not found in query");let n=(l="project-with-slug"===(a=e).type?a.projectNames[0]??"~":"~",[a.teamSlug,l,"observability"]),r=`/${n.join("/")}`,o=new URLSearchParams;o.set("builder","true"),o.set("aggregation",i.aggregation),o.set("metric",`${t.event}.${i.measure}`),t.groupBy&&t.groupBy.length>0&&o.set("by",t.groupBy.join(",")),o.set("time",`${t.startTime.toISOString()}/${t.endTime.toISOString()}`),t.filter&&o.set("filter",t.filter);let c=o.toString();return s===m?`${r}?${c}`:`https://${s}${r}?${c}`}e.s(["computeQueryBuilderLink",()=>x],7181648);var h=e.i(9100551),g=e.i(4141852),f=e.i(1829577),p=e.i(1344973),j=e.i(3169345),b=e.i(5255926),y=e.i(3306538),v=e.i(8835183),w=e.i(6850581),N=e.i(7087273),C=e.i(7797615),S=e.i(818351),k=e.i(4244280),T=e.i(8042625);function A(){let{startTime:e,endTime:a,disableRowClick:s=!1,hosts:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[n,r]=(0,o.useState)(""),c=(0,h.useRouter)(),u=(0,h.useParams)(),m=u?.teamSlug,x=u?.project,A=e=>{let t=new URL(window.location.href);t.searchParams.set("eventIp",e.clientIp),t.searchParams.set("eventHost",e.hostname),e.wafAction&&t.searchParams.set("eventAction",e.wafAction),t.searchParams.set("eventStart",e.startTime),t.searchParams.set("eventEnd",e.endTime),c.push(`/${m}/${x}/firewall?${t.searchParams.toString()}`)},{data:R,isLoading:_,error:I}=function(e){let{teamId:t,projectId:a,startTime:l,endTime:s,hosts:i}=e,n={teamId:t,projectId:a,...l&&{startTimestamp:l},...s&&{endTimestamp:s},...i&&i.length>0&&{hosts:i.join(",")}};return(0,S.useIsomorphicSWR)(`${k.API_FIREWALL}/firewall/events${(0,T.encode)(n)}`)}({teamId:m,projectId:x,startTime:(0,o.useMemo)(()=>e?e.getTime():void 0,[e]),endTime:(0,o.useMemo)(()=>a?a.getTime():void 0,[a]),hosts:i}),M=(0,o.useMemo)(()=>R?.actions?R.actions.map(e=>({startTime:e.startTime,endTime:e.endTime,clientIp:e.public_ip,hostname:e.host,actionType:"system-action"===e.action_type?"System Rule":"Customer Rule",wafAction:e.action,count:e.count,isRedacted:"***"===e.public_ip||"***"===e.host||"***"===e.action})):[],[R]),L=(0,o.useMemo)(()=>n?M.filter(e=>e.clientIp.toLowerCase().includes(n.toLowerCase())):M,[M,n]),B=(0,o.useMemo)(()=>M.slice(0,10),[M]),D=e=>"deny"===e?"red-subtle":"amber-subtle",$=e=>"deny"===e?(0,t.jsx)(g.FirewallFlame,{}):(0,t.jsx)(f.FirewallCheck,{});return(0,t.jsxs)(d,{children:[(0,t.jsx)(N.Scroller,{overflow:"x",children:(0,t.jsxs)("div",{className:"min-w-[800px]",children:[(0,t.jsx)("div",{className:"px-4 py-3 border-b border-gray-200",children:(0,t.jsxs)("div",{className:"flex font-medium text-label-14",children:[(0,t.jsx)("div",{className:"w-[16.66%]",children:"Events"}),(0,t.jsx)("div",{className:"w-[16.66%] pl-2",children:"Action"}),(0,t.jsx)("div",{className:"w-[20%] pl-1",children:"Hostname"}),(0,t.jsx)("div",{className:"w-[20%] pl-2",children:"IP Address"}),(0,t.jsx)("div",{className:"w-[20%] pl-2",children:"Start"}),(0,t.jsx)("div",{className:"w-[16.66%] text-right",children:"Requests"})]})}),(0,t.jsxs)("div",{className:"p-2",children:[(0,t.jsxs)(j.Table,{className:"table-fixed w-full",children:[(0,t.jsxs)("colgroup",{children:[(0,t.jsx)("col",{className:"w-[16.66%]"}),(0,t.jsx)("col",{className:"w-[16.66%]"}),(0,t.jsx)("col",{className:"w-[20%]"}),(0,t.jsx)("col",{className:"w-[20%]"}),(0,t.jsx)("col",{className:"w-[20%]"}),(0,t.jsx)("col",{className:"w-[16.66%]"})]}),(0,t.jsx)(j.Table.Body,{striped:!0,children:!_&&R&&B.map((e,a)=>(0,t.jsxs)(j.Table.Row,{onClick:s||e.isRedacted?void 0:()=>A(e),className:(0,l.cn)(!s&&!e.isRedacted&&"cursor-pointer hover:!bg-gray-100",e.isRedacted&&"blur-sm pointer-events-none select-none"),children:[(0,t.jsx)(j.Table.Cell,{children:(0,t.jsx)(p.Text,{variant:"label-14",children:e.actionType})}),(0,t.jsx)(j.Table.Cell,{children:e.wafAction&&(0,t.jsx)(y.Badge,{size:"md",icon:$(e.wafAction),variant:D(e.wafAction),children:e.wafAction})}),(0,t.jsx)(j.Table.Cell,{children:(0,t.jsx)(p.Text,{variant:"label-14",children:e.hostname})}),(0,t.jsx)(j.Table.Cell,{children:(0,t.jsx)(p.Text,{variant:"label-14",children:e.clientIp})}),(0,t.jsx)(j.Table.Cell,{children:(0,t.jsx)(w.RelativeTimeCard,{date:new Date(`${e.startTime}Z`).getTime(),side:"bottom",children:(0,t.jsx)(p.Text,{variant:"label-14",children:new Date(`${e.startTime}Z`).toLocaleString()})})}),(0,t.jsx)(j.Table.Cell,{children:(0,t.jsx)(p.Text,{variant:"label-14",children:(0,C.formatNumberCompact)(e.count)})})]},`${e.clientIp}-${e.wafAction}-${e.hostname}-${a}`))})]}),!R&&_?(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(b.Skeleton,{height:40,width:"100%"}),(0,t.jsx)(b.Skeleton,{height:40,width:"100%"}),(0,t.jsx)(b.Skeleton,{height:40,width:"100%"})]}):I?(0,t.jsx)(p.Text,{variant:"label-14",className:"m-2 text-red-600",children:"Failed to load firewall events"}):0===M.length?(0,t.jsx)("div",{className:"flex flex-row items-center justify-center p-2 h-[200px] w-full",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,t.jsx)("div",{className:"rounded-md border border-gray-200 p-2",children:(0,t.jsx)(g.FirewallFlame,{color:"gray-800"})}),(0,t.jsx)("p",{className:"text-label-14 text-gray-700",children:"There are no active firewall events"})]})}):null]})]})}),!_&&M.length>10&&(0,t.jsx)(d.Footer,{children:(0,t.jsx)(d.Expand,{})}),(0,t.jsx)(d.Expanded,{disableFocusTrap:!0,children:(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)(v.SearchInput,{placeholder:"Search by IP address",value:n,onChange:e=>r(e.target.value),className:"max-w-sm"})}),(0,t.jsx)(N.Scroller,{overflow:"x",children:(0,t.jsxs)(j.Table,{className:"min-w-[800px]",children:[(0,t.jsx)(j.Table.Header,{children:(0,t.jsxs)(j.Table.Row,{children:[(0,t.jsx)(j.Table.Cell,{children:"Events"}),(0,t.jsx)(j.Table.Cell,{children:"Action"}),(0,t.jsx)(j.Table.Cell,{children:"Hostname"}),(0,t.jsx)(j.Table.Cell,{children:"IP Address"}),(0,t.jsx)(j.Table.Cell,{children:"Start"}),(0,t.jsx)(j.Table.Cell,{children:"Requests"})]})}),(0,t.jsx)(j.Table.Body,{striped:!0,children:L.map((e,a)=>(0,t.jsxs)(j.Table.Row,{onClick:s||e.isRedacted?void 0:()=>A(e),className:(0,l.cn)(!s&&!e.isRedacted&&"cursor-pointer hover:!bg-gray-100",e.isRedacted&&"blur-sm pointer-events-none select-none"),children:[(0,t.jsx)(j.Table.Cell,{children:(0,t.jsx)(p.Text,{variant:"label-14",children:e.actionType})}),(0,t.jsx)(j.Table.Cell,{children:e.wafAction&&(0,t.jsx)(y.Badge,{icon:$(e.wafAction),variant:D(e.wafAction),children:e.wafAction})}),(0,t.jsx)(j.Table.Cell,{children:(0,t.jsx)(p.Text,{variant:"label-14",children:e.hostname})}),(0,t.jsx)(j.Table.Cell,{children:(0,t.jsx)(p.Text,{variant:"label-14",children:e.clientIp})}),(0,t.jsx)(j.Table.Cell,{children:(0,t.jsx)(w.RelativeTimeCard,{date:new Date(`${e.startTime}Z`).getTime(),side:"bottom",children:(0,t.jsx)(p.Text,{variant:"label-14",children:new Date(`${e.startTime}Z`).toLocaleString()})})}),(0,t.jsx)(j.Table.Cell,{children:(0,t.jsx)(p.Text,{variant:"label-14",children:(0,C.formatNumberCompact)(e.count)})})]},`${e.clientIp}-${e.wafAction}-${e.hostname}-${a}`))})]})})]})})]})}e.s(["FirewallEventsTable",()=>A],7849701)},5597167,e=>{"use strict";var t=e.i(6468255),a=e.i(4597921),l=e.i(9943777),s=e.i(7917902),i=e.i(1717203),n=e.i(7557283),r=e.i(5338940),o=e.i(4004502),c=e.i(3748432),d=e.i(6352514),u=e.i(119294),m=e.i(3268226),x=e.i(3306538),h=e.i(2504781),g=e.i(8674454),f=e.i(6694387),p=e.i(4991687),j=e.i(9508212),b=e.i(5232300),y=e.i(7749365),v=e.i(972022),w=e.i(8876434),N=e.i(6198010),C=e.i(2375916),S=e.i(3814652),k=e.i(9100551),T=e.i(6696646),A=e.i(9429645),R=e.i(2139548),_=e.i(6234625),I=e.i(1344973),M=e.i(3228096),L=e.i(5963711);function B(e){let{totalRequests:a}=e;return(0,t.jsx)("div",{className:"relative overflow-hidden rounded-t-md @container before:pointer-events-none before:absolute before:inset-0 before:shadow-[inset_-30px_0_20px_-20px_var(--ds-background-200)] before:content-[''] @[966px]:before:shadow-none",children:(0,t.jsx)("div",{className:"flex flex-1 flex-row divide-x [-ms-overflow-style:none] [scrollbar-width:none] [&::-webkit-scrollbar]:hidden",children:(0,t.jsx)(D,{icon:(0,t.jsx)(M.Globe,{}),label:"All Traffic",children:a})})})}function D(e){let{children:a,icon:l,label:s}=e;return(0,t.jsxs)(j.Stack,{className:"min-w-[166px] border-b-2 border-b-gray-1000 bg-background-100",flex:1,gap:1,padding:5,children:[(0,t.jsxs)(j.Stack,{align:"center",direction:"row",gap:2,className:"text-gray-1000",children:[l,(0,t.jsx)(I.Text,{className:"whitespace-nowrap",variant:"label-14",weight:500,children:s})]}),(0,t.jsx)(I.Text,{align:"left",variant:"heading-24",weight:500,children:0===a?"-":(0,L.formatShortPrecision)(a)})]})}var $=e.i(7950227),P=e.i(7527548),F=e.i(5797774),O=e.i(192211),E=e.i(9961052),q=e.i(5481907),z=e.i(9713924),H=e.i(8852884),U=e.i(9576862);function V(e){let{data:a,color:l,minimumMaxValue:s,width:i=44,height:n=28,margin:r={top:6,right:6,left:6,bottom:6},className:o}=e,c=(0,T.useMemo)(()=>Math.max(...a.map(e=>e.value),s||0),[a,s]);return(0,t.jsxs)(H.LineChart,{data:a,height:n,margin:r,width:i,className:o,children:[(0,t.jsx)(z.Line,{animationDuration:0,dataKey:"value",dot:!1,stroke:l||"var(--ds-gray-600)",strokeWidth:1.25,type:"monotone"}),(0,t.jsx)(U.YAxis,{...s?{domain:[0,c]}:{},hide:!0})]})}var W=e.i(5255926),G=e.i(2480776),Q=e.i(4573369),Z=e.i(1496379),K=e.i(3538015);let J=(0,T.createContext)({});function X(){return(0,T.useContext)(J)}function Y(e){let{children:a,formatter:l,series:s}=e,i=(0,Q.default)(),[n,r]=(0,Z.useToolbarState)(),[o,c]=(0,T.useState)(null),d=(0,T.useMemo)(()=>Array.from(s.values()).reduce((e,t)=>e.concat(t),[]),[s]),u=(0,T.useMemo)(()=>{let e={};return d.forEach(t=>{e[t.key]?e[t.key]+=t.value??0:e[t.key]=t.value??0}),e},[d]),m=(0,T.useMemo)(()=>[...s.keys()].sort((e,t)=>u[t]-u[e]),[s,u]);(0,T.useEffect)(()=>{!o||m.includes(o)||c(null)},[m,o]);let x=(0,T.useMemo)(()=>(0,G.scaleOrdinal)({domain:m.sort(K.stableSort),range:[700,600,400,200].flatMap(e=>[`var(--ds-blue-${e})`,`var(--ds-amber-${e})`,`var(--ds-green-${e})`,`var(--ds-teal-${e})`,`var(--ds-purple-${e})`,`var(--ds-pink-${e})`,`var(--ds-red-${e})`,`var(--ds-gray-${e})`])}),[m]),h=(0,T.useMemo)(()=>Object.fromEntries(m.map(e=>[e,x(e)])),[m,x]),g=(0,T.useCallback)(e=>{"all_rules"===n.filter?e&&r({type:"filter",value:e.split("$")[0]}):c(e)},[r,n.filter]),f=(0,T.useMemo)(()=>({activeDataKey:o,allData:d,allKeys:m,colorScale:x,formatter:l,maxByKeys:u,seriesColor:h,setActiveDataKey:g,tooltip:i}),[o,d,m,x,l,u,g,h,i]);return(0,t.jsx)(J.Provider,{value:f,children:a})}J.displayName="VisualizationContext";var ee=e.i(9179929),et=e.i(8459493),ea=e.i(5257834),el=e.i(455575),es=e.i(161312),ei=e.i(4030453),en=e.i(8835183);function er(e){let{items:a,itemKey:l,isLoading:s,error:i,Header:n,Row:r,RowSkeleton:o,EmptyState:c,collapsedRows:d=5,searchFilter:u}=e,[m,x]=(0,T.useState)(""),h=(0,T.useMemo)(()=>{if(u)return a?.filter(u);let e=m.toLowerCase();return a?.filter(t=>Object.values(t).some(t=>t?.toString().toLowerCase().includes(e)))},[a,m,u]);return(0,t.jsxs)(es.ExpandablePanel,{children:["string"==typeof n?(0,t.jsx)(es.ExpandablePanel.Header,{className:"text-label-14 font-medium",children:n}):(0,t.jsx)(n,{}),i?(0,t.jsx)("div",{className:"h-[200px] flex items-center justify-center",children:(0,t.jsx)(ei.Error,{children:"Error loading data"})}):void 0===a||s?(0,t.jsx)("div",{className:"p-2 [&>*:nth-child(odd)]:bg-background-200",children:Array(d).fill(0).map((e,a)=>(0,t.jsx)(o,{},a))}):0===a.length?c?(0,t.jsx)(c,{}):(0,t.jsx)("div",{className:"h-[200px] flex items-center justify-center bg-background-100",children:(0,t.jsx)("p",{className:"text-label-14 font-normal text-gray-600",children:"No data"})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"p-2 [&>*:nth-child(odd)]:bg-background-200",children:a?.slice(0,d).map((e,a)=>(0,t.jsx)(r,{...e},l?l(e):a))}),a?.length>d&&(0,t.jsx)(es.ExpandablePanel.Footer,{children:(0,t.jsx)(es.ExpandablePanel.Expand,{})})]}),(0,t.jsx)(es.ExpandablePanel.Expanded,{disableFocusTrap:!0,children:(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:["string"==typeof n?(0,t.jsx)(es.ExpandablePanel.Header,{className:"text-label-14 font-medium",children:n}):(0,t.jsx)(n,{}),(0,t.jsx)("div",{className:"px-2",children:(0,t.jsx)(en.SearchInput,{clearable:!1,onChange:e=>x(e.target.value),placeholder:"Search",value:m})}),(0,t.jsx)("div",{className:"p-2 [&>*:nth-child(odd)]:bg-background-200",children:h?.map((e,a)=>(0,t.jsx)(r,{...e},l?l(e):a))})]})})]})}er.Header=es.ExpandablePanel.Header;var eo=e.i(6143247);function ec(e){let{percentage:a,className:l,children:s,containerClassName:i}=e;return(0,t.jsxs)("div",{className:(0,eo.cn)("group relative flex items-center gap-x-2",l),children:[(0,t.jsx)("div",{className:"absolute inset-0 pr-2",style:{width:`${a}%`},children:(0,t.jsx)("div",{className:"h-full rounded-sm bg-gray-100 group-hover:bg-gray-400 dark:bg-gray-200",style:{width:`${a}%`}})}),(0,t.jsx)("div",{className:(0,eo.cn)("z-0 px-1 text-nowrap",i),children:s})]})}var ed=e.i(7181648),eu=e.i(4689018),em=e.i(6092370);function ex(e){let{event:t,filter:a,groupBy:l,teamIdOrSlug:s,projectIdOrName:i,startTime:n,endTime:r}=e;return(0,ed.computeQueryBuilderLink)({type:"project-with-slug",teamSlug:s,projectNames:[i]},{event:t,rollups:{value:{measure:"count",aggregation:"sum"}},startTime:n,endTime:r,groupBy:l,filter:a})}function eh(e){let{teamIdOrSlug:a,projectIdOrName:l,config:s,isLoading:i}=e,{range:n}=(0,eu.useFirewallTimeRange)(),{error:r,data:o,isLoading:c}=(0,q.useSonarQuery)({event:s.event,reason:s.reason||"firewall_tab",rollups:{value:{measure:"count",aggregation:"sum"}},groupBy:s.groupBy,filter:s.filter,lowGranularity:!0,startTime:n.start,endTime:n.end,limit:s.limit??500,orderBy:"value"},{noEnvironmentFilter:!0}),d=(0,ee.useTableData)(o,{enrich:e=>{let t=s.groupBy.reduce((t,a)=>{let l=e[a];return null!=l&&(t[a]=l),t},{}),i=(0,em.serializeObjectFilter)(t),r={queryLink:ex({event:s.event,filter:i||"",groupBy:s.groupBy,teamIdOrSlug:a,projectIdOrName:l,startTime:n.start,endTime:n.end})},o=s.enrichRow?s.enrichRow(e,{teamIdOrSlug:a,projectIdOrName:l,startTime:n.start,endTime:n.end}):{};return{...r,...o}},meta:{timeseries:{by:s.groupBy}}}),u=(0,T.useMemo)(()=>d?.toSorted((e,t)=>t.value-e.value),[d]),m=(0,T.useMemo)(()=>e=>(0,t.jsx)(eg,{...e,config:s}),[s]),x=(0,T.useMemo)(()=>()=>(0,t.jsx)(ep,{config:s}),[s]);return(0,t.jsx)(er,{items:u,itemKey:s.getRowKey,isLoading:i||c,error:r,Header:s.header,Row:m,RowSkeleton:ef,EmptyState:x})}let eg=(0,T.memo)(function(e){let{value:a,meta:l,config:s,queryLink:i,...n}=e,{formatter:r}=X(),o=(0,el.useToasts)(),c={value:a,meta:l,queryLink:i,...n};return(0,t.jsxs)("div",{className:"flex flex-row items-center justify-between p-2 group",children:[(0,t.jsx)("div",{className:"flex flex-row items-center gap-2 min-w-0 flex-shrink",children:s.renderRowLabel(c)}),(0,t.jsxs)(ec,{percentage:l.maxValue.value?100*a/l.maxValue.value:0,className:"ms-auto w-[120px] font-medium text-gray-1000",containerClassName:"flex flex-row items-center justify-between w-full",children:[r(a),l.timeseries?.value&&(0,t.jsx)(V,{height:24,data:l.timeseries.value,className:"ms-auto me-2"})]}),(0,t.jsxs)(p.MenuContainer,{position:"bottom-end",children:[(0,t.jsx)(f.MenuButton,{"aria-label":"more menu button",className:"flex max-h-[24px] items-center",shape:"square",size:"small",svgOnly:!0,type:"tertiary",children:(0,t.jsx)(w.MoreHorizontal,{})}),(0,t.jsxs)(g.Menu,{className:"min-w-[180px]",portalClassName:"tailwind-preflight",children:[(0,t.jsx)(et.MenuItem,{onClick:e=>{e.stopPropagation(),navigator.clipboard.writeText(s.getCopyValue({value:a,meta:l,queryLink:i,...n})),o.success("Copied to clipboard")},children:(0,t.jsx)("span",{children:"Copy Value"})}),(0,t.jsx)(ea.MenuLink,{href:i,children:(0,t.jsx)("span",{className:"whitespace-nowrap",children:"Use in Query"})}),s.menuActions?.map((e,s)=>{if(e.href){let r=e.href({value:a,meta:l,queryLink:i,...n});return(0,t.jsx)(ea.MenuLink,{href:r,external:e.external,children:(0,t.jsx)("span",{className:"whitespace-nowrap",children:e.label})},`${s}-${e.label}`)}return e.onClick?(0,t.jsx)(et.MenuItem,{onClick:t=>{t.stopPropagation(),e.onClick?.({value:a,meta:l,queryLink:i,...n})},children:(0,t.jsx)("span",{className:"whitespace-nowrap",children:e.label})},`${s}-${e.label}`):null})]})]})]})});function ef(){return(0,t.jsxs)("div",{className:"flex flex-row items-center justify-between p-2",children:[(0,t.jsx)("div",{className:"flex flex-row items-center gap-2",children:(0,t.jsx)(W.Skeleton,{width:120})}),(0,t.jsx)(W.Skeleton,{width:120,className:"ms-auto me-2"}),(0,t.jsx)(w.MoreHorizontal,{color:"gray-600"})]})}function ep(e){let{config:a}=e;return(0,t.jsx)("div",{className:"flex flex-row items-center justify-center p-2 h-[200px] w-full",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[a.emptyStateIcon&&(0,t.jsx)("div",{className:"rounded-md border border-gray-200 p-2",children:a.emptyStateIcon}),(0,t.jsx)("p",{className:"text-label-14 text-gray-700",children:a.emptyStateMessage})]})})}let ej={event:"blockedConnection",filter:"wafAction eq 'deny' and wafRuleId eq 'sys_dos_mitigation'",groupBy:["clientIp","clientIpCountry","asnName","asnId"],reason:"firewall_tab",header:"Denied IPs",emptyStateMessage:"There are no denied IP addresses",emptyStateIcon:(0,t.jsx)(P.NetworkDevice,{}),renderRowLabel:e=>{let a=e.clientIpCountry?.toUpperCase(),l=a?E.countriesByAlpha2[a]:void 0,s=Array.isArray(l)?l[0]:l||a,i=a?E.flagsByAlpha2[a]:void 0,n=(0,t.jsxs)("div",{className:"flex w-[250px] flex-col",children:[(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)(I.Text,{className:"mb-3",variant:"heading-14",weight:500,children:["Details for ",e.clientIp]}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("div",{className:"flex flex-1 flex-row items-baseline justify-between gap-6",children:[(0,t.jsx)(I.Text,{className:"shrink-0",variant:"label-13",children:"AS Name"}),(0,t.jsx)(I.Text,{align:"right",color:"gray-800",variant:"label-13",children:e.asnName||"N/A"})]}),(0,t.jsxs)("div",{className:"flex flex-1 flex-row items-baseline justify-between gap-6",children:[(0,t.jsx)(I.Text,{variant:"label-13",children:"AS Number"}),(0,t.jsx)(I.Text,{color:"gray-800",variant:"label-13",children:e.asnId||"N/A"})]})]})]}),s?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(O.Divider,{}),(0,t.jsx)("div",{className:"p-4",children:(0,t.jsx)(I.Text,{variant:"label-13",children:[i,s].filter(Boolean).join(" ")})})]}):null]});return(0,t.jsx)(F.ContextCard.Trigger,{content:n,noPadding:!0,children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[e.clientIpCountry&&(0,t.jsx)($.Flag,{countryCode:e.clientIpCountry}),e.clientIp]})})},getRowKey:e=>e.clientIp,getCopyValue:e=>e.clientIp,enrichRow:(e,t)=>{let{teamIdOrSlug:a,projectIdOrName:l,startTime:s,endTime:i}=t;return{queryLink:ex({event:"blockedConnection",filter:`clientIp eq '${e.clientIp}' and wafAction eq 'deny' and wafRuleId eq 'sys_dos_mitigation'`,groupBy:["clientIp"],teamIdOrSlug:a,projectIdOrName:l,startTime:s,endTime:i}),configureLink:`/${a}/${l}/firewall/configure/bypass/new?ip=${e.clientIp}&domain=%2A`}},menuActions:[{label:"Create System Bypass",href:e=>e.configureLink}]};function eb(e){let{teamIdOrSlug:a,projectIdOrName:l}=e;return(0,t.jsx)(eh,{teamIdOrSlug:a,projectIdOrName:l,config:ej})}let ey={ip_address:{conditionType:"ip_address",nameField:"IP Address",op:"eq"},user_agent:{conditionType:"user_agent",nameField:"User Agent",op:"eq"},path:{conditionType:"path",nameField:"Path",op:"eq"}};function ev(e){let{fieldType:t,fieldValue:a,teamSlug:s,projectName:i}=e,n=ey[t],r=[{conditions:[{type:n.conditionType,op:n.op,value:a}]}],o=JSON.stringify({name:`Rule for ${n.nameField}: ${a}`,description:`Automatically created from firewall table for ${n.nameField} ${a}`,conditionGroup:r,active:!0,action:{mitigate:{action:"log"}}}),c=(0,l.getRuleTemplateSignature)(o),d=new URLSearchParams({template:o,sig:c});return`/${s}/${i}/firewall/configure/rule/new?${d.toString()}`}function ew(e){let{teamIdOrSlug:a,projectIdOrName:l}=e,s=(0,T.useMemo)(()=>({event:"incomingRequest",filter:"clientIp ne '127.0.0.1'",groupBy:["clientIp","clientIpCountry","asnName","asnId"],reason:"firewall_tab",limit:50,header:"Top IPs",emptyStateMessage:"No Data",emptyStateIcon:(0,t.jsx)(M.Globe,{}),renderRowLabel:e=>{let a=e.clientIpCountry?.toUpperCase(),l=a?E.countriesByAlpha2[a]:void 0,s=Array.isArray(l)?l[0]:l||a,i=a?E.flagsByAlpha2[a]:void 0,n=(0,t.jsxs)("div",{className:"flex w-[250px] flex-col",children:[(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)(I.Text,{className:"mb-3",variant:"heading-14",weight:500,children:["Details for ",e.clientIp]}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("div",{className:"flex flex-1 flex-row items-baseline justify-between gap-6",children:[(0,t.jsx)(I.Text,{className:"shrink-0",variant:"label-13",children:"AS Name"}),(0,t.jsx)(I.Text,{align:"right",color:"gray-800",variant:"label-13",children:e.asnName||"N/A"})]}),(0,t.jsxs)("div",{className:"flex flex-1 flex-row items-baseline justify-between gap-6",children:[(0,t.jsx)(I.Text,{variant:"label-13",children:"AS Number"}),(0,t.jsx)(I.Text,{color:"gray-800",variant:"label-13",children:e.asnId||"N/A"})]})]})]}),s?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(O.Divider,{}),(0,t.jsx)("div",{className:"p-4",children:(0,t.jsx)(I.Text,{variant:"label-13",children:[i,s].filter(Boolean).join(" ")})})]}):null]});return(0,t.jsx)(F.ContextCard.Trigger,{content:n,noPadding:!0,children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[e.clientIpCountry&&(0,t.jsx)($.Flag,{countryCode:e.clientIpCountry}),e.clientIp]})})},getRowKey:e=>e.clientIp,getCopyValue:e=>e.clientIp,menuActions:[{label:"Create Custom Rule",href:e=>ev({fieldType:"ip_address",fieldValue:e.clientIp,teamSlug:a,projectName:l}),external:!0}]}),[a,l]);return(0,t.jsx)(eh,{teamIdOrSlug:a,projectIdOrName:l,config:s})}function eN(e){let{teamIdOrSlug:a,projectIdOrName:l}=e,s=(0,T.useMemo)(()=>({event:"incomingRequest",filter:"",groupBy:["clientUserAgent"],reason:"firewall_tab",limit:50,header:"Top User Agents",emptyStateMessage:"No Data",emptyStateIcon:(0,t.jsx)(M.Globe,{}),renderRowLabel:e=>(0,t.jsx)("span",{className:"truncate text-ellipses max-w-[300px]",title:e.clientUserAgent,children:e.clientUserAgent}),getRowKey:e=>e.clientUserAgent,getCopyValue:e=>e.clientUserAgent,menuActions:[{label:"Create Custom Rule",href:e=>ev({fieldType:"user_agent",fieldValue:e.clientUserAgent,teamSlug:a,projectName:l}),external:!0}]}),[a,l]);return(0,t.jsx)(eh,{teamIdOrSlug:a,projectIdOrName:l,config:s})}function eC(e){let{teamIdOrSlug:a,projectIdOrName:l}=e,s=(0,T.useMemo)(()=>({event:"incomingRequest",filter:"",groupBy:["requestPath"],reason:"firewall_tab",limit:50,header:"Top Request Paths",emptyStateMessage:"No Data",emptyStateIcon:(0,t.jsx)(M.Globe,{}),renderRowLabel:e=>(0,t.jsx)("span",{className:"truncate text-ellipses max-w-[300px] font-mono text-sm",title:e.requestPath,children:e.requestPath}),getRowKey:e=>e.requestPath,getCopyValue:e=>e.requestPath,menuActions:[{label:"Create Custom Rule",href:e=>ev({fieldType:"path",fieldValue:e.requestPath,teamSlug:a,projectName:l}),external:!0}]}),[a,l]);return(0,t.jsx)(eh,{teamIdOrSlug:a,projectIdOrName:l,config:s})}var eS=e.i(594750),ek=e.i(3774835),eT=e.i(421794);function eA(e){let{teamIdOrSlug:a,projectIdOrName:l}=e,{config:s,isLoadingConfig:i}=(0,eS.useFirewallConfig)({projectId:l}),{data:n,isLoading:r}=(0,ek.useManagedRulesets)({projectIdOrName:l,teamIdOrSlug:a}),o={event:"firewallAction",filter:"wafRuleId ne '' and wafAction ne ''",groupBy:["wafRuleId"],reason:"firewall_tab",limit:50,header:"Rules",emptyStateMessage:"There are no blocked connections",emptyStateIcon:(0,t.jsx)(C.Shield,{}),renderRowLabel:e=>{let a=function(e,t,a){if(a&&e.startsWith("managed_")){let[,t]=e.split("managed_"),l=(0,eT.getRulesetFromRulesets)(a,t);if(l)return l.name}let l=[];t&&(l.push(...t.rules),l.push(...t.crsRules),l.push(...t.currentConfig.ips.map(e=>({id:e.id,name:`IP Block ${"*"===e.hostname?"":e.hostname} ${e.ip}`}))));let s=l.find(t=>t.id===e);if(s)return s.name;let i=K.ruleToMappings[e];return i?i.label:"deployment_rules"===e?"Deployment Rules":"deployment_defined_rules"===e?"Deployment Defined Rules":e}(e.wafRuleId,s,n);return(0,t.jsx)("span",{className:"truncate max-w-[300px]",title:`${a} (${e.wafRuleId})`,children:a})},getRowKey:e=>e.wafRuleId,getCopyValue:e=>e.wafRuleId,menuActions:[]};return(0,t.jsx)(eh,{teamIdOrSlug:a,projectIdOrName:l,config:o,isLoading:i||r})}var eR=e.i(9722978),e_=e.i(4738733),eI=e.i(9658738),eM=e.i(8724159);function eL(e){let{onActionClick:a,query:l,state:s}=e,{can:r}=(0,i.default)(),o=(0,L.wafRuleId)(s.filter),{currentData:c}=(0,q.useSonarLiveQuery)({...l,filter:"all_rules"===s.filter?void 0:`wafRuleId eq '${o}'`,groupBy:["wafAction"],summaryOnly:!0},"live"===s.range&&(r(n.Action.Read,n.Resource.SeawallConfig)||r(n.Action.List,n.Resource.SeawallConfig))),d=(c?.summary??[]).reduce((e,t)=>{let a="allow"===t.wafAction?"allow":(0,L.normalizeFirewallAction)(t.wafAction);return a in e&&(e[a]+=t.value??0),e.all+=t.value??0,e},{all:0,allow:0,challenge:0,deny:0,log:0,rate_limit:0});return(0,t.jsx)("div",{className:"relative overflow-hidden rounded-t-md @container before:pointer-events-none before:absolute before:inset-0 before:shadow-[inset_-30px_0_20px_-20px_var(--ds-background-200)] before:content-[''] @[966px]:before:shadow-none",children:(0,t.jsxs)("div",{className:"flex flex-1 flex-row overflow-x-scroll divide-x [-ms-overflow-style:none] [scrollbar-width:none] [&::-webkit-scrollbar]:hidden",children:[(0,t.jsx)(eB,{active:"all"===s.action,icon:(0,t.jsx)(M.Globe,{}),label:"All Traffic",onClick:()=>a("all"),children:d.all}),(0,t.jsx)(eB,{active:"allow"===s.action,icon:(0,t.jsx)(eM.ShieldCheck,{}),label:"Allowed",onClick:()=>a("allow"),children:d.allow}),(0,t.jsx)(eB,{active:"deny"===s.action,icon:(0,t.jsx)(S.ShieldOff,{}),label:"Denied",onClick:()=>a("deny"),children:d.deny}),(0,t.jsx)(eB,{active:"challenge"===s.action,icon:(0,t.jsx)(C.Shield,{}),label:"Challenged",onClick:()=>a("challenge"),children:d.challenge}),(0,t.jsx)(eB,{active:"log"===s.action,icon:(0,t.jsx)(e_.CodeWrap,{}),label:"Logged",onClick:()=>a("log"),children:d.log}),(0,t.jsx)(eB,{active:"rate_limit"===s.action,icon:(0,t.jsx)(eI.Gauge,{}),label:"Rate Limited",onClick:()=>a("rate_limit"),children:d.rate_limit})]})})}function eB(e){let{active:a,children:l,icon:s,label:i,onClick:n}=e;return(0,t.jsxs)(j.Stack,{as:"button",className:(0,eR.clsx)("min-w-[166px] cursor-pointer",{"bg-background-100 border-b-2 border-b-gray-1000":a,"bg-background-200 border-b border-b-gray-200":!a}),flex:1,gap:1,onClick:n,padding:5,children:[(0,t.jsxs)(j.Stack,{align:"center",direction:"row",gap:2,className:a?"text-gray-1000":"text-gray-800",children:[s,(0,t.jsx)(I.Text,{className:"whitespace-nowrap",variant:"label-14",weight:500,children:i})]}),(0,t.jsx)(I.Text,{align:"left",variant:"heading-24",weight:500,children:0===l?"-":(0,L.formatShortPrecision)(l)})]})}function eD(){return(0,t.jsx)(h.Button,{disabled:!0,prefix:(0,t.jsx)(C.Shield,{}),type:"secondary",children:"Bot Management"})}var e$=e.i(5285422),eP=e.i(9317241),eF=e.i(6891161),eO=e.i(9386557),eE=e.i(109803),eq=e.i(8852425),ez=e.i(764581),eH=e.i(2359044),eU=e.i(9334638);let eV=(0,eU.withNewIcon)(`<path d="M14.3038 7.872L12.5118 7.456L12.1918 7.328L3.96777 7.392V11.36L14.3038 11.392V7.872Z" fill="white"/>
<path d="M10.9441 11.008C10.9956 10.8717 11.0138 10.7251 10.9971 10.5804C10.9804 10.4356 10.9293 10.297 10.8481 10.176C10.7648 10.0761 10.6625 9.99351 10.5472 9.93311C10.4319 9.87271 10.3058 9.83564 10.1761 9.82402L4.60814 9.76002C4.57614 9.76002 4.54414 9.72802 4.51214 9.72802C4.50469 9.72243 4.49864 9.71518 4.49447 9.70685C4.49031 9.69852 4.48814 9.68933 4.48814 9.68002C4.48814 9.6707 4.49031 9.66151 4.49447 9.65318C4.49864 9.64485 4.50469 9.6376 4.51214 9.63202C4.54414 9.56802 4.57614 9.53602 4.64014 9.53602L10.2401 9.47202C10.5957 9.43256 10.9343 9.29911 11.2211 9.08539C11.5079 8.87167 11.7326 8.5854 11.8721 8.25602L12.1921 7.42402C12.1921 7.39202 12.2241 7.36002 12.1921 7.32802C12.0182 6.55311 11.596 5.85618 10.9898 5.34312C10.3835 4.83006 9.62638 4.52893 8.83338 4.48548C8.04037 4.44202 7.25486 4.65863 6.5962 5.10238C5.93754 5.54612 5.44174 6.19276 5.18414 6.94402C4.84973 6.70518 4.44182 6.59187 4.03214 6.62402C3.65616 6.66594 3.30563 6.8345 3.03813 7.102C2.77062 7.3695 2.60206 7.72004 2.56014 8.09602C2.53883 8.28846 2.54965 8.48311 2.59214 8.67202C1.9838 8.68883 1.40603 8.94233 0.981719 9.37859C0.557411 9.81485 0.320056 10.3994 0.32014 11.008C0.314889 11.1263 0.325653 11.2447 0.35214 11.36C0.353609 11.385 0.364196 11.4086 0.381891 11.4263C0.399586 11.444 0.42316 11.4545 0.448141 11.456H10.7201C10.7841 11.456 10.8481 11.424 10.8481 11.36L10.9441 11.008Z" fill="#F48120"/>
<path d="M12.7038 7.42401H12.5438C12.5118 7.42401 12.4798 7.45601 12.4478 7.48801L12.2238 8.25601C12.1723 8.3923 12.1542 8.53893 12.1709 8.68366C12.1876 8.82839 12.2386 8.96703 12.3198 9.08801C12.4032 9.18798 12.5054 9.27052 12.6207 9.33092C12.7361 9.39132 12.8621 9.42839 12.9918 9.44001L14.1758 9.50401C14.2078 9.50401 14.2398 9.53601 14.2718 9.53601C14.2792 9.5416 14.2853 9.54885 14.2895 9.55718C14.2936 9.56551 14.2958 9.5747 14.2958 9.58401C14.2958 9.59333 14.2936 9.60251 14.2895 9.61084C14.2853 9.61918 14.2792 9.62642 14.2718 9.63201C14.2398 9.69601 14.2078 9.72801 14.1438 9.72801L12.9278 9.79201C12.5723 9.83147 12.2337 9.96492 11.9468 10.1786C11.66 10.3924 11.4353 10.6786 11.2958 11.008L11.2318 11.296C11.1998 11.328 11.2318 11.392 11.2958 11.392H15.5198C15.5328 11.3939 15.5461 11.3927 15.5586 11.3885C15.5711 11.3843 15.5825 11.3773 15.5918 11.368C15.6011 11.3587 15.6081 11.3473 15.6123 11.3348C15.6165 11.3223 15.6177 11.3091 15.6158 11.296C15.692 11.0249 15.735 10.7455 15.7438 10.464C15.7387 9.65932 15.4168 8.88903 14.8478 8.32001C14.2788 7.751 13.5085 7.42908 12.7038 7.42401Z" fill="#FAAD3F"/>
`);var eW=e.i(9308891),eG=e.i(4201247),eQ=e.i(8122440);let eZ={duration:.5,repeat:1/0,ease:"linear"},eK="0.15 4";function eJ(e){let{dashArray:a}=e;return(0,t.jsx)("div",{className:"flex-1 relative h-4 flex items-center",children:(0,t.jsx)("svg",{className:"w-full h-4",viewBox:"0 0 52 16",xmlns:"http://www.w3.org/2000/svg",children:(0,t.jsx)(eG.motion.line,{x1:"0",y1:"8",x2:"52",y2:"8",stroke:"var(--ds-gray-600)",strokeWidth:"2",strokeDasharray:a,strokeLinecap:"round",initial:{strokeDashoffset:0},animate:{strokeDashoffset:-8},transition:eZ},"animated-line")})})}function eX(e){let{children:a,variant:l="default"}=e;return(0,t.jsx)("div",{className:`w-11 h-11 rounded-full flex items-center justify-center shadow-sm bg-white ${"dark"===l?"border-1 border-gray-900":"border-1 border-gray-300 bg-white"}`,children:a})}function eY(e){let{items:a}=e;return(0,t.jsx)("div",{className:"w-full mt-4",children:(0,t.jsx)("ul",{className:"space-y-0",children:a.map(e=>(0,t.jsxs)("li",{className:"flex flex-row rounded-sm [:where(&:nth-child(odd))]:bg-[--ds-gray-100] overflow-hidden items-center justify-between px-2 py-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:`w-2 h-2 ${(e=>{switch(e){case"good":return"bg-green-700";case"warning":return"bg-amber-700";case"error":return"bg-red-700"}})(e.status)} rounded-full`}),(0,t.jsx)("span",{className:"text-xs",children:e.label})]}),(0,t.jsx)("span",{className:"text-xs text-gray-900 font-medium",children:e.value})]},e.label))})})}function e0(e){let{projectId:a,teamId:l,onClose:s}=e,{data:i,isLoading:n,error:r}=(0,eQ.useReverseProxyStatusV2)({projectIdOrName:a,teamIdOrSlug:l}),o=(0,T.useMemo)(()=>{if(!i||0===i.length||n)return[];let e=i.reduce((e,t)=>{let{percent_reqs_obscured_public_ip:a,percent_total_traffic:l}=t;return e+l/100*a},0),t=i.reduce((e,t)=>{let{percent_reqs_obscured_ja4s:a,percent_total_traffic:l}=t;return e+l/100*a},0),a=t>50?"error":t>1?"warning":"good";return[{status:e>50?"error":e>1?"warning":"good",label:"IPs",value:`${e.toFixed(0)}% Obscured`},{status:a,label:"JA4s",value:`${t.toFixed(0)}% Obscured`},{status:"warning",label:"Latency",value:"Increased"}]},[i,n]),c=(0,T.useMemo)(()=>!i||n||0===i.length?null:[...i].sort((e,t)=>t.percent_total_traffic-e.percent_total_traffic)[0].trusted_proxy_name,[i,n]);return!i&&(n||r)||i?.length===0&&n?(0,t.jsxs)(eF.Modal.Modal,{active:!0,onClickOutside:s,width:640,children:[(0,t.jsxs)(eF.Modal.Body,{className:"tailwind-preflight",children:[(0,t.jsx)(eF.Modal.Header,{children:(0,t.jsx)(eF.Modal.Title,{children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(eO.WarningFill,{color:"amber-600",size:24}),(0,t.jsx)("h2",{className:"text-2xl font-semibold",children:"Proxy Configuration detected"})]})})}),r?(0,t.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,t.jsx)("p",{className:"text-red-900",children:"Failed to load proxy information. Please try again."})}):(0,t.jsxs)("div",{children:[(0,t.jsx)(W.Skeleton,{width:"100%",height:16,className:"mb-2"}),(0,t.jsx)(W.Skeleton,{width:"80%",height:16,className:"mb-9"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsx)(W.Skeleton,{width:"100%",height:288}),(0,t.jsx)(W.Skeleton,{width:"100%",height:288})]})]})]}),(0,t.jsx)(eF.Modal.Actions,{children:(0,t.jsx)(eF.Modal.Action,{onClick:s,type:"secondary",children:"Dismiss"})})]}):(0,t.jsxs)(eF.Modal.Modal,{active:!0,onClickOutside:s,width:640,children:[(0,t.jsxs)(eF.Modal.Body,{className:"tailwind-preflight",children:[(0,t.jsx)(eF.Modal.Header,{children:(0,t.jsx)(eF.Modal.Title,{children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(eO.WarningFill,{color:"amber-600",size:24}),(0,t.jsx)("h2",{className:"text-2xl font-semibold",children:"Proxy Configuration detected"})]})})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"mb-8",children:["We detected an external proxy in front of your application, which is"," ",(0,t.jsx)("strong",{children:"not recommended"}),". Removing external proxies will improve performance and security."]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 border border-gray-300 rounded-sm overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center p-4",children:[(0,t.jsxs)("div",{className:"mb-4 mt-2 flex items-center gap-1 flex-col",children:[(0,t.jsx)("h3",{className:"font-medium text-base text-center",children:"With Proxies"}),(0,t.jsx)(x.Badge,{variant:"gray-subtle",children:"Current"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-0 mb-6 mt-6",children:[(0,t.jsx)(eX,{children:(0,t.jsx)(ez.WindowGlobe,{size:16,color:"gray-1000"})}),(0,t.jsx)(eJ,{dashArray:eK}),null!==c?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"relative w-11 h-11",children:[(0,t.jsxs)("svg",{className:"absolute inset-0 w-full h-full",children:[(0,t.jsx)("defs",{children:(0,t.jsxs)("mask",{id:"googleContainerMask",children:[(0,t.jsx)("circle",{cx:"22",cy:"22",r:"22",fill:"white"}),(0,t.jsx)("circle",{cx:"40",cy:"40",r:"11",fill:"black"})]})}),(0,t.jsx)("foreignObject",{width:"100%",height:"100%",mask:"url(#googleContainerMask)",children:(0,t.jsxs)("div",{className:"w-full h-full border-1 border-gray-300 rounded-full flex items-center justify-center bg-white shadow-sm",children:[(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center opacity-10 blur-sm scale-[2]",children:(0,t.jsx)(e1,{name:c,size:20})}),(0,t.jsx)(e1,{name:c,size:16})]})}),(0,t.jsxs)("g",{mask:"url(#googleContainerMask)",fill:"none",stroke:"var(--ds-gray-300)",strokeWidth:"1",children:[(0,t.jsx)("circle",{cx:"22",cy:"22",r:"21.5"}),(0,t.jsx)("circle",{cx:"40",cy:"40",r:"11.5"})]})]}),(0,t.jsx)("div",{className:"absolute bottom-1 -right-1 translate-y-1/2",children:(0,t.jsx)("div",{className:"w-4 h-4 bg-amber-800 rounded-full flex items-center justify-center",children:(0,t.jsx)(eO.WarningFill,{size:8,color:"background-100"})})})]}),(0,t.jsx)(eJ,{dashArray:"0.15 8"})]}):null,(0,t.jsx)(eX,{variant:"dark",children:(0,t.jsx)(eq.LogoVercel,{size:16,color:"gray-1000"})})]}),(0,t.jsx)(eY,{items:o})]}),(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center p-4 bg-gradient-to-b from-[var(--ds-background-200)] to-[var(--ds-background-100)] border-l border-gray-300",children:[(0,t.jsxs)("div",{className:"mb-4 mt-2 flex items-center gap-1 flex-col",children:[(0,t.jsx)("h3",{className:"font-medium text-base text-center",children:"Direct to Vercel"}),(0,t.jsx)(x.Badge,{variant:"green",children:"Recommended"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-0 mb-6 mt-6",children:[(0,t.jsx)(eX,{children:(0,t.jsx)(ez.WindowGlobe,{size:16,color:"gray-1000"})}),(0,t.jsx)(eJ,{dashArray:eK}),(0,t.jsx)(eX,{variant:"dark",children:(0,t.jsx)(eq.LogoVercel,{size:16,color:"gray-1000"})})]}),(0,t.jsx)(eY,{items:[{status:"good",label:"IPs",value:"Not Obscured"},{status:"good",label:"JA4s",value:"Not Obscured"},{status:"good",label:"Latency",value:"Lowest"}]})]})]})]})]}),(0,t.jsxs)(eF.Modal.Actions,{children:[(0,t.jsx)(eF.Modal.Action,{onClick:s,type:"secondary",children:"Dismiss"}),(0,t.jsx)(eF.Modal.Action,{onClick:()=>{window.open("/guides/can-i-use-a-proxy-on-top-of-my-vercel-deployment","_blank")},prefix:(0,t.jsx)(eE.External,{size:16}),type:"default",children:"View Migration Guide"})]})]})}function e1(e){let{name:a,size:l}=e,s=""===a?{kind:"no-proxy"}:a.startsWith("generic-")?{kind:"generic",name:a.slice(7)}:{kind:"known",name:a};if("no-proxy"===s.kind)return(0,t.jsx)(ez.WindowGlobe,{size:16,color:"gray-1000"});switch(s.name){case"gcp":return(0,t.jsx)(eH.LogoGoogleCloudPlatform,{size:l});case"cloudflare":return(0,t.jsx)(eV,{size:l});case"azure-front-door":return(0,t.jsx)(eW.LogoAzure,{size:l});default:return(0,t.jsx)(P.NetworkDevice,{size:l})}}var e2=e.i(5149014),e4=e.i(9983900);function e8(e){let{hasAnomaly:a,isLoading:l}=(0,e2.useActiveAnomaly)(e),s=function(){let[e,t]=(0,T.useState)(!1);return{isOpen:e,open:(0,T.useCallback)(()=>{t(!0)},[]),close:(0,T.useCallback)(()=>{t(!1)},[])}}(),[i,n,r]=(0,e2.useReverseProxyBadge)({...e,onProxyClick:s.open}),[o,c,d,u]=(0,e2.useACMBadge)(e),[m,x,h]=(0,e2.useGlobalBypass)(e),g=(0,T.useCallback)(()=>i||o||m?null:(0,t.jsx)("span",{className:"text-label-12 text-gray-alpha-900",children:"All systems normal"}),[o,i,m]),f=(0,T.useCallback)(()=>m?(0,t.jsx)(e4.ShieldOffLocal,{fill:"var(--ds-red-800)",size:56}):a?(0,t.jsx)(e4.ShieldGlobeLocal,{fill:"var(--ds-amber-800)",size:56,className:"ml-2"}):(0,t.jsx)(e4.ShieldCheckLocal,{fill:"var(--ds-blue-700)",size:56}),[m,a]),p=(0,T.useMemo)(()=>m?"System Mitigations Paused":a?"DDoS attacks are being mitigated":"Firewall is active",[a,m]),j=l||r||u||h,b=(0,T.useRef)(!1);return((0,T.useEffect)(()=>{j||b.current||(b.current=!0)},[j]),j&&!b.current)?(0,t.jsx)(W.Skeleton,{className:"h-full",width:300}):(0,t.jsxs)(eP.GradientPostureCard,{hasAnomaly:a,hasChallengeMode:o,hasGlobalBypass:m,children:[(0,t.jsxs)("figure",{className:"flex flex-col items-center gap-3 lg:gap-5 grow justify-center",children:[(0,t.jsx)(f,{}),(0,t.jsxs)("figcaption",{className:(0,eo.cn)("flex flex-col items-center",{"gap-1":o||i}),children:[(0,t.jsx)("p",{children:(0,t.jsx)("strong",{className:"text-label-14 font-medium",children:p})}),(0,t.jsxs)("div",{className:"flex flex-col gap-1 items-center",children:[(0,t.jsx)(x,{}),(0,t.jsx)(c,{}),(0,t.jsx)(n,{}),(0,t.jsx)(g,{})]})]})]}),(0,t.jsxs)("div",{className:"group flex flex-col gap-1",children:[(0,t.jsx)(eP.BotProtectionRow,{hasReverseProxy:i,...e}),(0,t.jsx)(eP.CustomRulesRow,{...e}),(0,t.jsx)(eP.AttackChallengeRow,{challengeData:d,isAlerting:o})]}),s.isOpen&&(0,t.jsx)(e0,{onClose:s.close,...e})]})}e.i(2318668);var e6=e.i(8114796),e5=e.i(8362250),e3=e.i(9367781),e9=e.i(5793260),e7=e.i(9465698),te=e.i(6060673),tt=e.i(3420813),ta=e.i(6881349),tl=e.i(9940838),ts=e.i(7390663),ti=e.i(2560270),tn=e.i(6318858),tr=e.i(3496900),to=e.i(57106),tc=e.i(7311072);function td(e){let a,{toolbarState:l,setToolbarState:s,rules:i,options:n,isCustomRuleSelected:r,team:c,managedRulesets:d}=e,u=(0,Z.getEnabledTimeRangeOptions)(c),m=u.find(e=>e.value===l.range),x=m?.icon||null,h=(0,k.useParams)(),j=i.find(e=>e.value===l.filter);if("all_rules"===l.filter)a="Overview";else if(j)a=j.label;else if(l.filter.startsWith("managed_")){let e=l.filter.slice(8);if(a=e,d){let t=(0,eT.getRulesetFromRulesets)(d,e);t&&(a=t.name)}}else a=l.filter;let b=n.find(e=>e.value===l.groupBy),y=(0,T.useMemo)(()=>"string"==typeof l.range?m?.label??"live":"Custom",[m?.label,l.range]);return(0,t.jsxs)("div",{className:"flex flex-col gap-4 @lg-page:flex-row @lg-page:gap-[unset] @lg-page:divide-x @lg-page:[&>*:not(:first-child)]:pl-3 @lg-page:[&>*:not(:last-child)]:pr-3",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-4 @lg-page:flex-row @lg-page:gap-3",children:[(0,t.jsxs)(ta.Combobox,{"data-testid":(0,o.tid)("firewall","graph-toolbar","filters"),"aria-label":"Select firewall filter option",className:(0,eR.clsx)(tc.default.container,"w-full lg:w-[226px]"),clearable:"all_rules"!==l.filter,onChange:e=>{s({type:"filter",value:e||"all_rules"})},value:a,children:[(0,t.jsx)(ta.Combobox.Input,{}),(0,t.jsx)(ta.Combobox.List,{children:i.map(e=>(0,t.jsx)(ta.Combobox.Option,{"data-testid":(0,o.tid)("firewall","graph-toolbar","filter-value"),value:e.value,children:e.label},e.value))})]}),r?(0,t.jsx)(to.ButtonLink,{href:`/${h?.teamSlug}/${h?.project}/firewall/configure/rule/${l.filter}`,prefix:(0,t.jsx)(tr.PencilEdit,{}),type:"secondary",children:"Edit Rule"}):null]}),(0,t.jsxs)("div",{className:"flex flex-col gap-4 @lg-page:flex-row @lg-page:gap-3",children:[(0,t.jsxs)(p.MenuContainer,{children:[(0,t.jsx)(f.MenuButton,{align:"flex-grow",className:"w-full text-left font-normal @lg-page:w-[176px]",style:{fontWeight:400},suffix:(0,t.jsx)(ti.ChevronDown,{}),type:"secondary",children:b?.label??""}),(0,t.jsx)(g.Menu,{className:"overflow-y-auto @md-page:max-h-[250px] @md-page:max-w-[200px] @lg-page:min-w-[200px]",portalClassName:"tailwind-preflight",style:{minWidth:"180px"},children:n.map(e=>{let{value:a,label:l}=e;return(0,t.jsx)(et.MenuItem,{label:l,onClick:()=>s({type:"groupBy",value:a}),suffix:b?.value===a?(0,t.jsx)(tn.Check,{size:16}):null,value:a,children:(0,t.jsx)("span",{children:l})},a)})})]}),(0,t.jsxs)(p.MenuContainer,{children:[(0,t.jsx)(f.MenuButton,{align:"flex-grow",className:"w-full text-left @lg-page:w-[146px]",prefix:x?(0,t.jsx)(x,{}):null,style:{fontWeight:400},suffix:(0,t.jsx)(ti.ChevronDown,{}),type:"secondary",children:y}),(0,t.jsx)(g.Menu,{className:"overflow-y-auto @md-page:max-h-[250px] @md-page:max-w-[200px] @lg-page:min-w-[200px]",portalClassName:"tailwind-preflight",children:u.map(e=>{let{value:a,label:l}=e;return(0,t.jsx)(et.MenuItem,{label:l,onClick:()=>s({type:"range",value:a}),suffix:m?.value===a?(0,t.jsx)(tn.Check,{size:16}):null,value:a,children:(0,t.jsx)("span",{children:l})},a)})})]})]})]})}function tu(e){let{positionTop:a=0,...l}=e,[s,i]=(0,T.useState)(!1),{scrollY:n}=(0,tl.useScroll)(),r=(0,T.useRef)(null);return(0,ts.useMotionValueEvent)(n,"change",e=>{r.current&&i(e>(0,L.getOffsetTop)(r.current)-56)}),(0,t.jsxs)("div",{ref:r,children:[(0,t.jsx)(eG.motion.div,{className:"z-[12]",style:{position:s?"fixed":void 0,top:s?a-56:0,left:0,right:0,paddingTop:8*!!s,paddingBottom:8*!!s,borderBottom:s?"1px solid var(--ds-gray-alpha-400)":void 0,background:s?"var(--ds-background-100)":void 0},children:(0,t.jsx)("div",{className:(0,eR.clsx)({container:s}),children:(0,t.jsx)(td,{...l})})}),s?(0,t.jsx)("div",{className:"h-[150px] lg:h-[40px]"}):null]})}var tm=e.i(5182595),tx=e.i(8690335);function th(){return(0,t.jsxs)("div",{className:"flex flex-col gap-4 @lg-page:flex-row @lg-page:gap-[unset] @lg-page:divide-x @lg-page:[&>*:not(:first-child)]:pl-3 @lg-page:[&>*:not(:last-child)]:pr-3",children:[(0,t.jsx)("div",{className:"flex w-full flex-col gap-4 @lg-page:flex-row @lg-page:gap-3",children:(0,t.jsx)("div",{className:"w-full @lg-page:w-[226px]",children:(0,t.jsx)(W.Skeleton,{height:40,width:"100%"})})}),(0,t.jsxs)("div",{className:"flex w-full flex-col gap-4 @lg-page:flex-row @lg-page:gap-3",children:[(0,t.jsx)("div",{className:"w-full @lg-page:w-[176px]",children:(0,t.jsx)(W.Skeleton,{height:40,width:"100%"})}),(0,t.jsx)("div",{className:"w-full @lg-page:w-[146px]",children:(0,t.jsx)(W.Skeleton,{height:40,width:"100%"})})]})]})}function tg(e){let{height:a}=e;return(0,t.jsxs)("div",{className:"flex w-full flex-col",style:{height:a},children:[(0,t.jsxs)("div",{className:"flex h-36 flex-row items-center gap-5",children:[(0,t.jsx)(W.Skeleton,{height:16,width:28}),(0,t.jsx)("hr",{className:"w-full"})]}),(0,t.jsxs)("div",{className:"flex h-36 flex-row items-center gap-5",children:[(0,t.jsx)(W.Skeleton,{height:16,width:28}),(0,t.jsx)("hr",{className:"w-full"})]}),(0,t.jsxs)("div",{className:"flex h-36 flex-row items-center gap-5",children:[(0,t.jsx)(W.Skeleton,{height:16,width:28}),(0,t.jsx)("hr",{className:"w-full"})]}),(0,t.jsxs)("div",{className:"flex h-36 flex-row items-center gap-5",children:[(0,t.jsx)(W.Skeleton,{height:16,width:28}),(0,t.jsx)("hr",{className:"w-full"})]}),(0,t.jsxs)("div",{className:"flex h-36 flex-row items-center gap-5",children:[(0,t.jsx)(W.Skeleton,{height:16,width:28}),(0,t.jsx)("hr",{className:"w-full"})]}),(0,t.jsxs)("div",{className:"flex h-36 flex-row items-center gap-5",children:[(0,t.jsx)(W.Skeleton,{height:16,width:28}),(0,t.jsx)("hr",{className:"w-full"})]}),(0,t.jsxs)("div",{className:"flex flex-row justify-around",children:[(0,t.jsx)(W.Skeleton,{height:16,width:48}),(0,t.jsx)(W.Skeleton,{height:16,width:48}),(0,t.jsx)(W.Skeleton,{className:"xs:block hidden",height:16,width:48}),(0,t.jsx)(W.Skeleton,{className:"hidden sm:block",height:16,width:48}),(0,t.jsx)(W.Skeleton,{className:"hidden md:block",height:16,width:48}),(0,t.jsx)(W.Skeleton,{className:"hidden @lg-page:block",height:16,width:48})]})]})}function tf(e){let{height:a,data:l,query:s,error:i,width:n,isLoading:r,onZoomIn:c}=e,{allData:d,allKeys:u,colorScale:m,formatter:x}=X(),h=(0,T.useMemo)(()=>{var e,t;let a;return e=d.filter(e=>!(0,L.isOthersAggregate)(e.key)),t=u,a=new Map(e.map(e=>{let{date:a}=e;return[a.toISOString(),{time:a.toISOString(),name:a.toISOString(),date:a,...Object.fromEntries(t.map(e=>[e,0]))}]})),e.forEach(e=>{let{date:t,key:l,value:s}=e,i=a.get(t.toISOString());i&&(i[l]=s)}),[...a.values()].sort((e,t)=>e.date.getTime()-t.date.getTime())},[d,u]);return i?(0,t.jsxs)("div",{"data-testid":(0,o.tid)("firewall","graph","error"),className:"border-border flex flex-col items-center justify-center gap-2 rounded-md border border-gray-400 bg-[var(--accents-1)]",style:{height:a},children:[(0,t.jsx)(I.Text,{className:"capitalize",weight:500,children:i.code}),(0,t.jsx)(I.Text,{className:"max-w-[400px] text-gray-800",children:i.message})]}):!l||r&&0===l.size||n<10?(0,t.jsx)(tg,{height:a}):0===l.size?(0,t.jsxs)("div",{"data-testid":(0,o.tid)("firewall","graph","empty"),className:"border-border flex flex-col items-center justify-center gap-2 rounded-md border border-gray-400 bg-[var(--accents-1)]",style:{height:a},children:[(0,t.jsx)(I.Text,{weight:500,children:"No Data"}),(0,t.jsx)(I.Text,{className:" max-w-[400px] text-gray-800",children:"There's no data available for your selection."})]}):(0,t.jsx)("div",{style:{height:a},children:(0,t.jsx)(tm.LineChart,{agentWorkflow:"firewall-investigation",data:h,categories:u,getColor:m,isLoading:r,syncId:"firewall",disableLegend:!0,formatValue:e=>x(e),formatXAxisValue:tj,xTickCount:5,yTickCount:5,builderQuery:(0,tx.fromSonarQuery)(s),tooltipStyle:"dots",onZoomIn:c})})}let tp={hour:"numeric",minute:"2-digit",second:"numeric"};function tj(e){return e.toLocaleTimeString(void 0,tp)}var tb=e.i(2329363);let ty=(0,eU.withNewIcon)(`<g clip-path="url(#clip0_4628_1818)">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M15.0932 7.64904C14.8377 3.56123 11.3168 0.454519 7.22898 0.710006C5.45234 0.821046 3.8593 1.54996 2.64882 2.67365L3.66933 3.77299C4.63533 2.87625 5.90403 2.29574 7.32254 2.20709C10.5835 2.00327 13.3923 4.48161 13.5961 7.74261C13.663 8.81244 14.0605 10.1035 15.1336 10.8299L15.9745 9.58773C15.4544 9.23567 15.1467 8.50463 15.0932 7.64904ZM1.21934 4.48945C0.544864 5.69225 0.197633 7.09732 0.28994 8.57425C0.414316 10.5643 0.700415 12.5343 1.14241 14.4655L2.6046 14.1308C2.1807 12.2786 1.90631 10.3893 1.78702 8.48068C1.71326 7.30048 1.99016 6.18167 2.52767 5.22312L1.21934 4.48945ZM11.9314 8.14996C11.7883 5.86143 9.81714 4.12215 7.5286 4.26518C5.24007 4.40822 3.50079 6.3794 3.64382 8.66793C3.6894 9.3971 3.75974 10.1232 3.85448 10.845L5.34173 10.6498C5.25141 9.9617 5.18435 9.2695 5.1409 8.57437C5.04955 7.11264 6.16045 5.85362 7.62217 5.76226C9.0839 5.67091 10.3429 6.78181 10.4343 8.24353C10.4726 8.85698 10.5332 9.46767 10.6157 10.0745L12.102 9.87246C12.0244 9.30161 11.9674 8.72708 11.9314 8.14996ZM13.0024 13.8749C12.7538 13.0919 12.5457 12.2962 12.379 11.4908L10.9101 11.7947C11.0749 12.5911 11.2779 13.3786 11.5181 14.1546L13.0024 13.8749ZM14.6499 24.8207L10.8508 25.5691C11.9295 25.8912 13.1347 25.7761 14.176 25.1513C14.3437 25.0507 14.5018 24.94 14.6499 24.8207ZM4.79771 15.421C4.62667 14.8172 4.47329 14.2083 4.33781 13.5951C4.27053 13.2906 4.20767 12.985 4.14924 12.6784L5.62272 12.3976C5.67842 12.6899 5.73835 12.9812 5.80249 13.2715C5.94137 13.9001 6.09998 14.5239 6.27803 15.142L4.79771 15.421ZM8.11677 14.7955L8.0783 14.6651L8.0775 14.6624C7.46325 12.5503 7.08106 10.3695 6.94287 8.1585C6.91703 7.7451 7.23122 7.38902 7.64463 7.36318C8.05803 7.33734 8.41411 7.65153 8.43995 8.06494C8.57119 10.1649 8.93413 12.2361 9.51744 14.2421L9.51783 14.2435L9.5983 14.5164L8.11677 14.7955Z" fill="currentColor" />
  </g>
  <defs>
  <clipPath id="clip0_4628_1818">
  <rect width="16" height="16" fill="white" style="fill:white;fill-opacity:1;"/>
  </clipPath>
  </defs>`);var tv=e.i(6675233),tw=e.i(5169576),tN=e.i(9339975),tC=e.i(1637579),tS=e.i(3863657),tk=e.i(5433449);function tT(e){let{isOpen:a,onClose:l}=e;return(0,t.jsxs)(eF.Modal.Modal,{active:a,onClickOutside:l,children:[(0,t.jsxs)(eF.Modal.Body,{children:[(0,t.jsxs)(eF.Modal.Header,{children:[(0,t.jsx)(eF.Modal.Title,{children:(0,t.jsxs)(j.Stack,{align:"center",direction:"row",gap:2,children:[(0,t.jsx)(tk.FileText,{size:20}),"Deployment Rules"]})}),(0,t.jsxs)(eF.Modal.Subtitle,{children:["Rules defined in ",(0,t.jsx)("code",{children:"vercel.json"})," files, created at build time."]})]}),(0,t.jsxs)(eF.Modal.P,{children:["Deployment rules are firewall rules that are automatically created from your project's ",(0,t.jsx)("code",{children:"vercel.json"})," configuration file. They are generated at build time and run at the edge before your application code executes to protect your deployment."]}),(0,t.jsxs)(eF.Modal.P,{children:["Each action type is shown separately and these rules are automatically generated from your ",(0,t.jsx)("code",{children:"vercel.json"}),"."]}),(0,t.jsxs)(eF.Modal.P,{children:["Learn more about configuring deployment rules in"," ",(0,t.jsx)(to.Link,{href:"/docs/project-configuration",target:"_blank",external:!0,variant:"highlight",children:"project configuration"})," ","or read about the"," ",(0,t.jsx)(to.Link,{href:"/docs/vercel-firewall",target:"_blank",external:!0,variant:"highlight",children:"Vercel firewall"}),"."]})]}),(0,t.jsx)(eF.Modal.Actions,{children:(0,t.jsx)(eF.Modal.Action,{onClick:l,type:"secondary",children:"Close"})})]})}function tA(e){let{config:a,project:s,rulesets:i}=e,{hoveredTimestamp:n}=(0,e$.useSonarContext)(),[r,o,c]=(0,Z.useToolbarState)(),{maxByKeys:d,allData:u}=X(),m=(0,k.useParams)(),x=function(e,t){let[a,l]=(0,T.useState)(tB(e,t)),s=(0,T.useRef)(tB(e,t));return(0,T.useEffect)(()=>{let a=performance.now(),i=tB(e,t),n=s.current,r=n.length===i.length,o=0,c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:performance.now(),t=Math.sin(Math.min((e-a)/100,1))*Math.PI*.5;if(!r||t>=1){l(i),Object.assign(n,i);return}o=requestAnimationFrame(c);let s=Array(i.length);for(let e=i.length;e--;){let a=i[e],l=n[e];s[e]={name:a.name,total:a.total,value:tD(l.value,a.value,t),ratio:tD(l.ratio,a.ratio,t)}}l(s)};return c(),()=>{cancelAnimationFrame(o),l(a=>(Object.assign(n,a),tB(e,t)))}},[e,t]),a}(d,(0,T.useMemo)(()=>{if(n)return Object.fromEntries(u.filter(e=>e.date.getTime()===n.getTime()).map(e=>[e.key,e.value]))},[n,u])),h=(0,T.useCallback)(e=>{let t="all_rules"===r.filter;if("BotID"===r.filter)return`/${m?.teamSlug}/${m?.project}/observability?builder=true&${new URLSearchParams({time:"1d",metric:"botIdCheck.count",by:"botCheckResult",aggregate:"sum"}).toString()}`;let a=(0,L.wafRuleId)(t?e:r.filter),l={time:"1d",by:"wafAction",filter:[s?.id&&`projectId eq '${s.id}'`,`wafRuleId eq '${a}'`].filter(e=>!!e).join(" and "),aggregate:"sum"};(0,K.isLimitedSystemRule)(a)?(l.metric="blockedConnection.count","clientIp"===r.groupBy&&(l.by="clientIp",l.where=`clientIp eq '${e}'`)):(l.metric="incomingRequest.count",t||(l.filter=[l.filter,`${r.groupBy} eq '${e}'`].join(" and ")));let i=new URLSearchParams(l);return`/${m?.teamSlug}/${m?.project}/observability?builder=true&${i.toString()}`},[m,s?.id,r.filter,r.groupBy]),g=(0,T.useCallback)(e=>{let t,a,[s]=e.split(tS.SEPARATOR);switch(r.groupBy){case"clientIp":t="ip_address",a="IP Address";break;case"clientIpCountry":t="geo_country",a="Country";break;case"clientAsn":t="geo_as_number",a="ASN";break;case"requestPath":t="path",a="Request Path";break;case"edgeNetworkRegion":t="region",a="Vercel Region";break;case"clientUserAgent":t="user_agent",a="User Agent";break;case"sourcePath":t="target_path",a="Route";break;case"clientJa4Digest":t="ja4_digest",a="JA4";break;case"requestHostname":t="host",a="Host";break;default:return null}let i=[{conditions:[{type:t,op:"eq",value:s}]}],n=s;n&&n.length>60&&(n=n.slice(0,60));let o=JSON.stringify({name:`Rule for ${a}: ${n}`,description:`Automatically created from firewall table for ${a} ${n}`,conditionGroup:i,active:!0,action:{mitigate:{action:"log"}}}),c=(0,l.getRuleTemplateSignature)(o),d=new URLSearchParams({template:o,sig:c});return`/${m?.teamSlug}/${m?.project}/firewall/configure/rule/new?${d.toString()}`},[m?.teamSlug,m?.project,r.groupBy]),f=Object.fromEntries(Object.entries((0,T.useMemo)(()=>"all_rules"===r.filter?"group_by_category"===r.groupBy?x.reduce((e,t)=>{let[a,l]=t.name.split(tS.SEPARATOR),s=K.ruleToMappings[a];if(s?.groupBy){let a=e[s.groupBy];a?a.push(t):a=[t],e[s.groupBy]=a}else(0,L.isCustomRuleId)(a)?e["Custom Rules"].push(t):t.value>0&&e.System.push(t);return e},{System:[],"Custom Rules":[]}):x.reduce((e,t)=>{let[,a]=t.name.split(tS.SEPARATOR),l=(0,L.formatFirewallActionForDisplay)(a),s=e[l];return s?s.push(t):s=[t],e[l]=s,e},{}):{[r.groupBy]:x},[x,r.filter,r.groupBy])).filter(e=>{let[,t]=e;return t.length>0}));return(0,t.jsx)("div",{className:(0,eR.clsx)("grid w-full grid-cols-1 gap-3",{"@lg-page:grid-cols-2":Object.keys(f).length>1}),children:Object.entries(f).map(e=>{let[l,s]=e;return(0,t.jsx)(tR,{config:a,createMonitoringSearchParams:h,createRuleBuilderLink:g,header:l,params:m,rulesets:i,segment:s,toolbarState:r,ruleOptions:c},l)})})}function tR(e){let{config:a,header:l,rulesets:s,segment:i,toolbarState:n,ruleOptions:r,createMonitoringSearchParams:o,createRuleBuilderLink:c,params:d}=e,[u,m]=(0,T.useState)(""),[x,h]=(0,T.useState)(!1),g=tL(a,s,n),f=i;u&&(f=f.filter(e=>{let{label:t,suffix:a}=g(e.name);return t.toLowerCase().includes(u.toLowerCase())||a?.toLowerCase().includes(u.toLowerCase())}));let p=e=>{let t=e.name.replace(/\$\$.*/,""),l=a?.ruleMap.get(t),i=a?.ruleMap.get(t)?.type==="custom_rule";return{config:a,createMonitoringSearchParams:o,createRuleBuilderLink:c,fieldId:t,isCustomRule:i,params:d,point:e,ruleFields:l,rulesets:s,toolbarState:n,onDeploymentRuleInfoClick:()=>{h(!0)}}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(es.ExpandablePanel,{children:[(0,t.jsxs)(es.ExpandablePanel.Header,{className:"flex flex-row items-center justify-between",children:[(0,t.jsx)(I.Text,{className:"leading-6",variant:"label-14",weight:500,children:(0,L.formatTableHeader)(r,l)}),"Custom Rules"===l?(0,t.jsx)(t_,{}):null]}),(0,t.jsx)("div",{className:"p-2 [&>*:nth-child(odd)]:bg-background-200",children:i.slice(0,5).map(e=>(0,t.jsx)(tI,{...p(e)},e.name))}),i.length>5&&(0,t.jsx)(es.ExpandablePanel.Footer,{children:(0,t.jsx)(es.ExpandablePanel.Expand,{})}),(0,t.jsx)(es.ExpandablePanel.Expanded,{disableFocusTrap:!0,children:(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsx)("div",{className:"border-b border-red-100 p-5",children:(0,t.jsx)(I.Text,{variant:"heading-16",weight:500,children:(0,L.formatTableHeader)(r,l)})}),(0,t.jsx)("div",{className:"px-2",children:(0,t.jsx)(en.SearchInput,{clearable:!1,onChange:e=>m(e.target.value),placeholder:"Search",value:u})}),(0,t.jsx)("div",{className:"p-2",children:f.map(e=>(0,t.jsx)(tI,{...p(e)},e.name))})]})})]}),(0,t.jsx)(tT,{isOpen:x,onClose:()=>h(!1)})]})}function t_(){let e=(0,k.useParams)(),{isLoading:a,team:l}=(0,r.useTeam)(),{can:s,isLoading:o}=(0,i.default)(),{data:c,isLoading:d}=(0,te.useProject)(e?.project),{config:u,isLoadingConfig:m}=(0,eS.useFirewallConfig)({projectId:c?.id});if(o||m||d||a)return(0,t.jsx)(W.Skeleton,{height:24,width:24});let x=s(n.Action.All,n.Resource.SeawallConfig),h=c?.microfrontends!==void 0&&!c.microfrontends.isDefaultApp,g=(0,L.isPlanLimitReached)({config:u,teamPlan:l?.billing?.plan,type:"customRules"});return(0,t.jsx)(to.ButtonLink,{"aria-label":"Add a custom rule",disabled:!x||h||g,href:"firewall/configure/rule/new",size:"tiny",style:{"--height":"24px"},svgOnly:!0,type:"secondary",children:(0,t.jsx)(N.Plus,{})})}function tI(e){let{config:a,createMonitoringSearchParams:l,createRuleBuilderLink:s,fieldId:i,isCustomRule:n,params:r,point:o,ruleFields:c,rulesets:d,toolbarState:u,onDeploymentRuleInfoClick:m}=e,{activeDataKey:x,formatter:h,seriesColor:j,setActiveDataKey:b}=X(),y=!(0,L.isOthersAggregate)(o.name),v=s(i),N=!(0,L.isOthersAggregate)(o.name)&&null!==v,C=()=>{y&&b(x===o.name?null:o.name)};return(0,t.jsxs)("div",{className:(0,eR.clsx)("flex min-h-[36px] flex-1 items-center gap-5 rounded-md p-2",{"transition-colors hover:!bg-gray-100 cursor-pointer":y}),onClick:C,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&C()},role:"button",tabIndex:0,"aria-disabled":!y,children:[(0,t.jsxs)("div",{className:"flex flex-1 items-center gap-2 border-none bg-transparent text-start",children:[(0,t.jsx)("div",{className:"size-[8px] rounded-full",style:{backgroundColor:null!==x&&x!==o.name?"var(--ds-gray-400)":j[o.name]}}),(0,t.jsx)(tM,{config:a,disabled:c?.type==="custom_rule"&&!c.active,rulesets:d,toolbarState:u,children:o.name}),(0,t.jsx)(I.Text,{className:"select-text tabular-nums",color:"gray-900",variant:"label-14",children:h(o.value)})]}),(0,t.jsxs)(p.MenuContainer,{position:"bottom-end",children:[(0,t.jsx)(f.MenuButton,{"aria-label":"more menu button",className:"flex max-h-[24px] items-center",shape:"square",size:"small",svgOnly:!0,type:"tertiary",children:(0,t.jsx)(w.MoreHorizontal,{})}),(0,t.jsxs)(g.Menu,{className:"min-w-[180px]",portalClassName:"tailwind-preflight",children:[n?(0,t.jsx)(ea.MenuLink,{href:`/${r?.teamSlug}/${r?.project}/firewall/configure/rule/${i}`,target:"_blank",children:(0,t.jsx)("span",{children:"Edit Rule"})}):null,(0,t.jsx)(et.MenuItem,{onClick:e=>{e.stopPropagation();let[t]=o.name.split("$$");navigator.clipboard.writeText(t)},children:(0,t.jsx)("span",{children:"Copy Value"})}),"deployment_defined_rules"===i?(0,t.jsx)(et.MenuItem,{onClick:e=>{e.stopPropagation(),m()},children:(0,t.jsx)("span",{children:"What is this?"})}):null,(0,L.isOthersAggregate)(o.name)?null:(0,t.jsx)(ea.MenuLink,{href:l(i),target:"_blank",children:(0,t.jsx)("span",{className:"whitespace-nowrap",children:"Inspect Traffic"})}),N?(0,t.jsx)(ea.MenuLink,{href:v,target:"_blank",children:(0,t.jsx)("span",{className:"whitespace-nowrap",children:"Create Custom Rule"})}):null]})]})]})}function tM(e){let{children:a,config:l,disabled:s,rulesets:i,toolbarState:n}=e,{context:r,icon:o,label:c,suffix:d}=tL(l,i,n)(a);return(0,t.jsxs)("div",{className:"flex flex-1 flex-row items-center gap-2",children:[(0,t.jsx)(F.ContextCard.Trigger,{content:r??null,noPadding:!0,children:(0,t.jsxs)(I.Text,{className:"flex items-center gap-2",color:s?"gray-600":"gray-1000",variant:"label-14",weight:500,children:[c,d?(0,t.jsx)(I.Text,{as:"span",color:s?"gray-600":"gray-900",children:d}):null,o?(0,t.jsx)("span",{className:`flex items-center ${s?"text-gray-600":"text-gray-900"}`,children:o}):null]})}),s?(0,t.jsx)(x.Badge,{variant:"gray-subtle",children:"Disabled"}):null]})}function tL(e,a,l){return s=>{var i,n;if((0,L.isOthersAggregate)(s))return{label:"Other"};let[r,o,...c]=s.split(tS.SEPARATOR);if("clientIp"===l.groupBy){let e=c[2]?.toUpperCase(),a=E.countriesByAlpha2[e],l=Array.isArray(a)?a[0]:a||e,s=E.flagsByAlpha2[e];return{label:r,suffix:(0,L.formatFirewallActionForDisplay)(o),context:(0,t.jsxs)("div",{className:"flex w-[250px] flex-col",children:[(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)(I.Text,{className:"mb-3",variant:"heading-14",weight:500,children:["Details for ",r]}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("div",{className:"flex flex-1 flex-row items-baseline justify-between gap-6",children:[(0,t.jsx)(I.Text,{className:"shrink-0",variant:"label-13",children:"AS Name"}),(0,t.jsx)(I.Text,{align:"right",color:"gray-800",variant:"label-13",children:c[1]||"N/A"})]}),(0,t.jsxs)("div",{className:"flex flex-1 flex-row items-baseline justify-between gap-6",children:[(0,t.jsx)(I.Text,{variant:"label-13",children:"AS Number"}),(0,t.jsx)(I.Text,{color:"gray-800",variant:"label-13",children:c[0]||"N/A"})]})]})]}),l?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(O.Divider,{}),(0,t.jsx)("div",{className:"p-4",children:(0,t.jsx)(I.Text,{variant:"label-13",children:[s,l].filter(Boolean).join(" ")})})]}):null]})}}if("clientIpCountry"===l.groupBy){let e=E.countriesByAlpha2[r.toUpperCase()];return{label:Array.isArray(e)?e[0]:e||s,suffix:(0,L.formatFirewallActionForDisplay)(o)}}if("clientUserAgent"===l.groupBy&&(0,eT.isBotProtectionData)(l.filter)&&(i=r,t$.some(e=>!(!e.must_contain.every(e=>i.includes(e))||e.must_not_contain&&e.must_not_contain.some(e=>i.includes(e)))&&!0)))return{label:r,suffix:(0,L.formatFirewallActionForDisplay)(o),icon:(0,t.jsx)(tw.Information,{size:14,className:"flex-none"}),context:(0,t.jsx)("div",{className:"flex w-[250px] flex-col",children:(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)(I.Text,{className:"mb-3 flex items-center gap-1",variant:"heading-14",weight:500,children:[(0,t.jsx)(tv.Robot,{className:"flex-none"})," Spoofed or malicious traffic"]}),(0,t.jsxs)(I.Text,{variant:"label-13",children:["These requests claimed to be from a legitimate bot but were flagged because they failed our"," ",(0,t.jsx)(to.Link,{external:!0,href:"/docs/bot-management#verified-bots",isDifferentZone:!0,variant:"highlight",children:"verification"})]})]})})};if("clientUserAgent"===l.groupBy&&(0,eT.isBotProtectionData)(l.filter)&&(n=r).startsWith("Mozilla/")&&!n.includes("Headless")&&!n.includes("bot")&&!n.includes("Bot"))return{label:r,suffix:(0,L.formatFirewallActionForDisplay)(o),icon:(0,t.jsx)(tw.Information,{size:14,className:"flex-none"}),context:(0,t.jsx)("div",{className:"flex w-[250px] flex-col",children:(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)(I.Text,{className:"mb-3 flex items-center gap-1",variant:"heading-14",weight:500,children:[(0,t.jsx)(ty,{className:"flex-none"})," Likely non-browser traffic"]}),(0,t.jsxs)(I.Text,{variant:"label-13",children:["These requests use browser User-Agents but their HTTP and TLS"," ",(0,t.jsx)(to.Link,{external:!0,href:"/docs/bot-management#bot-protection-managed-ruleset",isDifferentZone:!0,variant:"highlight",children:"fingerprints"})," ","do not match actual browser behavior"]})]})})};if("clientUserAgent"===l.groupBy)return{label:r,suffix:(0,L.formatFirewallActionForDisplay)(o),context:(0,t.jsx)(tN.UserAgentDetailCard,{value:r,hideUnknowns:!0})};if("edgeNetworkRegion"===l.groupBy){let e=tC.regions[r];return e?{label:e.name,suffix:e.providerRegion}:{label:s,suffix:(0,L.formatFirewallActionForDisplay)(o)}}if("wafRuleId"===l.groupBy||"all_rules"===l.filter){if(r.startsWith("managed_")){let[e,t]=r.split("managed_"),l=(0,eT.getRulesetFromRulesets)(a,t);if(l)return{label:l.name,suffix:(0,L.formatFirewallActionForDisplay)(o)}}let t=[];e&&(t.push(...e.rules),t.push(...e.crsRules),t.push(...e.currentConfig.ips.map(e=>({id:e.id,name:`IP Block ${"*"===e.hostname?"":e.hostname} ${e.ip}`}))));let l=t.find(e=>e.id===r);if(l)return{label:l.name,suffix:(0,L.formatFirewallActionForDisplay)(o)};let s=K.ruleToMappings[r];if(s)return{label:s.label,suffix:(0,L.formatFirewallActionForDisplay)(o)};if("deployment_rules"===r)return{label:"Deployment Rules",suffix:(0,L.formatFirewallActionForDisplay)(o)};if("deployment_defined_rules"===r)return{label:"Deployment Defined Rules",suffix:(0,L.formatFirewallActionForDisplay)(o)}}return"BotID"===l.filter?{label:r}:{label:r,suffix:(0,L.formatFirewallActionForDisplay)(o)}}}function tB(e,t){let a=0;return Object.entries(e).map(e=>{let[l,s]=e,i=s;return void 0!==t?.[l]&&(i=t[l]),a+=i,{name:l,value:i,total:s,ratio:0}}).sort((e,t)=>(0,L.isOthersAggregate)(e.name)?1:(0,L.isOthersAggregate)(t.name)?-1:t.total-e.total).map(e=>({name:e.name,value:e.value,ratio:e.value/Math.max(a,1)*100,total:e.total}))}function tD(e,t,a){if(null===e)return t;let l=e||0;return Math.max(0,l+(t-l)*a)}let t$=[{must_contain:["Googlebot"]},{must_contain:["bingbot/2.0"]},{must_contain:["DuckDuckBot"]},{must_contain:["DuckAssistBot"]},{must_contain:["YandexBot"]},{must_contain:["Applebot"]},{must_contain:["AhrefsBot"]},{must_contain:["AhrefsSiteAudit"]},{must_contain:["SemrushBot"]},{must_contain:["SiteAuditBot"]},{must_contain:["SplitSignalBot"]},{must_contain:["BacklinksExtendedBot"]},{must_contain:["ImagesiftBot"]},{must_contain:["GPTBot"]},{must_contain:["Claude-Web"]},{must_contain:["Claude-Search"]},{must_contain:["PerplexityBot"]},{must_contain:["OAI-SearchBot"]},{must_contain:["AlgoliaBot"]},{must_contain:["AdsBot-Google"]},{must_contain:["Mediapartners-Google"]},{must_contain:["APIs-Google"]},{must_contain:["Google-Safety"]},{must_contain:["Google-Site-Verification"]},{must_contain:["Google-InspectionTool"]},{must_contain:["Google-Read-Aloud"]},{must_contain:["Google-PageRenderer"]},{must_contain:["Google-PublisherCenter"]},{must_contain:["Google-Storebot"]},{must_contain:["Google-CloudVertexBot"]},{must_contain:["facebookexternalhit"],must_not_contain:["facebookexternalhit/1.1 Facebot Twitterbot/1.0"]},{must_contain:["facebookcatalog"]},{must_contain:["Twitterbot"],must_not_contain:["facebookexternalhit/1.1 Facebot Twitterbot/1.0"]},{must_contain:["LinkedInBot"]},{must_contain:["http://www.pinterest.com/bot.html"]},{must_contain:["meta-externalfetcher"]},{must_contain:["meta-externalagent"]},{must_contain:["UptimeRobot"]},{must_contain:["Pingdom"]},{must_contain:["Site24x7"]},{must_contain:["Better Uptime Bot"]},{must_contain:["Datadog/Synthetics"]},{must_contain:["SentryUptimeBot"]},{must_contain:["HetrixTools Uptime Monitoring Bot"]},{must_contain:["StatusCake"]},{must_contain:["Checkly"]},{must_contain:["Hydrozen.io"]},{must_contain:["ChatGPT-User"]},{must_contain:["Perplexity-User"]},{must_contain:["Stripe/"]},{must_contain:["PayPal"]},{must_contain:["GitHub-Hookshot"]},{must_contain:["GitHub-Camo"]},{must_contain:["Amazon-Route53-Health-Check"]},{must_contain:["amazonbot"]},{must_contain:["Amazon-Q"]},{must_contain:["Amazon-Kendra"]},{must_contain:["Cookiebot"]},{must_contain:["lumar.io"]},{must_contain:["deepcrawl.com"]},{must_contain:["inngest.com"]},{must_contain:["hookdeck.com"]},{must_contain:["qstash.com"]},{must_contain:["svix.com"]},{must_contain:["v0.dev"]},{must_contain:["Vercel Screenshot"]},{must_contain:["Vercel Favicon"]},{must_contain:["artemis web reader"]}];var tP=e.i(8114130),tF=e.i(6482765),tO=e.i(2801134),tE=e.i(4138437);function tq(){return(0,t.jsxs)("div",{className:"grid w-full grid-cols-1 gap-3 lg:grid-cols-2",children:[(0,t.jsx)(tz,{}),(0,t.jsx)(tz,{})]})}function tz(){return(0,t.jsxs)(tE.Card,{border:!0,className:"relative overflow-hidden",children:[(0,t.jsx)("div",{className:"border-b px-5 py-3",children:(0,t.jsx)(W.Skeleton,{height:20,width:100})}),(0,t.jsxs)("div",{className:"p-2",children:[(0,t.jsx)(tH,{}),(0,t.jsx)(tH,{}),(0,t.jsx)(tH,{}),(0,t.jsx)(tH,{}),(0,t.jsx)(tH,{})]})]})}function tH(){return(0,t.jsxs)("div",{className:"flex h-[36px] flex-1 items-center gap-5 p-2",children:[(0,t.jsxs)("div",{className:"flex flex-1 items-center gap-2",children:[(0,t.jsx)(W.Skeleton,{height:8,pill:!0,width:8}),(0,t.jsx)(W.Skeleton,{height:16,width:144})]}),(0,t.jsx)(W.Skeleton,{height:16,width:32})]})}function tU(e){let{width:a}=e;return(0,t.jsx)(W.Skeleton,{className:"hidden @lg-page:block",height:24,width:a??255})}var tV=e.i(6850581),tW=e.i(762945),tG=e.i(8761240),tQ=e.i(4045381),tZ=e.i(7742669),tK=e.i(8778858),tJ=e.i(3494530),tX=e.i(5760285);e.i(6483798);var tY=e.i(8287059);function t0(e){let{teamIdOrSlug:a,projectIdOrName:l,plan:s}=e,{data:i,error:n,isLoading:r}=(0,tJ.useO11yAlerts)(),{data:o,error:c,isLoading:d}=(0,tK.useAttackHistory)({teamId:a,projectId:l,since:"enterprise"===s?7:1}),u=!s||r||d,m=(0,T.useMemo)(()=>{let e=Date.now()-864e5*("enterprise"===s?7:1);return(o?.anomalies||[]).map(e=>{let t=Object.keys(e.affectedHostMap).reduce((t,a)=>{t.hosts.push(a);let l=e.affectedHostMap[a].ddosAlerts?.["sys_dos_mitigation:challenge"]?.totalReqs||0,s=e.affectedHostMap[a].ddosAlerts?.["sys_dos_mitigation:deny"]?.totalReqs||0;return t.challenged+=l,t.denied+=s,t.count+=l+s,t},{hosts:[],challenged:0,denied:0,count:0});return{id:`${e.ownerId}-${e.projectId}-${e.startTime}`,title:"DDoS Attack",type:"firewall_anomaly",startedAt:e.startTime,resolvedAt:e.endTime||void 0,detectionKey:`firewall_anomaly-${e.ownerId}-${e.projectId}-${e.startTime}`,data:t}}).concat((i?.alerts||[]).filter(t=>["botId_anomaly"].includes(t.type)&&(!t.resolvedAt||t.resolvedAt>e))).toSorted((e,t)=>!e.resolvedAt&&t.resolvedAt?-1:e.resolvedAt&&!t.resolvedAt?1:t.startedAt-e.startedAt)},[i,o,s]),x=(0,T.useCallback)(()=>(0,t.jsx)(t4,{plan:s}),[s]);return(0,t.jsx)(er,{items:m||[],itemKey:e=>e.detectionKey,isLoading:u,error:n||c,Header:"Alerts",Row:t1,RowSkeleton:t2,EmptyState:x})}function t1(e){let{id:a,title:l,startedAt:s,resolvedAt:i,data:n}=e,r=(0,k.useRouter)(),o=(0,k.useParams)(),c=o?.teamSlug,d=o?.project,{formatter:u}=X(),m=function(e){if("type"in e&&"firewall_anomaly"!==e.type&&"path"in e.data){let t=e.data.path;return"string"==typeof t?t:void 0}}(e);return(0,t.jsxs)("div",{onClick:()=>{let e=new URL(window.location.href);e.searchParams.set("alert",a),r.push(`/${c}/${d}/firewall?${e.searchParams.toString()}`)},className:(0,eo.cn)("cursor-pointer p-4 py-3 hover:!bg-gray-100","flex flex-row items-center justify-between p-2 group"),children:[(0,t.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[l,m?(0,t.jsx)("span",{className:"text-label-12 text-slate-500 bg-gray-100 px-1.5 py-0.5 rounded",children:m}):null,(0,t.jsx)(tV.RelativeTimeCard,{date:i||s,side:"bottom",children:(0,t.jsx)("span",{className:"text-label-14 text-gray-700 text-nowrap",children:i?`${(0,tX.formatRelativeTime)(i)} ago`:`Since ${(0,tX.formatRelativeTime)(s)}`})}),(0,t.jsx)(x.Badge,{className:"pl-1 pr-2",icon:i?(0,t.jsx)(tG.CheckCircleFill,{color:"gray-800"}):(0,t.jsx)(tW.Warning,{}),variant:i?"gray-subtle":"amber-subtle",children:i?"Resolved":"Active"})]}),(0,t.jsx)("div",{children:(0,t.jsxs)("span",{className:"flex flex-row items-center gap-1 font-medium",children:[" ",i?null:(0,t.jsx)(tQ.ArrowUpRight,{color:"red-800",size:12})," ",u(n.count)]})})]})}function t2(){return(0,t.jsxs)("div",{className:"flex flex-row items-center justify-between p-2",children:[(0,t.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,t.jsx)(W.Skeleton,{height:12,width:16,className:"rounded-xs"}),(0,t.jsx)(W.Skeleton,{width:120})]}),(0,t.jsx)(W.Skeleton,{width:120,className:"ms-auto me-2"}),(0,t.jsx)(w.MoreHorizontal,{color:"gray-600"})]})}function t4(e){let{plan:a}=e,l=(0,tY.useOpenUpgradeModal)();return"hobby"===a?(0,t.jsx)("div",{className:"flex flex-row items-center justify-center p-2 h-[200px] w-full",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,t.jsx)("p",{className:"text-label-14 text-gray-700",children:"There are no active alerts"}),(0,t.jsx)(h.Button,{size:"small",onClick:()=>{l({source:"firewall-alerts-panel"})},children:"Upgrade to Pro"}),(0,t.jsx)("p",{className:"text-label-12 text-gray-600",children:"to see previous alerts"})]})}):(0,t.jsx)("div",{className:"flex flex-row items-center justify-center p-2 h-[200px] w-full",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,t.jsx)("div",{className:"rounded-md border border-gray-200 p-2",children:(0,t.jsx)(tZ.FirewallGlobe,{color:"gray-800"})}),(0,t.jsx)("p",{className:"text-label-14 text-gray-700",children:"There are no recent alerts"})]})})}var t8=e.i(7849701);let t6=JSON.stringify({name:"",description:"",active:!0,conditionGroup:[{conditions:[{type:"path",op:"eq",value:""}]}],action:{mitigate:{action:"rate_limit",rateLimit:{action:"rate_limit",algo:"fixed_window",window:"60",limit:"100",keys:["ip"]}}}});function t5(e){let{botManagementButton:l,firewallAddNewButton:s,firewallMenuButton:d}=e,{team:u}=(0,r.useTeam)(),x=(0,k.useParams)(),h=x?.teamSlug??"",g=x?.project??"",f=(0,a.useServerFlag)("firewall-overview-refresh",!1),{data:p,isLoading:j}=(0,te.useProject)(x?.project),[b,y,v]=(0,Z.useToolbarState)({hideIpAddresses:!!u?.hideIpAddresses,firewallOverviewRefresh:f}),{can:w,isLoading:N}=(0,i.default)(),C=w(n.Action.Read,n.Resource.SeawallConfig)||w(n.Action.List,n.Resource.SeawallConfig),S=(0,T.useRef)(null),{activeConfig:A,isLoadingConfig:R}=(0,eS.useFirewallConfig)({projectId:g}),{data:_,isLoading:I}=(0,ek.useManagedRulesets)({projectIdOrName:g,teamIdOrSlug:h}),M=(0,eu.useQuerySelect)(b),{isLoading:D,error:$,currentData:P}=(0,q.useSonarLiveQuery)(C?M:void 0,"live"===b.range&&C),[F,O]=(0,T.useMemo)(()=>{let e=[...t9,...t3];if(A&&_){for(let[t,a]of Object.entries(A.currentConfig.managedRules??{})){let l=(0,eT.getRulesetFromRulesets)(_,t);if("owasp"===t){let t=(0,K.owaspToCrsConfig)(A.crsRules);e.push(...t.map(e=>({...e,active:a?.active??!1})))}else l&&e.push({label:l.name||t,value:`managed_${t}`,action:a?.action||l.defaultAction||l.actions?.[0]||"log",active:a?.active||l.active||!1})}for(let t of A.rules)e.push({label:t.name,value:t.id,action:t.action,active:t.active})}return[e,e.filter(e=>e.active)]},[A,_]),E=(0,T.useMemo)(()=>N&&!P?.data?null:C?P?.data?(0,L.getSonarSeriesData)(P.data,M.groupBy,F,b):null:new Map,[M.groupBy,F,C,N,P?.data,b]),{totalRequests:z}=function(e,t){let{can:a}=(0,i.default)(),{currentData:l}=(0,q.useSonarLiveQuery)({...e,filter:void 0,groupBy:void 0,summaryOnly:!0},"live"===t.range&&(a(n.Action.Read,n.Resource.SeawallConfig)||a(n.Action.List,n.Resource.SeawallConfig)));return{totalRequests:(0,T.useMemo)(()=>l?.summary[0]?.value??0,[l])}}(M,b),H=I||R||j,U=H||D,V="all_rules"===b.filter&&"all"===b.action&&"group_by_action"===b.groupBy;return(0,t.jsx)(c.ConditionalNavigationMarker,{enabled:!H,phase:"content",label:"FirewallOverview",children:(0,t.jsx)(tt.ReviewChangeProvider,{projectIdOrName:g,teamIdOrSlug:h,children:(0,t.jsxs)("div",{"data-testid":(0,o.tid)("firewall","overview","layout"),className:"tailwind-preflight",ref:S,children:[(0,t.jsx)(t7,{botManagementButton:l,firewallAddNewButton:s,firewallMenuButton:d,params:{teamSlug:h,project:g}}),(0,t.jsxs)("div",{className:"container flex flex-col gap-3 py-8",children:[(0,t.jsx)("div",{className:"flex flex-1 flex-row items-center justify-between gap-2",children:H?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"mr-auto"}),(0,t.jsx)("div",{className:"flex flex-1 flex-row justify-end",children:(0,t.jsx)("div",{className:"w-full @lg-page:w-auto",children:(0,t.jsx)(th,{})})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(tb.FirewallStatusBadge,{className:"hidden @lg-page:flex"}),(0,t.jsx)("div",{className:"flex flex-1 flex-row justify-end",children:(0,t.jsx)("div",{className:"w-full @lg-page:w-auto",children:(0,t.jsx)(T.Suspense,{fallback:(0,t.jsx)(th,{}),children:(0,t.jsx)(tu,{isCustomRuleSelected:A?.rules.some(e=>e.id===b.filter),options:v,positionTop:(0,L.getOffsetTop)(S.current),rules:O,setToolbarState:y,team:u??void 0,toolbarState:b,managedRulesets:_})})})})]})}),(0,t.jsx)(e$.SonarContextProvider,{children:(0,t.jsxs)(Y,{formatter:L.formatShortPrecision,series:E??new Map,children:[(0,t.jsxs)("div",{className:"flex flex-col gap-3 @lg-page:flex-row",children:[!x||H?(0,t.jsx)(tU,{width:300}):(0,t.jsx)("div",{className:"w-full @lg-page:h-[388px] @lg-page:w-[300px]",children:(0,t.jsx)(e8,{projectId:x.project,teamId:x.teamSlug})}),(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col rounded-md border border-gray-alpha-400 bg-background-100",children:["BotID"===b.filter?(0,t.jsx)(B,{totalRequests:z}):(0,t.jsx)(eL,{onActionClick:e=>y({type:"action",value:e}),query:M,state:b}),(0,t.jsx)("div",{"data-testid":(0,o.tid)("firewall","graph","container"),className:"flex-1 px-4 pb-4 pt-8",children:(0,t.jsx)(m.default,{children:e=>{let{width:a}=e;return(0,t.jsx)(tf,{data:E,error:$,height:240,isLoading:U,query:M,width:a,onZoomIn:e=>{y({type:"range",value:e})}})}})})]})]}),V&&f?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"grid lg:grid-cols-3 gap-3",children:[(0,t.jsx)(ew,{teamIdOrSlug:h,projectIdOrName:g}),(0,t.jsx)(eN,{teamIdOrSlug:h,projectIdOrName:g}),(0,t.jsx)(eC,{teamIdOrSlug:h,projectIdOrName:g})]}),(0,t.jsxs)("div",{className:"grid lg:grid-cols-3 gap-3",children:[(0,t.jsx)(t0,{teamIdOrSlug:h,projectIdOrName:g,plan:u?.billing?.plan}),(0,t.jsx)(eA,{teamIdOrSlug:h,projectIdOrName:g}),(0,t.jsx)(eb,{teamIdOrSlug:h,projectIdOrName:g})]}),(0,t.jsx)(t8.FirewallEventsTable,{})]}):(0,t.jsx)(T.Suspense,{fallback:(0,t.jsx)(tq,{}),children:U?(0,t.jsx)(tq,{}):(0,t.jsx)(tA,{config:A,project:p,rulesets:_??{}})})]})})]})]})})})}let t3=K.defaultShowSystemRules.map(e=>Object.assign({},e,{active:!0})),t9=[{label:"Overview",value:"all_rules",action:"allow",active:!0},{label:"BotID",value:"BotID",action:"allow",active:!0}];function t7(e){let{params:a,botManagementButton:l,firewallAddNewButton:r,firewallMenuButton:o}=e,c=(0,k.useRouter)(),{team:m,user:x}=(0,s.useAccount)(),{showMitigationsBypassModal:h,setShowMitigationsBypassModal:g}=(0,_.useMitigationsBypassModal)(),{showConfirmAttackModeModal:f,setShowConfirmAttackModeModal:p}=(0,R.useConfirmAttackModeModal)(),{can:b,isLoading:y}=(0,i.default)(),{data:v,isLoading:w,mutate:N}=(0,te.useProject)(a.project),{updateMitigationsBypassAll:C,isLoading:S,bypassRules:I}=(0,e7.useFirewallBypass)({projectId:v?.id}),{trigger:M}=(0,e9.useUpdateAttackMode)(),{config:L}=(0,eS.useFirewallConfig)({projectId:a.project});(0,T.useEffect)(()=>{v?.id&&m?.id&&x?.uid&&u.analytics.track(d.AnalyticsEvent.FIREWALL_TAB_VISITED,{projectId:v.id,teamId:m.id,userId:x.uid})},[v?.id,m?.id,x?.uid]);let B=(0,T.useMemo)(()=>{if(m&&m.billing&&m.billing.plan)return m?.billing?.plan==="pro"?"pro":m?.billing?.plan==="enterprise"?"enterprise":"hobby"},[m]),D=(0,i.useCanAct)(n.Resource.SeawallConfig,[n.Action.Read,n.Action.List]),$=(0,i.useCanAct)(n.Resource.SeawallConfig,[n.Action.All]),{enabled:P}=(0,tP.globalBypassStatus)(v),F=(0,T.useCallback)(e=>"string"==typeof e&&e.includes(`projects/${v?.name}`)&&e.includes(`teamId=${m?.slug}`),[v?.name,m?.slug]),O=v?.security?.attackModeEnabled&&(!v?.security?.attackModeActiveUntil||v.security.attackModeActiveUntil>Date.now());return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e6.DashboardHeading,{buttons:(0,t.jsxs)(j.Stack,{className:"hidden md:flex md:flex-wrap",direction:{sm:"column",md:"row",lg:"row"},gap:3,children:[(0,t.jsx)(tO.ReviewChangesButton,{currentConfig:L}),(0,t.jsx)(T.Suspense,{fallback:(0,t.jsx)(eD,{}),children:l}),r,o]}),title:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,t.jsx)("h1",{className:"text-heading-32 font-medium",children:"Firewall"}),(0,t.jsx)(e3.MicrofrontendsHelpBadge,{childHelp:"Firewall rules for the default app also run for every request to this microfrontend.",parentHelp:"Firewall rules defined here will run for all microfrontends in this group."})]}),(0,t.jsx)("div",{className:"md:hidden",children:(0,t.jsx)(ae,{canViewConfig:D,canWriteConfig:$,currentConfig:L,isBypassEnabled:P,isAttackModeEnabled:O||!1,onClickBypass:()=>g(!0),onClickAttackMode:()=>p(!0),params:a,showBypassOption:(B??"hobby")!=="hobby"})})]})}),(0,t.jsx)(tF.MitigationsBypassModal,{confirmText:`${m?m.slug:x?.username}/${v?.name}`,isEnabled:P,isLoading:S||w,onClose:()=>g(!1),onSubmit:()=>{C(!P).then(async()=>{g(!1),await Promise.all([N(),(0,A.mutate)(F)]),c.refresh()}).catch(()=>{})},open:h}),(0,t.jsx)(e5.ConfirmationAttackMode,{isEnabled:O||!1,onClose:()=>{p(!1)},onSubmit:e=>{v&&!w&&M({projectId:v.id,attackModeEnabled:!O,attackModeActiveUntil:e?Date.now()+e:void 0}).then(async()=>{p(!1),await Promise.all([N(),(0,A.mutate)(F)]),c.refresh()}).catch(e=>{console.error("Failed to update attack mode:",e)})},open:f})]})}function ae(e){let{params:a,onClickBypass:s,onClickAttackMode:i,currentConfig:n,canViewConfig:r,canWriteConfig:c,isBypassEnabled:d,isAttackModeEnabled:u,showBypassOption:m}=e,h=(0,k.useRouter)(),j=d?C.Shield:S.ShieldOff,{setOpen:b}=(0,tt.useReviewChangeContext)(),A=(0,T.useRef)(null),R=(0,T.useMemo)(()=>d?"Resume":"Pause",[d]);return(0,t.jsx)("div",{className:"",ref:A,children:(0,t.jsxs)(p.MenuContainer,{closeOnSelect:!0,position:"bottom-end",children:[(0,t.jsx)(f.MenuButton,{"aria-label":"firewall-configure-menu","data-testid":(0,o.tid)("firewall","open-menu","mobile"),shape:"square",size:"small",svgOnly:!0,type:"secondary",children:(0,t.jsx)(w.MoreHorizontal,{})}),(0,t.jsx)(g.Menu,{className:"md:hidden",containerRef:A,mobileContainerClassName:"z-[5001]",portalClassName:"tailwind-preflight md:hidden",width:"14rem",children:(0,t.jsxs)("div",{className:"flex h-full flex-col gap-y-3 p-2",children:[n?.changes&&n.changes.length>0&&r?(0,t.jsx)(at,{onClick:()=>setTimeout(()=>b(!0),30),prefix:(0,t.jsx)(v.CloudUpload,{size:16}),suffix:(0,t.jsx)(x.Badge,{className:"min-w-[28px]",size:"sm",variant:"blue",children:n.changes.length}),type:"secondary",children:"Review Changes"}):null,(0,t.jsx)(at,{"data-testid":(0,o.tid)("firewall","configure","rule","mobile"),onClick:()=>{h.push(`/${a.teamSlug}/${a.project}/firewall/configure/rule/new`)},type:"secondary",prefix:(0,t.jsx)(N.Plus,{size:16}),children:"Add Rule"}),(0,t.jsx)(at,{onClick:()=>{let e=(0,l.getRuleTemplateSignature)(t6);h.push(`/${a.teamSlug}/${a.project}/firewall/configure/rule/new?template=${encodeURIComponent(t6)}&sig=${encodeURIComponent(e)}`)},type:"secondary",prefix:(0,t.jsx)(y.Clock,{size:16}),children:"Add Rate Limit"}),(0,t.jsx)(at,{onClick:()=>{h.push(`/${a.teamSlug}/${a.project}/firewall/configure`)},type:"secondary",children:"Configure Rules"}),(0,t.jsx)(at,{onClick:()=>{h.push(`/${a.teamSlug}/${a.project}/firewall/activity-log`)},type:"secondary",children:"View Audit Log"}),m?(0,t.jsxs)(at,{disabled:!c,onClick:s,prefix:(0,t.jsx)(j,{size:16}),children:[R," System Mitigations"]}):null,(0,t.jsxs)(at,{disabled:!c,onClick:i,type:"error",children:[u?"Disable":"Enable"," Attack Mode"]}),(0,t.jsx)(at,{disabled:!r,onClick:()=>{h.push(`/${a.teamSlug}/${a.project}/firewall/configure#bot-management`)},prefix:(0,t.jsx)(C.Shield,{size:16}),children:"Bot Management"})]})})]})})}function at(e){let{disabled:a,onClick:l,prefix:s,suffix:i,type:n,children:r,"data-testid":o}=e,{actions:c}=(0,b.useMenu)();return(0,t.jsx)(h.Button,{disabled:a,onClick:()=>{c.setOpen(!1),l()},prefix:s,suffix:i,type:n,width:"100%","data-testid":o,children:r})}e.s(["FirewallOverview",()=>t5],5597167)},6928648,e=>{"use strict";var t=e.i(6468255),a=e.i(9100551),l=e.i(6696646),s=e.i(6891161),i=e.i(5255926),n=e.i(6850581),r=e.i(3306538),o=e.i(8761240),c=e.i(762945),d=e.i(5182595),u=e.i(9179929),m=e.i(5481907),x=e.i(3804618),h=e.i(5760285),g=e.i(3793583),f=e.i(6143247),p=e.i(1283928),j=e.i(8690335),b=e.i(8778858),y=e.i(5338940),v=e.i(3494530),w=e.i(7181648),N=e.i(57106),C=e.i(7849701);let S=(e,t)=>({startTime:new Date(e-18e5),endTime:new Date(t+18e5)});function k(e){let{active:a,onClose:l,children:i,modalBodyRef:n}=e;return(0,t.jsx)(s.Modal.Modal,{active:a,disableFocusTrap:!0,onClickOutside:l,style:{width:"66%",alignSelf:"flex-end",marginRight:"1rem",maxHeight:"calc(100% - 2rem)",height:"100%"},children:(0,t.jsx)(s.Modal.Body,{children:(0,t.jsx)("div",{ref:n,children:i})})})}function T(e){var s;let r,{teamSlug:o,projectSlug:c}=e,d=(0,a.useRouter)(),u=(0,a.usePathname)(),g=(0,a.useSearchParams)(),[f,p]=(0,l.useState)(!0),j=(0,l.useRef)(null),T=g?.get("alert"),$=!!T,q=g?.get("eventIp"),z=g?.get("eventHost"),H=g?.get("eventAction")||void 0,U=g?.get("eventStart"),V=g?.get("eventEnd"),W=!!(q&&z&&U&&V),{team:G}=(0,y.useTeam)(),Q=G?.billing?.plan??"hobby",{data:Z,isLoading:K}=(0,b.useAttackHistory)({teamId:o,projectId:c,..."hobby"!==Q&&{since:"enterprise"===Q?7:1}}),{data:J}=(0,v.useO11yAlerts)(),X=T?.split("-")||[],Y=T?.includes("team_")&&X.length>=3,ee=(0,l.useMemo)(()=>{if(!Y||!T||!Z)return;let e=Number.parseInt(X.at(-1)||"0",10);return Z.anomalies.find(t=>t.startTime===e)},[Y,T,X,Z]),et=(0,l.useMemo)(()=>{if(!Y&&J&&T)return J.alerts.find(e=>e.id===T)},[Y,T,J]),{chartData:ea,isLoading:el}=function(e){let t=(0,l.useMemo)(()=>{if(!e)return;let t={...e.sonarQuery},a=(0,h.getChartInterval)(e);return t.startTime=a.chartStartTime,t.endTime=a.chartEndTime,t},[e]),{data:a,isLoading:s}=(0,m.useSonarQuery)(t,{noEnvironmentFilter:!0});return{chartData:a,isLoading:s}}(et),{chartData:es,isLoading:ei}=function(e){let t=(0,l.useMemo)(()=>{if(!e)return;let{startTime:t,endTime:a}=S(e.startTime,e.endTime||e.startTime);return{event:"firewallAction",reason:"firewall_tab",rollups:{count:{measure:"count",aggregation:"sum"}},filter:"wafAction in ('challenge', 'deny') and wafRuleId eq 'sys_dos_mitigation'",groupBy:["wafAction"],startTime:t,endTime:a,granularity:{minutes:1},limitRanking:"top_by_summary",orderBy:"count",limit:2,tailRollup:"truncate",summaryOnly:!1}},[e]),{data:a,isLoading:s}=(0,m.useSonarQuery)(t,{noEnvironmentFilter:!0});return{chartData:(0,l.useMemo)(()=>a&&t?{...a,query:t}:a,[a,t]),isLoading:s}}(ee||void 0),{chartData:en,isLoading:er}=function(e){let{eventIp:t,eventHost:a,eventAction:s,eventStart:i,eventEnd:n}=e,r=(0,l.useMemo)(()=>{let e=e=>e.endsWith("Z")?e:`${e}Z`,l=new Date(new Date(e(i)).getTime()-9e5),s=new Date(new Date(e(n)).getTime()+9e5);return{event:"firewallAction",reason:"firewall_tab",rollups:{count:{measure:"count",aggregation:"sum"}},filter:`(clientIp eq '${t}') and (requestHostname eq '${a}') and (wafRuleId eq 'sys_dos_mitigation')`,groupBy:["wafAction"],limit:4,limitRanking:"top_by_summary",tailRollup:"truncate",startTime:l,endTime:s,granularity:{minutes:1},summaryOnly:!1}},[t,a,s,i,n]),{data:o,isLoading:c}=(0,m.useSonarQuery)(r,{noEnvironmentFilter:!0});return{chartData:(0,l.useMemo)(()=>o&&r?{...o,query:r}:o,[o,r]),isLoading:c}}(W&&q&&z&&U&&V?{eventIp:q,eventHost:z,eventAction:H,eventStart:U,eventEnd:V}:{eventIp:"",eventHost:"",eventStart:"",eventEnd:""});(0,l.useEffect)(()=>{u&&requestAnimationFrame(()=>{if(g?.has("alert")||g?.has("eventIp"))return p(!0);p(!1)})},[u,g]),s=j.current,r=(0,l.useRef)(0),(0,l.useEffect)(()=>{function e(e){var t;if(null===s||!/tab/i.test(e.key))return;e.preventDefault();let{activeElement:a}=document,l=Array.from(s.querySelectorAll(E)).filter(e=>"focus"in e&&"function"==typeof e.focus);if(0===l.length)return;let i=l[0],n=!e.shiftKey;if(!a||!(null!==(t=a)&&"nodeType"in t&&t.nodeType===Node.ELEMENT_NODE)||!s.contains(a))return void i.focus();let o=(r.current+(n?1:-1)+l.length)%l.length;l[o].focus(),r.current=o}return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[s]);let eo=()=>{if(!u)return;let e=new URLSearchParams(g?.toString());e.delete("alert"),e.delete("eventIp"),e.delete("eventHost"),e.delete("eventAction"),e.delete("eventStart"),e.delete("eventEnd");let t=e.toString()?`${u}?${e}`:u;d.push(t)},ec=(0,l.useMemo)(()=>{if(!Y||!ee)return null;let{startTime:e,endTime:t}=S(ee.startTime,ee.endTime||ee.startTime);return(0,w.computeQueryBuilderLink)({type:"project-with-slug",teamSlug:o,projectNames:[c]},{event:"firewallAction",rollups:{count:{measure:"count",aggregation:"sum"}},filter:"wafAction in ('challenge', 'deny') and wafRuleId eq 'sys_dos_mitigation'",groupBy:["wafAction"],startTime:e,endTime:t})},[Y,ee,o,c]),ed=(0,l.useMemo)(()=>et?(0,w.computeQueryBuilderLink)({type:"project-with-slug",teamSlug:o,projectNames:[c]},{...et.sonarQuery,startTime:new Date(et.sonarQuery.startTime),endTime:new Date(et.sonarQuery.endTime)}):null,[et,o,c]),eu=(0,l.useMemo)(()=>{if(!W||!q||!z||!U||!V)return null;let e=e=>e.endsWith("Z")?e:`${e}Z`,t=new Date(new Date(e(U)).getTime()-9e5),a=new Date(new Date(e(V)).getTime()+9e5);return(0,w.computeQueryBuilderLink)({type:"project-with-slug",teamSlug:o,projectNames:[c]},{event:"firewallAction",rollups:{count:{measure:"count",aggregation:"sum"}},filter:`(clientIp eq '${q}') and (requestHostname eq '${z}')`,groupBy:["wafAction"],startTime:t,endTime:a})},[W,q,z,U,V,o,c]);return $&&Y?K||!Z?(0,t.jsx)(k,{active:f,onClose:eo,modalBodyRef:j,children:(0,t.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsx)("h2",{className:"text-heading-20 font-medium",children:"DDoS Attack"})}),(0,t.jsx)(i.Skeleton,{width:160,height:20})]}),(0,t.jsx)(A,{}),(0,t.jsx)(I,{}),(0,t.jsx)(L,{})]})}):Z&&ee?(0,t.jsx)(k,{active:f,onClose:eo,modalBodyRef:j,children:(0,t.jsxs)("div",{className:"flex flex-col gap-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-heading-24 font-semibold",children:"DDoS Attack"}),ec&&(0,t.jsx)(N.ButtonLink,{variant:"invert",size:"medium",href:ec,children:"Use in Query"})]}),(0,t.jsx)(n.RelativeTimeCard,{date:ee.startTime,side:"bottom",children:(0,t.jsx)("span",{className:"text-label-14 text-gray-700 text-nowrap",children:new Date(ee.startTime).toLocaleString()})})]}),ei||!es?(0,t.jsx)(A,{}):(0,t.jsx)(R,{data:es}),ei?(0,t.jsx)(I,{}):(0,t.jsx)(M,{anomaly:ee,data:es,isLoading:ei}),(0,t.jsx)(B,{anomaly:ee}),(0,t.jsx)(C.FirewallEventsTable,{startTime:new Date(ee.startTime-18e5),endTime:new Date(ee.endTime?ee.endTime===ee.startTime?ee.startTime+18e5:ee.endTime+18e5:Date.now()+18e5),disableRowClick:!0,hosts:Object.keys(ee.affectedHostMap)})]})}):(0,t.jsx)(k,{active:f,onClose:eo,modalBodyRef:j,children:(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsx)("h2",{className:"text-heading-20 font-medium",children:"DDoS Attack"})}),(0,t.jsx)("div",{className:"h-40 flex items-center justify-center text-gray-700",children:"Alert not found"})]})}):$&&et?(0,t.jsx)(k,{active:f,onClose:eo,modalBodyRef:j,children:(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-heading-20 font-medium",children:(0,x.getAlertTitle)(et)}),ed&&(0,t.jsx)(N.ButtonLink,{variant:"invert",size:"medium",href:ed,children:"Use in Query"})]}),(0,t.jsx)(_,{alert:et}),(0,t.jsx)(P,{alert:et,data:ea,isLoading:el}),(0,t.jsx)(D,{alert:et})]})}):W&&q&&z&&U&&V?(0,t.jsx)(k,{active:f,onClose:eo,modalBodyRef:j,children:(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-heading-20 font-medium",children:"Firewall Event Details"}),eu&&(0,t.jsx)(N.ButtonLink,{variant:"invert",size:"medium",href:eu,children:"Use in Query"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1 p-4 border border-gray-200 rounded-lg",children:[(0,t.jsx)("span",{className:"text-gray-700 text-xs font-medium uppercase",children:"IP Address"}),(0,t.jsx)("span",{className:"text-label-14 font-mono",children:q})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1 p-4 border border-gray-200 rounded-lg",children:[(0,t.jsx)("span",{className:"text-gray-700 text-xs font-medium uppercase",children:"Hostname"}),(0,t.jsx)("span",{className:"text-label-14 font-mono",children:z})]}),H&&(0,t.jsxs)("div",{className:"flex flex-col gap-1 p-4 border border-gray-200 rounded-lg",children:[(0,t.jsx)("span",{className:"text-gray-700 text-xs font-medium uppercase",children:"Action"}),(0,t.jsx)("span",{className:"text-label-14",children:H})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1 p-4 border border-gray-200 rounded-lg",children:[(0,t.jsx)("span",{className:"text-gray-700 text-xs font-medium uppercase",children:"Event Start"}),(0,t.jsx)(n.RelativeTimeCard,{date:new Date(U.endsWith("Z")?U:`${U}Z`).getTime(),side:"bottom",children:(0,t.jsx)("span",{className:"text-label-14",children:new Date(U.endsWith("Z")?U:`${U}Z`).toLocaleString()})})]})]}),er?(0,t.jsx)(F,{}):(0,t.jsx)(O,{data:en,isLoading:er})]})}):null}function A(){return(0,t.jsx)("div",{className:"grid gap-4",children:(0,t.jsxs)("div",{className:"flex flex-col gap-1 p-4 border border-gray-200 rounded-lg",children:[(0,t.jsx)(i.Skeleton,{width:220,height:12}),(0,t.jsx)(i.Skeleton,{width:420,height:32})]})})}function R(e){let{data:a}=e,s=(0,l.useMemo)(()=>{let e=0,t=0;return a.summary&&a.summary.length>0&&a.summary.forEach(a=>{let l=a.wafAction,s=a.count||0;"challenge"===l?e=s:"deny"===l&&(t=s)}),{challenged:e,denied:t,total:e+t}},[a]);return(0,t.jsxs)("div",{className:"grid sm:grid-cols-1 lg:grid-cols-3 gap-4 justify-items-start mb-2",children:[0!==s.challenged&&0!==s.denied&&(0,t.jsxs)("div",{className:"flex flex-row gap-1.5 items-baseline",children:[(0,t.jsx)("span",{className:"text-heading-32 font-semibold",children:s.total.toLocaleString()}),(0,t.jsx)("span",{className:"text-gray-700 text-xs",children:"Requests"})]}),0!==s.challenged&&(0,t.jsxs)("div",{className:"flex flex-row gap-1.5 items-baseline",children:[(0,t.jsx)("span",{className:"text-heading-32 font-semibold",children:s.challenged.toLocaleString()}),(0,t.jsx)("span",{className:"text-gray-700 text-xs",children:"Challenged"})]}),0!==s.denied&&(0,t.jsxs)("div",{className:"flex flex-row gap-1.5 items-baseline",children:[(0,t.jsx)("span",{className:"text-heading-32 font-semibold",children:s.denied.toLocaleString()}),(0,t.jsx)("span",{className:"text-gray-700 text-xs",children:"Denied"})]})]})}function _(e){let{alert:a}=e,{count:l}=a.data,s=new Date(a.sonarQuery.startTime).getTime(),i=(new Date(a.sonarQuery.endTime).getTime()-s)/6e4,n=i>0?Math.round(l/i):0;return(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsx)("div",{className:"flex flex-col gap-1 p-4 border border-gray-200 rounded-lg",children:(0,t.jsx)("span",{className:"text-heading-24 font-semibold",children:l.toLocaleString()})}),(0,t.jsxs)("div",{className:"flex flex-col gap-1 p-4 border border-gray-200 rounded-lg",children:[(0,t.jsx)("span",{className:"text-gray-700 text-xs font-medium uppercase",children:"Rate Per Minute"}),(0,t.jsx)("span",{className:"text-heading-24 font-semibold",children:n.toLocaleString()})]})]})}function I(){return(0,t.jsx)("div",{className:"h-64 flex items-center justify-center border border-gray-200 rounded-lg bg-gray-50",children:(0,t.jsx)(i.Skeleton,{width:"80%",height:"80%"})})}function M(e){let{anomaly:a,data:l,isLoading:s}=e,i={data:[{count:null,timestamp:(0,g.sub)(new Date,{hours:1})},{count:null,timestamp:new Date}],summary:[],statistics:{rowsRead:0,bytesRead:0,dbTimeSeconds:0,engineTimeSeconds:0,queryTable:""}},n=[];if(a){let e,{startTime:t,endTime:l}=S(a.startTime,a.endTime||a.startTime);e=new Date(a.endTime&&a.endTime!==a.startTime?a.endTime:a.endTime&&a.endTime===a.startTime?a.startTime+18e5:Date.now()),n=a.endTime?[{id:"anomaly-period",type:"area",startTime:new Date(a.startTime),endTime:e,label:"Attack Period"}]:[{id:"anomaly-start",type:"timestamp",timestamp:new Date(a.startTime),label:"Attack Start"}],i.data=[t,l].map(e=>({count:null,timestamp:e}))}let r=(0,u.useTimeseriesData)(l??i,{category:e=>e.wafAction||"Unknown",value:"count"}),o=(0,j.getFormatter)("sum","count");return(0,t.jsx)("div",{className:(0,f.cn)("h-64","transition-opacity duration-200",(s||!l)&&"opacity-30"),children:(0,t.jsx)(d.LineChart,{data:r??[],sonarQueryResults:l,formatValue:o,lineType:"linear",granularity:{minutes:1},marks:n,marginLeft:20,yAxisWidth:10,showRollup:!1,disableZoom:!0})})}function L(){return(0,t.jsx)("div",{className:"flex flex-col gap-4",children:(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)(i.Skeleton,{width:120,height:12}),(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)(i.Skeleton,{width:200,height:20}),(0,t.jsx)(i.Skeleton,{width:180,height:20})]})]})})}function B(e){let{anomaly:a}=e,l=Object.keys(a.affectedHostMap),s=a.endTime;return(0,t.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,t.jsx)("span",{className:"text-heading-14",children:"Affected Hosts"}),(0,t.jsx)("div",{className:"flex flex-col gap-1",children:l.map(e=>(0,t.jsx)("span",{className:"text-label-13 font-mono text-gray-900",children:e},e))})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1 w-full items-start",children:[(0,t.jsx)("span",{className:"text-heading-14",children:"Status"}),(0,t.jsx)(r.Badge,{className:"pl-1 pr-2",icon:s?(0,t.jsx)(o.CheckCircleFill,{color:"gray-800"}):(0,t.jsx)(c.Warning,{}),variant:s?"gray-subtle":"amber-subtle",children:s?"Resolved":"Active"})]})]})}function D(e){var a;let{alert:l}=e,{path:s,metric:i}={path:"path"in(a=l.data)&&$(a.path)?a.path.toString():void 0,metric:"metric"in a&&$(a.metric)?a.metric.toString():void 0};return(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[s&&(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("span",{className:"text-gray-700 text-xs font-medium uppercase",children:"Path"}),(0,t.jsx)("span",{className:"text-label-14 font-mono",children:s})]}),i&&(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("span",{className:"text-gray-700 text-xs font-medium uppercase",children:"Result"}),(0,t.jsx)("span",{className:"text-label-14",children:i})]})]})}function $(e){return"object"==typeof e&&null!==e&&"toString"in e&&"function"==typeof e.toString}function P(e){let a,l,s,{alert:i,data:n,isLoading:r}=e,o={data:[{count:null,timestamp:(0,g.sub)(new Date,{days:1})},{count:null,timestamp:new Date}],summary:[],statistics:{rowsRead:0,bytesRead:0,dbTimeSeconds:0,engineTimeSeconds:0,queryTable:""}},c=[];if(i){let e=(0,h.getChartInterval)(i);s=i.sonarQuery.granularity,l=(0,j.getFormatter)(i.sonarQuery.rollups.count.aggregation,p.AllMeasures[i.sonarQuery.rollups.count.measure].unit),a=(0,x.getAlertTitle)(i),c=e.marks,o.data=[e.chartStartTime,e.chartEndTime].map(e=>({count:null,timestamp:e}))}let m=(0,u.useTimeseriesData)(n??o,{category:()=>a,value:"count"});return(0,t.jsx)("div",{className:(0,f.cn)("h-96","transition-opacity duration-200",(r||!n)&&"opacity-30"),children:(0,t.jsx)(d.LineChart,{data:m??[],sonarQueryResults:n,disableLegend:!0,formatValue:l,lineType:"linear",granularity:s,marks:c,disableZoom:!0})})}function F(){return(0,t.jsx)("div",{className:"h-96 flex items-center justify-center border border-gray-200 rounded-lg bg-gray-50",children:(0,t.jsx)(i.Skeleton,{width:"80%",height:300})})}function O(e){let{data:a,isLoading:l}=e,s={data:[{count:null,timestamp:(0,g.sub)(new Date,{hours:1})},{count:null,timestamp:new Date}],summary:[],statistics:{rowsRead:0,bytesRead:0,dbTimeSeconds:0,engineTimeSeconds:0,queryTable:""}},i=(0,u.useTimeseriesData)(a??s,{category:e=>e.wafAction||"Requests",value:"count"}),n=(0,j.getFormatter)("sum","count");return(0,t.jsx)("div",{className:(0,f.cn)("h-96","transition-opacity duration-200",(l||!a)&&"opacity-30"),children:(0,t.jsx)(d.LineChart,{data:i??[],sonarQueryResults:a,disableLegend:!1,formatValue:n,lineType:"linear",granularity:{minutes:1},marginLeft:20,yAxisWidth:10,showRollup:!1,disableZoom:!0})})}let E=`
button:not([disabled]),
input:not([disabled]):not([type="hidden"]),
select:not([disabled]),
textarea:not([disabled]),

[contenteditable],
[href],
[tabindex]:not([tabindex="-1"])`;function q(){let e=(0,a.useSearchParams)(),l=(0,a.useParams)(),s=e?.has("alert"),i=e?.has("eventIp");if(!s&&!i)return null;let n=l?.teamSlug,r=l?.project;return(0,t.jsx)(T,{teamSlug:n,projectSlug:r})}function z(){return(0,t.jsx)(l.Suspense,{fallback:null,children:(0,t.jsx)(q,{})})}e.s(["FirewallSheetOpener",()=>z],6928648)}]);

//# sourceMappingURL=e952b5c63429ba26.js.map
//# debugId=944c7983-b12e-5e54-a8c6-33d54cbc0f75
