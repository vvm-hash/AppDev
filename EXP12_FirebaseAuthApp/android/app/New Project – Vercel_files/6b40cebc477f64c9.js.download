
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="b0e0f736-271d-5150-91c3-45a33ad6df5d")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,7612113,9602070,1080526,e=>{"use strict";var a=e.i(6468255),t=e.i(6696646),r=e.i(2831393),i=e.i(2504781),n=e.i(4030453),l=e.i(6891161),s=e.i(8522580),o=e.i(455575),d=e.i(5338940),c=e.i(5140444);e.i(3512434);var u=e.i(9835407),m=e.i(7917902),p=e.i(119294),g=e.i(6352514);(0,e.i(7432042).default)("1y");var h=e.i(3911483),y=e.i(9540942);e.i(4373123);var x=e.i(5325056),f=e.i(4439612),b=(0,f.createServerReference)("40a8054b6c51a823393918d3ad4c91b3e6d2c1dc27",f.callServer,void 0,f.findSourceMapURL,"createTopUpPurchaseIntent");let C=u.z.object({amount:u.z.number().min(10).max(5e3)}),v=[20,50,100,500];function S(e){let{activeModalType:u,setActiveModalType:f,closeModal:S,autoRechargeConfig:j,isAutoRechargeEnabled:M}=e,{setPurchaseIntent:w,setProviderDetails:k}=(0,x.useCopperClient)(),{data:A}=(0,h.default)("deferred-auto-recharge-config",{fallbackData:null}),{balance:B}=(0,r.useAiCreditsBalance)(),[I,R]=(0,t.useState)("100"),[T,N]=(0,t.useState)(!1),[_,P]=(0,t.useState)(null),[E,$]=(0,t.useState)("ready"),O=""===I||"0"===I,U=Number(I),z=O||Number.isNaN(U)?100:U,{team:D}=(0,d.useTeam)(),{user:F}=(0,c.useUser)(),{account:H}=(0,m.useAccount)(),G=(0,o.useToasts)(),W=(0,t.useCallback)(e=>{let a=e;e.includes(".")?1===e.split(".")[1].length&&(a=`${e}0`):a=`${e}.00`;let t=Number.parseFloat(a);return Number.isNaN(t)||t<10?(P("Minimum amount is $10"),!1):t>5e3?(P(`Maximum amount is $${5e3.toLocaleString()}`),!1):(P(null),t)},[]),L=(0,t.useCallback)(e=>{R(e),P(null),$("ready")},[]),Y=(0,t.useMemo)(()=>j&&A||j?`Auto-reload is enabled. Your balance will be restored to $${j.targetBalance} when it falls below $${j.minimumBalance}.`:A?"Auto-reload will be enabled after your first purchase.":"Auto-reload is disabled.",[j,A]),K=(0,t.useCallback)(async()=>{try{if(!F||!D)return;let e=W(I);if(!e)return;$("in_progress");let a=C.safeParse({amount:e});if(!a.success){a.error.issues[0],e<10?$("amount_too_low"):e>5e3?$("amount_too_high"):$("invalid_amount");return}let t=await b({amount:I,returnUrl:window.location.href,teamIdOrSlug:D.id});$("completed"),w(t.purchaseIntent),k(t.providerDetails),f("checkout")}catch(e){G.error("We're having trouble processing your payment. Please try again."),$("ready"),w(null),k(null),S(),p.analytics.track(g.AnalyticsEvent.AI_CREDITS_CHECKOUT_ERROR,{message:e.message})}},[I,F,D,H,S,w,k,f,W,G]);return(0,a.jsxs)(l.Modal.Modal,{active:"top_up"===u,onClickOutside:S,children:[(0,a.jsxs)(l.Modal.Body,{children:[(0,a.jsxs)(l.Modal.Header,{children:[(0,a.jsx)(l.Modal.Title,{children:"Buy AI Gateway Credit"}),(0,a.jsx)(l.Modal.Subtitle,{children:"Purchase credit as a one time top-up to use for your team's AI Gateway usage. Credit expires 1 year after purchase and is only valid for use on AI Gateway."})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4 pb-4",children:[(0,a.jsx)("div",{className:"flex h-[84px] items-center justify-center text-gray-1000",children:T?(0,a.jsxs)("div",{className:"flex items-center justify-center w-full transition-transform duration-200 animate-in zoom-in-95",children:[(0,a.jsx)("span",{className:"text-heading-64 text-gray-1000",children:"$"}),(0,a.jsx)("input",{type:"text",value:I.startsWith("$")?I.slice(1):I,onChange:e=>{let a=e.target.value.replace(/,/g,"").replace(/[^0-9.]/g,"");a.split(".")[0].length>6||L(a)},onBlur:()=>{I&&""!==I||R("100"),N(!1)},autoFocus:!0,className:"text-heading-64 text-start border-none outline-none",style:{width:`${Math.max(3,I.length)}ch`},placeholder:"100"})]}):(0,a.jsx)("div",{className:"flex w-full items-center justify-center transition-transform duration-200 animate-in zoom-in-105 cursor-pointer hover:scale-105",onPointerDown:e=>{e.preventDefault(),N(!0),R(z.toString())},children:(0,a.jsx)(y.default,{className:"text-heading-64 text-gray-1000 cursor-pointer",value:z,format:{style:"currency",currency:"USD"}})})}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-center gap-2",children:[v.map(e=>(0,a.jsxs)(i.Button,{size:"small",type:"secondary",normalStyle:I===e.toString()?{backgroundColor:"var(--ds-gray-100)",color:"var(--ds-gray-1000)",borderColor:"var(--ds-gray-alpha-300)"}:void 0,onClick:()=>{R(e.toString()),N(!1),P(null),$("ready")},children:["$",e]},e)),(0,a.jsx)(i.Button,{size:"small",type:"secondary",onClick:()=>{N(!0)},normalStyle:v.map(e=>e.toString()).includes(I)?void 0:{backgroundColor:"var(--ds-gray-100)",color:"var(--ds-gray-1000)",borderColor:"var(--ds-gray-alpha-300)"},children:"Custom"})]})]}),_&&(0,a.jsx)(n.Error,{children:_}),M?(0,a.jsx)(s.Note,{action:(0,a.jsx)(i.Button,{size:"small",type:"secondary",onClick:()=>{f("auto_recharge")},children:"Change"}),fill:!0,type:"secondary",children:Y}):null]})]}),(0,a.jsxs)(l.Modal.Actions,{children:[(0,a.jsx)(l.Modal.Action,{onClick:()=>f(null),type:"secondary",children:"Cancel"}),(0,a.jsx)(l.Modal.Action,{onClick:K,disabled:O||!!_,loading:"in_progress"===E,autoFocus:!0,children:"Continue to Payment"})]})]})}var j=e.i(7418514),M=e.i(1637825),w=e.i(5323212),k=e.i(5255926),A=e.i(9508212),B=e.i(1344973),I=e.i(6446781),R=e.i(4614946),T=e.i(5895979),N=e.i(5883567),_=e.i(57106),P=(0,f.createServerReference)("40621fd516aff7ae9e8f252f37e85a285dd1a5ad15",f.callServer,void 0,f.findSourceMapURL,"completePurchaseIntent"),E=(0,f.createServerReference)("40f4e720d7893bdf9358bdbfcd97cd084094fe3a4f",f.callServer,void 0,f.findSourceMapURL,"confirmPurchaseIntent"),$=(0,f.createServerReference)("40e61acdaa035d45344d7be6da0f8a4a248d389ca5",f.callServer,void 0,f.findSourceMapURL,"createAutoTopupConfig"),O=(0,f.createServerReference)("40a0b7bbabe5a5daf89070af2b299cc44e92899ca9",f.callServer,void 0,f.findSourceMapURL,"patchPaymentMethod"),U=e.i(9781044),z=e.i(6280036),D=e.i(5978870);let F=(0,T.withBillingContext)(function(e){let{activeModalType:n,setActiveModalType:s,closeModal:u,providerDetails:h}=e,{purchaseIntent:y}=(0,x.useCopperClient)(),[f,b]=(0,t.useState)("ready"),[C,v]=(0,t.useState)(null),{team:S}=(0,d.useTeam)(),{user:k}=(0,c.useUser)(),{mutate:B}=(0,R.useSWRConfig)(),{account:T}=(0,m.useAccount)(),{paymentMethods:_}=(0,M.useBillingPlatform)(),{balance:E,hasEverPaid:$}=(0,r.useAiCreditsBalance)(),z=(0,U.useStripe)(),D=(0,o.useToasts)(),F=(0,t.useMemo)(()=>{if(_){if(!C){let e=_.defaultSource;return _.sources.find(a=>a.id===e)}return _.sources.find(e=>e.id===C)}},[_,C]),H=(0,t.useMemo)(()=>K(y),[y]),G=(0,t.useCallback)(async()=>{try{if(b("in_progress"),!S||!z||!F||!k||!y||!h||void 0===E||void 0===H)return;F.billing_details.email||await O({paymentMethodId:F.id,teamIdOrSlug:S.id});let e=await z.initCheckout({fetchClientSecret:()=>Promise.resolve(h.clientSecret)}),a=await e.confirm({redirect:"if_required",paymentMethod:F.id});if("error"===a.type){p.analytics.track(g.AnalyticsEvent.AI_CREDITS_CHECKOUT_ERROR,{message:a.error.message}),D.error("Failed to add funds. Please try again."),b("ready");return}await P({purchaseIntentId:y.id,teamIdOrSlug:S.id}),D.success(`Successfully added $${H} to your AI Gateway Credits balance!`);let t=Number(E)+H;await B(`/api/ai/ai-credits-balance?teamId=${S.id}`,()=>({cumulativeBalance:t,hasEverPaid:!0}),{revalidate:!1}),b("completed"),u()}catch(e){D.error("We're having trouble processing your payment. Please try again."),b("ready"),u(),p.analytics.track(g.AnalyticsEvent.AI_CREDITS_CHECKOUT_ERROR,{message:e.message})}},[k,S,T,z,F,y,B,b,h,D,u,H,E,$]);return(0,a.jsxs)(l.Modal.Modal,{active:"checkout"===n,onClickOutside:u,children:[(0,a.jsxs)(l.Modal.Body,{children:[(0,a.jsxs)(l.Modal.Header,{children:[(0,a.jsx)(l.Modal.Title,{children:"Confirm Payment Method"}),(0,a.jsx)(l.Modal.Subtitle,{children:"Your default payment method will be used for a one-time charge unless you add a new payment method below."})]}),(0,a.jsxs)(A.Stack,{direction:"column",gap:4,children:[(0,a.jsx)(w.Select,{label:"Payment method",prefix:(0,a.jsx)(j.CardIcon,{brand:F?.card?.brand??"unknown"}),value:F?.id,onChange:e=>{b("ready"),v(e.target.value)},children:_?.sources.map(e=>(0,a.jsx)("option",{value:e.id,children:`${(0,I.cardBrand)(e.card?.brand)} ${e.card?.funding} ending in •••• ${e.card?.last4} ${e.id===_.defaultSource?"(Default)":""}`},e.id))}),(0,a.jsx)(i.Button,{type:"secondary",size:"medium",prefix:(0,a.jsx)(N.PlusCircle,{}),onClick:()=>{s("add_card")},children:"Add payment method"})]})]}),(0,a.jsxs)(A.Stack,{direction:"column",paddingY:4,paddingTop:2,paddingX:6,gap:4,className:"border-t bg-background-200",children:[(0,a.jsx)(W,{purchaseIntent:y}),(0,a.jsx)(L,{})]}),(0,a.jsxs)(l.Modal.Actions,{children:[(0,a.jsx)(l.Modal.Action,{onClick:()=>{s("top_up")},type:"secondary",children:"Back"}),(0,a.jsx)(l.Modal.Action,{onClick:async()=>{await G()},loading:"in_progress"===f,children:"Confirm and Pay"})]})]})});function H(e){var i,n;let{activeModalType:s,setActiveModalType:u,closeModal:y,providerDetails:f}=e,{purchaseIntent:b}=(0,x.useCopperClient)(),{data:C}=(0,h.default)("deferred-auto-recharge-config",{fallbackData:null}),[v,S]=(0,t.useState)("initializing"),{team:j}=(0,d.useTeam)(),{user:M}=(0,c.useUser)(),{mutate:w}=(0,R.useSWRConfig)(),{account:B}=(0,m.useAccount)(),{balance:I,hasEverPaid:T}=(0,r.useAiCreditsBalance)(),N=(0,o.useToasts)(),{resolvedTheme:_}=(0,z.useTheme)(),E=(0,t.useMemo)(()=>K(b),[b]),O=(0,t.useRef)(null),U=(0,t.useCallback)(async()=>{try{if(S("in_progress"),!j||!M||!b||!f||void 0===I||void 0===E)return void S("ready");if(O.current){let e=await O.current();if(e.success){await P({purchaseIntentId:b.id,teamIdOrSlug:j.id}),N.success(`Successfully added $${E} to your AI Gateway Credits balance!`);let e=Number(I)+E;if(await w(`/api/ai/ai-credits-balance?teamId=${j.id}`,()=>({cumulativeBalance:e,hasEverPaid:!0}),{revalidate:!1}),C)try{let{minimumBalance:e,targetBalance:a,maximumMonthlySpend:t}=C;await $({teamIdOrSlug:j.id,minimumBalance:e,targetBalance:a,maximumMonthlySpend:t}),w(`/api/credit-topups?teamId=${j.id}&currency=ai_gateway_credits`),w("deferred-auto-recharge-config",null,{revalidate:!1}),N.success("Auto-reload has been enabled!")}catch(e){N.error("Payment successful, but auto-reload setup failed. Please try setting it up again.")}S("completed"),y()}else{p.analytics.track(g.AnalyticsEvent.AI_CREDITS_CHECKOUT_ERROR,{message:e.error??"Payment checkout failed"}),N.error(e.error??"Failed to add credits. Please try again."),S("ready");return}}else{p.analytics.track(g.AnalyticsEvent.AI_CREDITS_CHECKOUT_ERROR,{message:"Payment handler not initialized"}),N.error("We're having trouble processing your payment. Please try again."),S("ready");return}}catch(e){N.error("We're having trouble processing your payment. Please try again."),S("ready"),y(),p.analytics.track(g.AnalyticsEvent.AI_CREDITS_CHECKOUT_ERROR,{message:e.message})}},[M,j,B,b,w,S,f,N,y,E,I,C,T]);return(0,a.jsxs)(l.Modal.Modal,{active:"checkout"===s,onClickOutside:y,children:[(0,a.jsxs)(l.Modal.Body,{children:[(0,a.jsxs)(l.Modal.Header,{children:[(0,a.jsx)(l.Modal.Title,{children:"Confirm Payment Method"}),(0,a.jsx)(l.Modal.Subtitle,{children:"Your default payment method will be used for a one-time charge unless you add a new payment method below."})]}),"initializing"===v?(0,a.jsx)(k.Skeleton,{className:"h-32",width:"100%"}):null,(0,a.jsx)(A.Stack,{direction:"column",gap:4,children:f?(0,a.jsx)(D.CopperPaymentElement,{confirmHandler:O,clientSecret:f.clientSecret,options:{elementsOptions:{appearance:(n={theme:"stripe"},{theme:"flat",variables:{fontSizeBase:"14px",fontSizeSm:"14px",colorTextPlaceholder:(i="dark"===_)?"hsl(240, 3.8%, 60%)":"hsl(240, 3.8%, 46.1%)",colorText:i?"white":"rgb(9, 9, 11)",colorPrimary:"var(--blue-700)",colorDanger:"hsl(0, 84.2%, 60.2%)",borderRadius:"6px",colorBackground:i?"black":"white",focusBoxShadow:i?"rgb(255, 255, 255) 0px 0px 0px 0px, rgb(161, 161, 170) 0px 0px 0px 1px, rgba(0, 0, 0, 0.05) 0px 1px 2px 0px":"rgb(0, 0, 0) 0px 0px 0px 0px, rgb(161, 161, 170) 0px 0px 0px 1px, rgba(0, 0, 0, 0.05) 0px 1px 2px 0px"},rules:{".Input":{border:i?"1px solid hsl(240, 5.9%, 30%)":"1px solid hsl(240, 5.9%, 90%)",padding:"10px 12px",transition:"all cubic-bezier(0.4, 0, 0.2, 1) 150ms"},".Label":{marginBottom:"8px",color:i?"#999999":"#666666",lineHeight:"20px",fontWeight:"400"},".AccordionItem":{backgroundColor:i?"black":"white"},".Block":{backgroundColor:i?"black":"white"}},...n}),loader:"never",savedPaymentMethod:{enableRedisplay:"auto"}}},onReady:()=>S("ready")}):null})]}),(0,a.jsxs)(A.Stack,{direction:"column",paddingY:4,paddingTop:2,paddingX:6,gap:4,className:"border-t bg-background-200",children:[(0,a.jsx)(W,{purchaseIntent:b}),(0,a.jsx)(L,{})]}),(0,a.jsxs)(l.Modal.Actions,{children:[(0,a.jsx)(l.Modal.Action,{onClick:()=>{u("top_up"),S("initializing")},type:"secondary",children:"Back"}),(0,a.jsx)(l.Modal.Action,{onClick:async()=>{await U()},loading:["in_progress","initializing"].includes(v),children:"Confirm and Pay"})]})]})}function G(e){let{activeModalType:i,setActiveModalType:n,closeModal:s,providerDetails:u}=e,{purchaseIntent:y}=(0,x.useCopperClient)(),{data:f}=(0,h.default)("deferred-auto-recharge-config",{fallbackData:null}),[b,C]=(0,t.useState)("ready"),{team:v}=(0,d.useTeam)(),{user:S}=(0,c.useUser)(),{mutate:j}=(0,R.useSWRConfig)(),{account:M}=(0,m.useAccount)(),{balance:w,hasEverPaid:k}=(0,r.useAiCreditsBalance)(),B=(0,o.useToasts)(),I=(0,t.useMemo)(()=>K(y),[y]),T=(0,t.useCallback)(async()=>{if(v&&S&&y&&u&&void 0!==w&&void 0!==I&&"in_progress"!==b)try{C("in_progress"),await E({purchaseIntentId:y.id,teamIdOrSlug:v.id}),await P({purchaseIntentId:y.id,teamIdOrSlug:v.id}),B.success(`Successfully added $${I} to your AI Gateway Credits balance!`);let e=Number(w)+I;if(await j(`/api/ai/ai-credits-balance?teamId=${v.id}`,()=>({cumulativeBalance:e,hasEverPaid:!0}),{revalidate:!1}),f)try{let{minimumBalance:e,targetBalance:a,maximumMonthlySpend:t}=f;await $({teamIdOrSlug:v.id,minimumBalance:e,targetBalance:a,maximumMonthlySpend:t}),j(`/api/credit-topups?teamId=${v.id}&currency=ai_gateway_credits`),j("deferred-auto-recharge-config",null,{revalidate:!1}),B.success("Auto-reload has been enabled!")}catch(e){B.error("Payment successful, but auto-reload setup failed. Please try setting it up again.")}C("completed"),s()}catch(e){B.error("We're having trouble processing your payment. Please try again."),C("ready"),s(),p.analytics.track(g.AnalyticsEvent.AI_CREDITS_CHECKOUT_ERROR,{message:e.message})}},[S,v,M,y,j,C,b,u,B,s,I,w,f,k]);return(0,a.jsxs)(l.Modal.Modal,{active:"checkout"===i,onClickOutside:s,children:[(0,a.jsx)(l.Modal.Body,{children:(0,a.jsxs)(l.Modal.Header,{children:[(0,a.jsx)(l.Modal.Title,{children:"Confirm Purchase"}),(0,a.jsx)(l.Modal.Subtitle,{children:"Your purchase will be reported to AWS Markeplace for invoicing and payment."})]})}),(0,a.jsxs)(A.Stack,{direction:"column",paddingY:4,paddingTop:2,paddingX:6,gap:4,className:"border-t bg-background-200",children:[(0,a.jsx)(W,{purchaseIntent:y}),(0,a.jsx)(L,{})]}),(0,a.jsxs)(l.Modal.Actions,{children:[(0,a.jsx)(l.Modal.Action,{onClick:()=>{n("top_up")},type:"secondary",children:"Back"}),(0,a.jsx)(l.Modal.Action,{onClick:async()=>{await T()},loading:"in_progress"===b,children:"Confirm and Pay"})]})]})}function W(e){let{purchaseIntent:r}=e,i=(0,t.useMemo)(()=>r?r.lineItems?.map(e=>({name:e.name,amount:Number(e.unitAmount)*Number(e.quantity)}))??[]:[],[r]),n=r?.total?Number(r.total):0,l=r?.tax?Number(r.tax):0;return(0,a.jsxs)(A.Stack,{direction:"column",children:[i.map(e=>(0,a.jsxs)(A.Stack,{direction:"row",gap:4,justify:"space-between",className:"border-b",paddingY:4,children:[(0,a.jsx)(B.Text,{className:"text-gray-900",weight:500,children:e.name}),(0,a.jsx)(B.Text,{className:"text-gray-900",weight:500,children:`$${e.amount.toFixed(2)}`})]},e.name)),l>0?(0,a.jsxs)(A.Stack,{direction:"row",gap:4,justify:"space-between",className:"border-b",paddingY:4,children:[(0,a.jsx)(B.Text,{className:"text-foreground",weight:500,children:"Estimated Tax"}),(0,a.jsx)(B.Text,{className:"text-foreground",weight:500,children:`$${l.toFixed(2)}`})]}):null,(0,a.jsxs)(A.Stack,{direction:"column",gap:1,className:"border-b",paddingY:4,children:[(0,a.jsxs)(A.Stack,{direction:"row",gap:4,justify:"space-between",children:[(0,a.jsx)(B.Text,{className:"text-foreground",weight:500,children:"Total"}),(0,a.jsx)(B.Text,{className:"text-foreground",weight:500,children:`$${n.toFixed(2)}`})]}),(0,a.jsx)(B.Text,{align:"right",size:12,color:"gray-900",children:"* Plus applicable tax and fees"})]})]})}function L(){return(0,a.jsxs)(B.Text,{className:"text-gray-900",children:['By pressing "Confirm and Pay" and accessing AI Gateway, you agree to'," ",(0,a.jsx)(_.Link,{href:"/legal/ai-product-terms",className:"text-foreground underline",target:"_blank",children:"Vercel's AI Product Terms."})]})}function Y(e){var t;let{isUpdatedStripeElementsEnabled:r}=e,{purchaseIntent:i,providerDetails:n}=(0,x.useCopperClient)();return(t=i,t?.provider?.type==="tackle_aws_marketplace")?(0,a.jsx)(G,{...e,providerDetails:n}):r?(0,a.jsx)(H,{...e,providerDetails:n}):(0,a.jsx)(F,{...e,providerDetails:n})}function K(e){return e?e.lineItems?.filter(e=>"AI Gateway Credits"===e.name).reduce((e,a)=>e+Number(a.unitAmount)*(Number(a.quantity)||1),0):0}var q=e.i(8158658),X=e.i(2471070);function V(){let{topups:e,loading:a,mutate:t}=(0,X.useAiGatewayCreditTopups)(),r=e?.find(e=>"orb_ledger"!==e.provider.type||"miu"!==e.provider.currency);return{autoRechargeConfig:r?{minimumBalance:r.minimumBalance,targetBalance:r.targetBalance,maximumMonthlySpend:r.maximumMonthlySpend??""}:void 0,loading:a,mutate:t}}e.s(["useAiCreditsAutoRecharge",()=>V],9602070);var J=e.i(3500331),Q=e.i(1906681),Z=(0,f.createServerReference)("40f3f3b613afdb7078f414f708aecf536d1a502cc2",f.callServer,void 0,f.findSourceMapURL,"deleteAutoTopupConfig"),ee=(0,f.createServerReference)("402ab100eb25aa8334ba8f582b85cf99d1c79b246e",f.callServer,void 0,f.findSourceMapURL,"updateAutoTopupConfig");let ea=u.z.object({minimumBalance:u.z.string().refine(e=>!Number.isNaN(Number(e))&&Number.isInteger(Number(e))&&Number(e)>=5,{message:"Minimum balance must be a whole number and at least $5"}),targetBalance:u.z.string().refine(e=>!Number.isNaN(Number(e))&&Number.isInteger(Number(e))&&Number(e)>=25,{message:"Target balance must be a whole number and at least $25"}),maximumMonthlySpend:u.z.string().optional().refine(e=>!e||!Number.isNaN(Number(e))&&Number.isInteger(Number(e))&&Number(e)>=50,{message:"Maximum monthly spend must be a whole number and at least $50"})}).refine(e=>{let{minimumBalance:a,targetBalance:t}=e;return Number(t)>Number(a)},{message:"Target balance must be greater than minimum balance",path:["targetBalance"]});function et(e){let{autoRechargeConfig:a,draftAutoRechargeConfig:t,type:r}=e;return t?t[r]??"":a?a[r]??"":"minimumBalance"===r?"5":"targetBalance"===r?"25":"maximumMonthlySpend"===r?"50":"0"}function er(e){let{autoRechargeConfig:n,onCancel:l,onComplete:s}=e,{data:c,mutate:u}=(0,h.default)("deferred-auto-recharge-config",{fallbackData:null}),m=n??c??void 0,[p,g]=(0,t.useState)(!!m),[y,x]=(0,t.useState)(null),[f,b]=(0,t.useState)("ready"),[C,v]=(0,t.useState)({}),{balance:S,hasEverPaid:j}=(0,r.useAiCreditsBalance)(),M=!!m!==p||null!==y,{team:w}=(0,d.useTeam)(),{mutate:k}=(0,R.useSWRConfig)(),I=(0,o.useToasts)(),T=function(e){let{autoRechargeConfig:a,draftAutoRechargeConfig:t}=e;return(e,r)=>({minimumBalance:"minimumBalance"===e?r:et({autoRechargeConfig:a,draftAutoRechargeConfig:t,type:"minimumBalance"}),targetBalance:"targetBalance"===e?r:et({autoRechargeConfig:a,draftAutoRechargeConfig:t,type:"targetBalance"}),maximumMonthlySpend:"maximumMonthlySpend"===e?r:et({autoRechargeConfig:a,draftAutoRechargeConfig:t,type:"maximumMonthlySpend"})})}({autoRechargeConfig:m,draftAutoRechargeConfig:y}),N=(0,t.useCallback)(async()=>{if(!w||!y)return;let{minimumBalance:e,targetBalance:a,maximumMonthlySpend:t}=y;j?(await $({teamIdOrSlug:w.id,minimumBalance:e,targetBalance:a,maximumMonthlySpend:t??""}),k(`/api/credit-topups?teamId=${w.id}&currency=ai_gateway_credits`),I.success("Successfully enabled auto-reload!")):(u({minimumBalance:e,targetBalance:a,maximumMonthlySpend:t??""}),I.success("Auto-reload will be enabled after your first purchase."))},[w,y,k,I,j,u]),_=(0,t.useCallback)(async()=>{if(!w||!n||!y)return;let{maximumMonthlySpend:e,minimumBalance:a,targetBalance:t}=y;await ee({teamIdOrSlug:w.id,updatedMaximumMonthlySpend:e??"",updatedMinimumBalance:a,updatedTargetBalance:t}),k(`/api/credit-topups?teamId=${w.id}&currency=ai_gateway_credits`),I.success("Successfully updated auto-reload!")},[w,n,y,k,I]),P=(0,t.useCallback)(async()=>{w&&n&&(await Z({teamIdOrSlug:w.id}),k(`/api/credit-topups?teamId=${w.id}&currency=ai_gateway_credits`),I.success("Successfully disabled auto-reload!"))},[w,n,k,I,Z]),E=(0,t.useCallback)(async()=>{if(b("in_progress"),!M)return void b("ready");let e=ea.safeParse({minimumBalance:et({autoRechargeConfig:m,draftAutoRechargeConfig:y,type:"minimumBalance"}),targetBalance:et({autoRechargeConfig:m,draftAutoRechargeConfig:y,type:"targetBalance"}),maximumMonthlySpend:et({autoRechargeConfig:m,draftAutoRechargeConfig:y,type:"maximumMonthlySpend"})});if(!e.success){b("ready");let a={};e.error.errors.forEach(e=>{a[e.path[0]]=e.message}),v(a);return}if(void 0!==S&&Number(e.data.minimumBalance)>=Number(S)&&!0===j){b("ready"),v({minimumBalance:"Minimum balance must be lower than your current balance"});return}v({});try{m&&!p?n?await P():u(null):!n&&y?await N():n&&y&&await _(),b("completed"),s?.()}catch{I.error("Failed to update auto-reload. Please try again."),b("ready")}},[n,y,p,m,N,_,P,u,I,M,s,S,b,v,j]);return(0,a.jsxs)(A.Stack,{direction:"column",gap:4,children:[(0,a.jsxs)(A.Stack,{direction:"column",gap:4,children:[(0,a.jsxs)(A.Stack,{direction:"row",gap:2,align:"center",justify:"space-between",children:[(0,a.jsx)(B.Text,{weight:500,children:"Auto-reload"}),(0,a.jsx)(Q.Toggle,{"aria-label":"Enable Auto-reload",checked:p,size:"large",onChange:()=>{g(e=>{let a=!e;return a&&x({minimumBalance:"5",targetBalance:"25",maximumMonthlySpend:""}),v({}),a})}})]}),(0,a.jsxs)(A.Stack,{direction:"row",gap:4,children:[(0,a.jsx)(J.Input,{"aria-labelledby":"balance-trigger-label",label:"When balance falls below",width:"100%",suffix:"USD",value:et({autoRechargeConfig:m,draftAutoRechargeConfig:y,type:"minimumBalance"}),onChange:e=>{x(()=>T("minimumBalance",e.target.value)),C.minimumBalance&&v(e=>({...e,minimumBalance:void 0}))},disabled:!p,suffixStyling:!1,error:C.minimumBalance}),(0,a.jsx)(J.Input,{"aria-labelledby":"balance-reload-label",label:"Recharge to target balance",width:"100%",suffix:"USD",value:et({autoRechargeConfig:m,draftAutoRechargeConfig:y,type:"targetBalance"}),onChange:e=>{x(()=>T("targetBalance",e.target.value)),C.targetBalance&&v(e=>({...e,targetBalance:void 0}))},disabled:!p,suffixStyling:!1,error:C.targetBalance})]}),(0,a.jsx)(A.Stack,{children:(0,a.jsx)(J.Input,{"aria-labelledby":"max-spend-label",label:"Maximum monthly spend",width:"100%",suffix:"USD",placeholder:et({autoRechargeConfig:m,draftAutoRechargeConfig:y,type:"maximumMonthlySpend"}),value:et({autoRechargeConfig:m,draftAutoRechargeConfig:y,type:"maximumMonthlySpend"}),onChange:e=>{x(()=>T("maximumMonthlySpend",e.target.value)),C.maximumMonthlySpend&&v(e=>({...e,maximumMonthlySpend:void 0}))},disabled:!p,suffixStyling:!1,error:C.maximumMonthlySpend})})]}),(0,a.jsxs)(A.Stack,{direction:"row",justify:"end",gap:2,children:[l?(0,a.jsx)(i.Button,{type:"secondary",onClick:l,size:"small",children:"Cancel"}):null,(0,a.jsx)(i.Button,{onClick:E,loading:"in_progress"===f,disabled:!M,size:"small",children:"Save Changes"})]})]})}e.s(["AutoRechargeForm",()=>er],1080526);var ei=e.i(9100551);function en(e){let{activeModalType:t,setActiveModalType:r,autoRechargeConfig:i}=e,n=(0,ei.useParams)(),o="string"==typeof n?.teamSlug?n.teamSlug:void 0,{topups:d}=(0,X.useAiGatewayCreditTopups)(),c=d?.some(e=>"orb_ledger"===e.provider.type&&"miu"===e.provider.currency)??!1;return(0,a.jsxs)(l.Modal.Modal,{active:"auto_recharge"===t,onClickOutside:()=>r(null),children:[(0,a.jsxs)(l.Modal.Body,{children:[(0,a.jsx)(l.Modal.Header,{children:(0,a.jsx)(l.Modal.Title,{children:"Enable Auto-reload"})}),c&&o?(0,a.jsx)(s.Note,{fill:!0,children:(0,a.jsxs)(B.Text,{children:["MIU draw down is enabled for AI Gateway. Auto-reload is managed in your"," ",(0,a.jsx)(_.Link,{href:`/${o}/~/settings/billing#plan`,variant:"highlight",children:"billing settings"}),"."]})}):(0,a.jsx)(er,{autoRechargeConfig:i,onCancel:()=>r("top_up"),onComplete:()=>r("top_up")})]}),c&&(0,a.jsx)(l.Modal.Actions,{children:(0,a.jsx)(l.Modal.Action,{type:"secondary",onClick:()=>r("top_up"),children:"Back"})})]})}var el=e.i(3089600),es=e.i(2166755);let eo=(0,t.createContext)(null);function ed(e){let{children:r,isUpdatedStripeElementsEnabled:i,isAutoRechargeEnabled:n}=e,{openModal:l,closeModal:s,modals:o}=function(e){let{isUpdatedStripeElementsEnabled:r,isAutoRechargeEnabled:i}=e,{data:n,mutate:l}=(0,h.default)("modal:ai-credits",{fallbackData:null}),{autoRechargeConfig:s}=V(),{team:o}=(0,d.useTeam)(),{account:c}=(0,m.useAccount)(),u=(0,es.useEnvironment)(c),p=(0,t.useRef)(null);(0,el.default)("modal",e=>{"top-up"===e&&l("top_up")});let g=(0,t.useCallback)(()=>{l(null),p.current?.()},[l]),y=(0,a.jsxs)(x.CopperProvider,{environment:u,teamIdOrSlug:o?.id,clearPaymentStateRef:p,children:[(0,a.jsx)(S,{activeModalType:n??null,setActiveModalType:l,closeModal:g,isAutoRechargeEnabled:i,autoRechargeConfig:s}),(0,a.jsx)(Y,{activeModalType:n??null,setActiveModalType:l,closeModal:g,isUpdatedStripeElementsEnabled:r}),(0,a.jsx)(q.default,{active:"add_card"===n,onAdded:()=>{l("checkout")},onCancel:()=>{l("checkout")}}),(0,a.jsx)(en,{activeModalType:n??null,setActiveModalType:l,autoRechargeConfig:s},JSON.stringify(s))]});return{openModal:()=>l("top_up"),closeModal:g,modals:y}}({isUpdatedStripeElementsEnabled:i,isAutoRechargeEnabled:n});return(0,a.jsxs)(eo.Provider,{value:{openModal:l,closeModal:s,modals:o},children:[r,o]})}function ec(){let e=(0,t.useContext)(eo);if(!e)throw Error("useAddCreditsModalContext must be used within AddCreditsModalProvider");return e}e.s(["AddCreditsModalProvider",()=>ed,"useAddCreditsModalContext",()=>ec],7612113)},4375105,e=>{"use strict";var a=e.i(6468255),t=e.i(2831393),r=e.i(2504781),i=e.i(5255926),n=e.i(5468328),l=e.i(6696646),s=e.i(6347389),o=e.i(7612113),d=e.i(1717203),c=e.i(7557283),u=e.i(5338940),m=e.i(4597921);function p(){let{type:e="inline"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{can:p}=(0,d.default)(),g=p(c.Action.Update,c.Resource.PaymentMethod),{team:h,isReady:y}=(0,u.useTeam)(),{balance:x,hasEverPaid:f}=(0,t.useAiCreditsBalance)(),{openModal:b}=(0,o.useAddCreditsModalContext)(),C=h?.billing?.status==="overdue",v=(0,l.useCallback)(e=>{if(void 0===e)return"";let a=Math.max(0,e);return a<100?a.toFixed(2):a<1e3?a.toFixed(0):`${(a/1e3).toFixed(0)}k`},[]),S=(0,m.useServerFlag)("enable-ai-gateway-free-usage-insights",!1);return(0,a.jsx)("div",{className:"flex items-center gap-2",children:void 0!==x&&y?(0,a.jsx)(n.Tooltip,{position:"bottom",disableTriggers:g&&!C,boxAlign:"center",text:g?"AI Gateway credit purchases are disabled due to an overdue invoice.":"You need additional permissions to manage your team’s AI Gateway credit.",children:(0,a.jsx)(r.Button,{type:"on-demand"===e?"default":"secondary",size:"on-demand"===e?"small":void 0,disabled:!g||C,onClick:b,prefix:"inline"===e?(0,a.jsx)(s.Coins,{}):void 0,children:"inline"===e?`${v(x)} ${S&&!1===f?"Free Credit":"Credit"}`:"Buy Credit"})}):(0,a.jsx)(i.Skeleton,{children:(0,a.jsx)(r.Button,{type:"on-demand"===e?"default":"secondary",size:"on-demand"===e?"small":void 0,prefix:"inline"===e?(0,a.jsx)(s.Coins,{}):void 0,children:"inline"===e?"Loading Credit":"Buy Credit"})})})}e.s(["ViewBalanceAndPurchaseCreditsModal",()=>p])}]);

//# sourceMappingURL=5df7d4bc3b264038.js.map
//# debugId=b0e0f736-271d-5150-91c3-45a33ad6df5d
