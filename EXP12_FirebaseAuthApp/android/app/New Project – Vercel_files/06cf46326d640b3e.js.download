
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="c0f74c56-6e15-5ed7-b7bf-c79eec923e20")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,2645806,e=>{"use strict";var t=e.i(6468255),i=e.i(6696646),n=e.i(9429645),l=e.i(6891161),a=e.i(455575),r=e.i(277234),o=e.i(4244280),s=e.i(9716741),d=e.i(4470704);let c=i.default.memo(e=>{let{active:c,onClose:u,deployment:m,teamId:h}=e,[p,g]=(0,i.useState)(!1),x=(0,a.useToasts)(),f=(0,i.useCallback)(async()=>{if(!m)return;g(!0);let e=h?"?teamId="+h:"",t=await (0,r.fetchAPI)(`${(0,o.API_DEPLOYMENTS)("v12")}/${m.id}/cancel`+e,{throwOnHTTPError:!1,method:"PATCH"});t.error&&x.error(`Could not cancel the deployment, it's ${m.readyState}`),"CANCELED"===t.readyState&&(x.success("The deployment has been successfully canceled."),(0,n.mutate)((0,d.getUrl)(m.id),{...m,readyState:t.readyState,status:t.readyState,canceledAt:t.canceledAt,host:m.url,isPrivate:!m.public})),g(!1),u()},[m,h,x,u]);return(0,t.jsxs)(l.Modal.Modal,{active:c,onClickOutside:u,width:"500px",children:[(0,t.jsxs)(l.Modal.Body,{children:[(0,t.jsx)(l.Modal.Header,{children:(0,t.jsx)(l.Modal.Title,{children:"Cancel Deployment"})}),(0,t.jsx)(s.default,{children:"Canceling this deployment will immediately stop the build, with no way to resume."}),(0,t.jsx)(s.default,{style:{margin:0},children:"Are you sure you want to continue?"})]}),(0,t.jsxs)(l.Modal.Actions,{children:[(0,t.jsx)(l.Modal.Action,{loading:!1,onClick:u,type:"secondary",children:"Close"}),(0,t.jsx)(l.Modal.Action,{disabled:p,loading:p,onClick:f,children:"Cancel deployment"})]})]})});e.s(["default",0,c])},3930829,e=>{"use strict";var t=e.i(6696646),i=e.i(8815282),n=e.i(2919890),l=e.i(7316497),a=e.i(5260505),r=e.i(8765922),o=e.i(1194788);function s(e,s,d){let{isServer:c,config:u,fetcher:m,fallbackSource:h}=(0,n.useIsomorphicSwrContext)(!0),p=(0,t.useMemo)(()=>"function"==typeof s?(e,t)=>s(e,t):(e,t)=>t(e),[s]),g=(0,t.useMemo)(()=>e=>{if(c)throw Error("useSWR: swrFetcher is not available on server");return p(e,m)},[c,p,m]),x="object"==typeof s?s:d,{ssr:f,...b}=x??{},y=(0,l.mergeConfig)(u,x),j=e(0,null),v=h(j??null,p,y,!1),{data:k,isLoading:S,error:A}=(0,a.useAsyncValue)(c,v),C=(0,i.default)((t,i)=>{let n=e(t,i);return S&&!c?null:n},g,{...b,suspense:!1,fallback:{[(0,i.unstable_serialize)(e)]:k?[k]:void 0},revalidateOnMount:!c&&(b.revalidateOnMount??(!k&&!S))}),{mutate:T,data:I,isLoading:R}=C,w=(0,t.useMemo)(()=>(0,r.withThrottle)(j,()=>{(0,o.debug)(`Client fallback data fetch for ${j}`),T()},2e3),[j,T]);return(0,t.useEffect)(()=>{!A||R||I||w()},[A,w,I,R]),{...C,isLoading:C.isLoading&&void 0===C.data||S||c}}e.s(["useIsomorphicSWRInfinite",()=>s])},5771992,e=>{"use strict";var t=e.i(6696646),i=e.i(3911483),n=e.i(8042625),l=e.i(277234),a=e.i(4244280),r=e.i(5338940),o=e.i(1360174),s=e.i(5140444),d=e.i(9100551),c=e.i(3930829),u=e.i(588428),m=e.i(4670733),h=e.i(2259673),p=e.i(7783521);function g(e){var i;let l,{limit:g,project:x,projectId:f,requireProject:b,users:y,target:j,readyStateFilter:v,meta:k,rollbackCandidate:S,since:A,until:C,subscribeToUpdates:T,branch:I,sha:R,ignoreProjectSlug:w,projectIds:D}=e,{refreshInterval:P,...M}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"v6",{isReady:N,team:O}=(0,r.useTeam)(),{user:E}=(0,s.useUser)(),[$,_]=(0,t.useState)(()=>P),B=y&&y.length>0?y.map(e=>e.uid).join(","):null,z=x?.id||f,{value:F}=(0,m.useInstantRollbackHobbyRestrictionFlag)(),{value:H}=(0,u.useInstantRollbackHobbyRestrictionTeamFlag)(),{teamSlug:W,project:U}=(0,d.useParams)()??{},Y={projectId:z,limit:g,teamId:O?.id,target:j||null,users:B,state:v,meta:k,rollbackCandidate:S,since:A,until:C,branch:I,sha:R,projectIds:D},V=b||(F||H)&&void 0!==S&&(!O||O.billing?.plan==="hobby"),G=(0,c.useIsomorphicSWRInfinite)((e,t)=>{if(W&&U&&!w){if(!e)return`${(0,a.API_DEPLOYMENTS)(L)}${(0,n.encode)({...Y,teamId:W,projectId:U})}`;let i=t&&t.deployments.length>=g?t.deployments[t.deployments.length-1].created-1:null;return i?`${(0,a.API_DEPLOYMENTS)(L)}${(0,n.encode)({...Y,teamId:W,projectId:U,from:i})}`:null}if(V&&!z)return null;if(!e)return N?`${(0,a.API_DEPLOYMENTS)(L)}${(0,n.encode)(Y)}`:null;let i=t&&t.deployments.length>=g?t.deployments[t.deployments.length-1].created-1:null;return i&&N?`${(0,a.API_DEPLOYMENTS)(L)}${(0,n.encode)({...Y,from:i})}`:null},{...M,refreshInterval:$,ssr:{timeout:1e3}}),{mutate:q}=G,K=(0,t.useMemo)(()=>(0,o.default)(()=>{q()},100),[q]),{isListening:X}=(l=(i=T?x:void 0)?`${i.accountId}-${i.id}`:void 0,(0,h.usePusherEvent)("deployments",l,"deployment-created",K));X||P===$?X&&3e4!==$&&_(3e4):_(P);let J=(0,t.useMemo)(()=>G.data?G.data.flatMap(e=>e.deployments):[],[G.data]),Q=O?O.id:E?.uid,Z=(0,t.useMemo)(()=>T&&Q?J.map(e=>({id:e.uid,readyState:e.readyState,aliasAssigned:!!e.aliasAssigned,ownerId:Q})):[],[J,T,Q]);(0,p.useDeploymentsStatusPing)(Z,K);let ee=!!G.data,et=ee&&0===J.length,ei=ee&&G.data&&G.size>G.data.length,en=ee&&G.data&&G.data[G.data.length-1]?.deployments.length<g;return[G,{deployments:J,initialDataLoaded:ee,isEmpty:et,loadMore:()=>G.setSize(e=>e+1),isLoadingMore:ei,isReachingEnd:en,mutate:G.mutate}]}function x(e){let{limit:t,projectId:o,project:s,from:d,target:c,users:u=[],...m}=e,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"v6",{isReady:g,team:x}=(0,r.useTeam)(),f=u.length>0?u.map(e=>e.uid).join(","):null,b=!!o||!!s?.id;return(0,i.default)(g&&b&&t>0?`${(0,a.API_DEPLOYMENTS)(p)}${(0,n.encode)({projectId:o||s?.id,limit:t,from:d||null,teamId:x?.id,target:c,users:f,...m})}`:null,e=>(0,l.fetchAPI)(e,{throwOnHTTPError:!0}),h)}e.s(["default",()=>x,"useDeploymentsInfinite",()=>g],5771992)},415061,e=>{"use strict";var t=e.i(6468255);function i(e){let{width:i=24,height:n=24,style:l}=e;return(0,t.jsxs)("svg",{fill:"none",height:n,style:{border:"1px solid var(--accents-2)",borderRadius:"100%",boxSizing:"border-box",...l},viewBox:"0 0 24 24",width:i,children:[(0,t.jsx)("path",{clipRule:"evenodd",d:"M12 24c6.627 0 12-5.373 12-12S18.627 0 12 0 0 5.373 0 12s5.373 12 12 12z",fill:"#000",fillRule:"evenodd"}),(0,t.jsx)("path",{clipRule:"evenodd",d:"M12.24 6.24L18 16.378H6.48L12.24 6.24z",fill:"#fff",fillRule:"evenodd"})]})}e.s(["default",()=>i])},8651268,e=>{"use strict";var t=e.i(6468255),i=e.i(415061),n=e.i(4585051),l=e.i(76079),a=e.i(3025777),r=e.i(3896588),o=e.i(6683690);let s={12:-6},d={12:-5};function c(e){var u,m,h,p,g,x,f;let b,y,j,v,k,{title:S,principalId:A,principal:C,viaIds:T,via:I,size:R=32,style:w,entities:D,deploymentMeta:P,viewerId:M,iconBackground:L,...N}=e,O=!1,E=N.iconSize??(0==(b=(u=R/2.2)%2)?u:u+2-b);D?.forEach(e=>{"system"===e.type?O=!0:"github_login"===e.type?y=e:"gitlab_login"===e.type?j=e:"bitbucket_login"===e.type&&(v=e)}),P&&(P.githubCommitAuthorLogin?y={login:P.githubCommitAuthorLogin}:P.gitlabCommitAuthorLogin?j={login:P.gitlabCommitAuthorLogin,avatar:P.gitlabCommitAuthorAvatar}:P.bitbucketCommitAuthorName&&(v={login:P.bitbucketCommitAuthorName,avatar:P.bitbucketCommitAuthorAvatar}));let $="object"==typeof N.showProviderIcon?N.showProviderIcon:{github:N.showProviderIcon,gitlab:N.showProviderIcon,bitbucket:N.showProviderIcon};if(m=A,h=C,h?.type==="app"||m.startsWith("cl_")||(p=A,g=C,g?.type==="integration"||p.startsWith("oac_"))){let e=C&&"name"in C?C.name:void 0;return(0,t.jsx)(n.Avatar,{hash:C?.avatar,size:R,style:w,title:S??(e?`${e} Avatar`:void 0),uid:A})}if(O||(x=A,f=C,f?.type==="system"||"system"===x))return(0,t.jsx)(i.default,{height:R,style:{marginTop:"2px",...w??{}},width:R});let _=S;A===M?(k="You",_??="Your Avatar"):C&&"username"in C&&(k=C.username,_??=`${k} Avatar`);let B=function(e,t){let i=e?.[0],n=t?.[0];if(!i){if(!n)return;switch(n.type){case"app":i=n.clientId;break;case"integration":i=n.id;break;case"system":i="system";break;default:i=n.uid}}return[i,n]}(T,I);return B?(0,t.jsx)(l.AvatarWithIcon,{hash:C?.avatar,size:R,style:w,title:_,uid:A,iconBackground:L,left:d[E],icon:(0,t.jsx)(c,{principalId:B[0],principal:B[1],size:E+4})}):y?.login?(0,t.jsx)(a.GitHubAvatar,{iconBackground:L,size:R,iconSize:E,left:s[E],bottom:s[E],style:w,title:S??`github/${y.login}`,username:y.login,showIcon:$.github}):j?.login?(0,t.jsx)(r.GitLabAvatar,{hash:j.avatar?void 0:C?.avatar,iconBackground:L,size:R,iconSize:E,style:w,title:S,url:j.avatar,showIcon:$.gitlab}):v?.login?(0,t.jsx)(o.BitbucketAvatar,{hash:v.avatar?void 0:C?.avatar,iconBackground:L,size:R,iconSize:E,style:w,title:S,url:v.avatar,showIcon:$.bitbucket}):(0,t.jsx)(n.Avatar,{hash:C?.avatar,size:R,style:w,title:_,uid:A})}function u(e){let t,{principalId:i,principal:n,viaIds:l,via:a,viewerId:r,includeVia:o}=e;if(n)switch(n.type){case"app":case"integration":t=n.name;break;case"system":t="System";break;default:if(n.uid===r){t="You";break}t=n.username}if(i&&i===r&&(t="You"),t&&o){let e=m({viaIds:l,via:a,viewerId:r});e&&(t+=`via ${e}`)}return t}function m(e){let{viaIds:t,via:i,viewerId:n}=e;if(t&&t.length>0)return u({principalId:t[0],principal:i?.[0],viewerId:n})}e.s(["PrincipalAvatar",()=>c,"getPrincipalName",()=>u,"getViaName",()=>m])},2982888,e=>{"use strict";var t=e.i(6468255),i=e.i(4585051),n=e.i(415061),l=e.i(8651268);function a(e){let{deployment:i,size:n=24,showIcon:l=!0,iconBackground:a=!0}=e;return(0,t.jsx)("span",{style:{display:"inline-block"},children:(0,t.jsx)(o,{deployment:i,iconBackground:a,showIcon:l,size:n})})}function r(e){let{deployment:t}=e;if(!t)return null;if(!t.meta?.originalDeploymentId){if(t.meta?.githubDeployment&&"string"==typeof t.meta.githubCommitAuthorLogin)return t.meta.githubCommitAuthorLogin;if(t.meta?.gitlabDeployment&&"string"==typeof t.meta.gitlabCommitAuthorLogin)return t.meta.gitlabCommitAuthorLogin;if(t.meta?.bitbucketDeployment){if("string"==typeof t.meta.bitbucketCommitAuthorLogin)return t.meta.bitbucketCommitAuthorLogin;if("string"==typeof t.meta.bitbucketCommitAuthorName)return t.meta.bitbucketCommitAuthorName}}return t.creator?.username||null}function o(e){let{deployment:n,showIcon:a,iconBackground:r,size:o}=e;return n?(0,t.jsx)(l.PrincipalAvatar,{size:o,principalId:n.creator.uid,principal:{type:"user",uid:n.creator.uid,username:n.creator.username},deploymentMeta:n.meta?.originalDeploymentId?void 0:n.meta,showProviderIcon:a,iconBackground:r}):(0,t.jsx)(i.Avatar,{placeholder:!0,size:o})}function s(e){let{height:i,width:l}=e;return(0,t.jsx)("div",{className:"flex items-center justify-center",children:(0,t.jsx)(n.default,{height:i,width:l})})}e.s(["DeployHookAvatar",()=>s,"DeploymentCreatorAvatar",()=>a,"getDeploymentCreatorUsername",()=>r])},4896636,e=>{"use strict";var t=e.i(3911483),i=e.i(8042625),n=e.i(277234),l=e.i(4244280),a=e.i(5338940);e.s(["default",0,(e,r)=>{let{domain:o,filterDeleted:s=!0}=e,{isReady:d,team:c}=(0,a.useTeam)();return(0,t.default)(()=>o&&d?`${l.API_ALIASES}/${encodeURIComponent(o)}${(0,i.encode)({filterDeleted:s,teamId:c?.id})}`:null,e=>(0,n.fetchAPI)(e,{throwOnHTTPError:!0}),r)}])},2405448,e=>{"use strict";var t=e.i(542164);function i(e){return(0,t.default)(e)?e.slice(2):e}e.s(["default",()=>i])},9719784,e=>{"use strict";var t=e.i(6468255),i=e.i(6696646),n=e.i(57106),l=e.i(822157),a=e.i(7018452),r=e.i(2405448),o=e.i(542164),s=e.i(1681029),d=e.i(4478191);let c=(0,i.memo)(function(e){let{url:c,truncate:u,defaultRoute:m,...h}=e,[p,g]=(0,a.default)("#wildcard"),[x,f]=(0,i.useState)(null),[b,y]=(0,i.useState)(!1),j=(0,i.useCallback)(()=>{f((0,r.default)(c)),g(!0)},[f,g,c]);return c?(0,o.default)(c)?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.Link,{className:"pt-px leading-[16px] hover:underline",onClick:j,...h,onMouseEnter:()=>y(!0),style:{minWidth:0,maxWidth:u?"100%":void 0},children:u?(0,t.jsx)("span",{className:"geist-ellipsis",children:c}):c}),b||p?(0,t.jsx)(l.default,{active:p,onCancel:()=>{g(!1)},url:x}):null]}):(0,t.jsx)(n.Link,{className:"pt-px leading-[16px] hover:underline",external:!0,href:(0,d.withDefaultRoute)((0,s.domainToUrl)(c),m),...h,style:{minWidth:0,maxWidth:u?"100%":void 0},children:u?(0,t.jsx)("span",{className:"geist-ellipsis",children:c}):c}):null});e.s(["default",0,c])},822157,e=>{"use strict";var t=e.i(6468255),i=e.i(6696646),n=e.i(9177216),l=e.i(3500331),a=e.i(6891161),r=e.i(9318197),o=e.i(1681029);let s=(0,i.memo)(e=>{let{active:s,url:d,onCancel:c}=e,[u,m]=(0,i.useState)(""),h=(0,i.useMemo)(()=>!u||u.includes(".")||!(0,n.isValid)(`${u}.${d}`),[u,d]),p=(0,i.useCallback)(()=>{m(""),c()},[c]),g=(0,i.useCallback)(e=>{e.preventDefault(),window.open((0,o.domainToUrl)(`${u}.${d}`),"_blank","noopener"),p()},[u,d,p]);return d?(0,t.jsx)(a.Modal,{active:s,onClickOutside:p,children:(0,t.jsxs)("form",{onSubmit:g,children:[(0,t.jsxs)(a.Modal.Body,{children:[(0,t.jsx)(a.Modal.Title,{children:"Wildcard Domain"}),(0,t.jsx)(r.Spacer,{}),(0,t.jsx)(a.Modal.Subtitle,{children:"Enter a subdomain to visit below."}),(0,t.jsx)(r.Spacer,{y:.75}),(0,t.jsx)(l.Input,{autoFocus:!0,id:"hostname",label:"Hostname",onChange:e=>m(e.target.value),suffix:`.${d}`,value:u})]}),(0,t.jsxs)(a.Modal.Actions,{children:[(0,t.jsx)(a.Modal.Action,{onClick:c,children:"Cancel"}),(0,t.jsx)(a.Modal.Action,{buttonType:"submit",disabled:h,children:"Visit"})]})]})}):null});e.s(["default",0,s])},5229375,e=>{"use strict";var t=e.i(6696646),i=e.i(3911483),n=e.i(8815282),l=e.i(818351),a=e.i(8042625),r=e.i(277234),o=e.i(4244280),s=e.i(5338940);function d(e,t){let{deploymentId:i,teamId:n}=e;return(0,l.useIsomorphicSWR)(i?function(e){let{deploymentId:t,teamId:i}=e;return`${(0,o.API_DEPLOYMENTS)("v2")}/${t}/aliases${(0,a.encode)({teamId:i})}`}({deploymentId:i,teamId:n}):null,t)}function c(e,t){return(0,i.default)(()=>{if(!e)return null;let{team:t,id:i,teamId:n}=e;return`${(0,o.API_DEPLOYMENTS)("v2")}/${i}/aliases${(0,a.encode)({teamId:n??(t?t.id:null)})}`},e=>(0,r.fetchAPI)(e,{throwOnHTTPError:!0}),t)}function u(e,i){let{limit:l=20,domains:a,rollbackDeploymentId:d}=e,{isReady:c,team:u}=(0,s.useTeam)(),h=(0,n.default)((e,t)=>{if(!c)return null;let i=`${o.API_ALIASES}`,n=a?.map(e=>`domain=${encodeURIComponent(e)}`).join("&")||null;if(!e)return`${i}${m({limit:l+1,teamId:u?.id,rollbackDeploymentId:d},n)}`;let r=t?.aliases&&t.aliases.length>l?t.aliases[l-1].createdAt:null;return r?`${i}${m({limit:l+1,teamId:u?.id,until:r},n)}`:null},e=>(0,r.fetchAPI)(e,{throwOnHTTPError:!0}),i),p=(0,t.useMemo)(()=>h.data?[].concat(...h.data.filter(Boolean).map(e=>e.aliases.slice(0,l))):[],[h.data,l]),g=!!h.data&&!h.error,x=!!(h.data&&0===p.length),f=!!(h.data&&h.size>h.data.length),b=!!(h.data&&h.data[h.data.length-1]?.aliases.length<=l);return[h,{aliases:p,initialDataLoaded:g,isEmpty:x,loadMore:()=>h.setSize(e=>e+1),isLoadingMore:f,isReachingEnd:b}]}function m(e,t){let i=(0,a.encode)(e,!1),n=t?`&${t}`:"";return i?`?${i}${n}`:`?${n}`}e.s(["useAliases",()=>c,"useAliasesInfinite",()=>u,"useAliasesV2",()=>d],5229375)},663807,e=>{"use strict";let t=/^xn--/,i=/[^\0-\x7F]/,n=/[\x2E\u3002\uFF0E\uFF61]/g,l={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},a=Math.floor,r=String.fromCharCode;function o(e){throw RangeError(l[e])}function s(e,t){let i=e.split("@"),l="";return i.length>1&&(l=i[0]+"@",e=i[1]),l+(function(e,t){let i=[],n=e.length;for(;n--;)i[n]=t(e[n]);return i})((e=e.replace(n,".")).split("."),t).join(".")}function d(e){let t=[],i=0,n=e.length;for(;i<n;){let l=e.charCodeAt(i++);if(l>=55296&&l<=56319&&i<n){let n=e.charCodeAt(i++);(64512&n)==56320?t.push(((1023&l)<<10)+(1023&n)+65536):(t.push(l),i--)}else t.push(l)}return t}let c=e=>String.fromCodePoint(...e),u=function(e,t){return e+22+75*(e<26)-((0!=t)<<5)},m=function(e,t,i){let n=0;for(e=i?a(e/700):e>>1,e+=a(e/t);e>455;n+=36)e=a(e/35);return a(n+36*e/(e+38))},h=function(e){let t=[],i=e.length,n=0,l=128,r=72,s=e.lastIndexOf("-");s<0&&(s=0);for(let i=0;i<s;++i)e.charCodeAt(i)>=128&&o("not-basic"),t.push(e.charCodeAt(i));for(let c=s>0?s+1:0;c<i;){let s=n;for(let t=1,l=36;;l+=36){var d;c>=i&&o("invalid-input");let s=(d=e.charCodeAt(c++))>=48&&d<58?26+(d-48):d>=65&&d<91?d-65:d>=97&&d<123?d-97:36;s>=36&&o("invalid-input"),s>a((0x7fffffff-n)/t)&&o("overflow"),n+=s*t;let u=l<=r?1:l>=r+26?26:l-r;if(s<u)break;let m=36-u;t>a(0x7fffffff/m)&&o("overflow"),t*=m}let u=t.length+1;r=m(n-s,u,0==s),a(n/u)>0x7fffffff-l&&o("overflow"),l+=a(n/u),n%=u,t.splice(n++,0,l)}return String.fromCodePoint(...t)},p=function(e){let t=[],i=(e=d(e)).length,n=128,l=0,s=72;for(let i of e)i<128&&t.push(r(i));let c=t.length,h=c;for(c&&t.push("-");h<i;){let i=0x7fffffff;for(let t of e)t>=n&&t<i&&(i=t);let d=h+1;for(let p of(i-n>a((0x7fffffff-l)/d)&&o("overflow"),l+=(i-n)*d,n=i,e))if(p<n&&++l>0x7fffffff&&o("overflow"),p===n){let e=l;for(let i=36;;i+=36){let n=i<=s?1:i>=s+26?26:i-s;if(e<n)break;let l=e-n,o=36-n;t.push(r(u(n+l%o,0))),e=a(l/o)}t.push(r(u(e,0))),s=m(l,d,h===c),l=0,++h}++l,++n}return t.join("")},g=function(e){return s(e,function(e){return t.test(e)?h(e.slice(4).toLowerCase()):e})},x=function(e){return s(e,function(e){return i.test(e)?"xn--"+p(e):e})};e.s(["decode",()=>h,"default",0,{version:"2.3.1",ucs2:{decode:d,encode:c},decode:h,encode:p,toASCII:x,toUnicode:g},"encode",()=>p,"toASCII",()=>x,"toUnicode",()=>g,"ucs2decode",()=>d,"ucs2encode",()=>c])},9177216,(e,t,i)=>{"use strict";var n=e.r(663807),l={};l.rules=e.r(8765996).map(function(e){return{rule:e,suffix:e.replace(/^(\*\.|\!)/,""),punySuffix:-1,wildcard:"*"===e.charAt(0),exception:"!"===e.charAt(0)}}),l.endsWith=function(e,t){return -1!==e.indexOf(t,e.length-t.length)},l.findRule=function(e){var t=n.toASCII(e);return l.rules.reduce(function(e,i){return(-1===i.punySuffix&&(i.punySuffix=n.toASCII(i.suffix)),l.endsWith(t,"."+i.punySuffix)||t===i.punySuffix)?i:e},null)},i.errorCodes={DOMAIN_TOO_SHORT:"Domain name too short.",DOMAIN_TOO_LONG:"Domain name too long. It should be no more than 255 chars.",LABEL_STARTS_WITH_DASH:"Domain name label can not start with a dash.",LABEL_ENDS_WITH_DASH:"Domain name label can not end with a dash.",LABEL_TOO_LONG:"Domain name label should be at most 63 chars long.",LABEL_TOO_SHORT:"Domain name label should be at least 1 character long.",LABEL_INVALID_CHARS:"Domain name label can only contain alphanumeric characters or dashes."},l.validate=function(e){var t,i=n.toASCII(e);if(i.length<1)return"DOMAIN_TOO_SHORT";if(i.length>255)return"DOMAIN_TOO_LONG";for(var l=i.split("."),a=0;a<l.length;++a){if(!(t=l[a]).length)return"LABEL_TOO_SHORT";if(t.length>63)return"LABEL_TOO_LONG";if("-"===t.charAt(0))return"LABEL_STARTS_WITH_DASH";if("-"===t.charAt(t.length-1))return"LABEL_ENDS_WITH_DASH";if(!/^[a-z0-9\-]+$/.test(t))return"LABEL_INVALID_CHARS"}},i.parse=function(e){if("string"!=typeof e)throw TypeError("Domain name must be a string.");var t=e.slice(0).toLowerCase();"."===t.charAt(t.length-1)&&(t=t.slice(0,t.length-1));var a=l.validate(t);if(a)return{input:e,error:{message:i.errorCodes[a],code:a}};var r={input:e,tld:null,sld:null,domain:null,subdomain:null,listed:!1},o=t.split(".");if("local"===o[o.length-1])return r;var s=function(){return/xn--/.test(t)&&(r.domain&&(r.domain=n.toASCII(r.domain)),r.subdomain&&(r.subdomain=n.toASCII(r.subdomain))),r},d=l.findRule(t);if(!d)return o.length<2?r:(r.tld=o.pop(),r.sld=o.pop(),r.domain=[r.sld,r.tld].join("."),o.length&&(r.subdomain=o.pop()),s());r.listed=!0;var c=d.suffix.split("."),u=o.slice(0,o.length-c.length);return d.exception&&u.push(c.shift()),r.tld=c.join("."),u.length&&(d.wildcard&&(c.unshift(u.pop()),r.tld=c.join(".")),u.length&&(r.sld=u.pop(),r.domain=[r.sld,r.tld].join("."),u.length&&(r.subdomain=u.join(".")))),s()},i.get=function(e){return e&&i.parse(e).domain||null},i.isValid=function(e){var t=i.parse(e);return!!(t.domain&&t.listed)}},7018452,e=>{"use strict";var t=e.i(6696646);function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",[i,n]=(0,t.useState)(!1),l=window.location.hash,a=e.startsWith("#")?e:`#${e}`;return(0,t.useEffect)(()=>{let e=()=>{window.location.hash!==a||i||n(!0)};return window.addEventListener("hashchange",e),()=>{window.removeEventListener("hashchange",e)}},[i,a]),l!==a||i||(n(!0),window.history.replaceState(null,""," ")),l!==a&&i&&(window.location.hash=a),[i,n]}e.s(["default",()=>i])},3981247,e=>{"use strict";var t=e.i(3911483),i=e.i(2547843);function n(e){let{teamIdOrSlug:t,projectSlug:i}=e;return l({teamIdOrSlug:t,projectSlug:i},{suspense:!0,revalidateOnMount:!1})}function l(e,n){let{teamIdOrSlug:l,projectSlug:a}=e,r=!l||!a,o=(0,t.default)(()=>r?null:(0,i.getRollingReleaseEndpoint)(l,a),i.rollingReleaseFetcher,n);return{...o,skipped:r,isLoading:!r&&o.isLoading}}e.s(["useRollingRelease",()=>l,"useSuspenseRollingRelease",()=>n])},4443312,e=>{"use strict";var t=e.i(4603164),i=e.i(5338940);function n(e){let{deploymentId:n,swrOptions:l,enableCiChecksAndPolicies:a}=e,{team:r}=(0,i.useTeam)();return(0,t.useTypedSWR)("/v2/deployments/{deploymentId}/check-runs",a&&n&&r?.id?{deploymentId:n,teamId:r.id}:null,{refreshInterval:3e3,...l})}e.s(["CHECK_RUNS_REFRESH_INTERVAL",0,3e3,"useProjectCheckRuns",()=>n])},8529990,e=>{"use strict";let t=encodeURIComponent;function i(e){return"string"==typeof e?e:void 0}function n(e){if(!e)return null;let{meta:n}=e;if(n?.githubDeployment){let e=`https://github.com/${t(n.githubCommitOrg??"")}/${t(n.githubCommitRepo??"")}/commit/${n.githubCommitSha}`,l=`https://github.com/${t(n.githubCommitOrg??"")}/${t(n.githubCommitRepo??"")}/tree/${t(n.githubCommitRef??"")}`,a=n.githubPrId?`https://github.com/${t(n.githubOrg??"")}/${t(n.githubRepo??"")}/pull/${n.githubPrId}`:void 0;return{type:"github",commitRef:String(n.githubCommitRef),commitSha:String(n.githubCommitSha),commitAuthorName:String(n.githubCommitAuthorName),commitAuthorLogin:i(n.githubCommitAuthorLogin),commitMessage:String(n.githubCommitMessage),repoName:String(n.githubCommitRepo),repoNamespace:String(n.githubCommitOrg),orgNamespace:String(n.githubOrg),commitUrl:e,refUrl:l,viaFork:n.githubOrg!==n.githubCommitOrg,prId:n.githubPrId?Number(n.githubPrId):void 0,prUrl:a,gitDirty:String(n.gitDirty),isPublic:"public"===n.githubRepoVisibility}}if(n?.gitlabDeployment){let e=`https://gitlab.com/${n.gitlabProjectPath}/tree/${t(n.gitlabCommitRef??"")}`,l=`https://gitlab.com/${n.gitlabProjectPath}/commit/${n.gitlabCommitSha}`;return{type:"gitlab",commitRef:String(n.gitlabCommitRef),commitSha:String(n.gitlabCommitSha),commitAuthorName:String(n.gitlabCommitAuthorName),commitAuthorLogin:i(n.gitlabCommitAuthorLogin),commitMessage:String(n.gitlabCommitMessage||n.gitCommitMessage),repoName:String(n.gitlabProjectName),repoNamespace:String(n.gitlabProjectNamespace),orgNamespace:String(n.gitlabProjectNamespace),commitUrl:l,refUrl:e,isPublic:"public"===n.gitlabProjectVisibility}}if(n?.bitbucketDeployment){let e=`https://bitbucket.org/${n.bitbucketRepoOwner}/${n.bitbucketRepoSlug}/branch/${t(n.bitbucketCommitRef??"")}`,l=`https://bitbucket.org/${n.bitbucketRepoOwner}/${n.bitbucketRepoSlug}/commits/${n.bitbucketCommitSha}`;return{type:"bitbucket",commitRef:String(n.bitbucketCommitRef),commitSha:String(n.bitbucketCommitSha),commitAuthorName:i(n.bitbucketCommitAuthorName),commitAuthorLogin:i(n.bitbucketCommitAuthorLogin),commitMessage:String(n.bitbucketCommitMessage),repoName:String(n.bitbucketRepoSlug),repoNamespace:String(n.bitbucketRepoOwner),orgNamespace:String(n.bitbucketRepoOwner),commitUrl:l,refUrl:e,isPublic:"public"===n.bitbucketRepoVisibility}}return null}e.s(["getGitInfoFromDeployment",()=>n])},3907048,e=>{"use strict";var t=e.i(6468255),i=e.i(4585051),n=e.i(6696646),l=e.i(2982888),a=e.i(8651268);let r=(0,n.memo)(e=>{let{deployment:n,size:r=24,showProviderIcon:o=!1}=e;return n.meta?.deployHookId?(0,t.jsx)(l.DeployHookAvatar,{height:r,width:r}):n.creator?.uid?(0,t.jsx)(a.PrincipalAvatar,{size:r,principalId:n.creator.uid,principal:{type:"user",uid:n.creator.uid,username:n.creator.username},deploymentMeta:n.meta?.originalDeploymentId?void 0:n.meta,showProviderIcon:{github:!1,gitlab:o,bitbucket:o}}):(0,t.jsx)(i.Avatar,{size:r})});r.displayName="CreatorAvatar",e.s(["CreatorAvatar",0,r])},8227242,e=>{"use strict";var t=e.i(6468255);e.i(9623499);var i=e.i(5576066);function n(e){let n,{text:l}=e;return(0,t.jsx)("span",{children:(n=/(?<temp1>https?:\/\/[^\s]+)/g,l.split(n).map(e=>n.test(e)?(0,t.jsx)(i.Link,{className:"break-all font-normal",href:e,rel:"noopener noreferrer",target:"_blank",type:"blend",children:e},e):(0,t.jsx)("span",{children:e},e)))})}e.s(["LinkParser",()=>n])},930810,9745887,e=>{"use strict";var t=e.i(6468255),i=e.i(1344973),n=e.i(2504781),l=e.i(9334091),a=e.i(3306538),r=e.i(9508212),o=e.i(57106),s=e.i(3753138),d=e.i(6226725),c=e.i(4345845),u=e.i(8893913),m=e.i(7218483),h=e.i(9722978),p=e.i(9375869),g=e.i(8529990),x=e.i(3907048);function f(e){let{isForm:i,children:n,className:l}=e;return i?(0,t.jsx)("label",{className:l,children:n}):(0,t.jsx)("div",{className:l,children:n})}function b(e){let{deployment:n,isForm:l,isPromote:b,isPreviousDeployment:y,isProductionDeployment:j,isRolledBackDeployment:v,selectedDeployment:k,setSelectedDeployment:S,ariaLabel:A="Rollback Deployment"}=e,C=(0,m.useAgo)(n.createdAt||0),T="number"==typeof n.aliasAssigned?n.aliasAssigned:0,I=T>0,R=(0,m.useAgo)(T),w=(0,p.useDeploymentLink)(n),D=(0,g.getGitInfoFromDeployment)(n),P=j||y||v;y&&v&&(y=!1);let M="Preview";if("target"in n)switch(n.target){case"staging":M="Staging";break;case"production":M="Production";break;default:M="Preview"}else M="Production";let L="uid"in n?n.uid:n.id,N=null;b?D?.commitRef&&(N=(0,t.jsxs)(r.Stack,{align:"center",direction:"row",gap:.5,children:[(0,t.jsx)(c.GitBranch,{color:"gray-900"}),(0,t.jsx)(i.Text,{as:"span",color:"gray-900",monospace:!0,style:{marginRight:"4px",maxWidth:120,textOverflow:"ellipsis",overflowX:"hidden",minWidth:0},title:D.commitRef,truncate:!0,wrap:!1,children:D.commitRef}),(0,t.jsxs)(i.Text,{as:"span",className:"flex items-center gap-1",color:"gray-900",style:{flexBasis:"50%",flexShrink:0,flexGrow:1,textOverflow:"ellipsis",overflowX:"hidden",minWidth:0,maxWidth:260},truncate:!0,wrap:!1,children:["Staged"," ",C," by"," ",(0,t.jsx)("span",{children:(0,t.jsx)(x.CreatorAvatar,{deployment:n,showProviderIcon:!0,size:24})}),(0,t.jsx)("span",{children:!n.meta?.originalDeploymentId&&n.creator?.username?n.creator.username:D.commitAuthorLogin})]})]})):N=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"inline-flex flex-row items-center",children:[(0,t.jsx)(i.Text,{as:"span",color:"gray-900",size:14,style:{marginRight:"4px"},children:M}),D?.commitRef?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.GitBranch,{color:"gray-900",size:14}),(0,t.jsx)(i.Text,{as:"span",className:"max-w-[100px] truncate whitespace-nowrap px-1 text-center text-sm leading-5 text-gray-900",monospace:!0,title:D.commitRef,children:D.commitRef}),(0,t.jsx)(i.Text,{as:"span",color:"gray-900",children:"by"}),(0,t.jsxs)("div",{className:"ml-1 inline-flex flex-row items-center gap-1",children:[(0,t.jsx)(x.CreatorAvatar,{deployment:n,size:20}),(0,t.jsx)(i.Text,{as:"span",className:"max-w-[140px] truncate",color:"gray-900",truncate:!0,children:!n.meta?.originalDeploymentId&&n.creator?.username?`${n.creator.username}`:D.commitAuthorLogin})]})]}):null]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)(i.Text,{as:"span",color:"gray-900",size:14,children:["Deployed"," "]}),(0,t.jsx)(i.Text,{as:"span",color:"gray-900",size:14,children:C}),(0,t.jsxs)(i.Text,{as:"span",color:"gray-900",size:14,children:[","," "]}),I?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(i.Text,{as:"span",color:"gray-900",size:14,children:["promoted"," "]}),(0,t.jsx)(i.Text,{as:"span",color:"gray-900",size:14,children:R})]}):(0,t.jsx)(i.Text,{as:"span",color:"gray-900",size:14,children:"never promoted"})]})]});let O=null;return l||(O=b?(0,t.jsx)(s.ArrowCircleUp,{className:"mr-4 hidden self-center sm:block",style:{flexShrink:0}}):j?(0,t.jsx)(d.CrossCircle,{className:"mr-4 hidden self-center sm:block",style:{flexShrink:0}}):(0,t.jsx)(u.RotateCounterClockwise,{className:"mr-4 hidden self-center sm:block",color:"gray-1000",style:{flexShrink:0}})),(0,t.jsxs)(f,{className:(0,h.clsx)("flex w-full items-end justify-start px-4 py-3","rounded border border-solid border-[var(--accents-2)]","rounded-b-none","last:rounded-b","[&+&]:rounded-t-none [&+&]:border-t-0",{"bg-[var(--accents-1)] shadow-none":j,"bg-[var(--geist-background)]":!j}),isForm:l,children:[l?(0,t.jsx)("input",{"aria-label":A,checked:k?.uid===L,className:`
            relative m-0 mr-4 size-4 shrink-0 appearance-none
            self-center rounded-[1000px] border
            border-solid border-[var(--geist-foreground)] after:absolute after:inset-[3px]
            after:rounded-[1000px] after:bg-[var(--geist-foreground)]
            after:content-none checked:after:content-['']
          `,name:"rollbackDeployment",onChange:()=>{"uid"in n&&"type"in n&&S&&S(n)},type:"radio",value:L}):O,(0,t.jsxs)("div",{style:{width:P?"initial":"100%",minWidth:0},children:[(0,t.jsx)(o.Link,{className:"flex w-[calc(100%-1ch)] items-center gap-0.5 break-all text-sm font-bold leading-5",href:w,target:"_blank",children:(0,t.jsx)(i.Text,{as:"span",title:n.url,truncate:1,weight:500,children:n.url})}),D?.commitMessage?(0,t.jsxs)(i.Text,{as:"p",className:"break-words",color:"gray-900",size:14,title:D.commitMessage,truncate:1,children:[D.commitSha.substring(0,7)," ",D.commitMessage]}):null,N]}),j?(0,t.jsx)(a.Badge,{className:"ml-auto hidden self-start text-xs font-medium sm:inline-flex",variant:"inverted",children:"Current"}):null,y?(0,t.jsx)(a.Badge,{className:"ml-auto hidden self-start text-xs font-medium sm:inline-flex",variant:"gray-subtle",children:"Previous"}):null,v?(0,t.jsx)(a.Badge,{className:"ml-auto hidden self-start text-xs font-medium sm:inline-flex",variant:"red-subtle",children:"Rolled back"}):null]})}e.s(["DeploymentCardSmall",()=>b],9745887);var y=e.i(8227242),j=e.i(8651268);function v(e){return"id"in e?e.id:"uid"in e?e.uid:void 0}function k(e){return void 0!==e.deleted}function S(e){let{rollbackDescription:n,project:l,preview:a}=e,r=(0,m.useAgo)(n.createdAt);return(0,t.jsxs)("div",{className:"px-4 py-3 rounded bg-background-200 shadow-border",children:[(0,t.jsx)(i.Text,{className:"break-words",color:"gray-900",children:n.description.length>0?(0,t.jsxs)(t.Fragment,{children:["“",(0,t.jsx)(y.LinkParser,{text:n.description}),"”"]}):(0,t.jsx)(i.Text,{children:"No reason provided."})}),(0,t.jsxs)("div",{className:"flex gap-1 pt-1",children:[a?null:(0,t.jsx)(i.Text,{children:"Rolled back by"}),n.username?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.PrincipalAvatar,{size:20,principalId:n.userId,principal:{type:"user",uid:n.userId,username:n.username}}),(0,t.jsx)(i.Text,{children:n.username}),l?.lastAliasRequest!==void 0&&!a&&(0,t.jsx)(i.Text,{children:r})]}):null]})]})}function A(e){let{deployments:i,previousDeployment:l,rolledBackDeploymentId:a,productionDeployment:r,selectedDeployment:o,setSelectedDeployment:s,swr:d,ariaLabel:c}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:i.map(e=>r.id!==e.uid&&(0,t.jsx)(b,{deployment:e,isForm:!0,isPreviousDeployment:l?.uid===e.uid,isRolledBackDeployment:a===e.uid,selectedDeployment:o,setSelectedDeployment:s,ariaLabel:c},e.uid))}),!d.isReachingEnd&&(0,t.jsx)(n.Button,{loading:d.isLoadingMore,onClick:()=>{d.loadMore()},style:{marginTop:24},type:"secondary",width:"100%",children:"Show More"})]})}function C(e){if(0===e.length)return;let t=e.reduce((e,t)=>e.aliasAssigned&&t.aliasAssigned?e.aliasAssigned>t.aliasAssigned?e:t:t.aliasAssigned?t:e);if(t.aliasAssigned)return t}function T(e){let{value:i,onChange:n,id:a}=e;return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(l.Textarea,{autoFocus:!0,className:"text-base min-h-24",error:i.length>=250?"Reason cannot be longer than 250 characters.":void 0,id:a,onChange:e=>n(e.target.value),placeholder:"Production is not behaving as expected…",required:!0,value:i,style:{fontSize:14}})})}e.s(["ChooseDeploymentList",()=>A,"REASON_MAX_CHARACTER_LENGTH",0,250,"RollbackDescriptionCard",()=>S,"RollbackDescriptionTextarea",()=>T,"getDeploymentId",()=>v,"getMostRecentlyPromotedDeployment",()=>C,"isDeleted",()=>k],930810)},6619197,5645345,e=>{"use strict";var t=e.i(6468255),i=e.i(6696646),n=e.i(8248823),l=e.i(9100551),a=e.i(57106),r=e.i(3869281),o=e.i(4030453),s=e.i(2455417),d=e.i(6891161),c=e.i(8522580),u=e.i(5255926),m=e.i(9318197),h=e.i(9508212),p=e.i(1344973),g=e.i(455575),x=e.i(8761240),f=e.i(472117),b=e.i(4004502),y=e.i(8042625),j=e.i(277234),v=e.i(4244280),k=e.i(4443312),S=e.i(5140444),A=e.i(5338940),C=e.i(4614946),T=e.i(4450569),I=e.i(4396019),R=e.i(9375869),w=e.i(8518548);function D(e){if(!e)return;if("id"in e==!1)return e;let{aliasAssigned:t,aliasError:i=null,aliasAssignedAt:n,buildingAt:l,created:a=e.createdAt,createdAt:r,creator:o,name:s,ready:d,readyState:c,readySubstate:u,target:m=null,uid:h=e.id,url:p,isRollbackCandidate:g="production"===e.target}=e;return{aliasAssigned:t,aliasError:i,aliasAssignedAt:n,buildingAt:l,created:a,createdAt:r,creator:{email:"",githubLogin:"",...o},name:s,ready:d,readyState:c,readySubstate:u,target:m,type:"LAMBDAS",uid:h,url:p,isRollbackCandidate:g}}e.s(["asListDeployment",()=>D],5645345);var P=e.i(1840726),M=e.i(930810),L=e.i(7952834),N=e.i(1173672),O=e.i(9745887),E=e.i(3008300),$=e.i(3981247),_=e.i(6060673);function B(e){let t=e?.name,{deployment:n,isLoading:l}=(0,I.useProjectProductionDeployment)(t);return(0,i.useMemo)(()=>{let t=D(e);return t?l?"Loading…":t.uid===n?.id?"This Deployment is already in Production.":"readyState"in t&&"READY"!==t.readyState?"Only Deployments that are Ready can be promoted.":"":""},[e,l,n?.id])}function z(e){let{title:i}=e;return(0,t.jsx)(d.Modal.Header,{children:(0,t.jsx)(d.Modal.Title,{center:!0,children:i})})}function F(e){let{deploymentId:i}=e,n=(0,f.useChecksPrivateBetaFlag)(),l=(0,f.useCiChecksAndPoliciesFlagV2)(),r=n||l,{data:o,isLoading:s}=(0,k.useProjectCheckRuns)({deploymentId:i,enableCiChecksAndPolicies:r});if(!r)return null;if(s)return(0,t.jsx)(u.Skeleton,{});if(o?.runs.every(e=>"succeeded"===e.conclusion))return null;let d=o?.runs.filter(e=>"succeeded"!==e.conclusion)||[];return(0,t.jsxs)(c.Note,{type:"error",fill:!0,className:"mt-6",children:["By clicking Promote, you acknowledge that you are bypassing promotion requirements:",d.length>0&&(0,t.jsx)("ul",{className:"flex flex-col gap-1 ml-4 list-disc",children:d.slice(0,5).map(e=>(0,t.jsx)("li",{children:e.externalUrl?(0,t.jsx)(a.Link,{href:e.externalUrl,external:!0,children:e.name}):(0,t.jsx)("span",{children:e.name})},e.id||e.name||`${e.conclusion}-${e.status}`))})]})}function H(e,n){let{onDeploymentPromoted:l}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},[u,g]=(0,i.useState)(!1),[f,y]=(0,i.useState)(null),{team:j}=(0,A.useTeam)(),v=e??f?.name,{data:k}=(0,_.useProject)(v),C=n??k,R=(0,P.useShowIgnoreBuildStep)({project:C,deployment:f}),[D,L]=(0,i.useState)(E.DEFAULT_USE_IGNORE_BUILD_STEP_PROMOTE),N=(0,i.useCallback)(()=>{g(!1)},[]),{error:B,loading:H,promote:U,setError:Y,setLoading:V}=W({deployment:f,useIgnoreBuildStep:D,project:C,onCurrentDeploymentPromoted:(0,i.useCallback)(()=>{N(),l?.()},[N,l])}),{user:G}=(0,S.useUser)(),{data:q}=(0,$.useRollingRelease)({teamIdOrSlug:j?.slug,projectSlug:v}),K=C?.rollingRelease?.stages!==void 0&&C.rollingRelease.stages.length>0,X=q?.rollingRelease?.state==="ACTIVE",J=q?.rollingRelease?.canaryDeployment?.id,Q=X&&J===f?.uid,Z=K&&!X&&f?.target==="production",ee=K&&X&&f?.target==="production",et=Z&&C.rollingRelease?.stages!==void 0?C.rollingRelease.stages[0]?.targetPercentage:null,{data:ei}=(0,w.useProjectDomains)(v,{limit:11,production:"true",redirects:"false",verified:"true",order:"ASC"}),en=(0,i.useCallback)(e=>{y(e),g(!0)},[]),el=(0,i.useCallback)(()=>{V(!1),y(null),Y(void 0)},[Y,V]),{rollbackDescription:ea,deploymentIsStale:er}=(0,I.useProjectProductionDeployment)(C?.name),{andMoreDomains:eo,remainingDomains:es}=(0,i.useMemo)(()=>{if(!ei)return{andMoreDomains:!1,remainingDomains:[]};let e=ei.length>2,t=e?ei.slice(2).map(e=>e.name):[];return{andMoreDomains:e,remainingDomains:t}},[ei]),ed=(0,i.useMemo)(()=>{if(!C||!f)return(0,t.jsx)(T.default,{center:!0,style:{marginTop:10},children:(0,t.jsx)(s.LoadingDots,{size:4})});let e=!!(ei&&ei.length>0);return(0,t.jsxs)(t.Fragment,{children:["production"===f.target?(0,t.jsx)(p.Text,{as:"p",style:{marginBottom:"16px"},weight:400,children:"Deployment to promote:"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.Text,{as:"p",style:{marginBottom:"16px"},children:"A new deployment will be built using your production environment."}),(0,t.jsx)(p.Text,{as:"p",style:{marginBottom:"16px"},weight:400,children:"Deployment to promote to production:"})]}),(0,t.jsx)("div",{children:(0,t.jsx)(O.DeploymentCardSmall,{deployment:f,isPromote:!0,selectedDeployment:null})}),Z?(0,t.jsxs)(p.Text,{as:"p",style:{marginBottom:16,marginTop:24},children:["This will start a new rolling release with initial traffic of"," ",et,"%."]}):null,ee?(0,t.jsx)(p.Text,{as:"p",style:{marginBottom:16,marginTop:24},children:"This will queue the deployment for promotion after the current rolling release completes."}):null,Z||ee||!e?null:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.Text,{as:"p",style:{marginBottom:16,marginTop:24},weight:400,children:"It will be aliased to the following domains:"}),(0,t.jsx)(h.Stack,{gap:2,style:{paddingLeft:12},children:ei?.slice(0,2).map(e=>{let{name:i}=e;return(0,t.jsx)(p.Text,{as:"p",children:(0,t.jsxs)(h.Stack,{align:"center",direction:"row",gap:3,children:[(0,t.jsx)(x.CheckCircleFill,{color:"blue-700",size:20}),(0,t.jsx)("span",{children:i.startsWith("*")?i:(0,t.jsx)(a.Link,{"data-testid":(0,b.tid)("deployments","promote-to-production-overlay","preview-link"),external:!0,href:`https://${i}`,variant:"highlight",children:i})})]})},i)})}),eo?(0,t.jsxs)(p.Text,{as:"p",className:"mt-6 mb-4",children:["...and ",es.length," more"]}):null]}),!Z&&!e&&(0,t.jsxs)(p.Text,{as:"p",style:{marginBottom:"24px",marginTop:"24px"},children:["Warning: Your Project does not have a Production Domain. We recommend you"," ",(0,t.jsx)(a.Link,{href:`/${j?j.slug:G?.username}/${encodeURIComponent(C.name)}/settings/domains`,variant:"highlight",children:"add"})," ","one."]}),C.link&&f.gitSource?(0,t.jsx)(F,{deploymentId:f.id}):null,R?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.Spacer,{y:1}),(0,t.jsx)(r.Checkbox,{checked:D,fullWidth:!0,onChange:()=>{L(!D)},children:"Use project's Ignore Build Step"})]}):null,Q?(0,t.jsx)(c.Note,{className:" border border-[#fde68a] bg-[#fffbeb] text-[#bd5200] dark:border-[#411d06] dark:bg-[#241005] dark:text-[#fde68a] ",fill:!0,size:"small",style:{marginTop:24},type:"warning",variant:"contrast",children:(0,t.jsx)(h.Stack,{align:"center",direction:"row",gap:4,style:{padding:1},children:(0,t.jsx)(h.Stack,{align:"start",children:(0,t.jsx)(p.Text,{as:"p",color:"inherit",children:"This will complete the rolling release for this deployment."})})})}):null,er?(0,t.jsx)(c.Note,{className:" border border-[#fde68a] bg-[#fffbeb] text-[#bd5200] dark:border-[#411d06] dark:bg-[#241005] dark:text-[#fde68a] ",fill:!0,size:"small",style:{marginTop:24},type:"warning",variant:"contrast",children:(0,t.jsx)(h.Stack,{align:"center",direction:"row",gap:4,style:{padding:1},children:(0,t.jsx)(h.Stack,{align:"start",children:(0,t.jsx)(p.Text,{as:"p",color:"inherit",children:Z?"Completing the Rolling Release will undo the current Instant Rollback":"This action will undo the current Instant Rollback"})})})}):null,ea?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.Text,{as:"p",style:{marginBottom:16,marginTop:24},children:"Rollback Details:"}),(0,t.jsx)(M.RollbackDescriptionCard,{rollbackDescription:ea,project:C})]}):null]})},[eo,es,ei,C,j,G,f,D,R,er,ea,et,Z,ee,Q]),ec=(0,i.useMemo)(()=>(0,t.jsx)(d.Modal.Action,{"data-testid":(0,b.tid)("deployments","promote-to-production-overlay","confirm-button"),loading:H,onClick:U,children:f&&"target"in f&&"production"===f.target?"Promote":"Promote to Production"}),[U,H,f]);return{modal:(0,i.useMemo)(()=>(0,t.jsxs)(d.Modal.Modal,{active:u,"data-testid":(0,b.tid)("deployments","promote-to-production-overlay"),onAnimationDone:el,onClickOutside:N,sticky:!0,width:"500px",children:[(0,t.jsxs)(d.Modal.Body,{children:[(0,t.jsx)(z,{title:ee?"Queue for Promotion":f&&"target"in f&&"production"!==f.target?"Promote to Production":"Promote"}),ed,B?(0,t.jsx)(o.Error,{error:B}):null]}),(0,t.jsxs)(d.Modal.Actions,{children:[(0,t.jsx)(d.Modal.Action,{"data-testid":(0,b.tid)("deployments","promote-to-production-overlay","cancel-button"),loading:!1,onClick:N,type:"secondary",children:"Cancel"}),ec]})]}),[u,el,N,ed,B,ec,ee,f]),close:N,open:en}}let W=e=>{let{deployment:t,project:a,useIgnoreBuildStep:r,onCurrentDeploymentPromoted:o}=e,s=(0,g.useToasts)(),d=(0,l.useRouter)(),{team:c}=(0,A.useTeam)(),{user:u}=(0,S.useUser)(),{mutate:m}=(0,C.useSWRConfig)(),[h,p]=(0,i.useState)(!1),[x,f]=(0,i.useState)(void 0),b=(0,P.useShowIgnoreBuildStep)({project:a,deployment:t});return{promote:(0,i.useCallback)(async()=>{if(t&&a){p(!0),f(void 0);try{let e,i=c?.id,n="Promoted Deployment successfully.";if("production"===t.target)await (0,j.fetchAPI)(`${(0,v.API_DEPLOYMENT_PROMOTE)(a.id,t.uid||t.id)}${(0,y.encode)({teamId:i})}`,{method:"POST",body:{},throwOnHTTPError:!0}),e=(0,R.pathFromDeployment)(t,{user:u,team:c});else{let l=await (0,j.fetchAPI)(`${(0,v.API_DEPLOYMENTS)("v13")}${(0,y.encode)({teamId:i,skipIgnoreBuildStep:b&&!r?"1":null})}`,{method:"POST",body:JSON.stringify({deploymentId:t.uid||t.id,meta:{action:"promote"},name:a.name,target:"production"}),throwOnHTTPError:!0});e=(0,R.pathFromDeployment)(l,{user:u,team:c});let o=t.uid||t.id;n="production"===t.target?o===l.id?"Deployment is already the current Production Deployment.":"Promoted Deployment to Production successfully.":"Created Production Deployment successfully."}c&&((0,L.revalidateProject)(m,a),await m((0,N.getProjectProductionDeploymentKey)({projectIdOrName:a.id,teamId:c.slug}))),s.success({text:n,key:"production-deployment"}),e&&(e===location.pathname?o?.():d.push(e))}catch(e){f((0,n.normalizeError)(e))}finally{p(!1)}}},[t,a,d,b,c,s,r,u,m,o]),loading:h,setLoading:p,error:x,setError:f}};e.s(["default",()=>H,"usePromoteDeployment",0,W,"usePromoteTooltip",()=>B],6619197)},9365163,4904548,e=>{"use strict";var t=e.i(6468255),i=e.i(6696646),n=e.i(5338940),l=e.i(1717203),a=e.i(7557283),r=e.i(4670733),o=e.i(588428),s=e.i(4396019),d=e.i(762945),c=e.i(7749291),u=e.i(9508212),m=e.i(8735244),h=e.i(1344973),p=e.i(2504781),g=e.i(6891161),x=e.i(455575),f=e.i(8522580),b=e.i(8761240),y=e.i(5756088),j=e.i(9386557),v=e.i(4004502),k=e.i(8042625),S=e.i(277234),A=e.i(4244280),C=e.i(5140444),T=e.i(4614946),I=e.i(5802506),R=e.i(6641571);e.i(9623499);var w=e.i(5576066),D=e.i(8815282),P=e.i(5229375);e.i(942336);var M=e.i(9668517);let L="[teamSlug]";var N=e.i(6060673),O=e.i(930810),E=e.i(7952834),$=e.i(1173672),_=e.i(8227242),B=e.i(9745887),z=e.i(3306538),F=e.i(5468328),H=e.i(9719784);function W(e){let{hidden:i,showIcon:n=!0,linkProps:l,defaultRoute:a}=e;return(0,t.jsx)(t.Fragment,{children:i.map(e=>(0,t.jsx)("div",{children:(0,t.jsx)(H.default,{defaultRoute:a,icon:n,title:e,truncate:!0,url:e,...l})},e))})}function U(e){let{hidden:i,linkProps:n}=e;return(0,t.jsx)(F.Tooltip,{text:(0,t.jsx)(W,{hidden:i,linkProps:n}),children:(0,t.jsx)(z.Badge,{size:"sm",variant:"gray-subtle",children:`+${i.length}`})})}let Y=function(e){let{className:i,defaultRoute:n,domains:l,firstOnly:a,showIcon:r=!0,style:o,linkProps:s}=e;if(!l)return(0,t.jsx)(h.Text,{as:"span",className:i,color:"gray-900",style:o,weight:400,children:"-"});let{visible:d,hidden:c}=l.reduce((e,t)=>(0===e.visible.length||!a&&1===e.visible.length&&e.visible[0].length<=20?e.visible.push(t):e.hidden.push(t),e),{visible:[],hidden:[]});return(0,t.jsx)(h.Text,{as:"span",className:i,weight:500,children:(0,t.jsxs)(u.Stack,{align:"center",direction:"row",gap:2,style:{display:"flex",maxWidth:"100%",alignItems:"stretch",...o},children:[d.map((e,i)=>{let l=i===d.length-1;return(0,t.jsx)(H.default,{defaultRoute:n,icon:r,style:{marginRight:l?void 0:"var(--geist-gap-half)",minWidth:0},truncate:!0,url:e,...s},e)}),c.length?(0,t.jsx)(U,{hidden:c,linkProps:s}):null]})})};e.s(["default",0,Y],4904548);var V=e.i(8651268),G=e.i(2547843);function q(){return(0,t.jsx)(g.Modal.Header,{children:(0,t.jsx)(g.Modal.Title,{center:!0,children:"Instant Rollback"})})}function K(e){let{setStage:i}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(g.Modal.Body,{children:[(0,t.jsx)(q,{}),(0,t.jsx)(h.Text,{as:"p",style:{marginBottom:"24px"},children:"Error: You must select a deployment to roll back."})]}),(0,t.jsx)(g.Modal.Actions,{children:(0,t.jsx)(g.Modal.Action,{fullWidth:!0,onClick:()=>{i("initial")},type:"secondary",children:"Back"})})]})}function X(){return(0,t.jsx)("div",{children:(0,t.jsx)(f.Note,{className:"bg-yellow-50 border-yellow-300 border text-amber-700",fill:!0,label:!1,type:"warning",variant:"contrast",children:(0,t.jsxs)(u.Stack,{align:"center",direction:"row",gap:4,style:{padding:4},children:[(0,t.jsx)(d.Warning,{style:{flexShrink:0}}),(0,t.jsxs)(u.Stack,{align:"start",children:[(0,t.jsx)(h.Text,{as:"p",color:"inherit",children:"Make sure the domains listed above are correct."}),(0,t.jsx)(h.Text,{as:"p",color:"inherit",children:"This deployment has custom aliases not included in the project's domain settings."})]})]})})})}function J(e){var l;let a,{hasFloatingAliases:s,onCancel:d,previousDeployment:m,productionAliases:x,productionDeployment:b,project:j,rollbackCandidates:k,setStage:S,selectedDeployment:A,setSelectedDeployment:C,deploymentSwr:T,rollbackReason:I,setRollbackReason:R}=e,D=(l="/[teamSlug]",a=(0,M.useTeamSlug)(),(0,i.useMemo)(()=>l.includes(L)?l.replace(`/${L}`,a?`/${a}`:""):l,[a,l])),[P,N]=(0,i.useState)(!1),{team:E}=(0,n.useTeam)(),$=!E||E.billing?.plan==="hobby",{value:_}=(0,r.useInstantRollbackHobbyRestrictionFlag)(),{value:z}=(0,o.useInstantRollbackHobbyRestrictionTeamFlag)();return k.length&&m&&A?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(g.Modal.Body,{children:[(0,t.jsx)(q,{}),(0,t.jsxs)(u.Stack,{gap:4,children:[(0,t.jsxs)(u.Stack,{gap:2,children:[(0,t.jsxs)(h.Text,{as:"p",size:16,children:["Rolling back"," ",(0,t.jsx)(Y,{domains:x,firstOnly:!0,style:{display:"inline-flex",fontWeight:"500"}})]}),s?(0,t.jsx)(X,{}):null,(0,t.jsx)("div",{children:(0,t.jsx)(B.DeploymentCardSmall,{deployment:b,isProductionDeployment:!0,selectedDeployment:A,setSelectedDeployment:C})})]}),(0,t.jsxs)(u.Stack,{gap:2,children:[(0,t.jsx)(h.Text,{as:"p",size:16,children:"To the following deployment:"}),P?(0,t.jsx)("div",{children:(0,t.jsx)(O.ChooseDeploymentList,{deployments:k,previousDeployment:m,productionDeployment:b,rolledBackDeploymentId:j?.lastAliasRequest?.type==="rollback"?j.lastAliasRequest.fromDeploymentId:void 0,selectedDeployment:A,setSelectedDeployment:C,swr:T})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:(0,t.jsx)(B.DeploymentCardSmall,{deployment:A,isForm:P,isPreviousDeployment:A.uid===m.uid,selectedDeployment:A,setSelectedDeployment:C})}),(_||z)&&$?(0,t.jsx)(u.Stack,{style:{marginTop:"24px"},children:(0,t.jsx)(f.Note,{className:"bg-blue-50 border border-blue-500 text-blue-600",fill:!0,label:!1,size:"small",variant:"contrast",children:(0,t.jsxs)(u.Stack,{align:"center",direction:"row",gap:4,style:{padding:8},children:[(0,t.jsx)(y.LockClosed,{style:{transform:"translateX(1px)"}}),(0,t.jsxs)(u.Stack,{align:"start",direction:"column",children:[(0,t.jsx)(h.Text,{as:"p",color:"inherit",weight:500,children:"Looking for an earlier deployment?"}),(0,t.jsxs)("div",{children:[(0,t.jsx)(w.Link,{className:"inline-flex items-center justify-center gap-1 text-current no-underline",href:"/"===D?"/dashboard?createTeam=instant-rollback":`${D}?upgradeTeam=instant-rollback`,target:"_blank",children:(0,t.jsx)(h.Text,{as:"span",color:"inherit",children:"Upgrade to Pro"})}),(0,t.jsx)(c.ExternalSmall,{className:"ml-1"}),(0,t.jsx)(h.Text,{as:"span",color:"inherit",style:{whiteSpace:"nowrap"},children:"to roll back to an earlier deployment"})]})]})]})})}):(0,t.jsx)(p.Button,{onClick:()=>{N(!0)},type:"secondary",width:"100%",size:"small",children:"Choose another deployment"})]})]}),(0,t.jsxs)(u.Stack,{gap:2,children:[(0,t.jsx)(u.Stack,{as:"label",gap:1,htmlFor:"rollback-reason",children:(0,t.jsx)(h.Text,{as:"span",size:16,children:"Share a reason for this rollback:"})}),(0,t.jsx)(O.RollbackDescriptionTextarea,{value:I,onChange:R,id:"rollback-reason"})]})]})]}),(0,t.jsxs)(g.Modal.Actions,{children:[(0,t.jsx)(g.Modal.Action,{onClick:d,type:"secondary",children:"Cancel"}),(0,t.jsx)(g.Modal.Action,{"data-testid":(0,v.tid)("deployment","rollback-modal","continue-button"),disabled:I.length>=O.REASON_MAX_CHARACTER_LENGTH,onClick:()=>{S("selected")},children:"Continue"})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(g.Modal.Body,{children:[(0,t.jsx)(q,{}),(0,t.jsx)(h.Text,{as:"p",children:"This project does not have any valid deployments to roll back to."})]}),(0,t.jsx)(g.Modal.Actions,{children:(0,t.jsx)(g.Modal.Action,{onClick:d,type:"secondary",children:"Cancel"})})]})}function Q(e){let{selectedDeployment:i,setStage:n,requestRollback:l,project:a,rollbackReason:r,rollbackCandidates:o}=e,{user:s}=(0,C.useUser)();if(!i)return(0,t.jsx)(K,{setStage:n});let d=r.length>=O.REASON_MAX_CHARACTER_LENGTH,m=(0,O.getMostRecentlyPromotedDeployment)(o);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(g.Modal.Body,{children:[(0,t.jsx)(q,{}),(0,t.jsxs)(u.Stack,{gap:2,children:[(0,t.jsxs)(u.Stack,{gap:2,children:[(0,t.jsx)(h.Text,{size:16,children:"Rolling back to:"}),(0,t.jsx)(B.DeploymentCardSmall,{deployment:i,isPreviousDeployment:i.uid===m?.uid,selectedDeployment:i,setSelectedDeployment:()=>null})]}),r.trim()&&(0,t.jsx)(u.Stack,{gap:4,children:(0,t.jsx)(O.RollbackDescriptionCard,{rollbackDescription:{description:r.trim(),userId:s?.uid??"",username:s?.username??"",deploymentId:i.uid,projectId:a?.id??"",createdAt:new Date().getTime()},project:a,preview:!0})}),(0,t.jsxs)(R.UL,{className:"mb-0",children:[(0,t.jsx)(R.LI,{children:"Instant Rollback assigns domains to a previous deployment. All Environment Variables from the original build will remain. Cron jobs will be reverted to the state of the previous deployment."}),(0,t.jsxs)(R.LI,{children:[(0,t.jsxs)(w.Link,{className:"inline-flex items-center text-[var(--geist-success)] no-underline",href:`https://${i.url}`,target:"_blank",children:["View the selected deployment ",(0,t.jsx)(c.ExternalSmall,{className:"ml-1"})]})," ","before rolling back—external APIs, databases, and CMS platforms may not behave as expected."]}),(0,t.jsx)(R.LI,{children:"You can update the rollback reason from the project overview."})]}),(a?.autoAssignCustomDomains??!0)||a?.lastAliasRequest?.type==="rollback"?(0,t.jsx)(f.Note,{fill:!0,type:"secondary",children:(0,t.jsx)(u.Stack,{align:"center",direction:"row",gap:4,children:(0,t.jsx)(u.Stack,{align:"start",children:(0,t.jsx)(h.Text,{as:"p",color:"inherit",children:"After rolling back, production deployments will not be automatically promoted until the rollback is removed."})})})}):null]})]}),(0,t.jsxs)(g.Modal.Actions,{children:[(0,t.jsx)(g.Modal.Action,{onClick:()=>{n("initial")},type:"secondary",children:"Back"}),(0,t.jsx)(g.Modal.Action,{"data-testid":(0,v.tid)("deployment","rollback-modal","rollback-button"),disabled:d,onClick:()=>{l(i.uid),n("processing")},children:"Confirm Rollback"})]})]})}function Z(e){let{jobStatus:n,rollbackDeploymentId:l,rollbackCandidates:a,selectedDeployment:r,setStage:o,onCancel:s,statusSwr:d,requestRollback:c,rollbackReason:x}=e,{user:f}=(0,C.useUser)();if((0,i.useEffect)(()=>{l===r?.uid&&("failed"===n?o("error"):"succeeded"===n&&o("done"))},[l,n,r,o]),!r)return(0,t.jsx)(K,{setStage:o});let y=(0,O.getMostRecentlyPromotedDeployment)(a);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(g.Modal.Body,{children:[(0,t.jsx)(q,{}),(0,t.jsxs)(u.Stack,{gap:2,children:[(0,t.jsxs)(u.Stack,{gap:2,children:[(0,t.jsx)(h.Text,{children:"Assigning production domains:"}),(0,t.jsx)(B.DeploymentCardSmall,{deployment:r,isPreviousDeployment:r.uid===y?.uid,selectedDeployment:r,setSelectedDeployment:()=>null})]}),""!==x?(0,t.jsxs)("div",{className:"rounded bg-background-200 px-4 py-3 shadow-border",children:[(0,t.jsxs)(h.Text,{color:"gray-900",children:["“",(0,t.jsx)(_.LinkParser,{text:x.trim()}),"”"]}),(0,t.jsxs)("div",{className:"flex gap-1 pt-1",children:[(0,t.jsx)(h.Text,{children:"Rolled back by"}),f?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(V.PrincipalAvatar,{size:20,principalId:f.uid,principal:{type:"user",uid:f.uid,username:f.username}}),(0,t.jsx)(h.Text,{children:f.username})]}):null]})]}):null,(0,t.jsxs)(R.UL,{className:"mx-4 my-0 list-none pt-2",children:[d.aliases.map(e=>{let i="loading";return"completed"===e.status?i="success":"failed"===e.status&&(i="error"),(0,t.jsx)(R.LI,{children:(0,t.jsxs)("div",{style:{height:"24px",display:"flex"},children:["loading"===i&&(0,t.jsx)(m.Spinner,{size:24}),"error"===i&&(0,t.jsx)(j.WarningFill,{color:"amber-800",size:24}),"success"===i&&(0,t.jsx)(b.CheckCircleFill,{color:"blue-700",size:24}),(0,t.jsx)(h.Text,{as:"span",style:{lineHeight:"24px",paddingLeft:"7px"},children:e.alias})]})},e.alias)}),!d.isReachingEnd&&d.initialDataLoaded?(0,t.jsx)(R.LI,{children:(0,t.jsx)(p.Button,{loading:d.isLoadingMore,onClick:()=>{d.loadMore()},style:{marginTop:24},type:"secondary",width:"100%",children:"Show More"})}):null]})]})]}),(0,t.jsx)(g.Modal.Actions,{children:(0,t.jsx)(g.Modal.Action,{"data-testid":(0,v.tid)("deployment","rollback-modal","finish-button"),fullWidth:!0,loading:"failed"!==n&&"succeeded"!==n,onClick:()=>{"failed"===n?c(r.uid):"succeeded"===n&&(o("initial"),s())},children:"failed"===n?"Retry":"Done"})})]})}function ee(e){let{active:l,initialSelectedDeployment:a,onCancel:r,productionBranch:o,productionDeployment:s,projectId:d,rollbackCandidates:c,swr:u,rollbackDescription:m}=e,{mutate:h}=(0,T.useSWRConfig)(),[p,f]=(0,i.useState)("initial"),[b,y]=(0,i.useState)(""),{isReady:j,team:C}=(0,n.useTeam)(),R=(0,x.useToasts)(),w=(0,i.useMemo)(()=>{let e=c.filter(e=>e.uid!==s.id);return(0,O.getMostRecentlyPromotedDeployment)(e)},[c,s]),[M,L]=(0,i.useState)(null),_=M??a??w??null,B=(0,i.useCallback)(f,[f]),z=(0,i.useCallback)(L,[L]),[,{aliases:F}]=(0,P.useAliasesInfinite)({rollbackDeploymentId:s.id}),{data:H}=(0,N.useProject)(d),{lastAliasRequest:W,hasFloatingAliases:U}=H||{lastAliasRequest:void 0,hasFloatingAliases:!1},{toDeploymentId:Y,jobStatus:V}=W||{toDeploymentId:null,jobStatus:null},[,q]=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,{isReady:a,team:r}=(0,n.useTeam)(),o=(0,D.default)((t,i)=>{if(!a)return null;let n={teamId:r?.id,limit:l};return t?i?.next?`${(0,A.API_PROJECTS_ROLLBACK_ALIAS_STATUS)(e)}${(0,k.encode)({...n,until:i.next})}`:null:`${(0,A.API_PROJECTS_ROLLBACK_ALIAS_STATUS)(e)}${(0,k.encode)(n)}`},e=>(0,S.fetchAPI)(e,{throwOnHTTPError:!0}),{refreshInterval:t}),s=(0,i.useMemo)(()=>o.data?[].concat(...o.data.filter(Boolean).map(e=>e.aliases.slice(0,l))):[],[o.data,l]),d=!!o.data,c=d&&0===s.length,u=d&&o.data&&o.size>o.data.length,m=d&&o.data&&o.data[o.data.length-1]?.aliases.length<l;return[o,{aliases:s,initialDataLoaded:d,isEmpty:c,loadMore:()=>o.setSize(e=>e+1),isLoadingMore:u,isReachingEnd:m,mutate:o.mutate}]}(d,2e3),K=(0,i.useMemo)(()=>s,[l]),X=()=>{f("initial"),L(a||w||null),r()},ee=(0,i.useCallback)(async e=>{if(!j)return;let t=`${(0,A.API_DEPLOYMENT_ROLLBACK)(d,e)}${(0,k.encode)({teamId:C?.id,description:b.trim()})}`;try{await (0,S.fetchAPI)(t,{throwOnHTTPError:!0,method:"POST",body:{}}),C&&(void 0!==H&&(0,E.revalidateProject)(h,H),await h((0,$.getProjectProductionDeploymentKey)({projectIdOrName:d,teamId:C.slug})),h((0,G.getRollingReleaseEndpoint)(C.slug,d)))}catch(e){R.error({text:"Something went wrong - please try requesting an Instant Rollback again",key:"rollback-deployment"}),(0,I.captureError)(e)}},[j,d,R,b,h,C,H]),et={rollbackDeploymentId:Y,hasFloatingAliases:!!U,jobStatus:V,onCancel:X,previousDeployment:w,productionBranch:o,productionDeployment:K,productionAliases:F.map(e=>{let{alias:t}=e;return t}),project:H,rollbackCandidates:c,setStage:B,selectedDeployment:_,setSelectedDeployment:z,deploymentSwr:u,statusSwr:q,requestRollback:ee,rollbackWarningText:"New deployments will not be automatically assigned production domains until this rollback is removed.",rollbackReason:b,setRollbackReason:y,rollbackDescription:m};return(0,t.jsxs)(g.Modal.Modal,{active:l,"data-testid":(0,v.tid)("deployment","rollback-modal"),onClickOutside:X,sticky:!0,width:"500px",children:["initial"===p&&(0,t.jsx)(J,{...et}),"selected"===p&&(0,t.jsx)(Q,{...et}),["processing","error","done"].includes(p)&&(0,t.jsx)(Z,{...et})]})}var et=e.i(5771992),ei=e.i(5645345),en=e.i(3981247);e.i(3182268);var el=e.i(7849855);function ea(e){let{team:t}=(0,n.useTeam)(),l=!t||t.billing?.plan==="hobby",{value:a}=(0,r.useInstantRollbackHobbyRestrictionFlag)(),{value:d}=(0,o.useInstantRollbackHobbyRestrictionTeamFlag)(),c=a||d,u=e?.name,{deployment:m,isLoading:h}=(0,s.useProjectProductionDeployment)(u);return(0,i.useMemo)(()=>{let t=(0,ei.asListDeployment)(e),i=l&&!t?.isRollbackCandidate;return t?h?"Loading…":"readyState"in t&&"READY"!==t.readyState?"Only Deployments that are Ready can be rolled back.":"readySubstate"in t&&"PROMOTED"!==t.readySubstate?"Only Deployments previously aliased to a Production domain can be rolled back.":t.uid===m?.id?"This Deployment is already in Production.":c?t.isRollbackCandidate||"production"===t.target?i?"Hobby customers can only roll back to the previous deployment.":"":"Only Deployments previously aliased to a Production domain can be rolled back.":t.isRollbackCandidate?"":"Only Deployments previously aliased to a Production domain can be rolled back.":""},[e,l,h,m?.id,c])}function er(e){let{onClose:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},[r,o]=(0,i.useState)(!1),[d,c]=(0,i.useState)(),{teamSlug:u,projectSlug:m}=(0,el.useProjectAndTeamSlug)(),{data:h}=(0,N.useProject)(d?.name),p=m??d?.name,g=e??h,{data:x}=(0,en.useRollingRelease)({teamIdOrSlug:u,projectSlug:p}),f=x?.rollingRelease?x?.rollingRelease?.canaryDeployment?.id:void 0,{deployment:b,rollbackDescription:y,mutate:j}=(0,s.useProjectProductionDeployment)(g?.name),{can:v}=(0,l.default)({projectIdOrName:g?.name}),k=v(a.Action.Create,a.Resource.DeploymentRollback),S=g?.link?.productionBranch?g.link.productionBranch:void 0,[A,C]=(0,et.useDeploymentsInfinite)({projectId:g?g.id:"",requireProject:!0,limit:10,rollbackCandidate:!0},{}),{deployments:T,initialDataLoaded:I}=C,R=T.filter(e=>!!e.isRollbackCandidate&&e.uid!==f),w=!!(I&&g&&!R.length),D=(0,i.useCallback)(e=>{c((0,ei.asListDeployment)(e)),o(!0)},[]),P=(0,i.useCallback)(()=>{o(!1),j().finally(()=>null),n?.()},[j,n]);return{rollbackModal:(0,i.useMemo)(()=>k&&r&&b&&g?(0,t.jsx)(ee,{active:r,initialSelectedDeployment:d,onCancel:P,productionBranch:S,productionDeployment:b,projectId:g.id,rollbackCandidates:R,rollbackDescription:y,swr:C}):null,[k,r,d,S,b,R,g,C,P,y]),closeRollbackModal:P,openRollbackModal:D,canRollbackDeployment:k,noRollbackCandidates:w}}e.s(["useInstantRollbackModal",()=>er,"useRollbackTooltip",()=>ea],9365163)}]);

//# sourceMappingURL=10e49444665c6bd4.js.map
//# debugId=c0f74c56-6e15-5ed7-b7bf-c79eec923e20
