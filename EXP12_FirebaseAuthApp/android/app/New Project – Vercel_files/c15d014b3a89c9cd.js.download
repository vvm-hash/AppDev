
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="652d9c3a-2229-5467-bcb4-93f24ac1ad28")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,6269588,e=>{e.v({badge:"bell-module__AXcxMG__badge",badgeMotion:"bell-module__AXcxMG__badgeMotion",btn:"bell-module__AXcxMG__btn",buttonContent:"bell-module__AXcxMG__buttonContent",content:"bell-module__AXcxMG__content",fadeOut:"bell-module__AXcxMG__fadeOut",focus:"bell-module__AXcxMG__focus",frame:"bell-module__AXcxMG__frame",frameMotion:"bell-module__AXcxMG__frameMotion",hover:"bell-module__AXcxMG__hover",icon:"bell-module__AXcxMG__icon",lg:"bell-module__AXcxMG__lg",md:"bell-module__AXcxMG__md",pressed:"bell-module__AXcxMG__pressed",shadow:"bell-module__AXcxMG__shadow",sm:"bell-module__AXcxMG__sm",statusIcon:"bell-module__AXcxMG__statusIcon",svgNoPointerEvents:"bell-module__AXcxMG__svgNoPointerEvents",text:"bell-module__AXcxMG__text"})},1889129,e=>{e.v({archiveFooter:"feed-module__491t5W__archiveFooter",breakAll:"feed-module__491t5W__breakAll",cell:"feed-module__491t5W__cell",commentsView:"feed-module__491t5W__commentsView",emptyIcon:"feed-module__491t5W__emptyIcon",emptyLabel:"feed-module__491t5W__emptyLabel",feed:"feed-module__491t5W__feed",feedContent:"feed-module__491t5W__feedContent",header:"feed-module__491t5W__header",headerGrid:"feed-module__491t5W__headerGrid",settingsLink:"feed-module__491t5W__settingsLink",tabText:"feed-module__491t5W__tabText",view:"feed-module__491t5W__view"})},6241262,e=>{e.v({archive:"item-module__Hg2RJW__archive",archiveButton:"item-module__Hg2RJW__archiveButton",dot:"item-module__Hg2RJW__dot",fallbackIcon:"item-module__Hg2RJW__fallbackIcon","focus-visible":"item-module__Hg2RJW__focus-visible",focusVisible:"item-module__Hg2RJW__focusVisible",hidden:"item-module__Hg2RJW__hidden",item:"item-module__Hg2RJW__item",link:"item-module__Hg2RJW__link",notificationContent:"item-module__Hg2RJW__notificationContent",subAvatar:"item-module__Hg2RJW__subAvatar",subject:"item-module__Hg2RJW__subject"})},8698247,e=>{e.v({commentWrapper:"comment-item-module__JJqGUq__commentWrapper",selected:"comment-item-module__JJqGUq__selected"})},2977232,e=>{e.v({commentsDetailView:"notifications-module__J76_1G__commentsDetailView"})},6561189,e=>{"use strict";var t=e.i(6468255),i=e.i(6696646),n=e.i(4004502),s=e.i(8634363),a=e.i(119294),l=e.i(7917902);e.i(942336),e.i(2201144);var r=e.i(2880301),o=e.i(9100551);let d={"mvp-stub-notifications":(e,t,i,n)=>!1,"deployment-failed"(e,t,i,n){let{teamSlug:s,project:a,id:l}=i;return!!(s&&a&&l&&e===`/${s}/${a}/${l}`||e.startsWith("/new/import/"))&&!![...t.getAll("id"),...t.getAll("deploymentIds")].find(e=>{if(e)return(n.data?.actionUrl||"").includes(e.replace("dpl_",""))})}};function c(e){let t=(0,r.useAuthenticatedKnockClient)("pk_cBlwgRRBkMc-3KKgA0J7W-q7LbxjyDuL1u3XXU164p4",e.userId,e.userToken),n=(0,r.useNotifications)(t,"6f1dd852-e25d-4cb7-b99c-6b0acc743109",{page_size:e.pageSize||10,tenant:e.tenant,archived:"archived"===e.tab?"only":"exclude"});if(!n)throw Error("expected feed");let[s,a]=(0,i.useState)(),l=(0,o.usePathname)(),c=(0,o.useSearchParams)(),u=(0,o.useParams)();(0,i.useEffect)(()=>{if("inbox"!==e.tab)return;let t=e=>{let t;l&&c&&u&&(t=e.items.filter(e=>!!(!e.seen_at&&1===e.total_activities&&e.source.key in d&&d[e.source.key](l,c,u,e)))).length&&n.markAsSeen(t)};return n.on("items.received.*",t),()=>n.off("items.received.*",t)},[n,u,l,e.tab,c]),(0,i.useEffect)(()=>{if(e.userId)try{let t=new BroadcastChannel(`__notifier_feed${e.userId}${e.tenant??""}`);t.addEventListener("message",t=>{let{data:i}=t;if("inbox"===e.tab&&(n.getState().setMetadata(i.state.metadata),n.store.setState({items:i.state.items})),"archived"===e.tab&&("markAsArchived"===i.method||"markAllAsArchived"===i.method)){let e=new Date().toISOString();i.changes.forEach(t=>{t.archived_at=e}),n.store.setState({items:i.changes.concat(n.store.getState().items)})}});let i=async e=>{let i=await n.markAsArchived(e),s=Array.isArray(e)?e:[e],{items:a,metadata:l}=n.getState();return t.postMessage({state:{items:a,metadata:l},method:"markAsArchived",changes:s}),i},s=async()=>{let{items:e,metadata:i}=n.store.getState(),s=n.markAllAsArchived();return t.postMessage({state:{items:e,metadata:i},method:"markAllAsArchived",changes:e}),s};return a({markAsArchived:i,markAllAsArchived:s}),()=>{a(void 0),t.close()}}catch(e){}},[n,e.tab,e.tenant,e.userId]);let{loading:h,items:m,metadata:f}=(0,r.useNotificationStore)(n),x=(0,i.useCallback)(async e=>{s?.markAsArchived?await s.markAsArchived(e):await n.markAsArchived(e)},[n,s]),_=(0,i.useCallback)(async()=>{s?.markAllAsArchived?await s.markAllAsArchived():await n.markAllAsArchived()},[n,s]);return{loading:h,items:m??[],metadata:f??{},feed:n,markAsArchived:x,markAllAsArchived:_}}var u=e.i(6352514),h=e.i(4810515),m=e.i(8097508),f=e.i(1581757),x=e.i(1080700);let _=(0,i.createContext)(null);_.displayName="NotificationContext";let v=/vtest314-[^@]+@zeit\.pub/;function g(){let{user:e,team:t,isLoading:i}=(0,l.useAccount)(),{isLoading:n,token:s}=(0,h.useKnockToken)({});if(!i&&!t)return{state:null,isLoading:!1};let a=!!(i||n);return i||(e?.limited!==!0||t)&&(!t||!0!==t.limited)?s?{state:"full",tenant:t?.id,isLoading:a}:e?{state:"placeholder",tenant:t?.id,isLoading:a}:{state:null,isLoading:a}:{state:"limited",tenant:t?.id,isLoading:a}}var b=e.i(9001495),p=e.i(5338940),j=e.i(3322724),k=e.i(4585051),w=e.i(6280036),A=e.i(287495);function y(){let{resolvedTheme:e}=(0,w.useTheme)(),i=(0,A.default)();return(0,t.jsxs)("svg",{fill:"none",height:"36",opacity:+!!e,viewBox:"0 0 36 36",width:"36",xmlns:"http://www.w3.org/2000/svg",children:[(0,t.jsx)("rect",{fill:i?"#F0FDF4":"#071D10",height:"35",rx:"17.5",width:"35",x:"0.5",y:"0.5"}),(0,t.jsx)("g",{clipPath:"url(#clip0_798_8657)",children:(0,t.jsx)("path",{d:"M14.6667 17.8809L16.75 19.9643L21.2143 15.5M26.3333 18C26.3333 22.6024 22.6024 26.3333 18 26.3333C13.3976 26.3333 9.66666 22.6024 9.66666 18C9.66666 13.3976 13.3976 9.66666 18 9.66666C22.6024 9.66666 26.3333 13.3976 26.3333 18Z",stroke:i?"#0D883B":"#86EFAC",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"})}),(0,t.jsx)("rect",{height:"35",rx:"17.5",stroke:i?"#DCFCE7":"#0D3B1E",width:"35",x:"0.5",y:"0.5"}),(0,t.jsx)("defs",{children:(0,t.jsx)("clipPath",{id:"clip0_798_8657",children:(0,t.jsx)("rect",{fill:"white",height:"20",transform:"translate(8 8)",width:"20"})})})]})}function C(){let{resolvedTheme:e}=(0,w.useTheme)(),i=(0,A.default)(),n=i?"#BD5200":"#FDE68A";return(0,t.jsxs)("svg",{fill:"none",height:"36",opacity:+!!e,viewBox:"0 0 36 36",width:"36",xmlns:"http://www.w3.org/2000/svg",children:[(0,t.jsx)("rect",{fill:i?"#FFFBEB":"#241005",height:"35",rx:"17.5",width:"35",x:"0.5",y:"0.5"}),(0,t.jsxs)("g",{clipPath:"url(#clip0_798_8667)",children:[(0,t.jsx)("path",{d:"M16.575 11.2167L9.51665 23C9.37113 23.252 9.29413 23.5377 9.29331 23.8288C9.2925 24.1198 9.3679 24.4059 9.51201 24.6588C9.65612 24.9116 9.86392 25.1223 10.1147 25.2699C10.3656 25.4174 10.6507 25.4968 10.9417 25.5H25.0583C25.3493 25.4968 25.6344 25.4174 25.8852 25.2699C26.136 25.1223 26.3439 24.9116 26.488 24.6588C26.6321 24.4059 26.7075 24.1198 26.7067 23.8288C26.7058 23.5377 26.6288 23.252 26.4833 23L19.425 11.2167C19.2764 10.9717 19.0673 10.7693 18.8176 10.6287C18.568 10.4882 18.2864 10.4144 18 10.4144C17.7135 10.4144 17.4319 10.4882 17.1823 10.6287C16.9327 10.7693 16.7235 10.9717 16.575 11.2167V11.2167Z",stroke:n,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,t.jsx)("path",{d:"M18 22.1667H18.0083",stroke:n,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,t.jsx)("path",{d:"M18 15.5V18.8333",stroke:n,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"})]}),(0,t.jsx)("rect",{height:"35",rx:"17.5",stroke:i?"#FEF3C7":"#411D06",width:"35",x:"0.5",y:"0.5"}),(0,t.jsx)("defs",{children:(0,t.jsx)("clipPath",{id:"clip0_798_8667",children:(0,t.jsx)("rect",{fill:"white",height:"20",transform:"translate(8 8)",width:"20"})})})]})}function N(){let{resolvedTheme:e}=(0,w.useTheme)(),i=(0,A.default)(),n=i?"#D00505":"#FCA5A5";return(0,t.jsxs)("svg",{fill:"none",height:"36",opacity:+!!e,viewBox:"0 0 36 36",width:"36",xmlns:"http://www.w3.org/2000/svg",children:[(0,t.jsx)("rect",{fill:i?"#FEF2F2":"#2A0909",height:"35",rx:"17.5",width:"35",x:"0.5",y:"0.5"}),(0,t.jsx)("path",{d:"M23.8333 10.5H12.1667C11.2462 10.5 10.5 11.2462 10.5 12.1667V23.8333C10.5 24.7538 11.2462 25.5 12.1667 25.5H23.8333C24.7538 25.5 25.5 24.7538 25.5 23.8333V12.1667C25.5 11.2462 24.7538 10.5 23.8333 10.5Z",stroke:n,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,t.jsx)("path",{d:"M15.5 15.5L20.5 20.5",stroke:n,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,t.jsx)("path",{d:"M20.5 15.5L15.5 20.5",stroke:n,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,t.jsx)("rect",{height:"35",rx:"17.5",stroke:i?"#FEE2E2":"#450C0C",width:"35",x:"0.5",y:"0.5"})]})}function E(){let{resolvedTheme:e}=(0,w.useTheme)(),i=(0,A.default)(),n=i?"#666666":"#888888";return(0,t.jsxs)("svg",{fill:"none",height:"36",opacity:+!!e,viewBox:"0 0 36 36",width:"36",xmlns:"http://www.w3.org/2000/svg",children:[(0,t.jsx)("rect",{fill:i?"#FAFAFA":"#111111",height:"35",rx:"17.5",width:"35",x:"0.5",y:"0.5"}),(0,t.jsxs)("g",{clipPath:"url(#clip0_1415_8585)",children:[(0,t.jsx)("path",{d:"M18 26.3333C22.6024 26.3333 26.3334 22.6024 26.3334 18C26.3334 13.3976 22.6024 9.66666 18 9.66666C13.3976 9.66666 9.66669 13.3976 9.66669 18C9.66669 22.6024 13.3976 26.3333 18 26.3333Z",stroke:n,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,t.jsx)("path",{d:"M18 21.3333V18",stroke:n,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,t.jsx)("path",{d:"M18 14.6667H18.0083",stroke:n,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"})]}),(0,t.jsx)("rect",{height:"35",rx:"17.5",stroke:i?"#EAEAEA":"#333333",width:"35",x:"0.5",y:"0.5"}),(0,t.jsx)("defs",{children:(0,t.jsx)("clipPath",{id:"clip0_1415_8585",children:(0,t.jsx)("rect",{fill:"white",height:"20",transform:"translate(8 8)",width:"20"})})})]})}var M=e.i(6346477);function I(e){return!!e&&e.startsWith("team_")}var S=e.i(5213664),T=e.i(9992248),L=e.i(9443581),P=e.i(704885),F=e.i(8616297),W=e.i(6160523),O=e.i(4770807),H=e.i(9722978),D=e.i(7171047),G=e.i(9358876),B=e.i(1288475),R=e.i(9031150),z=e.i(6357175),X=e.i(9482244);let J=(e,t)=>t.ts<e.ts||!["stable","shown"].includes(t.type)?e:{...e,[t.type]:t.value,ts:t.ts},V={ts:0,stable:0,shown:0},$=[.1,.3,.5,.6,.8,1].map(function(e){return 1-Math.pow(1-e,3)});var U=e.i(6269588);let q=(0,i.forwardRef)(function(e,s){let{unseen:a,disabled:l,disableMotion:r,children:d,onOpenChange:c,...u}=e,h=(0,o.usePathname)(),m=(0,i.useContext)(_),f=!!m?.hasOpened,{focusProps:x,isFocusVisible:v}=(0,P.useFocusRing)(),{hoverProps:g,isHovered:b}=(0,F.useHover)({isDisabled:l}),p=(0,O.useObjectRef)(s),{isPressed:k}=(0,L.useButton)(u,p),w=(0,j.useIsMobile)(),A=function(e,t){let n=(0,X.usePrefersReducedMotion)(),s=!(t.disableMotion||n),[{stable:a,shown:l},r]=(0,i.useReducer)(J,V);(0,i.useEffect)(()=>{if(s&&(!(a<l)||t.animateDown)){let e=a===l?[]:$.map((e,t)=>{let i=Math.round(l+(a-l)*e);if(i!==a||t===$.length-1)return setTimeout(()=>requestAnimationFrame(()=>r({value:i,type:"shown",ts:Date.now()})),50+100*t)});return()=>{for(let t of e)t&&clearTimeout(t)}}r({value:a,type:"shown",ts:Date.now()})},[a,s]);let o=(0,i.useCallback)(e=>r({type:"stable",ts:Date.now(),value:e}),[r]),d=(0,z.useDebouncedValue)(e,100);return(0,i.useEffect)(()=>{o(Number(d))},[d,o]),l}(a,{disableMotion:r}),y=(0,H.clsx)(U.default.btn,{[U.default.focus]:v,[U.default.hover]:b,[U.default.pressed]:k||f,[U.default.shadow]:!w});return(0,i.useEffect)(()=>{m?.setHasOpened(!1)},[h]),(0,t.jsxs)("div",{children:[m?.hasOpened?(0,t.jsx)("div",{"aria-hidden":!0}):null,(0,t.jsxs)(T.Root,{"aria-label":"Notifications","data-testid":(0,n.tid)("notifications","popover"),onOpenChange:e=>{(0,R.awaitPaint)().then(()=>{m?.setHasOpened(e),c(e)})},open:f,children:[(0,t.jsx)(T.Trigger,{"aria-label":a?`${a} unseen ${(0,G.pluralize)("notification",a)}`:"notifications",...(0,W.mergeProps)(x,g,u),className:y,"data-testid":(0,n.tid)("notifications","bell"),ref:p,children:(0,t.jsxs)("span",{className:U.default.buttonContent,children:[(0,t.jsx)("div",{className:U.default.icon,children:(0,t.jsx)(D.Bell,{className:U.default.svgNoPointerEvents,color:"gray-1000",size:16})}),A>0?(0,t.jsx)(B.Status,{className:U.default.statusIcon,color:"blue-900"}):null]})}),(0,t.jsx)(T.Portal,{children:(0,t.jsx)(T.Content,{align:"end",alignOffset:-10,"aria-label":a?`${a} unseen ${(0,G.pluralize)("notification",a)}`:"notifications",className:U.default.content,sideOffset:10,children:d})})]})]})});var K=e.i(3351853),Z=e.i(313754),Y=e.i(386648),Q=e.i(9138164),ee=e.i(6015702),et=e.i(2155064),ei=e.i(9508212),en=e.i(1344973),es=e.i(2504781),ea=e.i(4237893),el=e.i(3306538),er=e.i(1492947),eo=e.i(57106),ed=e.i(5601342),ec=e.i(6817372),eu=e.i(3423911),eh=e.i(7796990),em=e.i(6036663),ef=e.i(9696510),ex=e.i(9563590),e_=e.i(1889129);function ev(e){let{children:i}=e;return(0,t.jsx)(el.Badge,{className:e_.default.tabBadge,size:"sm",variant:"gray-subtle",children:i})}function eg(e){var s,a,r,o,d,c,u,h,m;let{tab:x,setTab:v,settingsLink:g,currentTabEmpty:p,onArchiveAll:k,onScrollEnd:w,children:A,commentsUnread:y=0,commentsIsLoading:C=!1,inboxUnread:N=0,hasNextThread:E,hasPreviousThread:M,clearSelectedThread:I,selectNextThread:S,selectPreviousThread:T,commentsIsStale:L,viewFreshComments:P}=e,{account:F,isLoading:W}=(0,l.useAccount)(),O=(0,ed.usePreferences)(),[D,G]=(0,i.useState)(!1),B=(0,j.useIsMobile)(),R=(0,i.useContext)(_),z=(s={debounce:40,offset:7},r=(a=(0,i.useMemo)(function(){var e,t,i,n;return{offset:null!=(e=null==s?void 0:s.offset)?e:0,debounce:null!=(t=null==s?void 0:s.debounce)?t:200,debounceOptions:null!=(i=null==s?void 0:s.debounceOptions)?i:{leading:!0},triggerOnNoScroll:null!=(n=null==s?void 0:s.triggerOnNoScroll)&&n}},[null==s?void 0:s.offset,null==s?void 0:s.debounce,null==s?void 0:s.debounceOptions,null==s?void 0:s.triggerOnNoScroll])).offset,o=a.triggerOnNoScroll,d=a.debounce,c=a.debounceOptions,u=(0,i.useMemo)(function(){return d?(0,K.default)(w,d,c):w},[d,w]),h=(0,i.useRef)(null),m=(0,i.useCallback)(function(){if(null!=h.current){var e=h.current,t=Math.round(e.scrollTop+e.clientHeight);Math.round(e.scrollHeight-r)<=t&&u()}else{var i=document.scrollingElement||document.documentElement,n=Math.round(i.scrollTop+window.innerHeight);Math.round(i.scrollHeight-r)<=n&&u()}},[r,w,h.current]),(0,i.useEffect)(function(){var e=h.current;return null!=e?e.addEventListener("scroll",m):window.addEventListener("scroll",m),o&&m(),function(){null!=e?e.removeEventListener("scroll",m):window.removeEventListener("scroll",m)}},[m,d]),h),{filterValues:X,hasSelectedFilters:J}=(0,f.useCommentFilters)(),V=J(),$=X.q[0];(0,i.useEffect)(()=>{let e=O.isChannelEnabled("in_app_feed");e||D?e&&D&&G(!1):G(!0)},[O,D]);let U=(0,ec.useCommentsViewEnabled)("enable-comments-notifications-view"),q=(0,i.useMemo)(()=>[{title:(0,t.jsxs)(ek,{children:["Inbox ",N>0?(0,t.jsx)(ev,{children:N}):null]}),value:"inbox"},{title:(0,t.jsx)(ek,{children:"Archive"}),value:"archived"}],[N]),Z=(0,i.useMemo)(()=>U?[...q,{title:(0,t.jsxs)(ek,{children:["Comments"," ",y>0?(0,t.jsx)(ev,{children:y}):null]}),value:"comments"}]:q,[U,q,y]),Y=(0,i.useMemo)(()=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ea.Tabs,{border:!1,"data-testid":(0,n.tid)("notifications","tabs"),selected:x,setSelected:v,tabs:Z}),(0,t.jsx)(ej,{...g,onClick:()=>{R?.setHasOpened(!1)}})]}),[R,v,g,x,Z]),Q=null;if(D&&"inbox"===x)Q=(0,t.jsx)(ep,{onEnable:()=>{O.setChannel({channels:["in_app_feed"],enabled:!0})}});else if(p){let e;"comments"===x&&!C&&($?e=`No comments found for "${$}".`:V?e="No comments found with the selected filters.":W||F?.enablePreviewFeedback!=="off"||(e="Enable comments on your Preview Deployments to view them here.")),Q=(0,t.jsx)(eb,{label:e,tab:x})}let{thread:ee}=(0,b.useSelectedComment)(),et=(0,t.jsxs)("div",{className:e_.default.feed,"data-tab":x,children:[(0,t.jsx)("div",{className:e_.default.headerGrid,children:ee?(0,t.jsx)(em.CommentDetailHeader,{clearSelectedThread:I,flex:1,forceShowBackButton:!0,hasNext:E,hasPrevious:M,selectNextThread:S,selectPreviousThread:T,showContextMenu:!1,showLinearLink:!1,showPreviewLink:!1,thread:ee}):Y}),(0,t.jsxs)("div",{className:e_.default.feedContent,"data-empty":Q?"":null,ref:z,children:[ee?A:(0,t.jsxs)(ei.Stack,{children:["comments"===x?(0,t.jsxs)(ei.Stack,{gap:2,paddingTop:4,className:p?"absolute inset-x-0 top-0":void 0,children:[(0,t.jsxs)(ei.Stack,{direction:"row",gap:3,paddingX:4,children:[(0,t.jsx)(ef.CommentsSearch,{loading:C,size:"small"}),(0,t.jsx)(eu.FilterMenu,{buttonSize:"small"})]}),(0,t.jsx)(eh.ClearFilters,{buttonSize:"small",paddingX:4})]}):null,(0,t.jsx)("ol",{className:(0,H.clsx)(e_.default.view,{[e_.default.commentsView]:"comments"===x}),"data-empty":Q?"":null,"data-tab":x,children:Q||A})]}),"comments"===x&&L?(0,t.jsx)(ex.CommentsStaleButton,{onClick:P}):null]}),"inbox"===x&&!Q&&(0,t.jsx)("div",{className:e_.default.archiveFooter,children:(0,t.jsx)(es.Button,{"data-testid":(0,n.tid)("notifications","archive-all"),onClick:()=>k(),size:"small",type:"tertiary",children:"Archive All"})})]});return B?(0,t.jsx)(er.Drawer,{onDismiss:()=>{R?.setHasOpened(!1)},show:R?.hasOpened,children:et}):et}function eb(e){let{tab:i,label:s}=e,a="No new notifications";"archived"===i?a="Nothing in the archive":"comments"===i&&(a="No new comments");let l=(0,t.jsx)(Z.Inbox,{"aria-label":"Empty inbox",color:"gray-700",size:20});return"archived"===i?l=(0,t.jsx)(et.Archive,{"aria-label":"Empty archive",color:"gray-700",size:20}):"comments"===i&&(l=(0,t.jsx)(ee.Message,{"aria-label":"Empty inbox",color:"gray-700",size:20})),(0,t.jsx)(ei.Stack,{align:"center",as:"li","data-testid":(0,n.tid)("notifications","inbox-zero"),justify:"center",children:(0,t.jsxs)(ei.Stack,{align:"center",direction:"column",gap:3,children:[(0,t.jsx)("div",{className:e_.default.emptyIcon,children:l}),(0,t.jsx)(en.Text,{align:"center",className:e_.default.emptyLabel,color:"gray-900",size:14,weight:400,children:s??a})]})})}function ep(e){let{onEnable:i}=e;return(0,t.jsx)(ei.Stack,{align:"center",as:"li","data-testid":(0,n.tid)("notifications","inbox-zero"),justify:"center",children:(0,t.jsxs)(ei.Stack,{align:"center",direction:"column",gap:5,children:[(0,t.jsx)("div",{className:e_.default.emptyIcon,children:(0,t.jsx)(Y.BellOff,{color:"gray-700",size:20})}),(0,t.jsx)(en.Text,{color:"gray-900",size:14,weight:400,children:"You currently have notifications turned off"}),(0,t.jsx)(es.Button,{"data-testid":(0,n.tid)("notifications","turn-on"),onClick:i,size:"small",children:"Turn on notifications"})]})})}function ej(e){let{as:i,href:s,onClick:a}=e,{focusProps:l,isFocused:r,isFocusVisible:o}=(0,P.useFocusRing)(),{hoverProps:d,isHovered:c}=(0,F.useHover)({});return(0,t.jsx)(eo.Link,{"aria-label":"Settings",as:i,className:e_.default.settingsLink,"data-focus-visible":o?"":null,"data-hover":c?"":null,"data-testid":(0,n.tid)("notifications","settings"),href:s,onClick:a,...l,...d,children:(0,t.jsx)("span",{"aria-hidden":!0,style:{height:16},children:(0,t.jsx)(Q.SettingsGear,{color:c||r?"gray-1000":"gray-700"})})})}function ek(e){let{children:i}=e;return(0,t.jsx)(en.Text,{className:e_.default.tabText,color:"inherit",size:14,children:i})}var ew=e.i(7218483),eA=e.i(6241262);function ey(e){let{isMobile:s,notification:a,archiveNotification:l,readNotification:r}=e,[o,d]=(0,i.useState)(!1),{isHovered:c,hoverProps:u}=(0,F.useHover)({}),{isHovered:h,hoverProps:m}=(0,F.useHover)({}),{isFocusVisible:f,focusProps:x}=(0,P.useFocusRing)({within:!0}),_=c||o||s,{id:v,mainAvatar:g,subAvatar:b,actionUrl:p,ts:j,markup:k,isArchived:w,isSeen:A,workflow:y}=a,C=(0,t.jsxs)(ei.Stack,{as:"li",className:(0,H.clsx)(eA.default.item,{[eA.default.focusVisible]:f}),"data-testid":(0,n.tid)("notifications","item",v),direction:"row",gap:4,justify:"space-between",...u,...x,children:[(0,t.jsxs)("span",{className:eA.default.subject,children:[(0,t.jsx)("span",{children:g}),b?(0,t.jsx)("span",{className:eA.default.subAvatar,children:b}):null]}),(0,t.jsxs)(ei.Stack,{direction:"column",style:{flex:1},children:[k,(0,t.jsx)(eC,{ts:j})]}),(0,t.jsxs)("div",{"aria-hidden":w?"true":void 0,className:(0,H.clsx)({[eA.default.hidden]:w}),style:{position:"relative",width:32},children:[(0,t.jsx)(ei.Stack,{align:"center",className:(0,H.clsx)(eA.default.dot,{[eA.default.hidden]:A}),justify:"center",style:{left:_?-24:0},children:(0,t.jsx)("div",{"aria-label":"Not seen yet",role:"note"})}),(0,t.jsx)("div",{className:eA.default.archive,style:{opacity:_||f?1:0},...m,children:(0,t.jsx)(es.Button,{"aria-label":"Archive",className:eA.default.archiveButton,onBlur:()=>d(!1),onFocus:()=>d(!0),passthroughOnClick:e=>{e.preventDefault(),l(y)},shape:"circle",style:{width:32,height:32},svgOnly:!0,title:"Archive",type:"tertiary",children:(0,t.jsx)(et.Archive,{"aria-hidden":"true",color:h||f?"gray-1000":"gray-700"})})})]})]});return p?(0,t.jsx)(eo.Link,{"aria-roledescription":`${w?"Archived":A?"Previously seen":"Unseen"} Notification`,className:eA.default.link,"data-inbox":!w,"data-uid":v,href:p,onClick:()=>{r(y)},children:C}):C}function eC(e){let{ts:i}=e,n=(0,ew.useAgo)(i);return(0,t.jsxs)(en.Text,{color:"gray-900",size:14,title:new Date(i).toLocaleString(),weight:400,children:[(0,t.jsx)("span",{className:"geist-sr-only",children:", Created "}),n]})}var eN=e.i(4630293),eE=e.i(8719659),eM=e.i(8698247);function eI(e){let{thread:i}=e,{selectThread:n,thread:s}=(0,b.useSelectedComment)(),a=(0,eE.useUpdateComment)(),{team:l}=(0,p.useTeam)();return(0,t.jsx)("li",{children:(0,t.jsx)("button",{className:(0,H.clsx)(eM.default.commentWrapper,{[eM.default.selected]:s?.id===i.id}),onClick:()=>{n(i),i.read||a({threadId:i.id,roomId:i.roomId,read:!0,teamId:l?.id})},type:"button",children:(0,t.jsx)(eN.CommentsListItem,{padding:4,showMetadata:!1,thread:i})})})}var eS=e.i(2977232),eT=e.i(7017723);function eL(e){let{activeFeed:n,inbox:s,comments:l,tab:r,setTab:o,hasOpened:d,setHasOpened:c,settingsLink:h}=e,{team:m}=(0,p.useTeam)(),f=(0,j.useIsMobile)(),x=(0,eT.useIsImpersonating)(),[_,v]=(0,i.useState)({}),g=(0,i.useCallback)(()=>{v(Object.fromEntries(n.items.map(e=>[e.id,function(e,i,n){var s,a;let l,r,o,d=(l=[],r=(a=e).actors,(o=a.data?.icon)&&l.push({level:"primary",icon:o}),a.actors.length&&null!==r[0]&&l.push({level:"primary",id:r[0].id,avatar:r[0].avatar}),a.data?.focus&&!l.find(e=>"primary"===e.level)&&l.push({level:"primary",id:a.data.focus.id,avatar:a.data.focus.avatar}),l),c=e.blocks.find(e=>"body"===e.name),u=e.blocks.find(e=>"action_url"===e.name),h=u?.rendered??"";try{let e=new URL(h);e.searchParams.set("utm_medium","web"),e.searchParams.set("utm_source","notifications"),h=e.href}catch(e){}return{id:e.id,workflow:e.source.key,mainAvatar:function(e,i){let n=e.find(e=>"primary"===e.level);if(!n)return i?(0,t.jsx)(k.Avatar,{hash:i.avatar,size:36,teamId:i.id}):null;let{id:s,icon:a,avatar:l}=n;if(a){switch(a){case"alert":return(0,t.jsx)(N,{});case"warn":return(0,t.jsx)(C,{});case"success":return(0,t.jsx)(y,{});case"info":return(0,t.jsx)(E,{})}return}return I(s)?(0,t.jsx)(k.Avatar,{hash:l,size:36,teamId:s}):(0,t.jsx)(k.Avatar,{hash:l,size:36,uid:s})}(d,n),subAvatar:function(e,i){let n=e.find(e=>"secondary"===e.level);if(!n||i.hasIcon)return null;let{id:s,avatar:a}=n;return I(s)?(0,t.jsx)(k.Avatar,{hash:a,size:20,teamId:s}):(0,t.jsx)(k.Avatar,{hash:a,size:20,uid:s})}(d,{hasIcon:!!e.data?.icon}),icon:e.data?.icon,isSeen:!!e.seen_at,isArchived:!!e.archived_at,markup:c?(0,t.jsx)("div",{className:i,dangerouslySetInnerHTML:{__html:(s=c.rendered,M.default.sanitize(s))}}):(0,t.jsx)("div",{className:i}),ts:new Date(e.inserted_at).getTime(),actionUrl:h}}(e,eA.default.notificationContent,m)])))},[n.items,m]);(0,i.useEffect)(()=>{d&&g()},[d,n.items]);let w=(0,i.useMemo)(()=>l.threads.map(e=>(0,t.jsx)(eI,{thread:e},e.id)),[l.threads]),{thread:A,clearSelectedThread:T,selectThread:L}=(0,b.useSelectedComment)(),P=(0,i.useCallback)(e=>{if(0===s.items.length?o("comments"):o("inbox"),e){var t;c(!0),a.analytics.track(u.AnalyticsEvent.NOTIFICATIONS_SHOWN,{shownCount:s.unseen,isCountShown:s.unseen>0,shownGroup:0===(t=s.unseen)?"g0":t<=+Number(16)?"g1":t<=2*Number(16)?"g2":t<=3*Number(16)?"g3":t<=4*Number(16)?"g4":"gx"})}else T(),x||s.markAllSeen()},[T,x,o,s,c]),F=(0,i.useCallback)(()=>{x||s.markAllArchived()},[s,x]),W=(0,i.useMemo)(()=>"comments"===r?l.isEmpty:0===n.items.length,[r,n.items,l.isEmpty]),O=(0,i.useCallback)(()=>{if(!A)return;let e=l.threads.findIndex(e=>e.id===A.id);-1===e||e===l.threads.length-1||L(l.threads[e+1])},[l.threads,L,A]),H=(0,i.useCallback)(()=>{if(!A)return;let e=l.threads.findIndex(e=>e.id===A.id);-1===e||0===e||L(l.threads[e-1])},[l.threads,L,A]),D=(0,i.useMemo)(()=>{if(!A)return!1;let e=l.threads.findIndex(e=>e.id===A.id);return -1!==e&&e!==l.threads.length-1},[l.threads,A]),G=(0,i.useMemo)(()=>{if(!A)return!1;let e=l.threads.findIndex(e=>e.id===A.id);return -1!==e&&0!==e},[l.threads,A]);return(0,t.jsx)(q,{onOpenChange:P,unseen:s.unseen+l.unreadCount,children:(0,t.jsx)(ed.PreferencesProvider,{defaultLoaded:!0,children:(0,t.jsx)(eg,{clearSelectedThread:T,commentsIsLoading:l.isLoading,commentsIsStale:l.isStale,commentsUnread:l.unreadCount,currentTabEmpty:W,hasNextThread:D,hasPreviousThread:G,inboxUnread:s.unseen,onArchiveAll:F,onScrollEnd:n.fetchNextPage,selectNextThread:O,selectPreviousThread:H,setTab:o,settingsLink:h,tab:r,viewFreshComments:l.viewFreshData,children:"comments"===r?(0,t.jsx)(t.Fragment,{children:A?(0,t.jsx)(S.Comments,{className:eS.default.commentsDetailView,source:"dashboard-notifications-center",thread:A}):w}):n.items.map(e=>_[e.id]?(0,t.jsx)(eP,{archiveItem:s.archiveItem,impersonationMode:x,isMobile:f,item:e,presentation:_[e.id],readItem:s.readItem},`${r}-${e.id}`):null)})})})}function eP(e){let{item:n,presentation:s,readItem:a,archiveItem:l,isMobile:r,impersonationMode:o}=e,d=(0,i.useCallback)(e=>{o||l(n,e)},[l,o,n]),c=(0,i.useCallback)(e=>{o||a(n,e)},[o,a,n]);return(0,t.jsx)(ey,{archiveNotification:d,isMobile:r,notification:s,readNotification:c})}var eF=e.i(1110704);function eW(e){let{children:i}=e,n=g();return"full"!==n.state?i:(0,t.jsx)(f.CommentFilterContextProvider,{type:"modal",children:(0,t.jsx)(b.SelectedCommentContextProvider,{children:(0,t.jsx)(eO,{tenant:n.tenant,children:i})})})}function eO(e){let{children:n,tenant:r}=e,o=function(e){let{tenant:t}=e,n=(0,i.useRef)(0),r=g(),{account:o,user:d,team:_}=(0,l.useAccount)(),{token:b}=(0,h.useKnockToken)({}),[p,j]=(0,i.useState)(!1),[k,w]=(0,i.useState)("inbox");if(!d)throw Error("User not available");let A=v.exec(d.email)?"vtest314":d.uid,y=function(e){let{feed:t,items:n,metadata:s,loading:l,onArchiveAll:r,markAsArchived:o,markAllAsArchived:d}=e,c=(0,i.useRef)(!1);(0,i.useEffect)(()=>{c.current||(c.current=!0,t.fetch())},[t]);let h=(0,i.useCallback)(()=>{let e=n.filter(e=>null===e.seen_at);if(0!==e.length)return t.markAsSeen(e)},[t,n]),m=(0,i.useCallback)(()=>{d(),r()},[r,d]),f=(0,i.useCallback)(async(e,t)=>{let i=Date.now(),n=new Date(e.inserted_at).getTime();a.analytics.track(u.AnalyticsEvent.NOTIFICATIONS_ENGAGEMENT,{uid:e.id,workflow:t??"none",action:"archive",messageTs:n,actionTs:i,timeToAction:i-n}),await o(e)},[o]),x=(0,i.useCallback)(async(e,i)=>{let n=Date.now(),s=new Date(e.inserted_at).getTime();a.analytics.track(u.AnalyticsEvent.NOTIFICATIONS_ENGAGEMENT,{uid:e.id,workflow:i??"none",action:"read",messageTs:s,actionTs:n,timeToAction:n-s}),await t.markAsSeen(e).then(()=>t.markAsRead(e))},[t]),_=(0,i.useCallback)(()=>{n.length<s.total_count&&t.fetchNextPage()},[n.length,s.total_count,t]);return{items:n,loading:l,unseen:s.unseen_count,archiveItem:f,readItem:x,markAllSeen:h,markAllArchived:m,fetchNextPage:_}}({onArchiveAll:()=>{n.current=Date.now()},...c({tab:"inbox",userToken:b,userId:A,tenant:t})}),C=function(e){let{fetchEnabled:t,feed:n,items:s,metadata:a,loading:l}=e,[r,o]=(0,i.useState)(!1);(0,i.useEffect)(()=>{t&&!r&&(n.fetch(),o(!0))},[t,n,s,r]);let d=(0,i.useCallback)(()=>{s.length<a.total_count&&n.fetchNextPage()},[s.length,a.total_count,n]);return{loading:l,items:s,fetchNextPage:d,feed:n}}({fetchEnabled:p,...c({tab:"archived",userToken:b,userId:A,tenant:t})}),{filterValues:N}=(0,f.useCommentFilters)(),E="resolved"===N.status[0]||"unresolved"===N.status[0]?N.status[0]:void 0,M=(0,x.getIfNotEmpty)(N.q),I=(0,x.getIfNotEmpty)(N.project),S=(0,x.getIfNotEmpty)(N.author),T=(0,x.getIfNotEmpty)(N.page),L=(0,x.getIfNotEmpty)(N.pageRegex),P=(0,x.getIfNotEmpty)(N.branch),F=(0,m.useToolbarComments)({type:"inbox",q:M&&M[0].length>0?M[0]:void 0,teamId:_?.id,status:E,projectId:I,author:S,page:T,pageGlob:L,branch:P,limit:20,searchHeaderOnly:1}),W=(0,i.useCallback)(()=>C.feed.fetch(),[C.feed]);(0,i.useEffect)(()=>{"archived"===k&&Date.now()-n.current<3e4&&W()},[k,W]);let O={as:_?.slug?`/${_.slug}/~/settings/notifications`:"/account/notifications",href:_?.slug?"/teams/[teamSlug]/settings/notifications":"/account/notifications"},H="inbox"===k?y:C,D=(0,i.useCallback)(e=>{w(e),a.analytics.track(s.VercelSpecificAnalyticsEvent.NOTIFICATIONS_TAB_CHANGE,{tab:k,teamId:_?.id,commentsEnabled:o?.enablePreviewFeedback!=="off"})},[k,_?.id,o?.enablePreviewFeedback]);return{visibility:r,hasOpened:p,setHasOpened:j,tab:k,setTab:D,inbox:y,archive:C,comments:F,settingsLink:O,activeFeed:H}}({tenant:r});return(0,t.jsx)(_.Provider,{value:o,children:n})}function eH(){let e=g(),n=(0,i.useContext)(_);return e.isLoading?(0,t.jsx)(eF.PlaceholderBell,{visibility:e.state}):null===e.state?null:n?(0,t.jsx)(eL,{...n}):(0,t.jsx)(eF.PlaceholderBell,{visibility:e.state})}function eD(){return(0,t.jsx)(eW,{children:(0,t.jsx)(eH,{})})}(0,n.markLoadedForTest)("notifications"),e.s(["NotificationsProviderAndPopover",()=>eD],6561189)},4100285,e=>{e.n(e.i(6561189))}]);

//# sourceMappingURL=7e717c12e870a9b9.js.map
//# debugId=652d9c3a-2229-5467-bcb4-93f24ac1ad28
