
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="b5602e15-de33-575c-b337-a772b9358b23")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,2645806,e=>{"use strict";var t=e.i(6468255),l=e.i(6696646),n=e.i(9429645),i=e.i(6891161),a=e.i(455575),o=e.i(277234),s=e.i(4244280),r=e.i(9716741),d=e.i(4470704);let c=l.default.memo(e=>{let{active:c,onClose:u,deployment:h,teamId:m}=e,[p,f]=(0,l.useState)(!1),x=(0,a.useToasts)(),g=(0,l.useCallback)(async()=>{if(!h)return;f(!0);let e=m?"?teamId="+m:"",t=await (0,o.fetchAPI)(`${(0,s.API_DEPLOYMENTS)("v12")}/${h.id}/cancel`+e,{throwOnHTTPError:!1,method:"PATCH"});t.error&&x.error(`Could not cancel the deployment, it's ${h.readyState}`),"CANCELED"===t.readyState&&(x.success("The deployment has been successfully canceled."),(0,n.mutate)((0,d.getUrl)(h.id),{...h,readyState:t.readyState,status:t.readyState,canceledAt:t.canceledAt,host:h.url,isPrivate:!h.public})),f(!1),u()},[h,m,x,u]);return(0,t.jsxs)(i.Modal.Modal,{active:c,onClickOutside:u,width:"500px",children:[(0,t.jsxs)(i.Modal.Body,{children:[(0,t.jsx)(i.Modal.Header,{children:(0,t.jsx)(i.Modal.Title,{children:"Cancel Deployment"})}),(0,t.jsx)(r.default,{children:"Canceling this deployment will immediately stop the build, with no way to resume."}),(0,t.jsx)(r.default,{style:{margin:0},children:"Are you sure you want to continue?"})]}),(0,t.jsxs)(i.Modal.Actions,{children:[(0,t.jsx)(i.Modal.Action,{loading:!1,onClick:u,type:"secondary",children:"Close"}),(0,t.jsx)(i.Modal.Action,{disabled:p,loading:p,onClick:g,children:"Cancel deployment"})]})]})});e.s(["default",0,c])},2405448,e=>{"use strict";var t=e.i(542164);function l(e){return(0,t.default)(e)?e.slice(2):e}e.s(["default",()=>l])},9719784,e=>{"use strict";var t=e.i(6468255),l=e.i(6696646),n=e.i(57106),i=e.i(822157),a=e.i(7018452),o=e.i(2405448),s=e.i(542164),r=e.i(1681029),d=e.i(4478191);let c=(0,l.memo)(function(e){let{url:c,truncate:u,defaultRoute:h,...m}=e,[p,f]=(0,a.default)("#wildcard"),[x,g]=(0,l.useState)(null),[y,j]=(0,l.useState)(!1),b=(0,l.useCallback)(()=>{g((0,o.default)(c)),f(!0)},[g,f,c]);return c?(0,s.default)(c)?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.Link,{className:"pt-px leading-[16px] hover:underline",onClick:b,...m,onMouseEnter:()=>j(!0),style:{minWidth:0,maxWidth:u?"100%":void 0},children:u?(0,t.jsx)("span",{className:"geist-ellipsis",children:c}):c}),y||p?(0,t.jsx)(i.default,{active:p,onCancel:()=>{f(!1)},url:x}):null]}):(0,t.jsx)(n.Link,{className:"pt-px leading-[16px] hover:underline",external:!0,href:(0,d.withDefaultRoute)((0,r.domainToUrl)(c),h),...m,style:{minWidth:0,maxWidth:u?"100%":void 0},children:u?(0,t.jsx)("span",{className:"geist-ellipsis",children:c}):c}):null});e.s(["default",0,c])},822157,e=>{"use strict";var t=e.i(6468255),l=e.i(6696646),n=e.i(9177216),i=e.i(3500331),a=e.i(6891161),o=e.i(9318197),s=e.i(1681029);let r=(0,l.memo)(e=>{let{active:r,url:d,onCancel:c}=e,[u,h]=(0,l.useState)(""),m=(0,l.useMemo)(()=>!u||u.includes(".")||!(0,n.isValid)(`${u}.${d}`),[u,d]),p=(0,l.useCallback)(()=>{h(""),c()},[c]),f=(0,l.useCallback)(e=>{e.preventDefault(),window.open((0,s.domainToUrl)(`${u}.${d}`),"_blank","noopener"),p()},[u,d,p]);return d?(0,t.jsx)(a.Modal,{active:r,onClickOutside:p,children:(0,t.jsxs)("form",{onSubmit:f,children:[(0,t.jsxs)(a.Modal.Body,{children:[(0,t.jsx)(a.Modal.Title,{children:"Wildcard Domain"}),(0,t.jsx)(o.Spacer,{}),(0,t.jsx)(a.Modal.Subtitle,{children:"Enter a subdomain to visit below."}),(0,t.jsx)(o.Spacer,{y:.75}),(0,t.jsx)(i.Input,{autoFocus:!0,id:"hostname",label:"Hostname",onChange:e=>h(e.target.value),suffix:`.${d}`,value:u})]}),(0,t.jsxs)(a.Modal.Actions,{children:[(0,t.jsx)(a.Modal.Action,{onClick:c,children:"Cancel"}),(0,t.jsx)(a.Modal.Action,{buttonType:"submit",disabled:m,children:"Visit"})]})]})}):null});e.s(["default",0,r])},5229375,e=>{"use strict";var t=e.i(6696646),l=e.i(3911483),n=e.i(8815282),i=e.i(818351),a=e.i(8042625),o=e.i(277234),s=e.i(4244280),r=e.i(5338940);function d(e,t){let{deploymentId:l,teamId:n}=e;return(0,i.useIsomorphicSWR)(l?function(e){let{deploymentId:t,teamId:l}=e;return`${(0,s.API_DEPLOYMENTS)("v2")}/${t}/aliases${(0,a.encode)({teamId:l})}`}({deploymentId:l,teamId:n}):null,t)}function c(e,t){return(0,l.default)(()=>{if(!e)return null;let{team:t,id:l,teamId:n}=e;return`${(0,s.API_DEPLOYMENTS)("v2")}/${l}/aliases${(0,a.encode)({teamId:n??(t?t.id:null)})}`},e=>(0,o.fetchAPI)(e,{throwOnHTTPError:!0}),t)}function u(e,l){let{limit:i=20,domains:a,rollbackDeploymentId:d}=e,{isReady:c,team:u}=(0,r.useTeam)(),m=(0,n.default)((e,t)=>{if(!c)return null;let l=`${s.API_ALIASES}`,n=a?.map(e=>`domain=${encodeURIComponent(e)}`).join("&")||null;if(!e)return`${l}${h({limit:i+1,teamId:u?.id,rollbackDeploymentId:d},n)}`;let o=t?.aliases&&t.aliases.length>i?t.aliases[i-1].createdAt:null;return o?`${l}${h({limit:i+1,teamId:u?.id,until:o},n)}`:null},e=>(0,o.fetchAPI)(e,{throwOnHTTPError:!0}),l),p=(0,t.useMemo)(()=>m.data?[].concat(...m.data.filter(Boolean).map(e=>e.aliases.slice(0,i))):[],[m.data,i]),f=!!m.data&&!m.error,x=!!(m.data&&0===p.length),g=!!(m.data&&m.size>m.data.length),y=!!(m.data&&m.data[m.data.length-1]?.aliases.length<=i);return[m,{aliases:p,initialDataLoaded:f,isEmpty:x,loadMore:()=>m.setSize(e=>e+1),isLoadingMore:g,isReachingEnd:y}]}function h(e,t){let l=(0,a.encode)(e,!1),n=t?`&${t}`:"";return l?`?${l}${n}`:`?${n}`}e.s(["useAliases",()=>c,"useAliasesInfinite",()=>u,"useAliasesV2",()=>d],5229375)},663807,e=>{"use strict";let t=/^xn--/,l=/[^\0-\x7F]/,n=/[\x2E\u3002\uFF0E\uFF61]/g,i={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},a=Math.floor,o=String.fromCharCode;function s(e){throw RangeError(i[e])}function r(e,t){let l=e.split("@"),i="";return l.length>1&&(i=l[0]+"@",e=l[1]),i+(function(e,t){let l=[],n=e.length;for(;n--;)l[n]=t(e[n]);return l})((e=e.replace(n,".")).split("."),t).join(".")}function d(e){let t=[],l=0,n=e.length;for(;l<n;){let i=e.charCodeAt(l++);if(i>=55296&&i<=56319&&l<n){let n=e.charCodeAt(l++);(64512&n)==56320?t.push(((1023&i)<<10)+(1023&n)+65536):(t.push(i),l--)}else t.push(i)}return t}let c=e=>String.fromCodePoint(...e),u=function(e,t){return e+22+75*(e<26)-((0!=t)<<5)},h=function(e,t,l){let n=0;for(e=l?a(e/700):e>>1,e+=a(e/t);e>455;n+=36)e=a(e/35);return a(n+36*e/(e+38))},m=function(e){let t=[],l=e.length,n=0,i=128,o=72,r=e.lastIndexOf("-");r<0&&(r=0);for(let l=0;l<r;++l)e.charCodeAt(l)>=128&&s("not-basic"),t.push(e.charCodeAt(l));for(let c=r>0?r+1:0;c<l;){let r=n;for(let t=1,i=36;;i+=36){var d;c>=l&&s("invalid-input");let r=(d=e.charCodeAt(c++))>=48&&d<58?26+(d-48):d>=65&&d<91?d-65:d>=97&&d<123?d-97:36;r>=36&&s("invalid-input"),r>a((0x7fffffff-n)/t)&&s("overflow"),n+=r*t;let u=i<=o?1:i>=o+26?26:i-o;if(r<u)break;let h=36-u;t>a(0x7fffffff/h)&&s("overflow"),t*=h}let u=t.length+1;o=h(n-r,u,0==r),a(n/u)>0x7fffffff-i&&s("overflow"),i+=a(n/u),n%=u,t.splice(n++,0,i)}return String.fromCodePoint(...t)},p=function(e){let t=[],l=(e=d(e)).length,n=128,i=0,r=72;for(let l of e)l<128&&t.push(o(l));let c=t.length,m=c;for(c&&t.push("-");m<l;){let l=0x7fffffff;for(let t of e)t>=n&&t<l&&(l=t);let d=m+1;for(let p of(l-n>a((0x7fffffff-i)/d)&&s("overflow"),i+=(l-n)*d,n=l,e))if(p<n&&++i>0x7fffffff&&s("overflow"),p===n){let e=i;for(let l=36;;l+=36){let n=l<=r?1:l>=r+26?26:l-r;if(e<n)break;let i=e-n,s=36-n;t.push(o(u(n+i%s,0))),e=a(i/s)}t.push(o(u(e,0))),r=h(i,d,m===c),i=0,++m}++i,++n}return t.join("")},f=function(e){return r(e,function(e){return t.test(e)?m(e.slice(4).toLowerCase()):e})},x=function(e){return r(e,function(e){return l.test(e)?"xn--"+p(e):e})};e.s(["decode",()=>m,"default",0,{version:"2.3.1",ucs2:{decode:d,encode:c},decode:m,encode:p,toASCII:x,toUnicode:f},"encode",()=>p,"toASCII",()=>x,"toUnicode",()=>f,"ucs2decode",()=>d,"ucs2encode",()=>c])},9177216,(e,t,l)=>{"use strict";var n=e.r(663807),i={};i.rules=e.r(8765996).map(function(e){return{rule:e,suffix:e.replace(/^(\*\.|\!)/,""),punySuffix:-1,wildcard:"*"===e.charAt(0),exception:"!"===e.charAt(0)}}),i.endsWith=function(e,t){return -1!==e.indexOf(t,e.length-t.length)},i.findRule=function(e){var t=n.toASCII(e);return i.rules.reduce(function(e,l){return(-1===l.punySuffix&&(l.punySuffix=n.toASCII(l.suffix)),i.endsWith(t,"."+l.punySuffix)||t===l.punySuffix)?l:e},null)},l.errorCodes={DOMAIN_TOO_SHORT:"Domain name too short.",DOMAIN_TOO_LONG:"Domain name too long. It should be no more than 255 chars.",LABEL_STARTS_WITH_DASH:"Domain name label can not start with a dash.",LABEL_ENDS_WITH_DASH:"Domain name label can not end with a dash.",LABEL_TOO_LONG:"Domain name label should be at most 63 chars long.",LABEL_TOO_SHORT:"Domain name label should be at least 1 character long.",LABEL_INVALID_CHARS:"Domain name label can only contain alphanumeric characters or dashes."},i.validate=function(e){var t,l=n.toASCII(e);if(l.length<1)return"DOMAIN_TOO_SHORT";if(l.length>255)return"DOMAIN_TOO_LONG";for(var i=l.split("."),a=0;a<i.length;++a){if(!(t=i[a]).length)return"LABEL_TOO_SHORT";if(t.length>63)return"LABEL_TOO_LONG";if("-"===t.charAt(0))return"LABEL_STARTS_WITH_DASH";if("-"===t.charAt(t.length-1))return"LABEL_ENDS_WITH_DASH";if(!/^[a-z0-9\-]+$/.test(t))return"LABEL_INVALID_CHARS"}},l.parse=function(e){if("string"!=typeof e)throw TypeError("Domain name must be a string.");var t=e.slice(0).toLowerCase();"."===t.charAt(t.length-1)&&(t=t.slice(0,t.length-1));var a=i.validate(t);if(a)return{input:e,error:{message:l.errorCodes[a],code:a}};var o={input:e,tld:null,sld:null,domain:null,subdomain:null,listed:!1},s=t.split(".");if("local"===s[s.length-1])return o;var r=function(){return/xn--/.test(t)&&(o.domain&&(o.domain=n.toASCII(o.domain)),o.subdomain&&(o.subdomain=n.toASCII(o.subdomain))),o},d=i.findRule(t);if(!d)return s.length<2?o:(o.tld=s.pop(),o.sld=s.pop(),o.domain=[o.sld,o.tld].join("."),s.length&&(o.subdomain=s.pop()),r());o.listed=!0;var c=d.suffix.split("."),u=s.slice(0,s.length-c.length);return d.exception&&u.push(c.shift()),o.tld=c.join("."),u.length&&(d.wildcard&&(c.unshift(u.pop()),o.tld=c.join(".")),u.length&&(o.sld=u.pop(),o.domain=[o.sld,o.tld].join("."),u.length&&(o.subdomain=u.join(".")))),r()},l.get=function(e){return e&&l.parse(e).domain||null},l.isValid=function(e){var t=l.parse(e);return!!(t.domain&&t.listed)}},7018452,e=>{"use strict";var t=e.i(6696646);function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",[l,n]=(0,t.useState)(!1),i=window.location.hash,a=e.startsWith("#")?e:`#${e}`;return(0,t.useEffect)(()=>{let e=()=>{window.location.hash!==a||l||n(!0)};return window.addEventListener("hashchange",e),()=>{window.removeEventListener("hashchange",e)}},[l,a]),i!==a||l||(n(!0),window.history.replaceState(null,""," ")),i!==a&&l&&(window.location.hash=a),[l,n]}e.s(["default",()=>l])},9365163,4904548,e=>{"use strict";var t=e.i(6468255),l=e.i(6696646),n=e.i(5338940),i=e.i(1717203),a=e.i(7557283),o=e.i(4670733),s=e.i(588428),r=e.i(4396019),d=e.i(762945),c=e.i(7749291),u=e.i(9508212),h=e.i(8735244),m=e.i(1344973),p=e.i(2504781),f=e.i(6891161),x=e.i(455575),g=e.i(8522580),y=e.i(8761240),j=e.i(5756088),b=e.i(9386557),S=e.i(4004502),k=e.i(8042625),A=e.i(277234),v=e.i(4244280),T=e.i(5140444),C=e.i(4614946),D=e.i(5802506),I=e.i(6641571);e.i(9623499);var w=e.i(5576066),R=e.i(8815282),M=e.i(5229375);e.i(942336);var L=e.i(9668517);let O="[teamSlug]";var P=e.i(6060673),E=e.i(930810),_=e.i(7952834),N=e.i(1173672),$=e.i(8227242),B=e.i(9745887),H=e.i(3306538),F=e.i(5468328),W=e.i(9719784);function z(e){let{hidden:l,showIcon:n=!0,linkProps:i,defaultRoute:a}=e;return(0,t.jsx)(t.Fragment,{children:l.map(e=>(0,t.jsx)("div",{children:(0,t.jsx)(W.default,{defaultRoute:a,icon:n,title:e,truncate:!0,url:e,...i})},e))})}function U(e){let{hidden:l,linkProps:n}=e;return(0,t.jsx)(F.Tooltip,{text:(0,t.jsx)(z,{hidden:l,linkProps:n}),children:(0,t.jsx)(H.Badge,{size:"sm",variant:"gray-subtle",children:`+${l.length}`})})}let V=function(e){let{className:l,defaultRoute:n,domains:i,firstOnly:a,showIcon:o=!0,style:s,linkProps:r}=e;if(!i)return(0,t.jsx)(m.Text,{as:"span",className:l,color:"gray-900",style:s,weight:400,children:"-"});let{visible:d,hidden:c}=i.reduce((e,t)=>(0===e.visible.length||!a&&1===e.visible.length&&e.visible[0].length<=20?e.visible.push(t):e.hidden.push(t),e),{visible:[],hidden:[]});return(0,t.jsx)(m.Text,{as:"span",className:l,weight:500,children:(0,t.jsxs)(u.Stack,{align:"center",direction:"row",gap:2,style:{display:"flex",maxWidth:"100%",alignItems:"stretch",...s},children:[d.map((e,l)=>{let i=l===d.length-1;return(0,t.jsx)(W.default,{defaultRoute:n,icon:o,style:{marginRight:i?void 0:"var(--geist-gap-half)",minWidth:0},truncate:!0,url:e,...r},e)}),c.length?(0,t.jsx)(U,{hidden:c,linkProps:r}):null]})})};e.s(["default",0,V],4904548);var Y=e.i(8651268),q=e.i(2547843);function G(){return(0,t.jsx)(f.Modal.Header,{children:(0,t.jsx)(f.Modal.Title,{center:!0,children:"Instant Rollback"})})}function K(e){let{setStage:l}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(f.Modal.Body,{children:[(0,t.jsx)(G,{}),(0,t.jsx)(m.Text,{as:"p",style:{marginBottom:"24px"},children:"Error: You must select a deployment to roll back."})]}),(0,t.jsx)(f.Modal.Actions,{children:(0,t.jsx)(f.Modal.Action,{fullWidth:!0,onClick:()=>{l("initial")},type:"secondary",children:"Back"})})]})}function X(){return(0,t.jsx)("div",{children:(0,t.jsx)(g.Note,{className:"bg-yellow-50 border-yellow-300 border text-amber-700",fill:!0,label:!1,type:"warning",variant:"contrast",children:(0,t.jsxs)(u.Stack,{align:"center",direction:"row",gap:4,style:{padding:4},children:[(0,t.jsx)(d.Warning,{style:{flexShrink:0}}),(0,t.jsxs)(u.Stack,{align:"start",children:[(0,t.jsx)(m.Text,{as:"p",color:"inherit",children:"Make sure the domains listed above are correct."}),(0,t.jsx)(m.Text,{as:"p",color:"inherit",children:"This deployment has custom aliases not included in the project's domain settings."})]})]})})})}function J(e){var i;let a,{hasFloatingAliases:r,onCancel:d,previousDeployment:h,productionAliases:x,productionDeployment:y,project:b,rollbackCandidates:k,setStage:A,selectedDeployment:v,setSelectedDeployment:T,deploymentSwr:C,rollbackReason:D,setRollbackReason:I}=e,R=(i="/[teamSlug]",a=(0,L.useTeamSlug)(),(0,l.useMemo)(()=>i.includes(O)?i.replace(`/${O}`,a?`/${a}`:""):i,[a,i])),[M,P]=(0,l.useState)(!1),{team:_}=(0,n.useTeam)(),N=!_||_.billing?.plan==="hobby",{value:$}=(0,o.useInstantRollbackHobbyRestrictionFlag)(),{value:H}=(0,s.useInstantRollbackHobbyRestrictionTeamFlag)();return k.length&&h&&v?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(f.Modal.Body,{children:[(0,t.jsx)(G,{}),(0,t.jsxs)(u.Stack,{gap:4,children:[(0,t.jsxs)(u.Stack,{gap:2,children:[(0,t.jsxs)(m.Text,{as:"p",size:16,children:["Rolling back"," ",(0,t.jsx)(V,{domains:x,firstOnly:!0,style:{display:"inline-flex",fontWeight:"500"}})]}),r?(0,t.jsx)(X,{}):null,(0,t.jsx)("div",{children:(0,t.jsx)(B.DeploymentCardSmall,{deployment:y,isProductionDeployment:!0,selectedDeployment:v,setSelectedDeployment:T})})]}),(0,t.jsxs)(u.Stack,{gap:2,children:[(0,t.jsx)(m.Text,{as:"p",size:16,children:"To the following deployment:"}),M?(0,t.jsx)("div",{children:(0,t.jsx)(E.ChooseDeploymentList,{deployments:k,previousDeployment:h,productionDeployment:y,rolledBackDeploymentId:b?.lastAliasRequest?.type==="rollback"?b.lastAliasRequest.fromDeploymentId:void 0,selectedDeployment:v,setSelectedDeployment:T,swr:C})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:(0,t.jsx)(B.DeploymentCardSmall,{deployment:v,isForm:M,isPreviousDeployment:v.uid===h.uid,selectedDeployment:v,setSelectedDeployment:T})}),($||H)&&N?(0,t.jsx)(u.Stack,{style:{marginTop:"24px"},children:(0,t.jsx)(g.Note,{className:"bg-blue-50 border border-blue-500 text-blue-600",fill:!0,label:!1,size:"small",variant:"contrast",children:(0,t.jsxs)(u.Stack,{align:"center",direction:"row",gap:4,style:{padding:8},children:[(0,t.jsx)(j.LockClosed,{style:{transform:"translateX(1px)"}}),(0,t.jsxs)(u.Stack,{align:"start",direction:"column",children:[(0,t.jsx)(m.Text,{as:"p",color:"inherit",weight:500,children:"Looking for an earlier deployment?"}),(0,t.jsxs)("div",{children:[(0,t.jsx)(w.Link,{className:"inline-flex items-center justify-center gap-1 text-current no-underline",href:"/"===R?"/dashboard?createTeam=instant-rollback":`${R}?upgradeTeam=instant-rollback`,target:"_blank",children:(0,t.jsx)(m.Text,{as:"span",color:"inherit",children:"Upgrade to Pro"})}),(0,t.jsx)(c.ExternalSmall,{className:"ml-1"}),(0,t.jsx)(m.Text,{as:"span",color:"inherit",style:{whiteSpace:"nowrap"},children:"to roll back to an earlier deployment"})]})]})]})})}):(0,t.jsx)(p.Button,{onClick:()=>{P(!0)},type:"secondary",width:"100%",size:"small",children:"Choose another deployment"})]})]}),(0,t.jsxs)(u.Stack,{gap:2,children:[(0,t.jsx)(u.Stack,{as:"label",gap:1,htmlFor:"rollback-reason",children:(0,t.jsx)(m.Text,{as:"span",size:16,children:"Share a reason for this rollback:"})}),(0,t.jsx)(E.RollbackDescriptionTextarea,{value:D,onChange:I,id:"rollback-reason"})]})]})]}),(0,t.jsxs)(f.Modal.Actions,{children:[(0,t.jsx)(f.Modal.Action,{onClick:d,type:"secondary",children:"Cancel"}),(0,t.jsx)(f.Modal.Action,{"data-testid":(0,S.tid)("deployment","rollback-modal","continue-button"),disabled:D.length>=E.REASON_MAX_CHARACTER_LENGTH,onClick:()=>{A("selected")},children:"Continue"})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(f.Modal.Body,{children:[(0,t.jsx)(G,{}),(0,t.jsx)(m.Text,{as:"p",children:"This project does not have any valid deployments to roll back to."})]}),(0,t.jsx)(f.Modal.Actions,{children:(0,t.jsx)(f.Modal.Action,{onClick:d,type:"secondary",children:"Cancel"})})]})}function Q(e){let{selectedDeployment:l,setStage:n,requestRollback:i,project:a,rollbackReason:o,rollbackCandidates:s}=e,{user:r}=(0,T.useUser)();if(!l)return(0,t.jsx)(K,{setStage:n});let d=o.length>=E.REASON_MAX_CHARACTER_LENGTH,h=(0,E.getMostRecentlyPromotedDeployment)(s);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(f.Modal.Body,{children:[(0,t.jsx)(G,{}),(0,t.jsxs)(u.Stack,{gap:2,children:[(0,t.jsxs)(u.Stack,{gap:2,children:[(0,t.jsx)(m.Text,{size:16,children:"Rolling back to:"}),(0,t.jsx)(B.DeploymentCardSmall,{deployment:l,isPreviousDeployment:l.uid===h?.uid,selectedDeployment:l,setSelectedDeployment:()=>null})]}),o.trim()&&(0,t.jsx)(u.Stack,{gap:4,children:(0,t.jsx)(E.RollbackDescriptionCard,{rollbackDescription:{description:o.trim(),userId:r?.uid??"",username:r?.username??"",deploymentId:l.uid,projectId:a?.id??"",createdAt:new Date().getTime()},project:a,preview:!0})}),(0,t.jsxs)(I.UL,{className:"mb-0",children:[(0,t.jsx)(I.LI,{children:"Instant Rollback assigns domains to a previous deployment. All Environment Variables from the original build will remain. Cron jobs will be reverted to the state of the previous deployment."}),(0,t.jsxs)(I.LI,{children:[(0,t.jsxs)(w.Link,{className:"inline-flex items-center text-[var(--geist-success)] no-underline",href:`https://${l.url}`,target:"_blank",children:["View the selected deployment ",(0,t.jsx)(c.ExternalSmall,{className:"ml-1"})]})," ","before rolling back—external APIs, databases, and CMS platforms may not behave as expected."]}),(0,t.jsx)(I.LI,{children:"You can update the rollback reason from the project overview."})]}),(a?.autoAssignCustomDomains??!0)||a?.lastAliasRequest?.type==="rollback"?(0,t.jsx)(g.Note,{fill:!0,type:"secondary",children:(0,t.jsx)(u.Stack,{align:"center",direction:"row",gap:4,children:(0,t.jsx)(u.Stack,{align:"start",children:(0,t.jsx)(m.Text,{as:"p",color:"inherit",children:"After rolling back, production deployments will not be automatically promoted until the rollback is removed."})})})}):null]})]}),(0,t.jsxs)(f.Modal.Actions,{children:[(0,t.jsx)(f.Modal.Action,{onClick:()=>{n("initial")},type:"secondary",children:"Back"}),(0,t.jsx)(f.Modal.Action,{"data-testid":(0,S.tid)("deployment","rollback-modal","rollback-button"),disabled:d,onClick:()=>{i(l.uid),n("processing")},children:"Confirm Rollback"})]})]})}function Z(e){let{jobStatus:n,rollbackDeploymentId:i,rollbackCandidates:a,selectedDeployment:o,setStage:s,onCancel:r,statusSwr:d,requestRollback:c,rollbackReason:x}=e,{user:g}=(0,T.useUser)();if((0,l.useEffect)(()=>{i===o?.uid&&("failed"===n?s("error"):"succeeded"===n&&s("done"))},[i,n,o,s]),!o)return(0,t.jsx)(K,{setStage:s});let j=(0,E.getMostRecentlyPromotedDeployment)(a);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(f.Modal.Body,{children:[(0,t.jsx)(G,{}),(0,t.jsxs)(u.Stack,{gap:2,children:[(0,t.jsxs)(u.Stack,{gap:2,children:[(0,t.jsx)(m.Text,{children:"Assigning production domains:"}),(0,t.jsx)(B.DeploymentCardSmall,{deployment:o,isPreviousDeployment:o.uid===j?.uid,selectedDeployment:o,setSelectedDeployment:()=>null})]}),""!==x?(0,t.jsxs)("div",{className:"rounded bg-background-200 px-4 py-3 shadow-border",children:[(0,t.jsxs)(m.Text,{color:"gray-900",children:["“",(0,t.jsx)($.LinkParser,{text:x.trim()}),"”"]}),(0,t.jsxs)("div",{className:"flex gap-1 pt-1",children:[(0,t.jsx)(m.Text,{children:"Rolled back by"}),g?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Y.PrincipalAvatar,{size:20,principalId:g.uid,principal:{type:"user",uid:g.uid,username:g.username}}),(0,t.jsx)(m.Text,{children:g.username})]}):null]})]}):null,(0,t.jsxs)(I.UL,{className:"mx-4 my-0 list-none pt-2",children:[d.aliases.map(e=>{let l="loading";return"completed"===e.status?l="success":"failed"===e.status&&(l="error"),(0,t.jsx)(I.LI,{children:(0,t.jsxs)("div",{style:{height:"24px",display:"flex"},children:["loading"===l&&(0,t.jsx)(h.Spinner,{size:24}),"error"===l&&(0,t.jsx)(b.WarningFill,{color:"amber-800",size:24}),"success"===l&&(0,t.jsx)(y.CheckCircleFill,{color:"blue-700",size:24}),(0,t.jsx)(m.Text,{as:"span",style:{lineHeight:"24px",paddingLeft:"7px"},children:e.alias})]})},e.alias)}),!d.isReachingEnd&&d.initialDataLoaded?(0,t.jsx)(I.LI,{children:(0,t.jsx)(p.Button,{loading:d.isLoadingMore,onClick:()=>{d.loadMore()},style:{marginTop:24},type:"secondary",width:"100%",children:"Show More"})}):null]})]})]}),(0,t.jsx)(f.Modal.Actions,{children:(0,t.jsx)(f.Modal.Action,{"data-testid":(0,S.tid)("deployment","rollback-modal","finish-button"),fullWidth:!0,loading:"failed"!==n&&"succeeded"!==n,onClick:()=>{"failed"===n?c(o.uid):"succeeded"===n&&(s("initial"),r())},children:"failed"===n?"Retry":"Done"})})]})}function ee(e){let{active:i,initialSelectedDeployment:a,onCancel:o,productionBranch:s,productionDeployment:r,projectId:d,rollbackCandidates:c,swr:u,rollbackDescription:h}=e,{mutate:m}=(0,C.useSWRConfig)(),[p,g]=(0,l.useState)("initial"),[y,j]=(0,l.useState)(""),{isReady:b,team:T}=(0,n.useTeam)(),I=(0,x.useToasts)(),w=(0,l.useMemo)(()=>{let e=c.filter(e=>e.uid!==r.id);return(0,E.getMostRecentlyPromotedDeployment)(e)},[c,r]),[L,O]=(0,l.useState)(null),$=L??a??w??null,B=(0,l.useCallback)(g,[g]),H=(0,l.useCallback)(O,[O]),[,{aliases:F}]=(0,M.useAliasesInfinite)({rollbackDeploymentId:r.id}),{data:W}=(0,P.useProject)(d),{lastAliasRequest:z,hasFloatingAliases:U}=W||{lastAliasRequest:void 0,hasFloatingAliases:!1},{toDeploymentId:V,jobStatus:Y}=z||{toDeploymentId:null,jobStatus:null},[,G]=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,{isReady:a,team:o}=(0,n.useTeam)(),s=(0,R.default)((t,l)=>{if(!a)return null;let n={teamId:o?.id,limit:i};return t?l?.next?`${(0,v.API_PROJECTS_ROLLBACK_ALIAS_STATUS)(e)}${(0,k.encode)({...n,until:l.next})}`:null:`${(0,v.API_PROJECTS_ROLLBACK_ALIAS_STATUS)(e)}${(0,k.encode)(n)}`},e=>(0,A.fetchAPI)(e,{throwOnHTTPError:!0}),{refreshInterval:t}),r=(0,l.useMemo)(()=>s.data?[].concat(...s.data.filter(Boolean).map(e=>e.aliases.slice(0,i))):[],[s.data,i]),d=!!s.data,c=d&&0===r.length,u=d&&s.data&&s.size>s.data.length,h=d&&s.data&&s.data[s.data.length-1]?.aliases.length<i;return[s,{aliases:r,initialDataLoaded:d,isEmpty:c,loadMore:()=>s.setSize(e=>e+1),isLoadingMore:u,isReachingEnd:h,mutate:s.mutate}]}(d,2e3),K=(0,l.useMemo)(()=>r,[i]),X=()=>{g("initial"),O(a||w||null),o()},ee=(0,l.useCallback)(async e=>{if(!b)return;let t=`${(0,v.API_DEPLOYMENT_ROLLBACK)(d,e)}${(0,k.encode)({teamId:T?.id,description:y.trim()})}`;try{await (0,A.fetchAPI)(t,{throwOnHTTPError:!0,method:"POST",body:{}}),T&&(void 0!==W&&(0,_.revalidateProject)(m,W),await m((0,N.getProjectProductionDeploymentKey)({projectIdOrName:d,teamId:T.slug})),m((0,q.getRollingReleaseEndpoint)(T.slug,d)))}catch(e){I.error({text:"Something went wrong - please try requesting an Instant Rollback again",key:"rollback-deployment"}),(0,D.captureError)(e)}},[b,d,I,y,m,T,W]),et={rollbackDeploymentId:V,hasFloatingAliases:!!U,jobStatus:Y,onCancel:X,previousDeployment:w,productionBranch:s,productionDeployment:K,productionAliases:F.map(e=>{let{alias:t}=e;return t}),project:W,rollbackCandidates:c,setStage:B,selectedDeployment:$,setSelectedDeployment:H,deploymentSwr:u,statusSwr:G,requestRollback:ee,rollbackWarningText:"New deployments will not be automatically assigned production domains until this rollback is removed.",rollbackReason:y,setRollbackReason:j,rollbackDescription:h};return(0,t.jsxs)(f.Modal.Modal,{active:i,"data-testid":(0,S.tid)("deployment","rollback-modal"),onClickOutside:X,sticky:!0,width:"500px",children:["initial"===p&&(0,t.jsx)(J,{...et}),"selected"===p&&(0,t.jsx)(Q,{...et}),["processing","error","done"].includes(p)&&(0,t.jsx)(Z,{...et})]})}var et=e.i(5771992),el=e.i(5645345),en=e.i(3981247);e.i(3182268);var ei=e.i(7849855);function ea(e){let{team:t}=(0,n.useTeam)(),i=!t||t.billing?.plan==="hobby",{value:a}=(0,o.useInstantRollbackHobbyRestrictionFlag)(),{value:d}=(0,s.useInstantRollbackHobbyRestrictionTeamFlag)(),c=a||d,u=e?.name,{deployment:h,isLoading:m}=(0,r.useProjectProductionDeployment)(u);return(0,l.useMemo)(()=>{let t=(0,el.asListDeployment)(e),l=i&&!t?.isRollbackCandidate;return t?m?"Loading…":"readyState"in t&&"READY"!==t.readyState?"Only Deployments that are Ready can be rolled back.":"readySubstate"in t&&"PROMOTED"!==t.readySubstate?"Only Deployments previously aliased to a Production domain can be rolled back.":t.uid===h?.id?"This Deployment is already in Production.":c?t.isRollbackCandidate||"production"===t.target?l?"Hobby customers can only roll back to the previous deployment.":"":"Only Deployments previously aliased to a Production domain can be rolled back.":t.isRollbackCandidate?"":"Only Deployments previously aliased to a Production domain can be rolled back.":""},[e,i,m,h?.id,c])}function eo(e){let{onClose:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},[o,s]=(0,l.useState)(!1),[d,c]=(0,l.useState)(),{teamSlug:u,projectSlug:h}=(0,ei.useProjectAndTeamSlug)(),{data:m}=(0,P.useProject)(d?.name),p=h??d?.name,f=e??m,{data:x}=(0,en.useRollingRelease)({teamIdOrSlug:u,projectSlug:p}),g=x?.rollingRelease?x?.rollingRelease?.canaryDeployment?.id:void 0,{deployment:y,rollbackDescription:j,mutate:b}=(0,r.useProjectProductionDeployment)(f?.name),{can:S}=(0,i.default)({projectIdOrName:f?.name}),k=S(a.Action.Create,a.Resource.DeploymentRollback),A=f?.link?.productionBranch?f.link.productionBranch:void 0,[v,T]=(0,et.useDeploymentsInfinite)({projectId:f?f.id:"",requireProject:!0,limit:10,rollbackCandidate:!0},{}),{deployments:C,initialDataLoaded:D}=T,I=C.filter(e=>!!e.isRollbackCandidate&&e.uid!==g),w=!!(D&&f&&!I.length),R=(0,l.useCallback)(e=>{c((0,el.asListDeployment)(e)),s(!0)},[]),M=(0,l.useCallback)(()=>{s(!1),b().finally(()=>null),n?.()},[b,n]);return{rollbackModal:(0,l.useMemo)(()=>k&&o&&y&&f?(0,t.jsx)(ee,{active:o,initialSelectedDeployment:d,onCancel:M,productionBranch:A,productionDeployment:y,projectId:f.id,rollbackCandidates:I,rollbackDescription:j,swr:T}):null,[k,o,d,A,y,I,f,T,M,j]),closeRollbackModal:M,openRollbackModal:R,canRollbackDeployment:k,noRollbackCandidates:w}}e.s(["useInstantRollbackModal",()=>eo,"useRollbackTooltip",()=>ea],9365163)}]);

//# sourceMappingURL=30acad88c79f643b.js.map
//# debugId=b5602e15-de33-575c-b337-a772b9358b23
