
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="c9f8b638-1ed2-5990-b9b3-c817a668cca9")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,1482429,2128692,2863467,1135066,e=>{"use strict";var t=e.i(6468255),r=e.i(9192216),i=e.i(5086286),n=e.i(4998750),l=e.i(4244280),s=e.i(9668517),a=e.i(5338940),o=e.i(9979783),u=e.i(119294),c=e.i(6352514),d=e.i(6696646),m=e.i(4614946),p=e.i(6636464),g=e.i(8673480),f=e.i(2749380);function b(e){let{mutate:t}=(0,m.useSWRConfig)(),r=(0,s.useTeamSlug)()??"",{team:i}=(0,a.useTeam)(),b=i?.id,x=i?.billing?.plan??"hobby",y=(0,g.buildSWRKey)(l.API_NOTEBOOK,{id:e?.id,teamSlug:r}),h=(0,g.buildSWRKey)(l.API_NOTEBOOKS,{teamSlug:r}),{trigger:v,isMutating:w}=(0,p.default)(y,async(t,i)=>{let{arg:s}=i,a=s.id??e?.id;if(!a)throw Error("Notebook ID is required to save a notebook");return(0,n.parseNotebook)(await (0,o.typedFetchData)(l.API_NOTEBOOK,"put",{id:a,slug:r},{title:s.title,variables:(0,n.serializeVariables)(s.variables)},{throwOnHTTPError:!0}))},{revalidate:!1}),{trigger:j,isMutating:N}=(0,p.default)(y,async(t,i)=>{let{arg:n}=i,s=n?.id??e?.id;if(!s)throw Error("Notebook ID is required to delete a notebook");return(0,o.typedFetchData)(l.API_NOTEBOOK,"delete",{id:s,slug:r},{throwOnHTTPError:!0})},{revalidate:!1}),{trigger:E,isMutating:k}=(0,p.default)(y,async(t,i)=>{let{arg:s}=i,a=s?.id??e?.id;if(!a)throw Error("Notebook ID is required to share a notebook");return(0,n.parseNotebook)(await (0,o.typedFetchData)(l.API_NOTEBOOK_SHARE,"put",{id:a,slug:r},{},{throwOnHTTPError:!0}))},{revalidate:!1}),{trigger:T,isMutating:C}=(0,p.default)(y,async(t,i)=>{let{arg:s}=i,a=s.notebookId??e?.id;if(!a)throw Error("Notebook ID is required to save a notebook widget");let{id:u,query:c,...d}=s.widget;return(0,n.parseNotebook)(await (0,o.typedFetchData)(l.API_NOTEBOOK_WIDGET,"put",{id:a,slug:r,widgetId:u},{query:(0,f.serializeQuery)(c),...d},{throwOnHTTPError:!0}))},{revalidate:!1}),{trigger:O,isMutating:R}=(0,p.default)(y,async(t,i)=>{let{arg:s}=i,a=s.notebookId??e?.id;if(!a)throw Error("Notebook ID is required to remove a notebook widget");return(0,n.parseNotebook)(await (0,o.typedFetchData)(l.API_NOTEBOOK_WIDGET,"delete",{id:a,slug:r,widgetId:s.id},{throwOnHTTPError:!0}))},{revalidate:!1}),M=(0,d.useCallback)(async e=>(await Promise.all([t((0,g.buildSWRKey)(l.API_NOTEBOOK,{id:e.id,teamSlug:r}),e),t((0,g.buildSWRKey)(l.API_NOTEBOOKS,{teamSlug:r}),(0,g.updateCachedList)(e))]),e),[r,t]);return{saveNotebook:async e=>{let t=await M(await v(e,{optimisticData:(0,g.updateCachedNotebook)(e),rollbackOnError:!0}));return u.analytics.track(c.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_EDITED,{teamId:b,plan:x,operation:"title_edited",source:"notebook-details-page"}),t},deleteNotebook:async r=>{await j(r),u.analytics.track(c.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_DELETED,{teamId:b,plan:x,source:"notebook-details-page"});let i=r?.id??e?.id;return await t(h,(0,g.updateCachedList)({id:i},!1)),null},shareNotebook:async e=>{let t=M(await E(e));return u.analytics.track(c.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_EDITED,{teamId:b,plan:x,operation:"notebook_shared",source:"notebook-details-page"}),t},saveWidget:async(e,t)=>{let r=await M(await T(e,{optimisticData:(0,g.updateCachedNotebook)({},e.widget),rollbackOnError:!0}));return u.analytics.track(c.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_EDITED,{teamId:b,plan:x,operation:"new"===e.widget.id?"widget_added":"widget_edited",source:t??"notebook-details-page"}),r},removeWidget:async e=>{let t=await M(await O(e,{optimisticData:(0,g.updateCachedNotebook)({},null,e.id),rollbackOnError:!0}));return u.analytics.track(c.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_EDITED,{teamId:b,plan:x,operation:"widget_removed",source:"notebook-details-page"}),t},isSaving:w||N||k||C||R}}e.s(["useNotebookOperations",()=>b],2128692);var x=e.i(7371622),y=e.i(5115727),h=e.i(2126130),v=e.i(9992248),w=e.i(2504781),j=e.i(5468328),N=e.i(455575),E=e.i(9100551);let k="new-notebook";function T(e){let{query:l}=e,{hasObservabilityPlusAccess:s,ready:o}=(0,h.useHasObservabilityPlus)(),u=!o||!s,{notebooks:c}=(0,x.useNotebooks)(),{createNotebook:m,isSaving:p}=(0,i.useCreateNotebook)(),{saveWidget:g,isSaving:f}=b(),[T,S]=(0,d.useState)(!1),{team:I}=(0,a.useTeam)(),A=(0,N.useToasts)(),D=(0,E.useRouter)(),B=(0,y.useDefaultQueryTitle)(l),P=(0,d.useMemo)(()=>c.map(e=>({...e,group:I&&e.contributors.includes(I.id)?"Team":"Personal"})),[c,I]),F=(0,d.useCallback)(e=>{(async()=>{try{if(!I)throw Error("Team not found");S(!1);let t=e.id,r={id:"new",query:l,title:B};t===k?t=(await m({title:e.title,widget:r},"query-builder")).id:await g({notebookId:t,widget:r},"query-builder"),D.push(`/${I.slug}/~/observability/notebooks/${t}`)}catch(e){A.error({preserve:!0,text:(0,t.jsxs)(t.Fragment,{children:["Failed to add query to the notebook.",(0,t.jsx)("br",{}),(0,n.extractError)(e)]})})}})()},[m,g,B,l,A,D,I]),q=(0,t.jsx)(w.Button,{disabled:u,loading:f||p,onClick:()=>S(!0),size:"medium",type:"default",typeName:"button",children:"Add to Notebook"});return u?(0,t.jsx)(j.Tooltip,{text:"Unlock all advanced query features with Observability Plus",children:q}):(0,t.jsxs)(v.Root,{modal:!0,onOpenChange:S,open:T,children:[(0,t.jsx)(v.Anchor,{className:"flex",children:(0,t.jsx)(v.Trigger,{asChild:!0,children:q})}),(0,t.jsx)(v.Portal,{children:(0,t.jsx)(v.Content,{align:"end",onCloseAutoFocus:()=>S(!1),sideOffset:8,children:(0,t.jsx)(r.CommandMenu,{getId:O,getValue:R,label:"notebook",onChange:F,options:P,parseNewValue:C,renderItem:M,reverse:!0,allowEmptyAdd:!0,addLabel:"Create"})})})]})}function C(e){return{id:k,title:e||"Untitled Notebook",group:"Personal"}}function O(e){return e.id}let R=e=>{let{title:t,group:r}=e;return`${t}${r?` ${r}`:""}`};function M(e){return(0,t.jsx)("div",{className:"flex w-full items-center gap-2 px-2 py-1.5",children:(0,t.jsx)("span",{children:e.title})})}e.s(["AddToNotebookButton",()=>T],1482429);var S=e.i(1482596),I=e.i(8815885),A=e.i(3500331),D=e.i(5255926),B=e.i(8923565),P=e.i(1663964),F=e.i(244424),q=e.i(1918911),_=e.i(7749365),L=e.i(9096446),z=e.i(218692),Q=e.i(4047087),U=e.i(3675495),K=e.i(2006677),$=e.i(6143247),G=e.i(2713400),V=e.i(5033426),W=e.i(8119470),Y=e.i(1794286),H=e.i(7432042);function J(e){let{value:r,onChange:i,disabled:l,trackEvents:s,variables:a}=e,{start:o,end:u}=(0,f.fromTimeToRange)(r),c=(0,W.subDays)(new Date,90),d=(0,f.getTimeRangePresets)(!0,a?.time?{[n.TIME_VARIABLE]:{start:new Date,end:new Date,text:`Notebook (${(0,f.printTime)(a.time)})`}}:void 0),m=Object.keys(d).findIndex(e=>e===r);return(0,t.jsx)(Y.Calendar,{allowClear:!1,compact:!0,minValue:c,disabled:l,onChange:(e,t)=>{let r=new Date(e.start),n=new Date(e.end),l=t||(0,H.default)(n.getTime()-r.getTime());s&&(0,V.track)("Query Builder Changed Date Range Period",{period:l}),t?i(t):i({from:r,to:n})},popoverAlignment:"center",presetIndex:m,presets:d,size:"small",value:{start:o,end:u},width:"210px"},"date-range-select-query-builder")}e.s(["DateRangeSelect",()=>J],2863467);var X=e.i(9689002),Z=e.i(7087273),ee=e.i(1344973),et=e.i(2942788),er=e.i(3228096),ei=e.i(4333930),en=e.i(4796642),el=e.i(787358),es=e.i(8004707),ea=e.i(1898517),eo=e.i(1379708),eu=e.i(6401841),ec=e.i(4141852),ed=e.i(762945),em=e.i(7807066),ep=e.i(2712781),eg=e.i(2923544),ef=e.i(1813317);function eb(e){let[r,i]=function(){let[e,t]=(0,d.useState)({x:0,y:0});return(0,d.useEffect)(()=>{let e=e=>{t({x:e.clientX,y:e.clientY})};return window.addEventListener("mousemove",e),()=>{window.removeEventListener("mousemove",e)}},[]),[e.x,e.y]}(),[n,l]=(0,d.useState)({button:null,container:null,metrics:null,firstMetric:null});(0,d.useEffect)(()=>{let t=()=>{if(!e.containerRef.current||!e.metricsRef.current)return void l({button:null,container:null,metrics:null,firstMetric:null});let t=e.metricsRef.current.querySelectorAll("button");0===t.length?l({button:null,container:null,metrics:null,firstMetric:null}):l({button:e.buttonRef.current?.getBoundingClientRect()||null,container:e.containerRef.current.getBoundingClientRect(),metrics:e.metricsRef.current.getBoundingClientRect(),firstMetric:t[0].getBoundingClientRect()})};t();let r=new ResizeObserver(t);return e.buttonRef.current&&r.observe(e.buttonRef.current),e.containerRef.current&&r.observe(e.containerRef.current),e.metricsRef.current&&r.observe(e.metricsRef.current),()=>r.disconnect()},[e.buttonRef,e.containerRef,e.metricsRef]);let[s,a]=(0,d.useState)({x:r,y:i});(0,d.useEffect)(()=>{let e=setTimeout(()=>{a({x:r,y:i})},16);return()=>clearTimeout(e)},[r,i]);let o=(0,d.useMemo)(()=>{if(!n.container||!n.metrics||!n.firstMetric)return null;let e=Math.min(n.metrics.bottom,n.container.bottom),t=s.x-n.container.left,r=n.button?n.button.right-n.container.left:260,i=Math.min(1,Math.max(0,(t-.5*r)/(.5*r))),l=s.y-n.container.top,a=Math.max(260,r),o=Math.max(n.button?n.button.left-n.container.left:0,Math.min(t-(8+18*i),a-10)),u=a-o,c=l;if(n.button){let e=n.button.top-n.container.top,t=n.button.bottom-n.container.top;if(l>=e-10&&l<=t+10){let t=Math.max(0,Math.min(n.button.height,l-e));c=e+t}}let d=n.firstMetric.top-n.container.top,m=e-n.container.top,p=Math.max(50,c),g=Math.min(p,Math.max(50,d)),f=m-g;if(f<=0||u<=0||!Number.isFinite(g)||!Number.isFinite(c)||!Number.isFinite(o))return null;let b=Math.max(0,Math.min(100,(p-g)/f*100));return{position:"absolute",left:`${o}px`,top:`${g}px`,width:`${u}px`,height:`${f}px`,clipPath:`polygon(0 ${b}%, 100% 0, 100% 100%, 0 ${b}%)`,pointerEvents:"auto",zIndex:1,cursor:"pointer"}},[s.x,s.y,n]);return o?(0,t.jsx)("div",{className:"group-hover:block hidden",style:o,onMouseEnter:e.onMouseEnter,onWheel:t=>{e.eventsScrollerRef.current&&(e.eventsScrollerRef.current.scrollTop+=t.deltaY)},onClick:e=>{let t=document.elementsFromPoint(e.clientX,e.clientY).find(t=>t!==e.currentTarget&&("BUTTON"===t.tagName||t.closest("button")));if(t){let e="BUTTON"===t.tagName?t:t.closest("button");e&&e.click()}}}):null}let ex={incomingRequest:er.Globe,serverlessFunctionInvocation:ei.FunctionSquare,edgeFunctionInvocation:en.FunctionEdge,middlewareInvocation:el.FunctionMiddleware,edgeMiddlewareInvocation:el.FunctionMiddleware,outgoingRequest:es.ArrowGlobe,imageTransformation:ea.Image,imageTransformationFailure:ea.Image,isrOperation:eo.Isr,blockedConnection:eu.Stop,firewallAction:ec.FirewallFlame,botIdCheck:ed.Warning,aiGatewayRequest:ep.Sparkles};function ey(e){return ex[e]||et.Database}let eh=["count","durationMs","functionDurationMs","functionWallTimeMs","functionCpuTimeMs","functionDurationGbhr","ttfbMs","coldStartDurationMs","initDurationMs","fotInBytes","fotOutBytes","fotTotalBytes","isrReadBytes","isrWriteBytes","isrReadUnits","isrWriteUnits","vdcReadUnits","invokedMemoryMb","maxMemoryUsedMb","billedMemoryMb"];function ev(e){return(0,ef.getAggregableMeasures)(e).map(t=>({id:t,label:(0,eg.labelForMeasure)(e,t)})).toSorted((e,t)=>{let r=eh.indexOf(e.id),i=eh.indexOf(t.id);return -1!==r&&-1!==i?r-i:-1!==r?-1:-1!==i?1:e.label.localeCompare(t.label)})}function ew(e){let{disabled:r,selectedEventId:i,selectedMetricId:n,events:l,onSelect:s}=e,[a,o]=(0,d.useState)(!1),[u,c]=(0,d.useState)(""),[m,p]=(0,d.useState)(null),[g,f]=(0,d.useState)(null),[b,x]=(0,d.useState)(!1),[y,h]=(0,d.useState)(!1),[j,N]=(0,d.useState)("events"),[E,k]=(0,d.useState)(null),T=(0,d.useRef)(null),C=(0,d.useRef)(null),O=(0,d.useRef)(null),R=(0,d.useRef)(null),M=(0,d.useRef)(new Map),S=(0,d.useRef)(null),I=(0,d.useMemo)(()=>l.find(e=>e.id===i),[l,i]),A=(0,d.useMemo)(()=>{if(!u.trim())return{events:l,metrics:[],firstMatchingEventId:null};let e=u.toLowerCase(),t=new Set,r=null;return l.forEach(i=>{i.label.toLowerCase().includes(e)&&(t.add(i.id),r||(r=i.id))}),l.forEach(i=>{(0,ef.getAggregableMeasures)(i.id).map(e=>({id:e,label:(0,eg.labelForMeasure)(i.id,e)})).some(t=>t.label.toLowerCase().includes(e)||t.id.toLowerCase().includes(e))&&(t.add(i.id),r||(r=i.id))}),{events:l.filter(e=>t.has(e.id)),firstMatchingEventId:r}},[l,u]),D=y&&"metrics"===j&&E?E:m||(u.trim()&&A.firstMatchingEventId?A.firstMatchingEventId:i)||A.events[0]?.id,B=(0,d.useMemo)(()=>l.find(e=>e.id===D),[l,D]),P=(0,d.useMemo)(()=>D?ev(D):[],[D]),F=(0,d.useMemo)(()=>{if(!u.trim())return P;let e=u.toLowerCase(),t=P.filter(t=>t.label.toLowerCase().includes(e)||t.id.toLowerCase().includes(e));return 0===t.length&&D?P:t},[P,u,D]),_=(0,d.useMemo)(()=>{let e={};return A.events.forEach(t=>{let r=t.group||"Other";e[r]||(e[r]=[]),e[r].push(t)}),Object.entries(e).sort((e,t)=>{let[r]=e,[i]=t;return"Deprecated"===r&&"Deprecated"!==i?1:"Deprecated"!==r&&"Deprecated"===i?-1:0})},[A.events]),L=(0,d.useMemo)(()=>{let e=_.flatMap(e=>{let[,t]=e;return t});return m&&!e.some(e=>e.id===m),e},[_,m]),z=(0,d.useCallback)((e,t)=>{s(e,t),o(!1),c("")},[s]),Q=(0,d.useCallback)(e=>{if(y)k(e),N("metrics");else{let t=ev(e)[0];t&&z(e,t.id)}},[y,z]),U=(0,d.useCallback)(e=>{let t=y&&E?E:D;t&&z(t,e)},[y,E,D,z]),K=(0,d.useCallback)(e=>{if("ArrowDown"===e.key)if(e.preventDefault(),x(!0),m||g){if(m&&!g){let e=L.findIndex(e=>e.id===m);if(-1===e){let e=L[0];e&&p(e.id)}else{let t=L[e+1];t&&p(t.id)}}else if(g){let e=F.findIndex(e=>e.id===g),t=F[e+1];t&&f(t.id)}}else{let e=L[0];e&&p(e.id)}else if("ArrowUp"===e.key){if(e.preventDefault(),x(!0),m&&!g){let e=L.findIndex(e=>e.id===m);if(-1===e){let e=L[L.length-1];e&&p(e.id)}else e>0&&p(L[e-1].id)}else if(g){let e=F.findIndex(e=>e.id===g);e>0?f(F[e-1].id):f(null)}}else if("ArrowRight"===e.key)e.preventDefault(),x(!0),m&&F.length>0&&f(F[0].id);else if("ArrowLeft"===e.key)e.preventDefault(),x(!0),g&&f(null);else if("Enter"===e.key){if(m&&g)z(m,g);else if(m)if(u.trim()&&F.length>0)z(m,F[0].id);else{let e=l.find(e=>e.id===m);e&&Q(e.id)}}else"Escape"===e.key&&o(!1)},[L,F,m,g,z,l,Q,u]);(0,d.useEffect)(()=>{a&&(p(null),f(null),i&&C.current&&setTimeout(()=>{let e=C.current?.querySelector(`[data-event-id="${i}"]`);e?.scrollIntoView({block:"nearest",behavior:"auto"})},50))},[a,i]),(0,d.useEffect)(()=>{!m||L.some(e=>e.id===m)||u.trim()&&m===A.firstMatchingEventId||p(null)},[m,L,u,A.firstMatchingEventId]),(0,d.useEffect)(()=>{u.trim()&&A.firstMatchingEventId&&!b?(p(A.firstMatchingEventId),l.some(e=>e.id===A.firstMatchingEventId&&e.label.toLowerCase().includes(u.toLowerCase()))||F.length):u.trim()||i||p(null)},[u,A.firstMatchingEventId,F.length,i,l,b]),(0,d.useEffect)(()=>{if(b&&m&&C.current){let e=C.current.querySelector(`[data-event-id="${m}"]`);e&&e.scrollIntoView({block:"center",behavior:"smooth"})}},[m,b]),(0,d.useEffect)(()=>{let e=()=>{h(window.innerWidth<640)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,d.useEffect)(()=>{a||(N("events"),k(null))},[a]);let G=(0,d.useMemo)(()=>(function(e,t){if(!t||!e)return null;let r=(0,ef.getAggregableMeasures)(e).find(e=>e===t);return r?{id:r,label:(0,eg.labelForMeasure)(e,r)}:null})(i,n),[i,n]),V=I&&G?(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsxs)("span",{children:[I.label," "]}),(0,t.jsx)("span",{className:"text-gray-900 inline-block ml-1",children:G.label})]}):"Select Metric";return(0,t.jsxs)(v.Root,{modal:!0,onOpenChange:o,open:a,children:[(0,t.jsx)(v.Anchor,{className:"flex",children:(0,t.jsx)(v.Trigger,{asChild:!0,children:(0,t.jsx)(w.Button,{"aria-label":"Select event and metric",className:(0,$.cn)("!px-2 !py-4",r&&"!bg-white"),disabled:r,prefix:I?d.default.createElement(ey(I.id),{color:"gray-900"}):(0,t.jsx)(et.Database,{color:"gray-900"}),size:"small",suffix:(0,t.jsx)(q.ChevronUpDown,{color:"gray-800"}),type:"secondary",typeName:"button",children:V})})}),(0,t.jsx)(v.Portal,{children:(0,t.jsx)(v.Content,{align:"start",className:"tailwind-preflight",sideOffset:8,children:(0,t.jsxs)("div",{ref:R,className:(0,$.cn)("flex rounded-lg border-gray-alpha-400 bg-background-100 shadow-menu overflow-hidden font-sans relative isolate group",y?"w-[320px]":"w-[520px]"),children:[m&&!y&&(0,t.jsx)(eb,{buttonRef:m&&M.current.get(m)?{current:M.current.get(m)||null}:{current:null},containerRef:R,metricsRef:O,eventsScrollerRef:S,onMouseEnter:()=>{p(m)}}),(0,t.jsxs)("div",{className:"flex flex-1 flex-col",children:[y&&"metrics"===j&&(0,t.jsx)("div",{className:"flex items-center border-b px-2 py-3",children:(0,t.jsxs)("button",{onClick:()=>N("events"),className:"flex items-center gap-1 bg-transparent text-sm text-gray-800 hover:text-gray-900",type:"button",children:[(0,t.jsx)(em.ChevronRight,{className:"size-3 rotate-180"}),"Back to Events"]})}),!(y&&"metrics"===j)&&(0,t.jsxs)("div",{className:"flex items-center justify-between border-b px-4 py-3",children:[(0,t.jsx)("input",{className:"w-full border-none bg-transparent text-sm outline-none",onChange:e=>c(e.target.value),placeholder:"Find metric…",ref:T,value:u,onKeyDown:K}),(0,t.jsx)(X.Kbd,{small:!0,style:{paddingRight:"0.5rem"},children:"Esc"})]}),(0,t.jsx)("div",{className:(0,$.cn)("flex h-[340px]",y&&"flex-col"),children:u.trim()&&0===A.events.length?(0,t.jsx)("div",{className:"flex flex-1 items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center text-sm text-gray-800",children:[(0,t.jsx)("div",{className:"mb-2",children:"No events or metrics found"}),(0,t.jsx)("div",{className:"text-xs text-gray-600",children:"Try adjusting your search terms"})]})}):(0,t.jsxs)(t.Fragment,{children:[(!y||"events"===j)&&(0,t.jsx)("div",{className:(0,$.cn)(y?"flex-1":"w-[260px] border-r"),children:(0,t.jsx)(Z.Scroller,{className:"h-[340px]",overflow:"y",setContainerRef:e=>{S.current=e},children:(0,t.jsx)("div",{className:"px-2 py-2",ref:C,children:_.map(e=>{let[r,n]=e;return(0,t.jsxs)("div",{className:"mb-2",children:[(0,t.jsx)(ee.Text,{className:"mb-1 px-2 text-xs text-gray-800",children:r}),n.map(e=>{let r=ey(e.id),n=function(e){let{eventId:t,selectedEventId:r,activeEventId:i,activeMetricId:n,displayEventId:l}=e,s=t===r,a=t===l;return{isSelected:s,isActive:t===i,isDisplayed:a,showSelectedBg:s&&!i,isIndirectlyActive:a&&n}}({eventId:e.id,selectedEventId:i,activeEventId:m,activeMetricId:g,displayEventId:D});return(0,t.jsxs)("button",{ref:t=>{t?M.current.set(e.id,t):M.current.delete(e.id)},"data-event-id":e.id,className:(0,$.cn)("flex w-full items-center gap-2 rounded px-2 py-1.5 text-sm font-sans cursor-pointer","bg-white focus:bg-gray-100 focus:outline-none",!b&&"hover:bg-gray-100",(n.showSelectedBg||n.isIndirectlyActive)&&"bg-gray-100",n.isActive&&!g&&"bg-gray-100"),onMouseEnter:()=>{b||p(e.id)},onMouseMove:()=>x(!1),onFocus:()=>p(e.id),onClick:()=>Q(e.id),type:"button",children:[(0,t.jsx)(r,{className:"size-4",color:"gray-900"}),(0,t.jsx)("span",{className:"flex-1 text-left",children:e.label}),(0,t.jsx)(em.ChevronRight,{className:(0,$.cn)("size-3 text-gray-800 ",n.isDisplayed?"opacity-100":"opacity-0")})]},e.id)})]},r)})})})}),(!y||"metrics"===j)&&(0,t.jsx)("div",{className:(0,$.cn)("flex-1"),ref:O,children:(0,t.jsx)(Z.Scroller,{className:"h-[340px]",overflow:"y",children:(0,t.jsxs)("div",{className:"px-2 py-2",children:[B&&(0,t.jsxs)(ee.Text,{className:"mb-1 px-2 text-xs text-gray-800",children:["Metrics for ",B.label]}),F.length>0?F.map((e,r)=>{let l=function(e){let{metricId:t,metricIndex:r,selectedMetricId:i,activeEventId:n,activeMetricId:l,displayEventId:s,selectedEventId:a,isMobile:o,mobileStep:u}=e,c=t===i&&s===a;return{isSelected:c,isActive:(!o||"metrics"!==u)&&t===l,isFirstAndActive:(!o||"metrics"!==u)&&0===r&&n&&!l&&!c,showSelectedBg:c&&!l}}({metricId:e.id,metricIndex:r,selectedMetricId:n,activeEventId:m,activeMetricId:g,displayEventId:D,selectedEventId:i,isMobile:y,mobileStep:j});return(0,t.jsx)("button",{className:(0,$.cn)("flex w-full items-center rounded px-2 py-1.5 text-sm font-sans cursor-pointer","bg-white focus:bg-gray-100 focus:outline-none",!b&&"hover:bg-gray-100",(l.isFirstAndActive||l.showSelectedBg)&&"bg-gray-100",l.isActive&&"bg-gray-100"),onMouseEnter:()=>{b||y&&"metrics"===j||f(e.id)},onMouseLeave:()=>{b||y&&"metrics"===j||f(null)},onMouseMove:()=>x(!1),onClick:()=>U(e.id),type:"button",children:(0,t.jsx)("span",{className:"flex-1 text-left",children:e.label})},e.id)}):(0,t.jsx)("div",{className:"px-2 py-4 text-center text-sm text-gray-800",children:u?"No metrics match your search":"No metrics available"})]})})})]})})]})]})})})]})}var ej=e.i(1435235),eN=e.i(8735244),eE=e.i(2924363),ek=e.i(7867910),eT=e.i(1438473);function eC(e){let{onGeneratedQuery:r,query:i,disabled:n,className:s}=e,o=(0,N.useToasts)(),{team:m}=(0,a.useTeam)(),p=(0,d.useRef)(null),[g,f]=(0,d.useState)(!1),[b,x]=(0,d.useState)(""),{isGenerating:y,generate:h,error:v}=(e=>{let{onSuccess:t,query:r}=e,[i,n]=(0,d.useState)(!1),[s,o]=(0,d.useState)(null),{team:m}=(0,a.useTeam)(),p=(0,N.useToasts)();return{isGenerating:i,generate:(0,d.useCallback)(async e=>{if(!e.trim())return;n(!0);let i=new URLSearchParams({previousQuery:JSON.stringify(r),prompt:e}).toString();try{let e=await fetch(`${l.API_OBSERVABILITY_QUERY_GENERATION}?${i}`),r=await e.json(),n=r.rollups.value,s=(0,ef.getGroupableDimensions)(r.event),a=r.groupBy?.filter(e=>s.includes(e))??[];o(null),t({metric:`${r.event}.${n.measure}`,by:a,filter:r.filter??"",aggregation:n.aggregation,time:r.range??{from:new Date(r.startTime),to:new Date(r.endTime)}})}catch{let e="Error generating query";p.error(e),o(e)}finally{n(!1),u.analytics.track(c.AnalyticsEvent.QUERY_BUILDER_GENERATED_QUERY,{prompt:e,plan:m?.billing?.plan??"hobby"})}},[t,r,m,p]),error:s}})({query:i,onSuccess:e=>{r(e),p.current={query:JSON.stringify(e),prompt:b},x("")}}),j=(0,d.useRef)(null),[E,k]=(0,d.useState)(!1),T=E&&!y&&!v,C=async e=>{e.preventDefault(),b.trim()&&(k(!0),await h(b))},O="query-builder-input";return(0,ek.useHotkey)(()=>{f(!0),setTimeout(()=>j.current?.focus(),0)},"/"),(0,t.jsx)(ej.Root,{className:(0,$.cn)("border-t border-gray-400 px-4 bg-background-100",s),collapsible:!0,value:g?"query-assistant":"",type:"single",children:(0,t.jsxs)(ej.Item,{value:"query-assistant",children:[(0,t.jsxs)(ej.Trigger,{className:"group flex items-center w-full bg-transparent text-label-14 text-gray-800 font-medium p-0 py-3 gap-3 cursor-pointer",onClick:()=>{f(!g),g||setTimeout(()=>j.current?.focus(),0)},children:[(0,t.jsx)(em.ChevronRight,{className:"transition-transform group-[[data-state=open]]:rotate-90"}),(0,t.jsx)("span",{className:"mr-auto",children:"Query Assistant"}),(0,t.jsx)(X.Kbd,{className:(0,$.cn)("transition-opacity",0!==b.trim().length&&"hidden"),small:!0,children:"/"})]}),(0,t.jsx)(ej.Content,{className:"pb-4",children:(0,t.jsxs)("form",{onSubmit:C,children:[(0,t.jsx)("label",{className:"sr-only",htmlFor:O,children:"Prompt"}),(0,t.jsx)(A.Input,{className:"h-12 rounded-lg",id:O,innerWrapperClassName:(0,$.cn)("bg-background-100 shadow h-12 font-sans text-[14px] relative z-10 border-gray-200 focus:border-gray-600 rounded-lg overflow-hidden m-1","h-10 shadow-border rounded-md",{"bg-gray-100":y}),name:O,disabled:y||n,onChange:e=>{x(e.target.value),k(!1)},placeholder:"Show me requests by host…",prefix:(0,t.jsx)(ep.Sparkles,{size:14}),prefixStyling:!1,ref:j,suffix:(0,t.jsxs)("div",{className:"flex h-full gap-2 !pr-1",children:[T?(0,t.jsx)(w.Button,{"aria-label":"Not what I expected",className:"!px-0",size:"small",type:"secondary",onClickCapture:e=>{e.preventDefault()},onClick:()=>{k(!1),u.analytics.track(c.AnalyticsEvent.QUERY_BUILDER_FEEDBACK,{feedback:"badly-generated-query",plan:m?.billing?.plan??"hobby",prompt:p.current?.prompt??"",generatedQuery:p.current?.query??""}),o.success("Thank you for the feedback!")},children:(0,t.jsxs)("div",{className:"flex items-center gap-0.5 px-0.5 md:px-0",children:[(0,t.jsx)("span",{className:"hidden px-1.5 md:block",children:"Not what I expected"}),(0,t.jsx)(eE.ThumbDown,{})]})}):null,y&&(0,t.jsx)("div",{className:"flex items-center justify-center px-2",children:(0,t.jsx)(eN.Spinner,{size:14})}),(0,t.jsx)(w.Button,{"aria-label":"Build It",className:"!px-0 disabled:hidden",disabled:0===b.trim().length||y,size:"small",typeName:"submit",children:(0,t.jsxs)("div",{className:"flex items-center gap-0.5 px-0.5 md:px-0",children:[(0,t.jsx)("span",{className:"hidden px-1.5 md:block",children:"Generate Query"}),(0,t.jsx)(eT.ArrowRight,{})]})})]}),suffixContainer:!1,suffixStyling:!1,typeName:"text",value:b})]})})]})})}var eO=e.i(962099),eR=e.i(6029070),eM=e.i(5627633),eS=e.i(268049);function eI(e){return{granularity:e,id:(0,eS.milliseconds)(e).toString(),label:(0,eM.formatDuration)(e),type:"string"}}var eA=e.i(6190059),eD=e.i(1283928),eB=e.i(1717203),eP=e.i(9486194),eF=e.i(8690335),eq=e.i(4337458),e_=e.i(9667097),eL=e.i(1233856),ez=e.i(4919835),eQ=e.i(9429462),eU=e.i(7722264),eK=e.i(2107254),e$=e.i(747275);let eG=e=>{let{observabilityConfiguration:t}=(0,h.useHasObservabilityPlus)(),r=(0,s.useTeamSlug)(),{data:i,updateSearch:n,search:l}=(0,eK.default)({limit:10,latestDeployments:null},{},r??void 0);return{decorate:(0,d.useCallback)(async e=>[...e,...i?.projects.map(e=>{let{id:t,name:r}=e;return{id:t,value:t,label:r}})??[]].map(e=>t?.observabilityPlus.excludedProjects?.some(t=>t.id===e.id)?{...e,disabled:!0,tooltip:"Excluded from Observability Plus"}:e),[t,i]),triggerMutation:async e=>{l!==e.text&&n(e.text)},dimensionId:"projectId"}},eV=e=>{let{trigger:t}=(0,eQ.useDeploymentBadgeResolverMutation)(e);return{decorate:(0,d.useCallback)(async e=>{try{let r=await t();return(0,ez.applyBadgesToDeploymentIds)(e,r)}catch{return e}},[t]),triggerMutation:()=>t().catch(()=>{}),dimensionId:"deploymentId"}},eW=e=>{let{event:t,measure:r}=(0,eF.splitEventAndMeasure)(e),i=(0,eq.useSonarQueryScope)(),{hasObservabilityPlusAccess:n}=(0,h.useHasObservabilityPlus)();return{decorate:async(e,l)=>{let{dimension:s,text:a}=l;return i?[...e,...await eY({event:t,measure:r,column:s.id,reason:n?"observability_query_builder_plus":"observability_query_builder_free",text:a,...i})]:[]},dimensionId:null}};async function eY(e){let{event:t,measure:r,column:i,ownerId:n,reason:l,text:s}=e,a={minutes:5},o=(0,eL.startOfDuration)(new Date(Date.now()-36e5),a),u=(0,eL.endOfDuration)(new Date,a),c=eF.labelColumnByColumn.get(i),d=eP.staticDimensionValues.find(e=>e.dimensions.includes(i))?.values,m="number"===eD.AllDimensions[i].type;if(d)return d.map(e=>({id:e.id.toString(),value:e.id,..."label"in e?{label:e.label}:{}})).sort((e,t)=>String(e.id).localeCompare(String(t.id)));let p=s?`contains(${c||i},'${s}')`:void 0;return(await (0,e_.getSonarData)({event:t,scope:{type:"owner",ownerId:n},reason:l,startTime:o,endTime:u,rollups:{value:{measure:r,aggregation:"sum"}},filter:p,granularity:a,groupBy:c?[i,c]:[i],limit:10,tailRollup:"truncate",summaryOnly:!0})).summary.map(e=>{let t=m?Number.parseFloat(e[i]):e[i];return{id:t.toString(),label:c?e[c]:void 0,value:t}})}var eH=e.i(1111237),eJ=e.i(6198010);let eX="!ring-1 ring-gray-400 outline-offset-2 outline-[var(--ds-focus-color)] outline-2 overflow-visible focus:outline";function eZ(e){let{addButtonLabel:r,className:i,dimensions:n,values:l,onChange:s,isLoading:a,disabled:o,id:u}=e,[c,m]=(0,d.useReducer)(e1,{values:l,dimensions:n},e0);(0,d.useEffect)(()=>{m({type:"updateProps",dimensions:n,values:l})},[n,l]);let p=c.values.length>0;return(0,t.jsxs)("fieldset",{id:u,className:(0,$.cn)("flex flex-row flex-wrap items-center gap-2",i),children:[c.values.map((e,r)=>(0,t.jsxs)("span",{className:"flex flex-row",children:[(0,t.jsx)(I.SingleFilterPopoverBox,{className:(0,$.cn)("!p-1",eX,!o&&"!rounded-l"),disabled:o,label:"dimension",onChange:e=>m({type:"change",value:e,index:r,onChange:s}),onOpenChange:e=>m({type:"toggle",open:e,index:r}),open:c.open[r],options:c.remaining,rounded:o,value:e}),o?null:(0,t.jsx)(w.Button,{"aria-label":`Remove ${e.label}`,className:(0,$.cn)("!px-0.5 !text-gray-900 hover:!text-gray-1000",eX),onClick:()=>m({type:"remove",index:r,onChange:s}),size:"small",style:{borderTopLeftRadius:0,borderBottomLeftRadius:0},svgOnly:!0,type:"secondary",typeName:"button",children:(0,t.jsx)(L.CrossSmall,{size:"small"})})]},e.id)),(0,t.jsx)(I.SingleFilterPopoverBox,{className:"border !p-1",isLoading:a,label:"dimension",onChange:e=>m({type:"add",value:e,onChange:s}),onOpenChange:e=>m({type:"toggle",open:e}),open:c.openAdd,options:c.remaining,rounded:!0,children:(0,t.jsx)(w.Button,{"aria-label":"Add dimension",className:"!text-gray-900 data-[state='open']:!bg-gray-100 hover:!text-gray-1000",disabled:o,size:"small",type:"tertiary",...p?{shape:"square",svgOnly:!0,children:(0,t.jsx)(eJ.Plus,{})}:{children:(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)(eJ.Plus,{}),r]})}})})]})}function e0(e){let{values:t,dimensions:r}=e;return{open:Array.from(t,()=>!1),openAdd:!1,values:t,remaining:e2(r,t),allDimensions:r}}function e1(e,t){switch(t.type){case"toggle":if(void 0===t.index)return{...e,openAdd:t.open};return t.index<0||t.index>=e.values.length?{...e}:{...e,open:[...e.open.slice(0,t.index),t.open,...e.open.slice(t.index+1)]};case"updateProps":{let{dimensions:r}=t,i=t.values.filter(e=>{let{id:t}=e;return r.some(e=>e.id===t)});return{...e,remaining:e2(r,i),values:i,allDimensions:r}}case"add":return{...e,...e4(e.allDimensions,[...e.values,t.value],t.onChange)};case"change":{let{index:r,value:i,onChange:n}=t;if(r<0||r>=e.values.length)return e;return{...e,...e4(e.allDimensions,[...e.values.slice(0,r),i,...e.values.slice(r+1)],n)}}case"remove":{let{index:r,onChange:i}=t;return{...e,...e4(e.allDimensions,[...e.values.slice(0,r),...e.values.slice(r+1)],i)}}default:return e}}function e2(e,t){return e.filter(e=>{let{id:r}=e;return!t.some(e=>e.id===r)})}function e4(e,t,r){return setTimeout(()=>r?.(t),0),{open:Array.from(t,()=>!1),openAdd:!1,values:t,remaining:e2(e,t)}}var e6=e.i(8522580),e8=e.i(6982071);e.i(6728635);var e3=e.i(2630141),e9=e.i(5348482);function e5(){let{team:e}=(0,a.useTeam)(),r=(0,e3.useOpenEnableModal)(),[,i]=(0,e9.useQueryBuilderQueryState)(),n=e?.billing?.plan==="hobby"?"Upgrade to Pro":"Get Observability Plus";return(0,t.jsx)(e6.Note,{action:(0,t.jsx)(w.Button,{size:"small",onClick:()=>{u.analytics.track(c.AnalyticsEvent.OBSERVE_FEATURE_SEPARATION,{plan:e?.billing?.plan??"hobby",page:"query-builder",type:"modal_opened"}),r({from:"observability",via:"query-builder",upgradeUseCase:"query-builder"}),i({builder:!1})},children:n}),variant:"contrast",fill:!0,icon:(0,t.jsx)(e8.LockClosedSmall,{}),type:"secondary",className:"!rounded-md !pr-1.5",size:"small",children:(0,t.jsxs)("p",{children:["Read-only mode."," ",(0,t.jsx)("span",{className:"font-medium",children:"Unlock custom queries"})," by upgrading to"," ",e?.billing?.plan==="hobby"?"Pro and Observability Plus":"Observability Plus","."]})})}function e7(e){let{query:r,setQuery:i,Actions:l,Title:s,variables:a,children:o,embedded:u=!0}=e,[c,m]=(0,d.useState)(!1),{hasObservabilityPlusAccess:p}=(0,h.useHasObservabilityPlus)(),g=(0,d.useMemo)(()=>(0,n.replaceVariables)(r,a),[r,a]),{isReady:f}=(0,eA.useAccessibleMetrics)(),b=!f||!p,x=(0,d.useRef)(null),y=(0,d.useCallback)(()=>{x.current&&m(x.current.scrollTop>40)},[]),v=(0,d.useCallback)(()=>{x.current&&x.current.scrollTo({top:0,behavior:"smooth"})},[]);return u?(0,t.jsxs)("div",{ref:x,className:"relative flex flex-1 flex-col overflow-y-auto m-4",onScroll:y,children:[(0,t.jsxs)("div",{className:"sticky left-0 top-0 z-10 pb-3 flex items-center justify-between gap-3 bg-background-100",children:[(0,t.jsx)("div",{className:"flex flex-1 items-center justify-start gap-2",children:s}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(w.Button,{"aria-label":"Scroll to top",onClick:v,type:"tertiary",svgOnly:!0,"aria-hidden":!c,shape:"square",className:(0,$.cn)("transition-all duration-200",c?"opacity-100 translate-y-0":"opacity-0 translate-y-2 pointer-events-none"),tabIndex:c?0:-1,children:(0,t.jsx)(P.ArrowUp,{size:16})}),l]})]}),(0,t.jsx)(tr,{className:"sticky inset-x-0 pt-px",disabled:b,embedded:u,query:r,setQuery:i,variables:a}),(0,t.jsx)(ts,{className:"p-px sticky inset-x-0",disabled:b,query:r,setQuery:i}),(0,t.jsx)(eH.ResultsChart,{query:g,readOnly:b,scrollerRef:u?x:void 0,setQuery:i,showTable:r.by.length>0,sticky:u,variant:"minimal"}),o]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(tr,{disabled:b,embedded:u,query:r,setQuery:i,variables:a}),(0,t.jsxs)("div",{className:"p-4 flex flex-col gap-3 border-1 rounded-md shadow-border bg-background-100",children:[(0,t.jsx)(ts,{disabled:b,query:r,setQuery:i}),(0,t.jsx)(eH.ResultsChart,{query:g,readOnly:b,scrollerRef:u?x:void 0,setQuery:i,showTable:r.by.length>0,sticky:u,variant:"minimal"}),o]})]})}function te(e){let{query:r,setQuery:i,embedded:n}=e,{hasObservabilityPlusAccess:l,ready:s}=(0,h.useHasObservabilityPlus)(),a=(0,d.useMemo)(()=>(0,eF.toSonarQuery)(r),[r]);return!s||l?(0,t.jsx)(eC,{className:n?"bg-background-200 border-0 rounded-md":"rounded-b-md",onGeneratedQuery:i,query:a}):(0,t.jsx)("div",{className:n?"pl-2":"p-4 pt-0",children:(0,t.jsx)(e5,{})})}let tt="flex flex-col md:flex-row gap-3 align-center";function tr(e){let{disabled:r,embedded:i,query:n,setQuery:l,variables:s,className:o}=e,[u,c]=(0,d.useState)(!1),{isReady:m,accessibleDimensions:p,by:g}=(0,eR.useAccessibleDimensions)(n),{accessibleEvents:f}=(()=>{let{can:e}=(0,eB.default)(),{team:t}=(0,a.useTeam)();return t?{isReady:!0,accessibleEvents:eP.queryBuilderEvents.filter(r=>(0,ef.canAccessEvent)({event:r,team:t,can:e})).map(e=>({id:e,label:"label"in eD.AllEvents[e]?eD.AllEvents[e].label:e,type:"string",group:(e=>{switch(e){case"serverlessFunctionInvocation":case"middlewareInvocation":case"outgoingRequest":return"Compute";case"incomingRequest":case"imageTransformation":case"isrOperation":return"Edge Network";case"blockedConnection":case"firewallAction":case"botIdCheck":return"Security";case"aiGatewayRequest":return"AI";case"edgeFunctionInvocation":return"Deprecated";default:return"Other"}})(e)})).toSorted((e,t)=>"Deprecated"===e.group&&"Deprecated"!==t.group?1:"Deprecated"!==e.group&&"Deprecated"===t.group?-1:0)}:{isReady:!1,accessibleEvents:[]}})(),{event:b,measure:x}=(0,eF.splitEventAndMeasure)(n),{accessibleAggregations:y,aggregation:h}=(0,eO.useAccessibleAggregations)(n),v=(e=>{let t,r,i,n=(0,N.useToasts)(),{decorate:l,triggerMutation:s}=(t=[eW,eG,eV].map(t=>t(e)),(r=(0,d.useRef)(t)).current=t,i=e=>r.current.filter(t=>null===t.dimensionId||t.dimensionId===e.dimension.id),{decorate:async(e,t)=>{let r=e;for(let e of i(t))r=await e.decorate(r,t);return r},triggerMutation:e=>Promise.all(i(e).map(t=>t.triggerMutation?.(e)))});return async e=>{let{dimension:t,text:r}=e;try{s({dimension:t,text:r});let e=await l([],{dimension:t,text:r});return(0,e$.default)(e,"id")}catch(e){return n.error(`Error fetching dimension values. ${(0,eU.isError)(e)?e.message:""}`),[]}}})(n);((e,t)=>{let{event:r}=(0,eF.splitEventAndMeasure)(e),i=(0,d.useCallback)((e,t)=>{let r=(0,ef.getGroupableDimensions)(e);return t.filter(e=>r.includes(e))},[]);(0,d.useEffect)(()=>{if(e.by.length>0){let n=i(r,e.by);n.length!==e.by.length&&t({by:n})}},[e.by,t,r,i])})(n,l);let w=(0,d.useMemo)(()=>({dimensions:p,operators:G.operators,resolveValues:v,defaultSingleOperator:G.defaultSingleOperator,defaultMultiOperator:G.defaultMultiOperator,defaultArrayOperator:G.defaultArrayOperator}),[p,v]),j=(0,d.useMemo)(()=>(0,eF.parseFilters)(n.filter),[n.filter]),E=0===j.length&&n.filter,k=(0,d.useCallback)(e=>l({filter:(0,eF.serializeFilters)(e)}),[l]),T=(0,d.useCallback)(e=>{let t=n.view;0===e.length&&t?.type==="table"?t={type:"big-number"}:e.length>0&&t?.type==="big-number"&&(t={type:"table"}),l({by:e.map(e=>{let{id:t}=e;return t}),view:t})},[l,n.view]);return(0,t.jsxs)("div",{className:(0,$.cn)("flex flex-col bg-background-100 mb-3",!i&&"shadow-border rounded-md",o),children:[(0,t.jsxs)("div",{className:(0,$.cn)("flex flex-col flex-1 gap-3",i?"p-2 pt-0 pb-4":"p-4 pb-3"),children:[(0,t.jsxs)("div",{className:tt,children:[(0,t.jsx)(tn,{htmlFor:"event-metric",className:ti,children:"Metric"}),(0,t.jsxs)("div",{className:"flex flex-col flex-wrap md:flex-row gap-2 flex-1 [&>:nth-child(2)]:mr-auto",children:[(0,t.jsx)(ew,{disabled:r,selectedEventId:b,selectedMetricId:x,events:f,onSelect:(e,t)=>{l({metric:`${e}.${t}`,aggregation:function(e){let t=eD.AllMeasures[e];if(!t)return"sum";let{unit:r,aggregations:i}=t;switch(r){case"count":return i.includes("sum")?"sum":i[0];case"milliseconds":case"seconds":case"bytes":case"megabytes":case"gigabyte_hour":case"ratio":case"percent":return i.includes("avg")?"avg":i[0];default:return i[0]}}(t)})}}),(0,t.jsx)(I.SingleFilterPopoverBox,{id:"aggregation",className:"!px-2 !py-4",disabled:r,label:"aggregation",onChange:e=>{l({aggregation:e.id}),c(!1)},onOpenChange:c,open:u,options:y,rounded:!0,suffix:(0,t.jsx)(q.ChevronUpDown,{color:"gray-800"}),value:h}),(0,t.jsx)(J,{disabled:r,value:n.time,onChange:e=>l({time:e}),trackEvents:!0,variables:s})]})]}),(0,t.jsxs)("div",{className:tt,children:[(0,t.jsx)(tn,{htmlFor:"by",className:ti,children:"Group By"}),(0,t.jsx)("div",{className:"flex-1",children:m?(0,t.jsx)(eZ,{addButtonLabel:"Add",id:"by",dimensions:p,disabled:r,isLoading:!m,onChange:T,values:g}):(0,t.jsx)(D.Skeleton,{height:32,width:100})})]}),E?(0,t.jsx)(tl,{setQuery:l,query:n}):(0,t.jsxs)("div",{className:tt,children:[(0,t.jsx)(tn,{htmlFor:"filter",className:ti,children:"Filter"}),(0,t.jsx)("div",{className:"flex-1",children:m?(0,t.jsx)(S.FilterBar,{config:w,disabled:r,filters:j,onChange:k}):(0,t.jsx)(D.Skeleton,{height:32,width:200})})]})]}),(0,t.jsx)(te,{embedded:i,query:n,setQuery:l})]})}let ti="md:w-16 md:shrink-0 md:pt-1.5";function tn(e){let{children:r,className:i,htmlFor:n,...l}=e;return(0,t.jsx)("label",{className:(0,$.cn)("text-sm font-medium text-gray-800",i),htmlFor:n,...l,children:r})}function tl(e){let{setQuery:r,query:i}=e;return(0,t.jsxs)("div",{className:"flex w-full flex-row items-center gap-2 py-2 col-span-2",children:[(0,t.jsx)(j.Tooltip,{text:"Invalid or unsupported filter saved",children:(0,t.jsx)(K.Question,{size:16})}),(0,t.jsxs)("div",{className:"flex w-full flex-row items-center",children:[(0,t.jsx)(j.Tooltip,{className:"w-full",text:i.filter,children:(0,t.jsx)("div",{className:"w-full",children:(0,t.jsx)(A.Input,{"aria-label":"Invalid or unsupported filter saved",className:"w-full overflow-visible outline-2 outline-offset-2 outline-[var(--ds-focus-color)] !ring-1 ring-gray-400 focus:outline",disabled:!0,style:{borderTopRightRadius:0,borderBottomRightRadius:0},value:i.filter})})}),(0,t.jsx)(w.Button,{"aria-label":"Clear filter",className:"overflow-visible !border-l-0 outline-2 outline-offset-2 outline-[var(--ds-focus-color)] !ring-1 ring-gray-400 focus:outline",onClick:()=>r({filter:""}),size:"medium",style:{borderTopLeftRadius:0,borderBottomLeftRadius:0},svgOnly:!0,type:"secondary",children:(0,t.jsx)(L.CrossSmall,{size:20})})]})]})}function ts(e){let r,i,n,l,{className:s,query:a,setQuery:o,disabled:u}=e,[c,m]=(0,d.useState)(!1),{accessibleGranularities:p,granularity:g}=(r=(0,d.useMemo)(()=>{let{start:e,end:t}=(0,f.fromTimeToRange)(a.time);return Math.round(t.getTime()-e.getTime())},[a.time]),i=(0,d.useMemo)(()=>(0,f.getGranularityFromDuration)(r),[r]),n=(0,d.useMemo)(()=>{let e=[],t=(0,eS.milliseconds)(i);for(let i of f.preferredGranularities){let n=(0,eS.milliseconds)(i);n>=t&&n<=r&&e.push(eI(i))}return e},[i,r]),l=(0,d.useMemo)(()=>n.find(e=>{let{id:t}=e;return t===(0,eS.milliseconds)(a.granularity??{}).toString()})??eI(i),[i,n,a.granularity]),{accessibleGranularities:n,granularity:l});return(0,t.jsxs)("div",{className:(0,$.cn)("flex flex-wrap gap-2 items-center justify-end",s),children:[(0,t.jsx)(I.SingleFilterPopoverBox,{id:"granularity",disabled:u,label:"granularity",onChange:e=>{let{granularity:t}=e;o({granularity:t}),m(!1)},onOpenChange:m,open:c,options:p,prefix:(0,t.jsx)(_.Clock,{color:"gray-900"}),rounded:!0,suffix:(0,t.jsx)(q.ChevronUpDown,{color:"gray-800"}),value:g}),(0,t.jsx)(to,{query:a,onChange:e=>o({view:e})})]})}let ta=[{type:"line",icon:(0,t.jsx)(z.LineChart,{})},{type:"area",icon:(0,t.jsx)(F.BarChart,{})},{type:"table",icon:(0,t.jsx)(Q.MenuAlt,{}),isDisabled:e=>(e?.by.length??0)===0?"Add a Group By clause to view results in a Table.":null},{type:"big-number",icon:(0,t.jsx)(U.Percentage,{}),isDisabled:e=>(e?.by.length??0)>=1?"Remove your Group By clause to view results as a number.":null}];function to(e){let{query:r,onChange:i}=e,n=ta.filter(e=>{let{isDisabled:t}=e;return!t?.(r)});return(0,t.jsx)(B.Switch,{name:"view",size:"small",children:n.map(e=>{let{type:n,icon:l}=e;return(0,t.jsx)(B.Switch.Control,{checked:(r?.view?.type??"line")===n,icon:l,value:n,onChange:()=>i({type:n})},n)})})}e.s(["QueryBuilder",()=>e7],1135066)}]);

//# sourceMappingURL=c5a00df4902923e5.js.map
//# debugId=c9f8b638-1ed2-5990-b9b3-c817a668cca9
